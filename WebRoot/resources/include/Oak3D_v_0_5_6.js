(function(k){var c={ArrayBuffer:typeof ArrayBuffer!=="undefined",DataView:typeof DataView!=="undefined"&&"getFloat64" in DataView.prototype,NodeBuffer:typeof Buffer!=="undefined",NodeBufferFull:typeof Buffer!=="undefined"&&"readInt8LE" in Buffer,NodeBufferEndian:typeof Buffer!=="undefined"&&"readInt8" in Buffer};var e=function(l,o,m,p){if(!(this instanceof arguments.callee)){throw new Error("Constructor may not be called as a function")}this.buffer=l;if(!(c.NodeBuffer&&l instanceof Buffer)&&!(c.ArrayBuffer&&l instanceof ArrayBuffer)&&typeof l!=="string"){throw new TypeError("Type error")}this._isArrayBuffer=c.ArrayBuffer&&l instanceof ArrayBuffer;this._isDataView=c.DataView&&this._isArrayBuffer;this._isNodeBuffer=c.NodeBuffer&&l instanceof Buffer;this._littleEndian=p===undefined?true:p;var n=this._isArrayBuffer?l.byteLength:l.length;if(o===undefined){o=0}this.byteOffset=o;if(m===undefined){m=n-o}this.byteLength=m;if(!this._isDataView){if(typeof o!=="number"){throw new TypeError("Type error")}if(typeof m!=="number"){throw new TypeError("Type error")}if(typeof o<0){throw new Error("INDEX_SIZE_ERR: DOM Exception 1")}if(typeof m<0){throw new Error("INDEX_SIZE_ERR: DOM Exception 1")}}if(this._isDataView){this._view=new DataView(l,o,m);this._start=0}this._start=o;if(o+m>n){throw new Error("INDEX_SIZE_ERR: DOM Exception 1")}this._offset=0};e.createBuffer=function(){if(c.NodeBuffer){var m=new Buffer(arguments.length);for(var n=0;n<arguments.length;++n){m[n]=arguments[n]}return m}if(c.ArrayBuffer){var m=new ArrayBuffer(arguments.length);var l=new Int8Array(m);for(var n=0;n<arguments.length;++n){l[n]=arguments[n]}return m}return String.fromCharCode.apply(null,arguments)};e.prototype={getString:function(o,n){var p;if(n===undefined){n=this._offset}if(typeof n!=="number"){throw new TypeError("Type error")}if(o<0||n+o>this.byteLength){throw new Error("INDEX_SIZE_ERR: DOM Exception 1")}if(this._isNodeBuffer){p=this.buffer.toString("ascii",this._start+n,this._start+n+o)}else{p="";for(var l=0;l<o;++l){var m=this.getUint8(n+l);p+=String.fromCharCode(m>127?65533:m)}}this._offset=n+o;return p},getChar:function(l){return this.getString(1,l)},tell:function(){return this._offset},seek:function(l){if(typeof l!=="number"){throw new TypeError("Type error")}if(l<0||l>this.byteLength){throw new Error("INDEX_SIZE_ERR: DOM Exception 1")}return this._offset=l},_endianness:function(m,o,l,n){return m+(n?l-o-1:o)},_getFloat32:function(n,l){var u=this._getUint8(this._endianness(n,0,4,l)),t=this._getUint8(this._endianness(n,1,4,l)),s=this._getUint8(this._endianness(n,2,4,l)),p=this._getUint8(this._endianness(n,3,4,l)),o=1-(2*(u>>7)),q=(((u<<1)&255)|(t>>7))-127,m=((t&127)<<16)|(s<<8)|p;if(q===128){if(m!==0){return NaN}else{return o*Infinity}}if(q===-127){return o*m*Math.pow(2,-126-23)}return o*(1+m*Math.pow(2,-23))*Math.pow(2,q)},_getInt32:function(m,n){var l=this._getUint32(m,n);return l>Math.pow(2,31)-1?l-Math.pow(2,32):l},_getUint32:function(p,q){var l=this._getUint8(this._endianness(p,0,4,q)),m=this._getUint8(this._endianness(p,1,4,q)),n=this._getUint8(this._endianness(p,2,4,q)),o=this._getUint8(this._endianness(p,3,4,q));return(l*Math.pow(2,24))+(m<<16)+(n<<8)+o},_getInt16:function(m,n){var l=this._getUint16(m,n);return l>Math.pow(2,15)-1?l-Math.pow(2,16):l},_getUint16:function(n,o){var l=this._getUint8(this._endianness(n,0,2,o)),m=this._getUint8(this._endianness(n,1,2,o));return(l<<8)+m},_getInt8:function(m){var l=this._getUint8(m);return l>Math.pow(2,7)-1?l-Math.pow(2,8):l},_getUint8:function(l){if(this._isArrayBuffer){return new Uint8Array(this.buffer,l,1)[0]}else{if(this._isNodeBuffer){return this.buffer[l]}else{return this.buffer.charCodeAt(l)&255}}}};var h={Int8:1,Int16:2,Int32:4,Uint8:1,Uint16:2,Uint32:4,Float32:4,Float64:8};var d={Int8:"Int8",Int16:"Int16",Int32:"Int32",Uint8:"UInt8",Uint16:"UInt16",Uint32:"UInt32",Float32:"Float",Float64:"Double"};for(var f in h){if(!h.hasOwnProperty(f)){continue}(function(m){var l=h[m];e.prototype["get"+m]=function(n,p){var o;if(p===undefined){p=this._littleEndian}if(n===undefined){n=this._offset}if(this._isDataView){o=this._view["get"+m](n,p)}else{if(this._isArrayBuffer&&(this._start+n)%l===0&&(l===1||p)){o=new k[m+"Array"](this.buffer,this._start+n,1)[0]}else{if(this._isNodeBuffer&&c.NodeBufferFull){if(p){o=this.buffer["read"+d[m]+"LE"](this._start+n)}else{o=this.buffer["read"+d[m]+"BE"](this._start+n)}}else{if(this._isNodeBuffer&&c.NodeBufferEndian){o=this.buffer["read"+d[m]](this._start+n,p)}else{if(typeof n!=="number"){throw new TypeError("Type error")}if(n+l>this.byteLength){throw new Error("INDEX_SIZE_ERR: DOM Exception 1")}o=this["_get"+m](this._start+n,p)}}}}this._offset=n+l;return o}})(f)}if(typeof jQuery!=="undefined"&&jQuery.fn.jquery>="1.6.2"){var a=function(m){var o;try{o=IEBinaryToArray_ByteStr(m)}catch(t){var n="Function IEBinaryToArray_ByteStr(Binary)\r\n	IEBinaryToArray_ByteStr = CStr(Binary)\r\nEnd Function\r\nFunction IEBinaryToArray_ByteStr_Last(Binary)\r\n	Dim lastIndex\r\n	lastIndex = LenB(Binary)\r\n	if lastIndex mod 2 Then\r\n		IEBinaryToArray_ByteStr_Last = AscB( MidB( Binary, lastIndex, 1 ) )\r\n	Else\r\n		IEBinaryToArray_ByteStr_Last = -1\r\n	End If\r\nEnd Function\r\n";window.execScript(n,"vbscript");o=IEBinaryToArray_ByteStr(m)}var q=IEBinaryToArray_ByteStr_Last(m),v="",s=0,p=o.length%8,u;while(s<p){u=o.charCodeAt(s++);v+=String.fromCharCode(u&255,u>>8)}p=o.length;while(s<p){v+=String.fromCharCode((u=o.charCodeAt(s++),u&255),u>>8,(u=o.charCodeAt(s++),u&255),u>>8,(u=o.charCodeAt(s++),u&255),u>>8,(u=o.charCodeAt(s++),u&255),u>>8,(u=o.charCodeAt(s++),u&255),u>>8,(u=o.charCodeAt(s++),u&255),u>>8,(u=o.charCodeAt(s++),u&255),u>>8,(u=o.charCodeAt(s++),u&255),u>>8)}if(q>-1){v+=String.fromCharCode(q)}return v};jQuery.ajaxSetup({converters:{"* dataview":function(l){return new e(l)}},accepts:{dataview:"text/plain; charset=x-user-defined"},responseHandler:{dataview:function(m,l,n){if("mozResponseArrayBuffer" in n){m.text=n.mozResponseArrayBuffer}else{if("responseType" in n&&n.responseType==="arraybuffer"&&n.response){m.text=n.response}else{if("responseBody" in n){m.text=a(n.responseBody)}else{m.text=n.responseText}}}}}});jQuery.ajaxPrefilter("dataview",function(l,n,m){if(jQuery.support.ajaxResponseType){if(!l.hasOwnProperty("xhrFields")){l.xhrFields={}}l.xhrFields.responseType="arraybuffer"}l.mimeType="text/plain; charset=x-user-defined"})}k.jDataView=(k.module||{}).exports=e})(this);var OAK={ERROR:0,TYPE_VEC2:1,TYPE_VEC3:2,TYPE_VEC4:4,TYPE_MAT4:8,TYPE_MAT43:16,AXIS_X:1,AXIS_Y:2,AXIS_Z:3,COLLIDE_FALSE:0,COLLIDE_TRUE:1,COLLIDE_CONTAIN:2,SPACE_LOCAL:1,SPACE_PARENT:2,SPACE_WORLD:3,SPACE_VIEW:4,BBOX_AABB:1,BBOX_OBB:2,FLOAT_PRECISION:0.000001,PROJMODE_PERSPECTIVE:1,PROJMODE_ORTHO:2,PROJMODE_ORTHO_NORMALIZED:3,PROJMODE_ORTHO_PIXEL:4,FTPLANE_NEAR:0,FTPLANE_FAR:1,FTPLANE_LEFT:2,FTPLANE_RIGHT:3,FTPLANE_TOP:4,FTPLANE_BOTTOM:5,SKBLEND_ACCUMULATE:1,SKBLEND_LERP:2,BLENDCHANNEL_COLOR:1,BLENDCHANNEL_ALPHA:2,BLENDCHANNEL_ALL:3,MCUSAGE_ALBEDO1:0,MCUSAGE_ALBEDO2:1,MCUSAGE_ALBEDO3:2,MCUSAGE_ALBEDO4:3,MCUSAGE_NORMAL:4,MCUSAGE_OPACITY:5,MCUSAGE_SPECULAR_LEVEL:6,ETYPE_UNKNOWN:0,ETYPE_STATIC:1,ETYPE_DYNAMIC:2,ETYPE_DCT_LIGHT:4,ETYPE_POINT_LIGHT:8,ETYPE_SPOT_LIGHT:16,ETYPE_TERRAIN:32,ETYPE_CUSTOM_MESH:64,ETYPE_VIDEO:128,ETYPE_PARTICLE:256,ETYPE_CONFIG:512,ETYPE_LIGHT:(4|8|16),ETYPE_VISIBLE:(1|2|32|64|128|256),ETYPE_INTREE:(1|2|32|64|128|256),ETYPE_UPDATE:(2|256),ETYPE_ALL:4294967295,ESTATE_UNAVAILABLE:1,ESTATE_BASIC_AVAILABLE:2,ESTATE_COMPLETE_AVAILABLE:4,RESDOCTYPE_XML:1,RESDOCTYPE_JSON:2,RESDOCTYPE_BINARY:3,RESTYPE_UNKNOWN:0,RESTYPE_MODEL:1,RESTYPE_TEXTURE:2,RESTYPE_SKANIMATION:3,RESSTATE_NONE:1,RESSTATE_UNLOAD:2,RESSTATE_LOADING:3,RESSTATE_LOADED:4,RESSTATE_READY:5,RESPRIORITY_HIGH:1,RESPRIORITY_NORMAL:2,RESPRIORITY_LOW:3,LIGHTGROUP_1:1,LIGHTGROUP_2:2,LIGHTGROUP_3:3,LIGHTGROUP_4:4,LIGHTGROUP_5:5,LIGHTGROUP_6:6,LIGHTGROUP_7:7,LIGHTGROUP_8:8,LIGHTGROUP_9:9,LIGHTGROUP_10:10,LIGHTGROUP_11:11,LIGHTGROUP_12:12,LIGHTGROUP_13:13,LIGHTGROUP_14:14,LIGHTGROUP_15:15,LIGHTGROUP_16:16,ENV_FOG1:1,RSTAGE_DEPTH:0,RSTAGE_SHADOW:1,RSTAGE_LIGHTING:2,WORLDMAP_NOT_READ:1,WORLDMAP_PARSING:2,WORLDMAP_PARSED:3,TEXTURE_IMAGE:1,TEXTURE_VIDEO:2,PARTIME_BEGIN:1,PARTIME_END:2,PARTIME_ALL:4294967295};var tempCanvas=document.createElement("canvas");if(tempCanvas){tempCanvas.width=32;tempCanvas.height=32;if(tempCanvas.getContext){var tempRc=tempCanvas.getContext("webgl");if(tempRc==null){tempRc=tempCanvas.getContext("experimental-webgl")}if(tempRc){for(var $56 in tempRc){if($56.toUpperCase()==$56){OAK[$56]=tempRc[$56]}}}}}function okIsSupportWebGL(){if(OAK.__SUPPORT_WEBGL){return OAK.__SUPPORT_WEBGL}var c=document.createElement("canvas");if(c==null){OAK.__SUPPORT_WEBGL=false;return false}c.width=32;c.height=32;if(c.getContext==null){OAK.__SUPPORT_WEBGL=false;return false}var a=c.getContext("experimental-webgl");if(a==null){a=c.getContext("webgl")}if(a==null){OAK.__SUPPORT_WEBGL=false}else{OAK.__SUPPORT_WEBGL=true}return OAK.__SUPPORT_WEBGL}function okIsIE(){return navigator.appName=="Microsoft Internet Explorer"}function okGetGLError(d){var c=d.getError();if(c==0){return null}for(var a in d){if(d[a]==c){return a}}}function okGetGLEnumName(d,c){for(var a in d){if(d[a]==c){return a}}return null}function okGenCanvas(c,e,d,f){var a;if(okIsIE()){a=document.createElement("object");a.width=c;a.height=e;if(f){a.id=f}if(d){d.appendChild(a)}else{document.body.appendChild(a)}a.type="application/x-webgl"}else{a=document.createElement("canvas");a.width=c;a.height=e;if(f){a.id=f}if(d){d.appendChild(a)}else{document.body.appendChild(a)}}return a}var okRequestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(a){setTimeout(a,1000/60)};function okExtension(f){var e=f.getSupportedExtensions();for(var d=0;d<e.length;++d){var c=e[d];var a=f.getExtension(c);this[c]=a}}function okIsUndefined(a){return typeof a=="undefined"}function okIsString(a){return typeof a=="string"}function okIsElement(a){return a&&a.nodeType==1}function okIsFunction(a){return typeof a=="function"}function okIsObject(a){return typeof a=="object"}function okIsArray(a){return Object.prototype.toString.call(a)==="[object Array]"}function okIsNumber(a){return typeof a=="number"}function okIsBoolean(a){return typeof a=="boolean"}function okIsInt(a){if(parseInt(a)==a){return true}return false}function okFileFilter(c){var a=c.lastIndexOf(".");return c.substring(a+1,c.length)}function okLog(d,c,a){window.console.log((c?("["+c+"]"):"")+d);if(a){alert("[Oak Debug Stop]")}}function okGenQuadMesh(e,p,d,s,o,k,c){var n=[p,d,0,p,o,0,s,o,0,s,d,0];var a=[0,0,1,0,0,1,0,0,1,0,0,1];var h=c?[0,1,0,0,1,0,1,1]:[0,0,0,1,1,1,1,0];var f=[0,1,2,0,2,3];e.createAttribute("Position",n.length,n);e.createAttribute("Normal",a.length,a);e.createAttribute("Texcoord1",h.length,h);e.createIndex("Default",f.length,f,35044,4);e.setVertexNum(4);e.computeBoundingInfo();if(k){var m=new Array;var q=f.length/3;for(var l=0;l<q;++l){m.push(f[l*3],f[l*3+1]);m.push(f[l*3+1],f[l*3+2]);m.push(f[l*3+2],f[l*3])}e.createIndex("Wireframe",m.length,m,35044,1)}return e}function okGenBoxMesh(c,m,o,e){var l=[m.x,m.y,m.z,m.x,m.y,o.z,m.x,o.y,o.z,m.x,o.y,m.z,o.x,m.y,m.z,o.x,o.y,m.z,o.x,o.y,o.z,o.x,m.y,o.z,m.x,o.y,m.z,m.x,o.y,o.z,o.x,o.y,o.z,o.x,o.y,m.z,m.x,m.y,m.z,o.x,m.y,m.z,o.x,m.y,o.z,m.x,m.y,o.z,m.x,o.y,o.z,m.x,m.y,o.z,o.x,m.y,o.z,o.x,o.y,o.z,m.x,o.y,m.z,o.x,o.y,m.z,o.x,m.y,m.z,m.x,m.y,m.z];var a=[-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1];var d=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];var f=[1/4,2/3,1/4,1/3,0,1/3,0,2/3,2/4,2/3,3/4,2/3,3/4,1/3,2/4,1/3,4/4,2/3,4/4,1/3,3/4,1/3,3/4,2/3,1/4,2/3,2/4,2/3,2/4,1/3,1/4,1/3,1/4,0,1/4,1/3,2/4,1/3,2/4,0,1/4,3/3,2/4,3/3,2/4,2/3,1/4,2/3];c.createAttribute("Position",l.length,l);c.createAttribute("Normal",a.length,a);c.createAttribute("Texcoord1",f.length,f);c.createIndex("Default",d.length,d,35044,4);c.setVertexNum(24);c.computeBoundingInfo();if(e){var k=new Array;var n=d.length/3;for(var h=0;h<n;++h){k.push(d[h*3],d[h*3+1]);k.push(d[h*3+1],d[h*3+2]);k.push(d[h*3+2],d[h*3])}c.createIndex("Wireframe",k.length,k,35044,1)}return c}function okGenSphereMesh(f,u,a,C,A){var w=new Array;w.push(0,u,0);for(var s=1;s<C;++s){var I=Math.sin(Math.PI/C*s)*u;var o=Math.cos(Math.PI/C*s)*u;for(var F=0;F<a;++F){var p=Math.sin(Math.PI*2/a*F)*I;var n=Math.cos(Math.PI*2/a*F)*I;w.push(p,o,n)}}w.push(0,-u,0);var q=new Array;var e=new Array;for(var E=0;E<w.length/3;++E){var d=okA.vec3();d.x=w[E*3];d.y=w[E*3+1];d.z=w[E*3+2];d.normalize(true);q.push(d.x,d.y,d.z);e.push(Math.asin(d.x)/Math.PI+0.5,Math.asin(d.y)/Math.PI+0.5);okA._vec3(d)}var c=new Array;for(var F=0;F<a;++F){c.push(0,1+(F%a),1+((F+1)%a))}for(var s=1;s<C-1;++s){for(var F=0;F<a;++F){var t=1+(s-1)*a;var H=1+s*a;var m=t+(F%a),k=t+((F+1)%a);var D=H+(F%a),B=H+((F+1)%a);c.push(m,D,B);c.push(B,k,m)}}for(var F=0;F<a;++F){c.push(w.length/3-1,1+(C-2)*a+((F+1)%a),1+(C-2)*a+(F%a))}f.createAttribute("Position",w.length,w);f.createAttribute("Normal",q.length,q);f.createAttribute("Texcoord1",e.length,e);f.createIndex("Default",c.length,c,35044,4);f.setVertexNum(w.length/3);f.computeBoundingInfo();if(A){var l=new Array;var G=c.length/3;for(var E=0;E<G;++E){l.push(c[E*3],c[E*3+1]);l.push(c[E*3+1],c[E*3+2]);l.push(c[E*3+2],c[E*3])}f.createIndex("Wireframe",l.length,l,35044,1)}return f}function okGenColumnMesh(d,p,C,w,t){var q=new Array;var c=new Array;q.push(0,C*0.5,0);c.push(1/8,1/8);for(var A=0;A<w;++A){var m=Math.sin(Math.PI*2/w*A)*p;var k=Math.cos(Math.PI*2/w*A)*p;q.push(m,C*0.5,k);c.push(Math.sin(Math.PI*2/w*A)/8+1/8,1/8-Math.cos(Math.PI*2/w*A)/8)}q.push(0,-C*0.5,0);c.push(1/8,5/8);for(var A=0;A<w;++A){var m=Math.sin(Math.PI*2/w*A)*p;var k=Math.cos(Math.PI*2/w*A)*p;q.push(m,-C*0.5,k);c.push(Math.sin(Math.PI*2/w*A)/8+1/8,5/8-Math.cos(Math.PI*2/w*A)/8)}for(var A=0;A<w;++A){var m=Math.sin(Math.PI*2/w*A)*p;var k=Math.cos(Math.PI*2/w*A)*p;q.push(m,C*0.5,k);c.push(A/(2*w)+0.5,0)}for(var A=0;A<w;++A){var m=Math.sin(Math.PI*2/w*A)*p;var k=Math.cos(Math.PI*2/w*A)*p;q.push(m,-C*0.5,k);c.push(A/(2*w)+0.5,1)}var o=new Array;for(var y=0;y<w+1;++y){o.push(0,1,0)}for(var y=0;y<w+1;++y){o.push(0,-1,0)}for(var y=0;y<w;++y){var s=okA.vec3();s.set(q[(w*2+2)*3+y*3],0,q[(w*2+2)*3+y*3+2]);s.normalize(true);o.push(s.x,s.y,s.z);okA._vec3(s)}for(var y=0;y<w;++y){var s=okA.vec3();s.set(q[(w*3+2)*3+y*3],0,q[(w*3+2)*3+y*3+2]);s.normalize(true);o.push(s.x,s.y,s.z);okA._vec3(s)}var a=new Array;for(var A=0;A<w;++A){a.push(0,1+(A%w),1+((A+1)%w))}for(var A=0;A<w;++A){a.push(w+1,w+2+((A+1)%w),w+2+(A%w))}for(var A=0;A<w;++A){var l=w*2+2+A,e=w*2+2+(A+1)%w;var v=w*3+2+A,u=w*3+2+(A+1)%w;a.push(l,v,u);a.push(u,e,l)}d.createAttribute("Position",q.length,q);d.createAttribute("Normal",o.length,o);d.createAttribute("Texcoord1",c.length,c);d.createIndex("Default",a.length,a,35044,4);d.setVertexNum(q.length/3);d.computeBoundingInfo();if(t){var f=new Array;var B=a.length/3;for(var y=0;y<B;++y){f.push(a[y*3],a[y*3+1]);f.push(a[y*3+1],a[y*3+2]);f.push(a[y*3+2],a[y*3])}d.createIndex("Wireframe",f.length,f,35044,1)}return d}function okGenTaperMesh(l,t,E,A,y){var v=new Array;var k=new Array;v.push(0,-E*0.5,0);k.push(1/8,1/8);for(var C=0;C<A;++C){var p=Math.sin(Math.PI*2/A*C)*t;var o=Math.cos(Math.PI*2/A*C)*t;v.push(p,-E*0.5,o);k.push(Math.sin(Math.PI*2/A*C)/8+1/8,1/8-Math.cos(Math.PI*2/A*C)/8)}v.push(0,E*0.5,0);k.push(3/4,1/4);var c=Math.sqrt(t*t+E*E);for(var C=0;C<A;++C){var p=Math.sin(Math.PI*2/A*C)*t;var o=Math.cos(Math.PI*2/A*C)*t;v.push(p,-E*0.5,o);k.push(3/4+Math.sin(Math.PI*2/A*C*t/c)/4,1/4-Math.cos(Math.PI*2/A*C*t/c)/4)}var q=new Array;for(var B=0;B<A+1;++B){q.push(0,-1,0)}q.push(0,1,0);for(var B=0;B<A;++B){q.push(0,0,0)}for(var B=0;B<A;++B){var f=new okVec3(v[(A+1)*3],v[(A+1)*3+1],v[(A+1)*3+2]);var e=new okVec3(v[(A+2)*3+B*3],v[(A+2)*3+B*3+1],v[(A+2)*3+B*3+2]);var d=new okVec3(v[(A+2)*3+((B+1)%A)*3],v[(A+2)*3+((B+1)%A)*3+1],v[(A+2)*3+((B+1)%A)*3+2]);var u=okVec3Sub(e,f);var s=okVec3Sub(d,f);var w=okVec3Cross(u,s);w=w.normalize();q[(A+2)*3+B*3]+=w.x;q[(A+2)*3+B*3+1]+=w.y;q[(A+2)*3+B*3+2]+=w.z;q[(A+2)*3+((B+1)%A)*3]+=w.x;q[(A+2)*3+((B+1)%A)*3+1]+=w.y;q[(A+2)*3+((B+1)%A)*3+2]+=w.z}for(var B=0;B<A;++B){var w=new okVec3(q[(A+2)*3+B*3],q[(A+2)*3+B*3+1],q[(A+2)*3+B*3+2]);w=w.normalize();q[(A+2)*3+B*3]=w.x;q[(A+2)*3+B*3+1]=w.y;q[(A+2)*3+B*3+2]=w.z}var a=new Array;for(var C=0;C<A;++C){a.push(0,1+((C+1)%A),1+C)}for(var C=0;C<A;++C){a.push(A+1,A+2+C,A+2+(C+1)%A)}l.createAttribute("Position",v.length,v);l.createAttribute("Normal",q.length,q);l.createAttribute("Texcoord1",k.length,k);l.createIndex("Default",a.length,a,35044,4);l.setVertexNum(v.length/3);l.computeBoundingInfo();if(y){var m=new Array;var D=a.length/3;for(var B=0;B<D;++B){m.push(a[B*3],a[B*3+1]);m.push(a[B*3+1],a[B*3+2]);m.push(a[B*3+2],a[B*3])}l.createIndex("Wireframe",m.length,m,35044,1)}return l}function okGenFrustumMesh(c,p,f){var o=new Array;for(var h=0;h<8;++h){o.push(p.getPoint(h))}var l=new Array;l.push(o[0].x,o[0].y,o[0].z);l.push(o[1].x,o[1].y,o[1].z);l.push(o[2].x,o[2].y,o[2].z);l.push(o[3].x,o[3].y,o[3].z);l.push(o[5].x,o[5].y,o[5].z);l.push(o[4].x,o[4].y,o[4].z);l.push(o[7].x,o[7].y,o[7].z);l.push(o[6].x,o[6].y,o[6].z);l.push(o[1].x,o[1].y,o[1].z);l.push(o[5].x,o[5].y,o[5].z);l.push(o[6].x,o[6].y,o[6].z);l.push(o[2].x,o[2].y,o[2].z);l.push(o[4].x,o[4].y,o[4].z);l.push(o[0].x,o[0].y,o[0].z);l.push(o[3].x,o[3].y,o[3].z);l.push(o[7].x,o[7].y,o[7].z);l.push(o[3].x,o[3].y,o[3].z);l.push(o[2].x,o[2].y,o[2].z);l.push(o[6].x,o[6].y,o[6].z);l.push(o[7].x,o[7].y,o[7].z);l.push(o[1].x,o[1].y,o[1].z);l.push(o[0].x,o[0].y,o[0].z);l.push(o[4].x,o[4].y,o[4].z);l.push(o[5].x,o[5].y,o[5].z);var a=new Array;var e=okVec3Cross(okVec3Sub(o[1],o[0]),okVec3Sub(o[3],o[0])).normalize();a.push(e.x,e.y,e.z);a.push(e.x,e.y,e.z);a.push(e.x,e.y,e.z);a.push(e.x,e.y,e.z);e=okVec3Cross(okVec3Sub(o[4],o[5]),okVec3Sub(o[6],o[5])).normalize();a.push(e.x,e.y,e.z);a.push(e.x,e.y,e.z);a.push(e.x,e.y,e.z);a.push(e.x,e.y,e.z);e=okVec3Cross(okVec3Sub(o[5],o[1]),okVec3Sub(o[2],o[1])).normalize();a.push(e.x,e.y,e.z);a.push(e.x,e.y,e.z);a.push(e.x,e.y,e.z);a.push(e.x,e.y,e.z);e=okVec3Cross(okVec3Sub(o[0],o[4]),okVec3Sub(o[7],o[4])).normalize();a.push(e.x,e.y,e.z);a.push(e.x,e.y,e.z);a.push(e.x,e.y,e.z);a.push(e.x,e.y,e.z);e=okVec3Cross(okVec3Sub(o[2],o[3]),okVec3Sub(o[7],o[3])).normalize();a.push(e.x,e.y,e.z);a.push(e.x,e.y,e.z);a.push(e.x,e.y,e.z);a.push(e.x,e.y,e.z);e=okVec3Cross(okVec3Sub(o[0],o[1]),okVec3Sub(o[5],o[1])).normalize();a.push(e.x,e.y,e.z);a.push(e.x,e.y,e.z);a.push(e.x,e.y,e.z);a.push(e.x,e.y,e.z);var d=new Array;d.push(0,1,2,0,2,3);d.push(4,5,6,4,6,7);d.push(8,9,10,8,10,11);d.push(12,13,14,12,14,15);d.push(16,17,18,16,18,19);d.push(20,21,22,20,22,23);c.createAttribute("Position",l.length,l);c.createAttribute("Normal",a.length,a);c.createIndex("Default",d.length,d,35044,4);c.setVertexNum(l.length/3);c.computeBoundingInfo();if(f){var k=new Array;var m=d.length/3;for(var h=0;h<m;++h){k.push(d[h*3],d[h*3+1]);k.push(d[h*3+1],d[h*3+2]);k.push(d[h*3+2],d[h*3])}c.createIndex("Wireframe",k.length,k,35044,1)}return c}function okCollection(){this.$s=new Array;this.$f4=-1;this.$e4=0;this.$t4=0}okCollection.prototype={clear:function(){this.$s.lengh=0;this.$f4=-1;this.$e4=0;this.$t4=0},add:function(d){if(this.$f4!=-1){var c=this.$f4;this.$f4=this.$s[this.$f4].reserve;this.$s[c].data=d;this.$s[c].reserve=-1;this.$s[c].bValid=true;this.$e4+=1;return c}else{var a=new Object;a.data=d;a.reserve=-1;a.bValid=true;this.$s.push(a);this.$e4+=1;return this.$s.length-1}},find:function(c){for(var a=this.$s.length-1;a>=0;--a){if(this.$s[a].bValid&&this.$s[a].data==c){return true}}return false},remove:function(c){for(var a=this.$s.length-1;a>=0;--a){if(this.$s[a].bValid&&this.$s[a].data==c){this.$s[a].reserve=this.$f4;this.$s[a].bValid=false;this.$f4=a;this.$e4-=1;return}}},removeByIndex:function(a){if(this.$s[a].bValid){this.$s[a].reserve=this.$f4;this.$s[a].bValid=false;this.$f4=a;this.$e4-=1}},getSize:function(){return this.$e4},getCapacity:function(){return this.$s.length},getDataByIndex:function(a){return this.$s[a].data},isIndexValid:function(a){return(a<this.$s.length)&&(a>=0)&&this.$s[a].bValid},resetIterator:function(){this.$t4=0},iterate:function(){while(this.$t4<this.$s.length&&this.$s[this.$t4].bValid==false){this.$t4++}if(this.$t4>=this.$s.length){return null}return this.$s[this.$t4++].data}};function okList(){this.$N5=null;this.$D6=null;this.$I4=0;this.$y5=new Array}okList.prototype={clear:function(){var c=this.$N5;while(c){var a=c.next;c.data=null;c.pre=null;c.next=null;this.$y5.push(c);c=a}this.$N5=null;this.$D6=null;this.$I4=0},getRoot:function(){return this.$N5},getTail:function(){return this.$D6},getSize:function(){return this.$I4},isEmpty:function(){return(this.$I4==0)},pushFront:function(a){var c=this.$y5.length?this.$y5.shift():new Object;c.data=a;c.next=this.$N5;c.pre=null;if(this.$N5){this.$N5.pre=c}else{this.$D6=c}this.$N5=c;this.$I4+=1},popFront:function(){if(this.$N5==null){return null}var a=this.$N5;this.$N5=this.$N5.next;if(this.$N5!=null){this.$N5.pre=null}else{this.$D6=null}this.$I4-=1;a.pre=null;a.next=null;var c=a.data;a.data=null;this.$y5.push(a);return c},front:function(){if(this.$N5){return this.$N5.data}return null},pushBack:function(c){var a=this.$y5.length?this.$y5.shift():new Object;a.data=c;a.pre=this.$D6;a.next=null;if(this.$D6){this.$D6.next=a}else{this.$N5=a}this.$D6=a;this.$I4+=1},popBack:function(){if(this.$D6==null){return null}var a=this.$D6;this.$D6=this.$D6.pre;if(this.$D6!=null){this.$D6.next=null}else{this.$N5=null}this.$I4-=1;a.pre=null;a.next=null;var c=a.data;a.data=null;this.$y5.push(a);return c},back:function(){if(this.$D6){return this.$D6.data}return null},insertBefore:function(c,d){var a=this.$y5.length?this.$y5.shift():new Object;a.data=d;a.pre=c.pre;a.next=c;c.pre=a;if(a.pre==null){this.$N5=a}else{a.pre.next=a}this.$I4+=1},insertAfter:function(c,d){var a=this.$y5.length?this.$y5.shift():new Object;a.data=d;a.pre=c;a.next=c.next;c.next=a;if(a.next==null){this.$D6=a}else{a.next.pre=a}this.$I4+=1},remove:function(a){if(a==null){return null}if(a.pre){a.pre.next=a.next}if(a.next){a.next.pre=a.pre}if(a==this.$N5){this.$N5=a.next}if(a==this.$D6){this.$D6=a.pre}a.pre=null;a.next=null;a.data=null;this.$y5.push(a);this.$I4-=1},find:function(a){var c=this.$N5;while(c){if(c.data==a){return c}c=c.next}return null}};function okLayout2DHelper(a,c){this.$B1=new okList();this.$B1.pushBack(new okRect(0,0,a,c))}okLayout2DHelper.prototype={reset:function(a,c){this.$B1=new okList();this.$B1.pushBack(new okRect(0,0,a,c))},add:function(a,e){var k=this.$B1.getRoot();var h=null;var d=null,c=null;while(k){var f=k.data;if(f.width>=a&&f.height>=e){h=new okRect(f.x,f.y,a,e);this.$B1.remove(k);if((f.width!=a)&&(f.height!=e)){if(Math.max(f.height*(f.width-a),a*(f.height-e))>Math.max(f.width*(f.height-e),e*(f.width-a))){d=new okRect(f.x,f.y+e,a,f.height-e);c=new okRect(f.x+a,f.y,f.width-a,f.height)}else{d=new okRect(f.x,f.y+e,f.width,f.height-e);c=new okRect(f.x+a,f.y,f.width-a,e)}}else{if(f.width!=a){d=new okRect(f.x+a,f.y,f.width-a,f.height)}else{if(f.height!=e){d=new okRect(f.x,f.y+e,f.width,f.height-e)}}}break}k=k.next}if(d){this.appendBlankRect(d)}if(c){this.appendBlankRect(c)}return h},remove:function(a){this.appendBlankRect(a);return true},appendBlankRect:function(a){if(a==null||a.width<=0||a.height<=0){return}var d=this.$B1.getRoot();while(d){var c=d.data;if(c.width*c.height>a.width*a.height){this.$B1.insertBefore(d,a);break}d=d.next}if(d==null){this.$B1.pushBack(a)}}};function okPackVec3ToFloat(d){var a=d.x*255;var h=d.y*255;var f=d.z*255;var c=(a<<16)|(h<<8)|f;var e=c/(1<<24);return e}function okUnpackFloatToVec3(a){r=a-Math.floor(a);g=a*256-Math.floor(a*256);b=a*65536-Math.floor(a*65536);return new okVec3(r,g,b)}function okArray2D(){this.elementArray=new Array;this.oneDimLength;this.twoDimLength}okArray2D.prototype={clear:function(){for(var d=0;d<this.elementArray.length;++d){var c=this.elementArray[d];if(!c){continue}c=[]}this.elementArray=[]},addElement:function(d,a,c){var e=this.elementArray[d];if(!e){e=new Array;this.elementArray[d]=e}e[a]=c},getElement:function(c,a){if(c<0||c>=this.getOneDimLength()){return}if(a<0||a>=this.getTwoDimLength()){return}return this.elementArray[c][a]},getOneDimLength:function(){this.oneDimLength=this.elementArray.length;return this.elementArray.length},getTwoDimLength:function(){var c=0;for(var a=0;a<this.elementArray.length;++a){var d=this.elementArray[a];if(!d){d=new Array;this.elementArray[a]=d}if(c<d.length){c=d.length}}this.twoDimLength=c;return c}};function okGenXmlHttpRequest(){if(okIsIE()){return new ActiveXObject("Msxml2.XMLHTTP")}else{return new XMLHttpRequest()}return null}function okGetFileExtName(c){var a=c.lastIndexOf(".");if(a==-1){return""}return c.substr(a+1)}function okGetRelativePath(c,a){c=c.replace(/\\/g,"/");c=c.replace(/^\/+/g,"");c=c.replace(/\/$/g,"");a=a.replace(/\\/g,"/");a=a.replace(/^\/+/g,"");a=a.replace(/\/$/g,"");return c.substr(c.indexOf(a)+a.length)}function okExtend(d,a){var c=function(){};c.prototype=a.prototype;d.__parent=a.prototype;d.prototype=new c();d.prototype.constructor=d}function okBaseCall(h,e){var c=arguments.callee.caller;if(c.__parent){return c.__parent.constructor.apply(h,Array.prototype.slice.call(arguments,1))}var a=Array.prototype.slice.call(arguments,2);var f=false;for(var d=h.constructor;d;d=d.__parent&&d.__parent.constructor){if(d.prototype[e]===c){f=true}else{if(f){return d.prototype[e].apply(h,a)}}}if(h[e]===c){return h.constructor.prototype[e].apply(h,a)}else{throw Error("Called from a method of one name to a method of a different name")}}function okAllocatorPrototype(){this.$C1=new Array;this.$D1=new Array;this.$E1=new Array;this.$T=new Array;this.$U=new Array;this.$V=new Array;this.$91=new Array;this.$21=new Array;this.$3=new Array;this.$i1=new Array;this.$a1=new Array;this.$01=new Array;this.$7=new Array;this.$Z=new Array}okAllocatorPrototype.prototype={object:function(){if(this.$Z.length){return this.$Z.shift()}return new Object},_object:function(c){for(var a in c){delete c[a]}this.$Z.push(c)},array:function(){if(this.$7.length){return this.$7.shift()}return new Array},_array:function(a){a.length=0;this.$7.push(a)},vec2:function(){if(this.$C1.length){return this.$C1.shift()}return new okVec2()},_vec2:function(a){a.x=0;a.y=0;this.$C1.push(a)},vec3:function(d,c,a){if(this.$D1.length){return this.$D1.shift()}return new okVec3()},_vec3:function(a){a.x=0;a.y=0;a.z=0;this.$D1.push(a)},vec4:function(){if(this.$E1.length){return this.$E1.shift()}return new okVec4()},_vec4:function(a){a.x=0;a.y=0;a.z=0;a.w=0;this.$E1.push(a)},mat3:function(){if(this.$T.length){return this.$T.shift()}return new okMat3()},_mat3:function(a){a.m00=1;a.m10=0;a.m20=0;a.m01=0;a.m11=1;a.m21=0;a.m02=0;a.m12=0;a.m22=1;this.$T.push(a)},mat4:function(){if(this.$U.length){return this.$U.shift()}return new okMat4()},_mat4:function(a){a.m00=1;a.m10=0;a.m20=0;a.m30=0;a.m01=0;a.m11=1;a.m21=0;a.m31=0;a.m02=0;a.m12=0;a.m22=1;a.m32=0;a.m03=0;a.m13=0;a.m23=0;a.m33=1;this.$U.push(a)},mat43:function(){if(this.$V.length){return this.$V.shift()}return new okMat43()},_mat43:function(a){a.m00=1;a.m10=0;a.m20=0;a.m01=0;a.m11=1;a.m21=0;a.m02=0;a.m12=0;a.m22=1;a.m03=0;a.m13=0;a.m23=0;this.$V.push(a)},quat:function(){if(this.$91.length){return this.$91.shift()}return new okQuat()},_quat:function(a){a.s=1;a.x=0;a.y=0;a.z=0;this.$91.push(a)},plane:function(){if(this.$21.length){return this.$21.shift()}return new okPlane()},_plane:function(a){a.vOrigin.x=0;a.vOrigin.y=0;a.vOrigin.z=0;a.vNormal.x=0;a.vNormal.y=1;a.vNormal.z=0;this.$21.push(a)},aabbox:function(){if(this.$3.length){return this.$3.shift()}return new okAABBox()},_aabbox:function(a){a.set(OAK.VEC3_ZERO,OAK.VEC3_ZERO);this.$3.push(a)},sceneNode:function(){if(this.$i1.length){return this.$i1.shift()}return new okSceneNode()},_sceneNode:function(a){a.clear();this.$i1.push(a)},renderBatch:function(){if(this.$a1.length){return this.$a1.shift()}return new okRenderBatch()},_renderBatch:function(a){a.clear();this.$a1.push(a)},particle:function(){if(this.$01.length){return this.$01.shift()}return new okParticle()},_particle:function(a){a.lf=0;a.tlf=0;a.m.identity();a.v.x=0;a.v.y=0;a.v.z=0;a.ac.x=0;a.ac.y=0;a.ac.z=0;a.s.x=0.1;a.s.y=0.1;a.s0.x=0.1;a.s0.y=0.1;a.s1.x=0.1;a.s1.y=0.1;a.c.x=1;a.c.y=1;a.c.z=1;a.c0.x=1;a.c0.y=1;a.c0.z=1;a.c1.x=1;a.c1.y=1;a.c1.z=1;a.a=0;a.fdi=0;a.fdo=0;this.$01.push(a)}};var okA=new okAllocatorPrototype();function okFloatEqual(c,a){if((c-a)<0.000001&&(c-a)>-0.000001){return true}return false}function okAlign(c,a){return(c+a-1)&~(a-1)}function okAlignPower2(a){--a;for(var c=1;c<32;c<<=1){a=a|a>>c}return a+1}function okIsPower2(a){return(a&(a-1))==0}function okVec2(c,a){this.x=((c!=null)?c:0);this.y=((a!=null)?a:0)}okVec2.prototype={set:function(c,a){this.x=c;this.y=a},clone:function(a){var a=(a?a:okA.vec2());a.x=this.x;a.y=this.y;return a},equal:function(a){return this.x==a.x&&this.y==a.y},neg:function(a){var c=(a?this:okA.vec2());c.x=-this.x;c.y=-this.y;return c},len:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(c){var d=(c?this:okA.vec2());var a=1/Math.sqrt(this.x*this.x+this.y*this.y);d.x=this.x*a;d.y=this.y*a;return d},inverse:function(a){var c=(a?this:okA.vec2());c.x=1/this.x;c.y=1/this.y;return c},translate:function(e,d,c){if(e.x){c=d;if(c){this.x+=e.x;this.y+=e.y;return this}else{var a=okA.vec2();a.x=this.x+e.x;a.y=this.y+e.y;return a}}else{if(okIsNumber(d)){if(c){this.x+=e;this.y+=d;return this}else{var a=okA.vec2();a.x=this.x+e;a.y=this.y+d;return a}}else{c=d;if(c){this.x+=e;this.y+=e;return this}else{var a=okA.vec2();a.x=this.x+e;a.y=this.y+e;return a}}}},scale:function(e,d,c){if(e.x){c=d;if(c){this.x*=e.x;this.y*=e.y;return this}else{var a=okA.vec2();a.x=this.x*e.x;a.y=this.y*e.y;return a}}else{if(okIsNumber(d)){if(c){this.x*=e;this.y*=d;return this}else{var a=okA.vec2();a.x=this.x*e;a.y=this.y*d;return a}}else{c=d;if(c){this.x*=e;this.y*=e;return this}else{var a=okA.vec2();a.x=this.x*e;a.y=this.y*e;return a}}}},toArray:function(a){if(a==null){a=okA.array()}a.push(this.x,this.y);return a}};function okVec2Add(c,a){var d=okA.vec2();d.x=c.x+a.x;d.y=c.y+a.y;return d}function okVec2AddVal(a,c){var d=okA.vec2();d.x=a.x+c;d.y=a.y+c;return d}function okValAddVec2(c,a){var d=okA.vec2();d.x=a.x+c;d.y=a.y+c;return d}function okVec2Sub(c,a){var d=okA.vec2();d.x=c.x-a.x;d.y=c.y-a.y;return d}function okVec2SubVal(a,c){var d=okA.vec2();d.x=a.x-c;d.y=a.y-c;return d}function okValSubVec2(c,a){var d=okA.vec2();d.x=c-a.x;d.y=c-a.y;return d}function okVec2Mul(c,a){var d=okA.vec2();d.x=c.x*a.x;d.y=c.y*a.y;return d}function okVec2MulVal(a,c){var d=okA.vec2();d.x=a.x*c;d.y=a.y*c;return d}function okValMulVec2(c,a){var d=okA.vec2();d.x=a.x*c;d.y=a.y*c;return d}function okVec2Div(c,a){var d=okA.vec2();d.x=c.x/a.x;d.y=c.y/a.y;return d}function okVec2DivVal(a,c){var d=okA.vec2();d.x=a.x/c;d.y=a.y/c;return d}function okValDivVec2(c,a){var d=okA.vec2();d.x=c/a.x;d.y=c/a.y;return d}function okVec2Min(c,a){var d=okA.vec2();d.x=c.x<a.x?c.x:a.x;d.y=c.y<a.y?c.y:a.y;return d}function okVec2Max(c,a){var d=okA.vec2();d.x=c.x>a.x?c.x:a.x;d.y=c.y>a.y?c.y:a.y;return d}function okVec2Dot(c,a){return c.x*a.x+c.y*a.y}function okVec2Cross(c,a){return c.x*a.y-a.x*c.y}function okVec2Lerp(e,d,h){var c=okVec2MulVal(e,1-h);var a=okVec2MulVal(d,h);var f=okVec2Add(c,a);okA._vec2(c);okA._vec2(a);return f}function okVec2Len(e,d){var c=e.x-d.x;var a=e.y-d.y;return Math.sqrt(c*c+a*a)}function okVec3(d,c,a){this.x=((d!=null)?d:0);this.y=((c!=null)?c:0);this.z=((a!=null)?a:0)}okVec3.prototype={set:function(d,c,a){this.x=d;this.y=c;this.z=a},clone:function(a){var a=(a?a:okA.vec3());a.x=this.x;a.y=this.y;a.z=this.z;return a},equal:function(a){return this.x==a.x&&this.y==a.y&&this.z==a.z},len:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},neg:function(a){var c=(a?this:okA.vec3());c.x=-this.x;c.y=-this.y;c.z=-this.z;return c},normalize:function(c){var d=(c?this:okA.vec3());var a=1/Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);d.x=this.x*a;d.y=this.y*a;d.z=this.z*a;return d},inverse:function(a){var c=(a?this:okA.vec3());c.x=1/this.x;c.y=1/this.y;c.z=1/this.z;return c},translate:function(f,e,c,d){if(f.x){d=e;if(d){this.x+=f.x;this.y+=f.y;this.z+=f.z;return this}else{var a=okA.vec3();a.x=this.x+f.x;a.y=this.y+f.y;a.z=this.z+f.z;return a}}else{if(c==null){d=e;if(d){this.x+=f;this.y+=f;this.z+=f;return this}else{var a=okA.vec3();a.x=this.x+f;a.y=this.y+f;a.z=this.z+f;return a}}else{if(d){this.x+=f;this.y+=e;this.z+=c;return this}else{var a=okA.vec3();a.x=this.x+f;a.y=this.y+e;a.z=this.z+c;return a}}}},scale:function(f,e,c,d){if(f.x){d=e;if(d){this.x*=f.x;this.y*=f.y;this.z*=f.z;return this}else{var a=okA.vec3();a.x=this.x*f.x;a.y=this.y*f.y;a.z=this.z*f.z;return a}}else{if(c==null){d=e;if(d){this.x*=f;this.y*=f;this.z*=f;return this}else{var a=okA.vec3();a.x=this.x*f;a.y=this.y*f;a.z=this.z*f;return a}}else{if(d){this.x*=f;this.y*=e;this.z*=c;return this}else{var a=okA.vec3();a.x=this.x*f;a.y=this.y*e;a.z=this.z*c;return a}}}},rot:function(k,h,f,c,e){var d=okMat43Rot(k,h,f,c);var a=okMat43MulVec3(d,this);okA._mat43(d);if(e){this.x=a.x;this.y=a.y;this.z=a.z;okA._vec3(a);return this}else{return a}},rotX:function(e,d){var c=okMat43RotX(e);var a=okMat43MulVec3(c,this);okA._mat43(c);if(d){this.x=a.x;this.y=a.y;this.z=a.z;okA._vec3(a);return this}else{return a}},rotY:function(e,d){var c=okMat43RotY(e);var a=okMat43MulVec3(c,this);okA._mat43(c);if(d){this.x=a.x;this.y=a.y;this.z=a.z;okA._vec3(a);return this}else{return a}},rotZ:function(e,d){var c=okMat43RotZ(e);var a=okMat43MulVec3(c,this);okA._mat43(c);if(d){this.x=a.x;this.y=a.y;this.z=a.z;okA._vec3(a);return this}else{return a}},toVec4:function(a){if(a==null){a=okA.vec4()}a.set(this.x,this.y,this.z,1);return a},toArray:function(a){if(a==null){a=okA.array()}a.push(this.x,this.y,this.z);return a}};function okVec3Add(c,a){var d=okA.vec3();d.x=c.x+a.x;d.y=c.y+a.y;d.z=c.z+a.z;return d}function okVec3AddVal(a,c){var d=okA.vec3();d.x=a.x+c;d.y=a.y+c;d.z=a.z+c;return d}function okValAddVec3(c,a){var d=okA.vec3();d.x=a.x+c;d.y=a.y+c;d.z=a.z+c;return d}function okVec3Sub(c,a){var d=okA.vec3();d.x=c.x-a.x;d.y=c.y-a.y;d.z=c.z-a.z;return d}function okVec3SubVal(a,c){var d=okA.vec3();d.x=a.x-c;d.y=a.y-c;d.z=a.z-c;return d}function okValSubVec3(c,a){var d=okA.vec3();d.x=c-a.x;d.y=c-a.y;d.z=c-a.z;return d}function okVec3Mul(c,a){var d=okA.vec3();d.x=c.x*a.x;d.y=c.y*a.y;d.z=c.z*a.z;return d}function okVec3MulVal(a,c){var d=okA.vec3();d.x=a.x*c;d.y=a.y*c;d.z=a.z*c;return d}function okValMulVec3(c,a){var d=okA.vec3();d.x=a.x*c;d.y=a.y*c;d.z=a.z*c;return d}function okVec3Div(c,a){var d=okA.vec3();d.x=c.x/a.x;d.y=c.y/a.y;d.z=c.z/a.z;return d}function okVec3DivVal(a,c){var d=okA.vec3();d.x=a.x/c;d.y=a.y/c;d.z=a.z/c;return d}function okValDivVec3(c,a){var d=okA.vec3();d.x=c/a.x;d.y=c/a.y;d.z=c/a.z;return d}function okVec3Min(c,a){var d=okA.vec3();d.x=c.x<a.x?c.x:a.x;d.y=c.y<a.y?c.y:a.y;d.z=c.z<a.z?c.z:a.z;return d}function okVec3Max(c,a){var d=okA.vec3();d.x=c.x>a.x?c.x:a.x;d.y=c.y>a.y?c.y:a.y;d.z=c.z>a.z?c.z:a.z;return d}function okVec3Dot(c,a){return c.x*a.x+c.y*a.y+c.z*a.z}function okVec3Cross(c,a){var d=okA.vec3();d.x=c.y*a.z-c.z*a.y;d.y=c.z*a.x-c.x*a.z;d.z=c.x*a.y-c.y*a.x;return d}function okVec3Lerp(e,c,h){var f=1-h;var d=h;var a=okA.vec3();a.x=e.x*f+c.x*d;a.y=e.y*f+c.y*d;a.z=e.z*f+c.z*d;return a}function okVec3Len(e,d){var c=e.x-d.x;var a=e.y-d.y;var f=e.z-d.z;return Math.sqrt(c*c+a*a+f*f)}function okVec4(d,c,a,e){this.x=((d!=null)?d:0);this.y=((c!=null)?c:0);this.z=((a!=null)?a:0);this.w=((e!=null)?e:1)}okVec4.prototype={set:function(d,c,a,e){this.x=d;this.y=c;this.z=a;this.w=e},clone:function(a){var a=(a?a:okA.vec4());a.x=this.x;a.y=this.y;a.z=this.z;a.w=this.w;return a},equal:function(a){return okFloatEqual(this.x,a.x)&&okFloatEqual(this.y,a.y)&&okFloatEqual(this.z,a.z)&&okFloatEqual(this.w,a.w)},len:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},neg:function(a){var c=(a?this:okA.vec4());c.x=-this.x;c.y=-this.y;c.z=-this.z;c.w=-this.w;return c},normalize:function(c){var d=(c?this:okA.vec4());var a=1/Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);d.x=this.x*a;d.y=this.y*a;d.z=this.z*a;d.w=this.w*a;return d},inverse:function(a){var c=(a?this:okA.vec4());c.x=1/this.x;c.y=1/this.y;c.z=1/this.z;c.w=1/this.w;return c},toVec3:function(a){if(a==null){a=okA.vec3()}a.x=this.x/this.w;a.y=this.y/this.w;a.z=this.z/this.w;return a},toArray:function(a){if(a==null){a=okA.array()}a.push(this.x,this.y,this.z,this.w);return a}};function okVec4Add(c,a){var d=okA.vec4();d.x=c.x+a.x;d.y=c.y+a.y;d.z=c.z+a.z;d.w=c.w+a.w;return d}function okVec4AddVal(a,c){var d=okA.vec4();d.x=a.x+c;d.y=a.y+c;d.z=a.z+c;d.w=a.w+c;return d}function okValAddVec4(c,a){var d=okA.vec4();d.x=a.x+c;d.y=a.y+c;d.z=a.z+c;d.w=a.w+c;return d}function okVec4Sub(c,a){var d=okA.vec4();d.x=c.x-a.x;d.y=c.y-a.y;d.z=c.z-a.z;d.w=c.w-a.w;return d}function okVec4SubVal(a,c){var d=okA.vec4();d.x=a.x-c;d.y=a.y-c;d.z=a.z-c;d.w=a.w-c;return d}function okValSubVec4(c,a){var d=okA.vec4();d.x=c-a.x;d.y=c-a.y;d.z=c-a.z;d.w=c-a.w;return d}function okVec4Mul(c,a){var d=okA.vec4();d.x=c.x*a.x;d.y=c.y*a.y;d.z=c.z*a.z;d.w=c.w*a.w;return d}function okVec4MulVal(a,c){var d=okA.vec4();d.x=a.x*c;d.y=a.y*c;d.z=a.z*c;d.w=a.w*c;return d}function okValMulVec4(c,a){var d=okA.vec4();d.x=a.x*c;d.y=a.y*c;d.z=a.z*c;d.w=a.w*c;return d}function okVec4Div(c,a){var d=okA.vec4();d.x=c.x/a.x;d.y=c.y/a.y;d.z=c.z/a.z;d.w=c.w/a.w;return d}function okVec4DivVal(a,c){var d=okA.vec4();d.x=a.x/c;d.y=a.y/c;d.z=a.z/c;d.w=a.w/c;return d}function okValDivVec4(c,a){var d=okA.vec4();d.x=c/a.x;d.y=c/a.y;d.z=c/a.z;d.w=c/a.w;return d}function okVec4Min(c,a){var d=okA.vec4();d.x=c.x<a.x?c.x:a.x;d.y=c.y<a.y?c.y:a.y;d.z=c.z<a.z?c.z:a.z;d.w=c.w<a.w?c.w:a.w;return d}function okVec4Max(c,a){var d=okA.vec4();d.x=c.x>a.x?c.x:a.x;d.y=c.y>a.y?c.y:a.y;d.z=c.z>a.z?c.z:a.z;d.w=c.w>a.w?c.w:a.w;return d}function okVec4Dot(c,a){return c.x*a.x+c.y*a.y+c.z*a.z+c.w*a.w}function okVec4Lerp(e,d,h){var c=okVec4MulVal(e,1-h);var a=okVec4MulVal(d,h);var f=okVec4Add(c,a);okA._vec4(c);okA._vec4(a);return f}function okVec4Len(f,e){var c=f.x-e.x;var a=f.y-e.y;var h=f.z-e.z;var d=f.w-e.w;return Math.sqrt(c*c+a*a+h*h+d*d)}function okMat3(a){this.m00=((a!=null)?a:1);this.m10=0;this.m20=0;this.m01=0;this.m11=((a!=null)?a:1);this.m21=0;this.m02=0;this.m12=0;this.m22=((a!=null)?a:1)}okMat3.prototype={identity:function(){this.m00=1;this.m10=0;this.m20=0;this.m01=0;this.m11=1;this.m21=0;this.m02=0;this.m12=0;this.m22=1},set:function(a){this.m00=a[0];this.m10=a[1];this.m20=a[2];this.m01=a[3];this.m11=a[4];this.m21=a[5];this.m02=a[6];this.m12=a[7];this.m22=a[8]},clone:function(a){var a=(a?a:okA.mat3());a.m00=this.m00;a.m10=this.m10;a.m20=this.m20;a.m01=this.m01;a.m11=this.m11;a.m21=this.m21;a.m02=this.m02;a.m12=this.m12;a.m22=this.m22;return a},equal:function(a){return okFloatEqual(this.m00,a.m00)&&okFloatEqual(this.m10,a.m10)&&okFloatEqual(this.m20,a.m20)&&okFloatEqual(this.m01,a.m01)&&okFloatEqual(this.m11,a.m11)&&okFloatEqual(this.m21,a.m21)&&okFloatEqual(this.m02,a.m02)&&okFloatEqual(this.m12,a.m12)&&okFloatEqual(this.m22,a.m22)},setColumn:function(d,c,a,e){if(d==0){if(okIsNumber(c)){this.m00=c;this.m10=a;this.m20=e}else{this.m00=c.x;this.m10=c.y;this.m20=c.z}}else{if(d==1){if(okIsNumber(c)){this.m01=c;this.m11=a;this.m21=e}else{this.m01=c.x;this.m11=c.y;this.m21=c.z}}else{if(d==2){if(okIsNumber(c)){this.m02=c;this.m12=a;this.m22=e}else{this.m02=c.x;this.m12=c.y;this.m22=c.z}}}}},getColumn:function(c){var a=okA.vec3();if(c==0){a.set(this.m00,this.m10,this.m20)}else{if(c==1){a.set(this.m01,this.m11,this.m21)}else{if(c==2){a.set(this.m02,this.m12,this.m22)}}}return a},det:function(){var n=this.m00,m=this.m01,l=this.m02;var k=this.m10,f=this.m11,e=this.m12;var d=this.m20,c=this.m21,a=this.m22;var h=n*f*a+m*e*d+l*k*c-n*e*c-m*k*a-l*f*d;return h},inverse:function(m){var p=this.m00,o=this.m01,n=this.m02;var k=this.m10,h=this.m11,f=this.m12;var e=this.m20,d=this.m21,c=this.m22;var a=(m?this:okA.mat3());a.m00=h*c-f*d;a.m01=n*d-o*c;a.m02=o*f-n*h;a.m10=f*e-k*c;a.m11=p*c-n*e;a.m12=n*k-p*f;a.m20=k*d-h*e;a.m21=o*e-p*d;a.m22=p*h-o*k;var q=p*h*c+o*f*e+n*k*d-p*f*d-o*k*c-n*h*e;var l=1/q;a.m00*=l;a.m01*=l;a.m02*=l;a.m10*=l;a.m11*=l;a.m12*=l;a.m20*=l;a.m21*=l;a.m22*=l;return a},transpose:function(l){var e=(l?this:okA.mat3());var o=this.m00,n=this.m01,m=this.m02;var k=this.m10,h=this.m11,f=this.m12;var d=this.m20,c=this.m21,a=this.m22;e.m00=o;e.m10=n;e.m20=m;e.m01=k;e.m11=h;e.m21=f;e.m02=d;e.m12=c;e.m22=a;return e},rot:function(C,a,y,x,w,e){var s=okA.vec3();if(w!=null){s.x=y;s.y=x;s.z=w}else{s.x=y.x;s.y=y.y;s.z=y.z;e=x}s.normalize(true);var h=a*Math.PI/180;var u=Math.cos(h*0.5);var v=Math.sin(h*0.5);var o=okA.quat();o.s=u;o.x=v*s.x;o.y=v*s.y;o.z=v*s.z;okA._vec3(s);var t=okA.mat3();o.toMat3(t);var p=this.m00;var B=this.m10;var f=this.m20;var n=this.m01;var A=this.m11;var d=this.m21;var l=this.m02;var z=this.m12;var c=this.m22;var k=(e?this:okA.mat3());if(C==3){k.m00=t.m00*p+t.m01*B+t.m02*f;k.m10=t.m10*p+t.m11*B+t.m12*f;k.m20=t.m20*p+t.m21*B+t.m22*f;k.m01=t.m00*n+t.m01*A+t.m02*d;k.m11=t.m10*n+t.m11*A+t.m12*d;k.m21=t.m20*n+t.m21*A+t.m22*d;k.m02=t.m00*l+t.m01*z+t.m02*c;k.m12=t.m10*l+t.m11*z+t.m12*c;k.m22=t.m20*l+t.m21*z+t.m22*c}else{k.m00=p*t.m00+n*t.m10+l*t.m20;k.m10=B*t.m00+A*t.m10+z*t.m20;k.m20=f*t.m00+d*t.m10+c*t.m20;k.m01=p*t.m01+n*t.m11+l*t.m21;k.m11=B*t.m01+A*t.m11+z*t.m21;k.m21=f*t.m01+d*t.m11+c*t.m21;k.m02=p*t.m02+n*t.m12+l*t.m22;k.m12=B*t.m02+A*t.m12+z*t.m22;k.m22=f*t.m02+d*t.m12+c*t.m22}okA._mat3(t);okA._quat(o);return k},rotX:function(x,c,f){var l=c*Math.PI/180;var k=Math.cos(l),s=Math.sin(l);var q=this.m00;var w=this.m10;var h=this.m20;var p=this.m01;var v=this.m11;var e=this.m21;var o=this.m02;var u=this.m12;var d=this.m22;var n=this.m03;var t=this.m13;var a=this.m23;var m=(f?this:this.clone());if(x==3){m.m10=k*w-s*h;m.m20=s*w+k*h;m.m11=k*v-s*e;m.m21=s*v+k*e;m.m12=k*u-s*d;m.m22=s*u+k*d}else{m.m01=p*k+o*s;m.m11=v*k+u*s;m.m21=e*k+d*s;m.m02=p*-s+o*k;m.m12=v*-s+u*k;m.m22=e*-s+d*k}return m},rotY:function(a,o,q){var d=o*Math.PI/180;var l=Math.cos(d),p=Math.sin(d);var u=this.m00;var n=this.m10;var h=this.m20;var t=this.m01;var m=this.m11;var e=this.m21;var s=this.m02;var k=this.m12;var c=this.m22;var f=(q?this:this.clone());if(a==3){f.m00=l*u+p*h;f.m20=-p*u+l*h;f.m01=l*t+p*e;f.m21=-p*t+l*e;f.m02=l*s+p*c;f.m22=-p*s+l*c}else{f.m00=u*l+s*-p;f.m10=n*l+k*-p;f.m20=h*l+c*-p;f.m02=u*p+s*l;f.m12=n*p+k*l;f.m22=h*p+c*l}return f},rotZ:function(x,c,f){var l=c*Math.PI/180;var k=Math.cos(l),s=Math.sin(l);var q=this.m00;var w=this.m10;var h=this.m20;var p=this.m01;var v=this.m11;var e=this.m21;var o=this.m02;var u=this.m12;var d=this.m22;var n=this.m03;var t=this.m13;var a=this.m23;var m=(f?this:this.clone());if(x==3){m.m00=k*q+-s*w;m.m10=s*q+k*w;m.m01=k*p+-s*v;m.m11=s*p+k*v;m.m02=k*o+-s*u;m.m12=s*o+k*u}else{m.m00=q*k+p*s;m.m10=w*k+v*s;m.m20=h*k+e*s;m.m01=q*-s+p*k;m.m11=w*-s+v*k;m.m21=h*-s+e*k}return m},scale:function(a,h,e,d,m){var l,k,f;if(e){l=h;k=e;f=d}else{if(h.x){l=h.x;e=h.y;d=h.z;m=e}else{l=h;e=h;d=h;m=e}}var c=(m?this:this.clone());if(a==3){c.m00*=l;c.m10*=k;c.m20*=f;c.m01*=l;c.m11*=k;c.m21*=f;c.m02*=l;c.m12*=k;c.m22*=f}else{c.m00*=l;c.m10*=l;c.m20*=l;c.m01*=k;c.m11*=k;c.m21*=k;c.m02*=f;c.m12*=f;c.m22*=f}return c},toMat4:function(a){if(a==null){a=okA.mat4()}a.m00=this.m00;a.m10=this.m10;a.m20=this.m20;a.m30=0;a.m01=this.m01;a.m11=this.m11;a.m21=this.m21;a.m31=0;a.m02=this.m02;a.m12=this.m12;a.m22=this.m22;a.m32=0;a.m03=0;a.m13=0;a.m23=0;a.m33=1;return a},toMat43:function(a){if(a==null){a=okA.mat43()}a.m00=this.m00;a.m10=this.m10;a.m20=this.m20;a.m01=this.m01;a.m11=this.m11;a.m21=this.m21;a.m02=this.m02;a.m12=this.m12;a.m22=this.m22;a.m03=0;a.m13=0;a.m23=0;return a},toQuat:function(a){if(a==null){a=okA.quat()}var d=this.m00+this.m11+this.m22;if(d>0){var c=Math.sqrt(d+1)*2;a.s=0.25*c;a.x=(this.m21-this.m12)/c;a.y=(this.m02-this.m20)/c;a.z=(this.m10-this.m01)/c}else{if((this.m00>this.m11)&&(this.m00>this.m22)){var c=Math.sqrt(1+this.m00-this.m11-this.m22)*2;a.s=(this.m21-this.m12)/c;a.x=0.25*c;a.y=(this.m01+this.m10)/c;a.z=(this.m02+this.m20)/c}else{if(this.m11>this.m22){var c=Math.sqrt(1+this.m11-this.m00-this.m22)*2;a.s=(this.m02-this.m20)/c;a.x=(this.m01+this.m10)/c;a.y=0.25*c;a.z=(this.m12+this.m21)/c}else{var c=Math.sqrt(1+this.m22-this.m00-this.m11)*2;a.s=(this.m10-this.m01)/c;a.x=(this.m02+this.m20)/c;a.y=(this.m12+this.m21)/c;a.z=0.25*c}}}return a},toArray:function(a){if(a==null){a=okA.array()}a.push(this.m00,this.m10,this.m20,this.m01,this.m11,this.m21,this.m02,this.m12,this.m22,this.m03,this.m13,this.m23);return a}};function okMat3Add(d,c){var a=okA.mat3();a.m00=d.m00+c.m00;a.m10=d.m10+c.m10;a.m20=d.m20+c.m20;a.m01=d.m01+c.m01;a.m11=d.m11+c.m11;a.m21=d.m21+c.m21;a.m02=d.m02+c.m02;a.m12=d.m12+c.m12;a.m22=d.m22+c.m22;return a}function okMat3AddVal(c,d){var a=okA.mat3();a.m00=c.m00+d;a.m10=c.m10+d;a.m20=c.m20+d;a.m01=c.m01+d;a.m11=c.m11+d;a.m21=c.m21+d;a.m02=c.m02+d;a.m12=c.m12+d;a.m22=c.m22+d;return a}function okValAddMat3(d,c){var a=okA.mat3();a.m00=c.m00+d;a.m10=c.m10+d;a.m20=c.m20+d;a.m01=c.m01+d;a.m11=c.m11+d;a.m21=c.m21+d;a.m02=c.m02+d;a.m12=c.m12+d;a.m22=c.m22+d;return a}function okMat3Sub(d,c){var a=okA.mat3();a.m00=d.m00-c.m00;a.m10=d.m10-c.m10;a.m20=d.m20-c.m20;a.m01=d.m01-c.m01;a.m11=d.m11-c.m11;a.m21=d.m21-c.m21;a.m02=d.m02-c.m02;a.m12=d.m12-c.m12;a.m22=d.m22-c.m22;return a}function okMat3SubVal(c,d){var a=okA.mat3();a.m00=c.m00-d;a.m10=c.m10-d;a.m20=c.m20-d;a.m01=c.m01-d;a.m11=c.m11-d;a.m21=c.m21-d;a.m02=c.m02-d;a.m12=c.m12-d;a.m22=c.m22-d;return a}function okValSubMat3(d,c){var a=okA.mat3();a.m00=d-c.m00;a.m10=d-c.m10;a.m20=d-c.m20;a.m01=d-c.m01;a.m11=d-c.m11;a.m21=d-c.m21;a.m02=d-c.m02;a.m12=d-c.m12;a.m22=d-c.m22;return a}function okMat3Mul(d,c){var a=okA.mat3();a.m00=d.m00*c.m00+d.m01*c.m10+d.m02*c.m20;a.m10=d.m10*c.m00+d.m11*c.m10+d.m12*c.m20;a.m20=d.m20*c.m00+d.m21*c.m10+d.m22*c.m20;a.m01=d.m00*c.m01+d.m01*c.m11+d.m02*c.m21;a.m11=d.m10*c.m01+d.m11*c.m11+d.m12*c.m21;a.m21=d.m20*c.m01+d.m21*c.m11+d.m22*c.m21;a.m02=d.m00*c.m02+d.m01*c.m12+d.m02*c.m22;a.m12=d.m10*c.m02+d.m11*c.m12+d.m12*c.m22;a.m22=d.m20*c.m02+d.m21*c.m12+d.m22*c.m22;return a}function okMat3MulVal(c,d){var a=okA.mat3();a.m00=c.m00*d;a.m10=c.m10*d;a.m20=c.m20*d;a.m01=c.m01*d;a.m11=c.m11*d;a.m21=c.m21*d;a.m02=c.m02*d;a.m12=c.m12*d;a.m22=c.m22*d;return a}function okValMulMat3(d,c){var a=okA.mat3();a.m00=c.m00*d;a.m10=c.m10*d;a.m20=c.m20*d;a.m01=c.m01*d;a.m11=c.m11*d;a.m21=c.m21*d;a.m02=c.m02*d;a.m12=c.m12*d;a.m22=c.m22*d;return a}function okMat3MulVec3(c,a){var d=okA.vec3();d.x=c.m00*a.x+c.m01*a.y+c.m02*a.z;d.y=c.m10*a.x+c.m11*a.y+c.m12*a.z;d.z=c.m20*a.x+c.m21*a.y+c.m22*a.z;return d}function okMat3Lerp(d,c,e){var a=okA.mat3();a.m00=d.m00*(1-e)+c.m00*e;a.m10=d.m10*(1-e)+c.m10*e;a.m20=d.m20*(1-e)+c.m20*e;a.m01=d.m01*(1-e)+c.m01*e;a.m11=d.m11*(1-e)+c.m11*e;a.m21=d.m21*(1-e)+c.m21*e;a.m02=d.m02*(1-e)+c.m02*e;a.m12=d.m12*(1-e)+c.m12*e;a.m22=d.m22*(1-e)+c.m22*e;return a}function okMat3Scale(e,d,c){var f=okA.vec3();if(d!=null){f.x=e;f.y=d;f.z=c}else{f.x=e.x;f.y=e.y;f.z=e.z}var a=okA.mat3();a.m00=f.x;a.m11=f.y;a.m22=f.z;okA._vec3(f);return a}function okMat3RotX(e){var f=e*Math.PI/180;var a=Math.cos(f),d=Math.sin(f);var c=okA.mat3();c.m11=a;c.m12=-d;c.m21=d;c.m22=a;return c}function okMat3RotY(e){var f=e*Math.PI/180;var a=Math.cos(f),d=Math.sin(f);var c=okA.mat3();c.m00=a;c.m02=d;c.m20=-d;c.m22=a;return c}function okMat3RotZ(e){var f=e*Math.PI/180;var a=Math.cos(f),d=Math.sin(f);var c=okA.mat3();c.m00=a;c.m01=-d;c.m10=d;c.m11=a;return c}function okMat3Rot(l,o,n,m){var d=l*Math.PI/180;var h=okA.vec3();if(n!=null){h.x=o;h.y=n;h.z=m}else{h.x=o.x;h.y=o.y;h.z=o.z}var k=h.normalize();okA._vec3(h);var e=Math.cos(d*0.5);var c=Math.sin(d*0.5);var a=new okQuat();a.s=e;a.x=c*k.x;a.y=c*k.y;a.z=c*k.z;okA._vec3(k);var f=okA.mat3();a.toMat3(f);okA._quat(a);return f}function okMat4(a){this.m00=((a!=null)?a:1);this.m10=0;this.m20=0;this.m30=0;this.m01=0;this.m11=((a!=null)?a:1);this.m21=0;this.m31=0;this.m02=0;this.m12=0;this.m22=((a!=null)?a:1);this.m32=0;this.m03=0;this.m13=0;this.m23=0;this.m33=((a!=null)?a:1)}okMat4.prototype={set:function(a){this.m00=a[0];this.m10=a[1];this.m20=a[2];this.m30=a[3];this.m01=a[4];this.m11=a[5];this.m21=a[6];this.m31=a[7];this.m02=a[8];this.m12=a[9];this.m22=a[10];this.m32=a[11];this.m03=a[12];this.m13=a[13];this.m23=a[14];this.m33=a[15]},identity:function(){this.m00=1;this.m10=0;this.m20=0;this.m30=0;this.m01=0;this.m11=1;this.m21=0;this.m31=0;this.m02=0;this.m12=0;this.m22=1;this.m32=0;this.m03=0;this.m13=0;this.m23=0;this.m33=1},clone:function(a){var a=(a?a:okA.mat4());a.m00=this.m00;a.m10=this.m10;a.m20=this.m20;a.m30=this.m30;a.m01=this.m01;a.m11=this.m11;a.m21=this.m21;a.m31=this.m31;a.m02=this.m02;a.m12=this.m12;a.m22=this.m22;a.m32=this.m32;a.m03=this.m03;a.m13=this.m13;a.m23=this.m23;a.m33=this.m33;return a},equal:function(a){return okFloatEqual(this.m00,a.m00)&&okFloatEqual(this.m10,a.m10)&&okFloatEqual(this.m20,a.m20)&&okFloatEqual(this.m30,a.m30)&&okFloatEqual(this.m01,a.m01)&&okFloatEqual(this.m11,a.m11)&&okFloatEqual(this.m21,a.m21)&&okFloatEqual(this.m31,a.m31)&&okFloatEqual(this.m02,a.m02)&&okFloatEqual(this.m12,a.m12)&&okFloatEqual(this.m22,a.m22)&&okFloatEqual(this.m32,a.m32)&&okFloatEqual(this.m03,a.m03)&&okFloatEqual(this.m13,a.m13)&&okFloatEqual(this.m23,a.m23)&&okFloatEqual(this.m33,a.m33)},setColumn:function(d,c,a,f,e){if(d==0){if(okIsNumber(c)){this.m00=c;this.m10=a;this.m20=f;this.m30=(e?e:this.m30)}else{this.m00=c.x;this.m10=c.y;this.m20=c.z;this.m30=(c.w?c.w:this.m30)}}else{if(d==1){if(okIsNumber(c)){this.m01=c;this.m11=a;this.m21=f;this.m31=(e?e:this.m31)}else{this.m01=c.x;this.m11=c.y;this.m21=c.z;this.m31=(c.w?c.w:this.m31)}}else{if(d==2){if(okIsNumber(c)){this.m02=c;this.m12=a;this.m22=f;this.m32=(e?e:this.m32)}else{this.m02=c.x;this.m12=c.y;this.m22=c.z;this.m32=(c.w?c.w:this.m32)}}else{if(d==3){if(okIsNumber(c)){this.m03=c;this.m13=a;this.m23=f;this.m33=(e?e:this.m33)}else{this.m03=c.x;this.m13=c.y;this.m23=c.z;this.m33=(c.w?c.w:this.m33)}}}}}},getColumn:function(c){var a=okA.vec4();if(c==0){a.set(this.m00,this.m10,this.m20,this.m30)}else{if(c==1){a.set(this.m01,this.m11,this.m21,this.m31)}else{if(c==2){a.set(this.m02,this.m12,this.m22,this.m32)}else{if(c==3){a.set(this.m03,this.m13,this.m23,this.m33)}}}}return a},det:function(){var v=this.m00,u=this.m01,s=this.m02,p=this.m03;var m=this.m10,k=this.m11,h=this.m12,f=this.m13;var e=this.m20,d=this.m21,c=this.m22,a=this.m23;var t=this.m30,q=this.m31,o=this.m32,n=this.m33;var l=v*k*c*n+v*h*a*q+v*f*d*o+u*m*a*o+u*h*e*n+u*f*c*t+s*m*d*n+s*k*a*t+s*f*e*q+p*m*c*q+p*k*e*o+p*h*d*t-v*k*a*o-v*h*d*n-v*f*c*q-u*m*c*n-u*h*a*t-u*f*e*o-s*m*a*q-s*k*e*n-s*f*d*t-p*m*d*o-p*k*c*t-p*h*e*q;return l},inverse:function(l){var h=this.m00,e=this.m01,c=this.m02,a=this.m03;var t=this.m10,s=this.m11,q=this.m12,p=this.m13;var y=this.m20,x=this.m21,w=this.m22,v=this.m23;var m=this.m30,k=this.m31,f=this.m32,d=this.m33;var o=(l?this:okA.mat4());o.m00=s*w*d+q*v*k+p*x*f-s*v*f-q*x*d-p*w*k;o.m01=e*v*f+c*x*d+a*w*k-e*w*d-c*v*k-a*x*f;o.m02=e*q*d+c*p*k+a*s*f-e*p*f-c*s*d-a*q*k;o.m03=e*p*w+c*s*v+a*q*x-e*q*v-c*p*x-a*s*w;o.m10=t*v*f+q*y*d+p*w*m-t*w*d-q*v*m-p*y*f;o.m11=h*w*d+c*v*m+a*y*f-h*v*f-c*y*d-a*w*m;o.m12=h*p*f+c*t*d+a*q*m-h*q*d-c*p*m-a*t*f;o.m13=h*q*v+c*p*y+a*t*w-h*p*w-c*t*v-a*q*y;o.m20=t*x*d+s*v*m+p*y*k-t*v*k-s*y*d-p*x*m;o.m21=h*v*k+e*y*d+a*x*m-h*x*d-e*v*m-a*y*k;o.m22=h*s*d+e*p*m+a*t*k-h*p*k-e*t*d-a*s*m;o.m23=h*p*x+e*t*v+a*s*y-h*s*v-e*p*y-a*t*x;o.m30=t*w*k+s*y*f+q*x*m-t*x*f-s*w*m-q*y*k;o.m31=h*x*f+e*w*m+c*y*k-h*w*k-e*y*f-c*x*m;o.m32=h*q*k+e*t*f+c*s*m-h*s*f-e*q*m-c*t*k;o.m33=h*s*w+e*q*y+c*t*x-h*q*x-e*t*w-c*s*y;var u=h*s*w*d+h*q*v*k+h*p*x*f+e*t*v*f+e*q*y*d+e*p*w*m+c*t*x*d+c*s*v*m+c*p*y*k+a*t*w*k+a*s*y*f+a*q*x*m-h*s*v*f-h*q*x*d-h*p*w*k-e*t*w*d-e*q*v*m-e*p*y*f-c*t*v*k-c*s*y*d-c*p*x*m-a*t*x*f-a*s*w*m-a*q*y*k;var n=1/u;o.m00*=n;o.m01*=n;o.m02*=n;o.m03*=n;o.m10*=n;o.m11*=n;o.m12*=n;o.m13*=n;o.m20*=n;o.m21*=n;o.m22*=n;o.m23*=n;o.m30*=n;o.m31*=n;o.m32*=n;o.m33*=n;return o},transpose:function(e){var h=(e?this:okA.mat4());var p=this.m00,n=this.m01,m=this.m02,k=this.m03;var w=this.m10,v=this.m11,u=this.m12,t=this.m13;var f=this.m20,d=this.m21,c=this.m22,a=this.m23;var s=this.m30,q=this.m31,o=this.m32,l=this.m33;h.m00=p;h.m10=n;h.m20=m;h.m30=k;h.m01=w;h.m11=v;h.m21=u;h.m31=t;h.m02=f;h.m12=d;h.m22=c;h.m32=a;h.m03=s;h.m13=q;h.m23=o;h.m33=l;return h},translate:function(h,f,e,c,d){if(f.x){d=e;e=f.y;c=f.z;f=f.x}else{if(c==null){d=e;e=f;c=f}}var a=(d?this:this.clone());if(h==3){a.m00=this.m00+f*this.m30;a.m10=this.m10+e*this.m30;a.m20=this.m20+c*this.m30;a.m01=this.m01+f*this.m31;a.m11=this.m11+e*this.m31;a.m21=this.m21+c*this.m31;a.m02=this.m02+f*this.m32;a.m12=this.m12+e*this.m32;a.m22=this.m22+c*this.m32;a.m03=this.m03+f*this.m33;a.m13=this.m13+e*this.m33;a.m23=this.m23+c*this.m33}else{a.m03=this.m03+this.m00*f+this.m01*e+this.m02*c;a.m13=this.m13+this.m10*f+this.m11*e+this.m12*c;a.m23=this.m23+this.m20*f+this.m21*e+this.m22*c;a.m33=this.m33+this.m30*f+this.m31*e+this.m32*c}return a},rot:function(J,c,E,D,C,f){var x=okA.vec3();if(C!=null){x.x=E;x.y=D;x.z=C}else{x.x=E.x;x.y=E.y;x.z=E.z;f=D}x.normalize(true);var k=c*Math.PI/180;var A=Math.cos(k*0.5);var B=Math.sin(k*0.5);var u=okA.quat();u.s=A;u.x=B*x.x;u.y=B*x.y;u.z=B*x.z;okA._vec3(x);var z=okA.mat4();u.toMat4(z);var w=this.m00;var I=this.m10;var h=this.m20;var y=this.m30;var t=this.m01;var H=this.m11;var e=this.m21;var v=this.m31;var p=this.m02;var G=this.m12;var d=this.m22;var s=this.m32;var n=this.m03;var F=this.m13;var a=this.m23;var o=this.m33;var l=(f?this:okA.mat4());if(J==3){l.m00=z.m00*w+z.m01*I+z.m02*h+z.m03*y;l.m10=z.m10*w+z.m11*I+z.m12*h+z.m13*y;l.m20=z.m20*w+z.m21*I+z.m22*h+z.m23*y;l.m30=z.m30*w+z.m31*I+z.m32*h+z.m33*y;l.m01=z.m00*t+z.m01*H+z.m02*e+z.m03*v;l.m11=z.m10*t+z.m11*H+z.m12*e+z.m13*v;l.m21=z.m20*t+z.m21*H+z.m22*e+z.m23*v;l.m31=z.m30*t+z.m31*H+z.m32*e+z.m33*v;l.m02=z.m00*p+z.m01*G+z.m02*d+z.m03*s;l.m12=z.m10*p+z.m11*G+z.m12*d+z.m13*s;l.m22=z.m20*p+z.m21*G+z.m22*d+z.m23*s;l.m32=z.m30*p+z.m31*G+z.m32*d+z.m33*s;l.m03=z.m00*n+z.m01*F+z.m02*a+z.m03*o;l.m13=z.m10*n+z.m11*F+z.m12*a+z.m13*o;l.m23=z.m20*n+z.m21*F+z.m22*a+z.m23*o;l.m33=z.m30*n+z.m31*F+z.m32*a+z.m33*o}else{l.m00=w*z.m00+t*z.m10+p*z.m20+n*z.m30;l.m10=I*z.m00+H*z.m10+G*z.m20+F*z.m30;l.m20=h*z.m00+e*z.m10+d*z.m20+a*z.m30;l.m30=y*z.m00+v*z.m10+s*z.m20+o*z.m30;l.m01=w*z.m01+t*z.m11+p*z.m21+n*z.m31;l.m11=I*z.m01+H*z.m11+G*z.m21+F*z.m31;l.m21=h*z.m01+e*z.m11+d*z.m21+a*z.m31;l.m31=y*z.m01+v*z.m11+s*z.m21+o*z.m31;l.m02=w*z.m02+t*z.m12+p*z.m22+n*z.m32;l.m12=I*z.m02+H*z.m12+G*z.m22+F*z.m32;l.m22=h*z.m02+e*z.m12+d*z.m22+a*z.m32;l.m32=y*z.m02+v*z.m12+s*z.m22+o*z.m32;l.m03=w*z.m03+t*z.m13+p*z.m23+n*z.m33;l.m13=I*z.m03+H*z.m13+G*z.m23+F*z.m33;l.m23=h*z.m03+e*z.m13+d*z.m23+a*z.m33;l.m33=y*z.m03+v*z.m13+s*z.m23+o*z.m33}okA._mat4(z);okA._quat(u);return l},rotX:function(B,c,f){var l=c*Math.PI/180;var k=Math.cos(l),w=Math.sin(l);var t=this.m00;var A=this.m10;var h=this.m20;var v=this.m30;var s=this.m01;var z=this.m11;var e=this.m21;var u=this.m31;var p=this.m02;var y=this.m12;var d=this.m22;var q=this.m32;var n=this.m03;var x=this.m13;var a=this.m23;var o=this.m33;var m=(f?this:this.clone());if(B==3){m.m10=k*A-w*h;m.m20=w*A+k*h;m.m11=k*z-w*e;m.m21=w*z+k*e;m.m12=k*y-w*d;m.m22=w*y+k*d;m.m03=n;m.m13=k*x-w*a;m.m23=w*x+k*a}else{m.m01=s*k+p*w;m.m11=z*k+y*w;m.m21=e*k+d*w;m.m31=u*k+q*w;m.m02=s*-w+p*k;m.m12=z*-w+y*k;m.m22=e*-w+d*k;m.m32=u*-w+q*k}return m},rotY:function(B,c,f){var l=c*Math.PI/180;var k=Math.cos(l),w=Math.sin(l);var t=this.m00;var A=this.m10;var h=this.m20;var v=this.m30;var s=this.m01;var z=this.m11;var e=this.m21;var u=this.m31;var p=this.m02;var y=this.m12;var d=this.m22;var q=this.m32;var n=this.m03;var x=this.m13;var a=this.m23;var o=this.m33;var m=(f?this:this.clone());if(B==3){m.m00=k*t+w*h;m.m20=-w*t+k*h;m.m01=k*s+w*e;m.m21=-w*s+k*e;m.m02=k*p+w*d;m.m22=-w*p+k*d;m.m03=k*n+w*a;m.m23=-w*n+k*a}else{m.m00=t*k+p*-w;m.m10=A*k+y*-w;m.m20=h*k+d*-w;m.m30=v*k+q*-w;m.m02=t*w+p*k;m.m12=A*w+y*k;m.m22=h*w+d*k;m.m32=v*w+q*k}return m},rotZ:function(B,c,f){var l=c*Math.PI/180;var k=Math.cos(l),w=Math.sin(l);var t=this.m00;var A=this.m10;var h=this.m20;var v=this.m30;var s=this.m01;var z=this.m11;var e=this.m21;var u=this.m31;var p=this.m02;var y=this.m12;var d=this.m22;var q=this.m32;var n=this.m03;var x=this.m13;var a=this.m23;var o=this.m33;var m=(f?this:this.clone());if(B==3){m.m00=k*t+-w*A;m.m10=w*t+k*A;m.m01=k*s+-w*z;m.m11=w*s+k*z;m.m02=k*p+-w*y;m.m12=w*p+k*y;m.m03=k*n+-w*x;m.m13=w*n+k*x}else{m.m00=t*k+s*w;m.m10=A*k+z*w;m.m20=h*k+e*w;m.m30=v*k+u*w;m.m01=t*-w+s*k;m.m11=A*-w+z*k;m.m21=h*-w+e*k;m.m31=v*-w+u*k}return m},scale:function(a,h,e,d,m){var l,k,f;if(d){l=h;k=e;f=d}else{if(h.x){l=h.x;e=h.y;d=h.z;m=e}else{l=h;e=h;d=h;m=e}}var c=(m?this:this.clone());if(a==3){c.m00*=l;c.m10*=k;c.m20*=f;c.m01*=l;c.m11*=k;c.m21*=f;c.m02*=l;c.m12*=k;c.m22*=f;c.m03*=l;c.m13*=k;c.m23*=f}else{c.m00*=l;c.m10*=l;c.m20*=l;c.m30*=l;c.m01*=k;c.m11*=k;c.m21*=k;c.m31*=k;c.m02*=f;c.m12*=f;c.m22*=f;c.m32*=f}return c},toMat3:function(a){if(a==null){a=okA.mat3()}a.m00=this.m00;a.m10=this.m10;a.m20=this.m20;a.m01=this.m01;a.m11=this.m11;a.m21=this.m21;a.m02=this.m02;a.m12=this.m12;a.m22=this.m22;return a},toMat43:function(a){if(a==null){a=okA.mat43()}a.m00=this.m00;a.m10=this.m10;a.m20=this.m20;a.m01=this.m01;a.m11=this.m11;a.m21=this.m21;a.m02=this.m02;a.m12=this.m12;a.m22=this.m22;a.m03=this.m03;a.m13=this.m13;a.m23=this.m23;return a},toQuat:function(a){if(a==null){a=okA.quat()}var d=this.m00+this.m11+this.m22;if(d>0){var c=Math.sqrt(d+1)*2;a.s=0.25*c;a.x=(this.m21-this.m12)/c;a.y=(this.m02-this.m20)/c;a.z=(this.m10-this.m01)/c}else{if((this.m00>this.m11)&&(this.m00>this.m22)){var c=Math.sqrt(1+this.m00-this.m11-this.m22)*2;a.s=(this.m21-this.m12)/c;a.x=0.25*c;a.y=(this.m01+this.m10)/c;a.z=(this.m02+this.m20)/c}else{if(this.m11>this.m22){var c=Math.sqrt(1+this.m11-this.m00-this.m22)*2;a.s=(this.m02-this.m20)/c;a.x=(this.m01+this.m10)/c;a.y=0.25*c;a.z=(this.m12+this.m21)/c}else{var c=Math.sqrt(1+this.m22-this.m00-this.m11)*2;a.s=(this.m10-this.m01)/c;a.x=(this.m02+this.m20)/c;a.y=(this.m12+this.m21)/c;a.z=0.25*c}}}return a},toArray:function(a){if(a==null){a=okA.array()}a.push(this.m00,this.m10,this.m20,this.m30,this.m01,this.m11,this.m21,this.m31,this.m02,this.m12,this.m22,this.m32,this.m03,this.m13,this.m23,this.m33);return a}};function okMat4Add(d,c){var a=okA.mat4();a.m00=d.m00+c.m00;a.m10=d.m10+c.m10;a.m20=d.m20+c.m20;a.m30=d.m30+c.m30;a.m01=d.m01+c.m01;a.m11=d.m11+c.m11;a.m21=d.m21+c.m21;a.m31=d.m31+c.m31;a.m02=d.m02+c.m02;a.m12=d.m12+c.m12;a.m22=d.m22+c.m22;a.m32=d.m32+c.m32;a.m03=d.m03+c.m03;a.m13=d.m13+c.m13;a.m23=d.m23+c.m23;a.m33=d.m33+c.m33;return a}function okMat4AddVal(c,d){var a=okA.mat4();a.m00=c.m00+d;a.m10=c.m10+d;a.m20=c.m20+d;a.m30=c.m30+d;a.m01=c.m01+d;a.m11=c.m11+d;a.m21=c.m21+d;a.m31=c.m31+d;a.m02=c.m02+d;a.m12=c.m12+d;a.m22=c.m22+d;a.m32=c.m32+d;a.m03=c.m03+d;a.m13=c.m13+d;a.m23=c.m23+d;a.m33=c.m33+d;return a}function okValAddMat4(d,c){var a=okA.mat4();a.m00=c.m00+d;a.m10=c.m10+d;a.m20=c.m20+d;a.m30=c.m30+d;a.m01=c.m01+d;a.m11=c.m11+d;a.m21=c.m21+d;a.m31=c.m31+d;a.m02=c.m02+d;a.m12=c.m12+d;a.m22=c.m22+d;a.m32=c.m32+d;a.m03=c.m03+d;a.m13=c.m13+d;a.m23=c.m23+d;a.m33=c.m33+d;return a}function okMat4Sub(d,c){var a=okA.mat4();a.m00=d.m00-c.m00;a.m10=d.m10-c.m10;a.m20=d.m20-c.m20;a.m30=d.m30-c.m30;a.m01=d.m01-c.m01;a.m11=d.m11-c.m11;a.m21=d.m21-c.m21;a.m31=d.m31-c.m31;a.m02=d.m02-c.m02;a.m12=d.m12-c.m12;a.m22=d.m22-c.m22;a.m32=d.m32-c.m32;a.m03=d.m03-c.m03;a.m13=d.m13-c.m13;a.m23=d.m23-c.m23;a.m33=d.m33-c.m33;return a}function okMat4SubVal(c,d){var a=okA.mat4();a.m00=c.m00-d;a.m10=c.m10-d;a.m20=c.m20-d;a.m30=c.m30-d;a.m01=c.m01-d;a.m11=c.m11-d;a.m21=c.m21-d;a.m31=c.m31-d;a.m02=c.m02-d;a.m12=c.m12-d;a.m22=c.m22-d;a.m32=c.m32-d;a.m03=c.m03-d;a.m13=c.m13-d;a.m23=c.m23-d;a.m33=c.m33-d;return a}function okValSubMat4(d,c){var a=okA.mat4();a.m00=d-c.m00;a.m10=d-c.m10;a.m20=d-c.m20;a.m30=d-c.m30;a.m01=d-c.m01;a.m11=d-c.m11;a.m21=d-c.m21;a.m31=d-c.m31;a.m02=d-c.m02;a.m12=d-c.m12;a.m22=d-c.m22;a.m32=d-c.m32;a.m03=d-c.m03;a.m13=d-c.m13;a.m23=d-c.m23;a.m33=d-c.m33;return a}function okMat4Mul(d,c){var a=okA.mat4();a.m00=d.m00*c.m00+d.m01*c.m10+d.m02*c.m20+d.m03*c.m30;a.m10=d.m10*c.m00+d.m11*c.m10+d.m12*c.m20+d.m13*c.m30;a.m20=d.m20*c.m00+d.m21*c.m10+d.m22*c.m20+d.m23*c.m30;a.m30=d.m30*c.m00+d.m31*c.m10+d.m32*c.m20+d.m33*c.m30;a.m01=d.m00*c.m01+d.m01*c.m11+d.m02*c.m21+d.m03*c.m31;a.m11=d.m10*c.m01+d.m11*c.m11+d.m12*c.m21+d.m13*c.m31;a.m21=d.m20*c.m01+d.m21*c.m11+d.m22*c.m21+d.m23*c.m31;a.m31=d.m30*c.m01+d.m31*c.m11+d.m32*c.m21+d.m33*c.m31;a.m02=d.m00*c.m02+d.m01*c.m12+d.m02*c.m22+d.m03*c.m32;a.m12=d.m10*c.m02+d.m11*c.m12+d.m12*c.m22+d.m13*c.m32;a.m22=d.m20*c.m02+d.m21*c.m12+d.m22*c.m22+d.m23*c.m32;a.m32=d.m30*c.m02+d.m31*c.m12+d.m32*c.m22+d.m33*c.m32;a.m03=d.m00*c.m03+d.m01*c.m13+d.m02*c.m23+d.m03*c.m33;a.m13=d.m10*c.m03+d.m11*c.m13+d.m12*c.m23+d.m13*c.m33;a.m23=d.m20*c.m03+d.m21*c.m13+d.m22*c.m23+d.m23*c.m33;a.m33=d.m30*c.m03+d.m31*c.m13+d.m32*c.m23+d.m33*c.m33;return a}function okMat4MulVal(c,d){var a=okA.mat4();a.m00=c.m00*d;a.m10=c.m10*d;a.m20=c.m20*d;a.m30=c.m30*d;a.m01=c.m01*d;a.m11=c.m11*d;a.m21=c.m21*d;a.m31=c.m31*d;a.m02=c.m02*d;a.m12=c.m12*d;a.m22=c.m22*d;a.m32=c.m32*d;a.m03=c.m03*d;a.m13=c.m13*d;a.m23=c.m23*d;a.m33=c.m33*d;return a}function okValMulMat4(d,c){var a=okA.mat4();a.m00=c.m00*d;a.m10=c.m10*d;a.m20=c.m20*d;a.m30=c.m30*d;a.m01=c.m01*d;a.m11=c.m11*d;a.m21=c.m21*d;a.m31=c.m31*d;a.m02=c.m02*d;a.m12=c.m12*d;a.m22=c.m22*d;a.m32=c.m32*d;a.m03=c.m03*d;a.m13=c.m13*d;a.m23=c.m23*d;a.m33=c.m33*d;return a}function okMat4MulVec4(c,a){var d=okA.vec4();d.x=c.m00*a.x+c.m01*a.y+c.m02*a.z+c.m03*a.w;d.y=c.m10*a.x+c.m11*a.y+c.m12*a.z+c.m13*a.w;d.z=c.m20*a.x+c.m21*a.y+c.m22*a.z+c.m23*a.w;d.w=c.m30*a.x+c.m31*a.y+c.m32*a.z+c.m33*a.w;return d}function okMat4MulVec3(d,c){var a=okA.vec4();a.x=d.m00*c.x+d.m01*c.y+d.m02*c.z+d.m03;a.y=d.m10*c.x+d.m11*c.y+d.m12*c.z+d.m13;a.z=d.m20*c.x+d.m21*c.y+d.m22*c.z+d.m23;a.w=d.m30*c.x+d.m31*c.y+d.m32*c.z+d.m33;var e=1/a.w;var f=okA.vec3();f.x=a.x*e;f.y=a.y*e;f.z=a.z*e;return f}function okMat4Lerp(d,c,e){var a=okA.mat4();a.m00=d.m00*(1-e)+c.m00*e;a.m10=d.m10*(1-e)+c.m10*e;a.m20=d.m20*(1-e)+c.m20*e;a.m30=d.m30*(1-e)+c.m30*e;a.m01=d.m01*(1-e)+c.m01*e;a.m11=d.m11*(1-e)+c.m11*e;a.m21=d.m21*(1-e)+c.m21*e;a.m31=d.m31*(1-e)+c.m31*e;a.m02=d.m02*(1-e)+c.m02*e;a.m12=d.m12*(1-e)+c.m12*e;a.m22=d.m22*(1-e)+c.m22*e;a.m32=d.m32*(1-e)+c.m32*e;a.m03=d.m03*(1-e)+c.m03*e;a.m13=d.m13*(1-e)+c.m13*e;a.m23=d.m23*(1-e)+c.m23*e;a.m33=d.m33*(1-e)+c.m33*e;return a}function okMat4Trans(f,e,d){var c=okA.vec3();if(e!=null){c.x=f;c.y=e;c.z=d}else{c.x=f.x;c.y=f.y;c.z=f.z}var a=okA.mat4();a.setColumn(3,c.x,c.y,c.z,1);okA._vec3(c);return a}function okMat4Scale(e,d,c){var f=okA.vec3();if(d!=null){f.x=e;f.y=d;f.z=c}else{f.x=e.x;f.y=e.y;f.z=e.z}var a=okA.mat4();a.m00=f.x;a.m11=f.y;a.m22=f.z;okA._vec3(f);return a}function okMat4Rot(l,o,n,m){var h=okA.vec3();if(n!=null){h.x=o;h.y=n;h.z=m}else{h.x=o.x;h.y=o.y;h.z=o.z}var k=h.normalize();okA._vec3(h);var d=l*Math.PI/180;var e=Math.cos(d*0.5);var c=Math.sin(d*0.5);var a=new okQuat();a.s=e;a.x=c*k.x;a.y=c*k.y;a.z=c*k.z;okA._vec3(k);var f=okA.mat4();a.toMat4(f);return f}function okMat4RotX(e){var f=e*Math.PI/180;var a=Math.cos(f),d=Math.sin(f);var c=okA.mat4();c.m11=a;c.m12=-d;c.m21=d;c.m22=a;return c}function okMat4RotY(e){var f=e*Math.PI/180;var a=Math.cos(f),d=Math.sin(f);var c=okA.mat4();c.m00=a;c.m02=d;c.m20=-d;c.m22=a;return c}function okMat4RotZ(e){var f=e*Math.PI/180;var a=Math.cos(f),d=Math.sin(f);var c=okA.mat4();c.m00=a;c.m01=-d;c.m10=d;c.m11=a;return c}function okMat4Proj(k,e,h,l){var f=k*Math.PI/360;var a=l-h;var d=1/Math.tan(f);var c=okA.mat4();c.m00=d/e;c.m11=d;c.m22=-(l+h)/a;c.m32=-1;c.m23=-2*h*l/a;c.m33=0;return c}function okMat4Ortho(a,h,e,d,f,k){var c=okA.mat4();c.m00=2/(h-a);c.m11=2/(e-d);c.m22=-2/(k-f);c.m03=-(h+a)/(h-a);c.m13=-(e+d)/(e-d);c.m23=-(k+f)/(k-f);return c}function okMat4LookAt(k,c,f){var d=okA.vec3();d.x=k.x-c.x;d.y=k.y-c.y;d.z=k.z-c.z;d.normalize(true);var e=f.normalize();var h=okVec3Cross(e,d);var a=okA.mat4();a.m00=h.x;a.m10=h.y;a.m20=h.z;a.m01=e.x;a.m11=e.y;a.m21=e.z;a.m02=d.x;a.m12=d.y;a.m22=d.z;a.m03=k.x;a.m13=k.y;a.m23=k.z;a.inverse(true);okA._vec3(h);okA._vec3(e);okA._vec3(d);return a}function okMat43(a){this.m00=((a!=null)?a:1);this.m10=0;this.m20=0;this.m01=0;this.m11=((a!=null)?a:1);this.m21=0;this.m02=0;this.m12=0;this.m22=((a!=null)?a:1);this.m03=0;this.m13=0;this.m23=0}okMat43.prototype={set:function(a){this.m00=a[0];this.m10=a[1];this.m20=a[2];this.m01=a[3];this.m11=a[4];this.m21=a[5];this.m02=a[6];this.m12=a[7];this.m22=a[8];this.m03=a[9];this.m13=a[10];this.m23=a[11]},identity:function(){this.m00=1;this.m10=0;this.m20=0;this.m01=0;this.m11=1;this.m21=0;this.m02=0;this.m12=0;this.m22=1;this.m03=0;this.m13=0;this.m23=0},clone:function(a){var a=(a?a:okA.mat43());a.m00=this.m00;a.m10=this.m10;a.m20=this.m20;a.m01=this.m01;a.m11=this.m11;a.m21=this.m21;a.m02=this.m02;a.m12=this.m12;a.m22=this.m22;a.m03=this.m03;a.m13=this.m13;a.m23=this.m23;return a},equal:function(a){return okFloatEqual(this.m00,a.m00)&&okFloatEqual(this.m10,a.m10)&&okFloatEqual(this.m20,a.m20)&&okFloatEqual(this.m01,a.m01)&&okFloatEqual(this.m11,a.m11)&&okFloatEqual(this.m21,a.m21)&&okFloatEqual(this.m02,a.m02)&&okFloatEqual(this.m12,a.m12)&&okFloatEqual(this.m22,a.m22)&&okFloatEqual(this.m03,a.m03)&&okFloatEqual(this.m13,a.m13)&&okFloatEqual(this.m23,a.m23)},setColumn:function(d,c,a,e){if(d==0){if(okIsNumber(c)){this.m00=c;this.m10=a;this.m20=e}else{this.m00=c.x;this.m10=c.y;this.m20=c.z}}else{if(d==1){if(okIsNumber(c)){this.m01=c;this.m11=a;this.m21=e}else{this.m01=c.x;this.m11=c.y;this.m21=c.z}}else{if(d==2){if(okIsNumber(c)){this.m02=c;this.m12=a;this.m22=e}else{this.m02=c.x;this.m12=c.y;this.m22=c.z}}else{if(d==3){if(okIsNumber(c)){this.m03=c;this.m13=a;this.m23=e}else{this.m03=c.x;this.m13=c.y;this.m23=c.z}}}}}},getColumn:function(c){var a=okA.vec3();if(c==0){a.set(this.m00,this.m10,this.m20)}else{if(c==1){a.set(this.m01,this.m11,this.m21)}else{if(c==2){a.set(this.m02,this.m12,this.m22)}else{if(c==3){a.set(this.m03,this.m13,this.m23)}}}}return a},det:function(){var q=this.m00,p=this.m01,o=this.m02,n=this.m03;var m=this.m10,k=this.m11,h=this.m12,f=this.m13;var e=this.m20,d=this.m21,c=this.m22,a=this.m23;var l=q*k*c+p*h*e+o*m*d-q*h*d-p*m*c-o*k*e;return l},inverse:function(p){var t=this.m00,s=this.m01,q=this.m02,o=this.m03;var m=this.m10,l=this.m11,k=this.m12,h=this.m13;var f=this.m20,e=this.m21,d=this.m22,c=this.m23;var a=(p?this:okA.mat43());a.m00=l*d-k*e;a.m01=q*e-s*d;a.m02=s*k-q*l;a.m03=s*h*d+q*l*c+o*k*e-s*k*c-q*h*e-o*l*d;a.m10=k*f-m*d;a.m11=t*d-q*f;a.m12=q*m-t*k;a.m13=t*k*c+q*h*f+o*m*d-t*h*d-q*m*c-o*k*f;a.m20=m*e-l*f;a.m21=s*f-t*e;a.m22=t*l-s*m;a.m23=t*h*e+s*m*c+o*l*f-t*l*c-s*h*f-o*m*e;var u=t*l*d+s*k*f+q*m*e-t*k*e-s*m*d-q*l*f;var n=1/u;a.m00*=n;a.m01*=n;a.m02*=n;a.m03*=n;a.m10*=n;a.m11*=n;a.m12*=n;a.m13*=n;a.m20*=n;a.m21*=n;a.m22*=n;a.m23*=n;return a},transpose:function(l){var e=(l?this:okA.mat43());var o=this.m00,n=this.m01,m=this.m02;var k=this.m10,h=this.m11,f=this.m12;var d=this.m20,c=this.m21,a=this.m22;e.m00=o;e.m10=n;e.m20=m;e.m01=k;e.m11=h;e.m21=f;e.m02=d;e.m12=c;e.m22=a;e.m03=0;e.m13=0;e.m23=0;return e},translate:function(h,f,e,c,d){if(f.x){d=e;c=f.z;e=f.y;f=f.x}else{if(c==null){d=e;c=f;e=f}}var a=this;if(d){a=this.clone()}if(h==3){a.m03+=f;a.m13+=e;a.m23+=c}else{a.m03+=this.m00*f+this.m01*e+this.m02*c;a.m13+=this.m10*f+this.m11*e+this.m12*c;a.m23+=this.m20*f+this.m21*e+this.m22*c}return a},rot:function(F,c,A,z,y,f){var u=okA.vec3();if(y!=null){u.x=A;u.y=z;u.z=y}else{u.x=A.x;u.y=A.y;u.z=A.z;f=z}u.normalize(true);var k=c*Math.PI/180;var w=Math.cos(k*0.5);var x=Math.sin(k*0.5);var s=okA.quat();s.s=w;s.x=x*u.x;s.y=x*u.y;s.z=x*u.z;okA._vec3(u);var v=okA.mat4();s.toMat4(v);var t=this.m00;var E=this.m10;var h=this.m20;var p=this.m01;var D=this.m11;var e=this.m21;var o=this.m02;var C=this.m12;var d=this.m22;var n=this.m03;var B=his.m13;var a=this.m23;var l=(f?this:okA.mat43());if(F==3){l.m00=v.m00*t+v.m01*E+v.m02*h;l.m10=v.m10*t+v.m11*E+v.m12*h;l.m20=v.m20*t+v.m21*E+v.m22*h;l.m01=v.m00*p+v.m01*D+v.m02*e;l.m11=v.m10*p+v.m11*D+v.m12*e;l.m21=v.m20*p+v.m21*D+v.m22*e;l.m02=v.m00*o+v.m01*C+v.m02*d;l.m12=v.m10*o+v.m11*C+v.m12*d;l.m22=v.m20*o+v.m21*C+v.m22*d;l.m03=v.m00*n+v.m01*B+v.m02*a+v.m03;l.m13=v.m10*n+v.m11*B+v.m12*a+v.m13;l.m23=v.m20*n+v.m21*B+v.m22*a+v.m23}else{l.m00=t*v.m00+p*v.m10+o*v.m20;l.m10=E*v.m00+D*v.m10+C*v.m20;l.m20=h*v.m00+e*v.m10+d*v.m20;l.m01=t*v.m01+p*v.m11+o*v.m21;l.m11=E*v.m01+D*v.m11+C*v.m21;l.m21=h*v.m01+e*v.m11+d*v.m21;l.m02=t*v.m02+p*v.m12+o*v.m22;l.m12=E*v.m02+D*v.m12+C*v.m22;l.m22=h*v.m02+e*v.m12+d*v.m22;l.m03=t*v.m03+p*v.m13+o*v.m23+n;l.m13=E*v.m03+D*v.m13+C*v.m23+B;l.m23=h*v.m03+e*v.m13+d*v.m23+a}okA._mat4(v);okA._quat(s);return l},rotX:function(x,c,f){var l=c*Math.PI/180;var k=Math.cos(l),s=Math.sin(l);var q=this.m00;var w=this.m10;var h=this.m20;var p=this.m01;var v=this.m11;var e=this.m21;var o=this.m02;var u=this.m12;var d=this.m22;var n=this.m03;var t=this.m13;var a=this.m23;var m=(f?this:this.clone());if(x==3){m.m10=k*w-s*h;m.m20=s*w+k*h;m.m11=k*v-s*e;m.m21=s*v+k*e;m.m12=k*u-s*d;m.m22=s*u+k*d;m.m03=n;m.m13=k*t-s*a;m.m23=s*t+k*a}else{m.m01=p*k+o*s;m.m11=v*k+u*s;m.m21=e*k+d*s;m.m02=p*-s+o*k;m.m12=v*-s+u*k;m.m22=e*-s+d*k}return m},rotY:function(x,c,f){var l=c*Math.PI/180;var k=Math.cos(l),s=Math.sin(l);var q=this.m00;var w=this.m10;var h=this.m20;var p=this.m01;var v=this.m11;var e=this.m21;var o=this.m02;var u=this.m12;var d=this.m22;var n=this.m03;var t=this.m13;var a=this.m23;var m=(f?this:this.clone());if(x==3){m.m00=k*q+s*h;m.m20=-s*q+k*h;m.m01=k*p+s*e;m.m21=-s*p+k*e;m.m02=k*o+s*d;m.m22=-s*o+k*d;m.m03=k*n+s*a;m.m23=-s*n+k*a}else{m.m00=q*k+o*-s;m.m10=w*k+u*-s;m.m20=h*k+d*-s;m.m02=q*s+o*k;m.m12=w*s+u*k;m.m22=h*s+d*k}return m},rotZ:function(x,c,f){var l=c*Math.PI/180;var k=Math.cos(l),s=Math.sin(l);var q=this.m00;var w=this.m10;var h=this.m20;var p=this.m01;var v=this.m11;var e=this.m21;var o=this.m02;var u=this.m12;var d=this.m22;var n=this.m03;var t=this.m13;var a=this.m23;var m=(f?this:this.clone());if(x==3){m.m00=k*q+-s*w;m.m10=s*q+k*w;m.m01=k*p+-s*v;m.m11=s*p+k*v;m.m02=k*o+-s*u;m.m12=s*o+k*u;m.m03=k*n+-s*t;m.m13=s*n+k*t}else{m.m00=q*k+p*s;m.m10=w*k+v*s;m.m20=h*k+e*s;m.m01=q*-s+p*k;m.m11=w*-s+v*k;m.m21=h*-s+e*k}return m},scale:function(a,h,e,d,m){var l,k,f;if(e){l=h;k=e;f=d}else{if(h.x){l=h.x;e=h.y;d=h.z;m=e}else{l=h;e=h;d=h;m=e}}var c=(m?this:this.clone());if(a==3){c.m00*=l;c.m10*=k;c.m20*=f;c.m01*=l;c.m11*=k;c.m21*=f;c.m02*=l;c.m12*=k;c.m22*=f;c.m03*=l;c.m13*=k;c.m23*=f}else{c.m00*=l;c.m10*=l;c.m20*=l;c.m01*=k;c.m11*=k;c.m21*=k;c.m02*=f;c.m12*=f;c.m22*=f}return c},toMat3:function(a){if(a==null){a=okA.mat3()}a.m00=this.m00;a.m10=this.m10;a.m20=this.m20;a.m30=0;a.m01=this.m01;a.m11=this.m11;a.m21=this.m21;a.m31=0;a.m02=this.m02;a.m12=this.m12;a.m22=this.m22;a.m32=0;return a},toMat4:function(a){if(a==null){a=okA.mat4()}a.m00=this.m00;a.m10=this.m10;a.m20=this.m20;a.m30=0;a.m01=this.m01;a.m11=this.m11;a.m21=this.m21;a.m31=0;a.m02=this.m02;a.m12=this.m12;a.m22=this.m22;a.m32=0;a.m03=this.m03;a.m13=this.m13;a.m23=this.m23;a.m33=1;return a},toQuat:function(a){if(a==null){a=okA.quat()}var d=this.m00+this.m11+this.m22;if(d>0){var c=Math.sqrt(d+1)*2;a.s=0.25*c;a.x=(this.m21-this.m12)/c;a.y=(this.m02-this.m20)/c;a.z=(this.m10-this.m01)/c}else{if((this.m00>this.m11)&&(this.m00>this.m22)){var c=Math.sqrt(1+this.m00-this.m11-this.m22)*2;a.s=(this.m21-this.m12)/c;a.x=0.25*c;a.y=(this.m01+this.m10)/c;a.z=(this.m02+this.m20)/c}else{if(this.m11>this.m22){var c=Math.sqrt(1+this.m11-this.m00-this.m22)*2;a.s=(this.m02-this.m20)/c;a.x=(this.m01+this.m10)/c;a.y=0.25*c;a.z=(this.m12+this.m21)/c}else{var c=Math.sqrt(1+this.m22-this.m00-this.m11)*2;a.s=(this.m10-this.m01)/c;a.x=(this.m02+this.m20)/c;a.y=(this.m12+this.m21)/c;a.z=0.25*c}}}return a},toArray:function(a){if(a==null){a=okA.array()}a.push(this.m00,this.m10,this.m20,this.m01,this.m11,this.m21,this.m02,this.m12,this.m22,this.m03,this.m13,this.m23);return a}};function okMat43Add(d,c){var a=okA.mat43();a.m00=d.m00+c.m00;a.m10=d.m10+c.m10;a.m20=d.m20+c.m20;a.m01=d.m01+c.m01;a.m11=d.m11+c.m11;a.m21=d.m21+c.m21;a.m02=d.m02+c.m02;a.m12=d.m12+c.m12;a.m22=d.m22+c.m22;a.m03=d.m03+c.m03;a.m13=d.m13+c.m13;a.m23=d.m23+c.m23;return a}function okMat43AddVal(c,d){var a=okA.mat43();a.m00=c.m00+d;a.m10=c.m10+d;a.m20=c.m20+d;a.m01=c.m01+d;a.m11=c.m11+d;a.m21=c.m21+d;a.m02=c.m02+d;a.m12=c.m12+d;a.m22=c.m22+d;a.m03=c.m03+d;a.m13=c.m13+d;a.m23=c.m23+d;return a}function okValAddMat43(d,c){var a=okA.mat43();a.m00=c.m00+d;a.m10=c.m10+d;a.m20=c.m20+d;a.m01=c.m01+d;a.m11=c.m11+d;a.m21=c.m21+d;a.m02=c.m02+d;a.m12=c.m12+d;a.m22=c.m22+d;a.m03=c.m03+d;a.m13=c.m13+d;a.m23=c.m23+d;return a}function okMat43Sub(d,c){var a=okA.mat43();a.m00=d.m00-c.m00;a.m10=d.m10-c.m10;a.m20=d.m20-c.m20;a.m01=d.m01-c.m01;a.m11=d.m11-c.m11;a.m21=d.m21-c.m21;a.m02=d.m02-c.m02;a.m12=d.m12-c.m12;a.m22=d.m22-c.m22;a.m03=d.m03-c.m03;a.m13=d.m13-c.m13;a.m23=d.m23-c.m23;return a}function okMat43SubVal(c,d){var a=okA.mat43();a.m00=c.m00-d;a.m10=c.m10-d;a.m20=c.m20-d;a.m01=c.m01-d;a.m11=c.m11-d;a.m21=c.m21-d;a.m02=c.m02-d;a.m12=c.m12-d;a.m22=c.m22-d;a.m03=c.m03-d;a.m13=c.m13-d;a.m23=c.m23-d;return a}function okValSubMat43(d,c){var a=okA.mat43();a.m00=d-c.m00;a.m10=d-c.m10;a.m20=d-c.m20;a.m01=d-c.m01;a.m11=d-c.m11;a.m21=d-c.m21;a.m02=d-c.m02;a.m12=d-c.m12;a.m22=d-c.m22;a.m03=d-c.m03;a.m13=d-c.m13;a.m23=d-c.m23;return a}function okMat43Mul(d,c){var a=okA.mat43();a.m00=d.m00*c.m00+d.m01*c.m10+d.m02*c.m20;a.m10=d.m10*c.m00+d.m11*c.m10+d.m12*c.m20;a.m20=d.m20*c.m00+d.m21*c.m10+d.m22*c.m20;a.m01=d.m00*c.m01+d.m01*c.m11+d.m02*c.m21;a.m11=d.m10*c.m01+d.m11*c.m11+d.m12*c.m21;a.m21=d.m20*c.m01+d.m21*c.m11+d.m22*c.m21;a.m02=d.m00*c.m02+d.m01*c.m12+d.m02*c.m22;a.m12=d.m10*c.m02+d.m11*c.m12+d.m12*c.m22;a.m22=d.m20*c.m02+d.m21*c.m12+d.m22*c.m22;a.m03=d.m00*c.m03+d.m01*c.m13+d.m02*c.m23+d.m03;a.m13=d.m10*c.m03+d.m11*c.m13+d.m12*c.m23+d.m13;a.m23=d.m20*c.m03+d.m21*c.m13+d.m22*c.m23+d.m23;return a}function okMat43MulVal(c,d){var a=okA.mat43();a.m00=c.m00*d;a.m10=c.m10*d;a.m20=c.m20*d;a.m01=c.m01*d;a.m11=c.m11*d;a.m21=c.m21*d;a.m02=c.m02*d;a.m12=c.m12*d;a.m22=c.m22*d;a.m03=c.m03*d;a.m13=c.m13*d;a.m23=c.m23*d;return a}function okValMulMat43(d,c){var a=okA.mat43();a.m00=c.m00*d;a.m10=c.m10*d;a.m20=c.m20*d;a.m01=c.m01*d;a.m11=c.m11*d;a.m21=c.m21*d;a.m02=c.m02*d;a.m12=c.m12*d;a.m22=c.m22*d;a.m03=c.m03*d;a.m13=c.m13*d;a.m23=c.m23*d;return a}function okMat43MulVec3(c,a){var d=okA.vec3();d.x=c.m00*a.x+c.m01*a.y+c.m02*a.z+c.m03;d.y=c.m10*a.x+c.m11*a.y+c.m12*a.z+c.m13;d.z=c.m20*a.x+c.m21*a.y+c.m22*a.z+c.m23;return d}function okMat43Lerp(d,c,e){var a=okA.mat43();a.m00=d.m00*(1-e)+c.m00*e;a.m10=d.m10*(1-e)+c.m10*e;a.m20=d.m20*(1-e)+c.m20*e;a.m01=d.m01*(1-e)+c.m01*e;a.m11=d.m11*(1-e)+c.m11*e;a.m21=d.m21*(1-e)+c.m21*e;a.m02=d.m02*(1-e)+c.m02*e;a.m12=d.m12*(1-e)+c.m12*e;a.m22=d.m22*(1-e)+c.m22*e;a.m03=d.m03*(1-e)+c.m03*e;a.m13=d.m13*(1-e)+c.m13*e;a.m23=d.m23*(1-e)+c.m23*e;return a}function okMat43Trans(f,e,d){var c=okA.vec3();if(e!=null){c.x=f;c.y=e;c.z=d}else{c.x=f.x;c.y=f.y;c.z=f.z}var a=okA.mat43();a.setColumn(3,c.x,c.y,c.z);okA._vec3(c);return a}function okMat43Scale(e,d,c){var f=okA.vec3();if(d!=null){f.x=e;f.y=d;f.z=c}else{f.x=e.x;f.y=e.y;f.z=e.z}var a=okA.mat43();a.m00=f.x;a.m11=f.y;a.m22=f.z;okA._vec3(f);return a}function okMat43RotX(e){var f=e*Math.PI/180;var a=Math.cos(f),d=Math.sin(f);var c=okA.mat43();c.m11=a;c.m12=-d;c.m21=d;c.m22=a;return c}function okMat43RotY(e){var f=e*Math.PI/180;var a=Math.cos(f),d=Math.sin(f);var c=okA.mat43();c.m00=a;c.m02=d;c.m20=-d;c.m22=a;return c}function okMat43RotZ(e){var f=e*Math.PI/180;var a=Math.cos(f),d=Math.sin(f);var c=okA.mat43();c.m00=a;c.m01=-d;c.m10=d;c.m11=a;return c}function okMat43Rot(l,o,n,m){var d=l*Math.PI/180;var h=okA.vec3();if(n!=null){h.x=o;h.y=n;h.z=m}else{h.x=o.x;h.y=o.y;h.z=o.z}var k=h.normalize();okA._vec3(h);var e=Math.cos(d*0.5);var c=Math.sin(d*0.5);var a=new okQuat();a.s=e;a.x=c*k.x;a.y=c*k.y;a.z=c*k.z;okA._vec3(k);var f=okA.mat43();a.toMat43(f);return f}function okMat43LookAt(k,c,f){var d=okA.vec3();d.x=k.x-c.x;d.y=k.y-c.y;d.z=k.z-c.z;d.normalize(true);var e=f.normalize();var h=okVec3Cross(e,d);var a=okA.mat43();a.m00=h.x;a.m10=h.y;a.m20=h.z;a.m01=e.x;a.m11=e.y;a.m21=e.z;a.m02=d.x;a.m12=d.y;a.m22=d.z;a.m03=k.x;a.m13=k.y;a.m23=k.z;a.inverse(true);okA._vec3(h);okA._vec3(e);okA._vec3(d);return a}function okQuat(e,d,c,a){this.s=((e!=null)?e:1);this.x=((d!=null)?d:0);this.y=((c!=null)?c:0);this.z=((a!=null)?a:0)}okQuat.prototype={set:function(e,d,c,a){this.s=e;this.x=d;this.y=c;this.z=a},clone:function(a){var a=(a?a:okA.quat());a.s=this.s;a.x=this.x;a.y=this.y;a.z=this.z;return a},equal:function(a){return this.s==a.s&&this.x==a.x&&this.y==a.y&&this.z==a.z},getImVec3:function(){var a=okA.vec3();a.x=this.x;a.y=this.y;a.z=this.z;return a},len:function(){return Math.sqrt(this.s*this.s+this.x*this.x+this.y*this.y+this.z*this.z)},lenSquare:function(){return this.s*this.s+this.x*this.x+this.y*this.y+this.z*this.z},normalize:function(d){if(d){var c=1/Math.sqrt(this.s*this.s+this.x*this.x+this.y*this.y+this.z*this.z);this.s*=c;this.x*=c;this.y*=c;this.z*=c}else{var a=okA.quat();var c=1/Math.sqrt(this.s*this.s+this.x*this.x+this.y*this.y+this.z*this.z);a.s=this.s*c;a.x=this.x*c;a.y=this.y*c;a.z=this.z*c;return a}},conjugate:function(c){var a=c?this:okA.quat();a.set(this.s,-this.x,-this.y,-this.z);return a},inverse:function(e){var d=this.conjugate();var a=1/(this.s*this.s+this.x*this.x+this.y*this.y+this.z*this.z);var c=e?this:okA.quat();c.set(d.s*a,d.x*a,d.y*a,d.z*a);okA._quat(d);return c},toMat3:function(a){var c=2/Math.sqrt(this.s*this.s+this.x*this.x+this.y*this.y+this.z*this.z);if(a==null){a=okA.mat3()}a.m00=1-c*(this.y*this.y+this.z*this.z);a.m10=c*this.x*this.y+c*this.s*this.z;a.m20=-c*this.s*this.y+c*this.x*this.z;a.m01=c*this.x*this.y-c*this.s*this.z;a.m11=1-c*(this.x*this.x+this.z*this.z);a.m21=c*this.s*this.x+c*this.y*this.z;a.m02=c*this.s*this.y+c*this.x*this.z;a.m12=-c*this.s*this.x+c*this.y*this.z;a.m22=1-c*(this.x*this.x+this.y*this.y);return a},toMat4:function(a){var c=2/Math.sqrt(this.s*this.s+this.x*this.x+this.y*this.y+this.z*this.z);if(a==null){a=okA.mat4()}a.m00=1-c*(this.y*this.y+this.z*this.z);a.m10=c*this.x*this.y+c*this.s*this.z;a.m20=-c*this.s*this.y+c*this.x*this.z;a.m01=c*this.x*this.y-c*this.s*this.z;a.m11=1-c*(this.x*this.x+this.z*this.z);a.m21=c*this.s*this.x+c*this.y*this.z;a.m02=c*this.s*this.y+c*this.x*this.z;a.m12=-c*this.s*this.x+c*this.y*this.z;a.m22=1-c*(this.x*this.x+this.y*this.y);return a},toMat43:function(a){var c=2/Math.sqrt(this.s*this.s+this.x*this.x+this.y*this.y+this.z*this.z);if(a==null){a=okA.mat43()}a.m00=1-c*(this.y*this.y+this.z*this.z);a.m10=c*this.x*this.y+c*this.s*this.z;a.m20=-c*this.s*this.y+c*this.x*this.z;a.m01=c*this.x*this.y-c*this.s*this.z;a.m11=1-c*(this.x*this.x+this.z*this.z);a.m21=c*this.s*this.x+c*this.y*this.z;a.m02=c*this.s*this.y+c*this.x*this.z;a.m12=-c*this.s*this.x+c*this.y*this.z;a.m22=1-c*(this.x*this.x+this.y*this.y);return a}};function okQuatAdd(d,a){var c=okA.quat();c.s=d.s+a.s;c.x=d.x+a.x;c.y=d.y+a.y;c.z=d.z+a.z;return c}function okQuatSub(d,a){var c=okA.quat();c.s=d.s-a.s;c.x=d.x-a.x;c.y=d.y-a.y;c.z=d.z-a.z;return c}function okQuatMul(f,e){var a=okA.quat();var d=f.getImVec3();var c=e.getImVec3();a.s=f.s*e.s-okVec3Dot(d,c);var m=okVec3Cross(d,c);var l=okVec3MulVal(d,e.s);var k=okVec3MulVal(c,f.s);var n=okVec3Add(m,l);var h=okVec3Add(n,k);a.x=h.x;a.y=h.y;a.z=h.z;okA._vec3(d);okA._vec3(c);okA._vec3(m);okA._vec3(l);okA._vec3(k);okA._vec3(n);okA._vec3(h);return a}function okQuatDot(c,a){return c.s*a.s+c.x*a.x+c.y*a.y+c.z*a.z}function okQuatSlerp(e,d,m){if(e.equal(d)){return e.clone()}var f=okA.quat();var k=e.s*d.s+e.x*d.x+e.y*d.y+e.z*d.z;if(k<0){k=-k;f.s=-d.s;f.x=-d.x;f.y=-d.y;f.z=-d.z}else{f.s=d.s;f.x=d.x;f.y=d.y;f.z=d.z}k=(k<1?k:1);var c,a;if(k!=1&&k!=-1){var l=Math.acos(k);var h=Math.sin(l);c=Math.sin((1-m)*l)/h;a=Math.sin(m*l)/h}else{c=1-m;a=m}f.s=c*e.s+a*f.s;f.x=c*e.x+a*f.x;f.y=c*e.y+a*f.y;f.z=c*e.z+a*f.z;return f}function okQuatRot(n,l,k,h){var c=n*Math.PI/180;var f=okA.vec3();if(k!=null){f.x=l;f.y=k;f.z=h}else{f.x=l.x;f.y=l.y;f.z=l.z}var m=f.normalize();okA._vec3(f);var d=Math.cos(c*0.5);var a=Math.sin(c*0.5);var e=okA.quat();e.s=d;e.x=a*m.x;e.y=a*m.y;e.z=a*m.z;okA._vec3(m);return e}function okPlane(a,c){this.vOrigin=okA.vec3();this.vNormal=okA.vec3();if(a){this.vOrigin.x=a.x;this.vOrigin.y=a.y;this.vOrigin.z=a.z}if(c){this.vNormal.x=c.x;this.vNormal.y=c.y;this.vNormal.z=c.z}else{this.vNormal.x=0;this.vNormal.y=1;this.vNormal.z=0}}okPlane.prototype={clone:function(a){var a=(a?a:okA.plane());a.vOrigin.x=this.vOrigin.x;a.vOrigin.y=this.vOrigin.y;a.vOrigin.z=this.vOrigin.z;a.vNormal.x=this.vNormal.x;a.vNormal.y=this.vNormal.y;a.vNormal.z=this.vNormal.z;return a},set:function(a,d){this.vOrigin.x=a.x;this.vOrigin.y=a.y;this.vOrigin.z=a.z;var c=1/Math.sqrt(d.x*d.x+d.y*d.y+d.z*d.z);this.vNormal.x=d.x*c;this.vNormal.y=d.y*c;this.vNormal.z=d.z*c},setOrigin:function(a){this.vOrigin.x=a.x;this.vOrigin.y=a.y;this.vOrigin.z=a.z},setNormal:function(c){var a=1/Math.sqrt(c.x*c.x+c.y*c.y+c.z*c.z);this.vNormal.x=c.x*a;this.vNormal.y=c.y*a;this.vNormal.z=c.z*a},setByCoefficients:function(f,d,c,a){var e=1/Math.sqrt(f*f+d*d+c*c);this.vNormal.x=f*e;this.vNormal.y=d*e;this.vNormal.z=c*e;if(!okFloatEqual(f,0)){this.vOrigin.x=-a/f;this.vOrigin.y=0;this.vOrigin.z=0}else{if(!okFloatEqual(d,0)){this.vOrigin.x=0;this.vOrigin.y=-a/d;this.vOrigin.z=0}else{this.vOrigin.x=0;this.vOrigin.y=0;this.vOrigin.z=-a/c}}},collideVertex:function(c){var d=this.vNormal.x*this.vOrigin.x+this.vNormal.y*this.vOrigin.y+this.vNormal.z*this.vOrigin.z;var a=this.vNormal.x*c.x+this.vNormal.y*c.y+this.vNormal.z*c.z;if(okFloatEqual(a,d)){return 2}else{if(a>d){return 1}else{return 0}}},collideLine:function(d,h,c){var a=(h.x-d.x)*this.vNormal.x+(h.y-d.y)*this.vNormal.y+(h.z-d.z)*this.vNormal.z;if(okFloatEqual(a,0)){if(this.collideVertex(d)==2){return 2}return 0}var f=okVec3Sub(this.vOrigin,d);var e=okVec3Dot(this.vNormal,f)/a;okA._vec3(f);if(c!=null){c.fT=e}return 1},collideRay:function(d,f,c){var a=okVec3Dot(f,this.vNormal);if(okFloatEqual(a,0)){if(this.collideVertex(d)==2){return 2}return 0}var h=okVec3Sub(this.vOrigin,d);var e=okVec3Dot(this.vNormal,h)/a;okA._vec3(h);if(e<0){return 0}if(c!=null){c.fT=e}return 1}};function okPlaneIntersect3(q,o,m){var n=q.vNormal;var l=o.vNormal;var k=m.vNormal;var f=okVec3Cross(l,k);var c=okVec3Cross(k,n);var p=okVec3Cross(n,l);var e=okVec3Dot(q.vOrigin,n);var d=okVec3Dot(o.vOrigin,l);var a=okVec3Dot(m.vOrigin,k);var v=okVec3MulVal(f,e);var t=okVec3MulVal(c,d);var s=okVec3MulVal(p,a);var h=n.x*(l.y*k.z-k.y*l.z)+l.x*(k.y*n.z-n.y*k.z)+k.x*(n.y*l.z-n.z*l.y);var u=okA.vec3();u.x=(v.x+t.x+s.x)/h;u.y=(v.y+t.y+s.y)/h;u.z=(v.z+t.z+s.z)/h;okA._vec3(f);okA._vec3(c);okA._vec3(p);okA._vec3(v);okA._vec3(t);okA._vec3(s);return u}function okAABBox(c,a){this.vMin=okA.vec3();this.vMax=okA.vec3();if(c!=null){this.vMin.x=c.x;this.vMin.y=c.y;this.vMin.z=c.z}if(a!=null){this.vMax.x=a.x;this.vMax.y=a.y;this.vMax.z=a.z}this.$71=[okA.vec3(),okA.vec3(),okA.vec3(),okA.vec3(),okA.vec3(),okA.vec3(),okA.vec3(),okA.vec3()];this.$p2=true}okAABBox.prototype={clone:function(a){var c=(a?a:okA.aabbox());c.set(this.vMin,this.vMax);return c},set:function(c,a){this.vMin.x=c.x;this.vMin.y=c.y;this.vMin.z=c.z;this.vMax.x=a.x;this.vMax.y=a.y;this.vMax.z=a.z;this.$p2=true},setMin:function(d,c,a){if(c==null){this.vMin.x=d.x;this.vMin.y=d.y;this.vMin.z=d.z}else{this.vMin.x=d;this.vMin.y=c;this.vMin.z=a}this.$p2=true},setMax:function(d,c,a){if(c==null){this.vMax.x=d.x;this.vMax.y=d.y;this.vMax.z=d.z}else{this.vMax.x=d;this.vMax.y=c;this.vMax.z=a}this.$p2=true},getMin:function(){return this.vMin.clone()},getMax:function(){return this.vMax.clone()},union:function(e,c){var f=okVec3Min(this.vMin,e.vMin);var d=okVec3Max(this.vMax,e.vMax);var a=c?this:okA.aabbox();a.set(f,d);okA._vec3(f);okA._vec3(d);return a},intersect:function(e){var f=okVec3Max(this.vMin,e.vMin);var c=okVec3Min(this.vMax,e.vMax);var d=okVec3Max(this.vMin,c);var a=okA.aabbox();a.set(f,d);okA._vec3(f);okA._vec3(c);okA._vec3(d);return a},getExtent:function(a){if(a==1){return Math.max(0,this.vMax.x-this.vMin.x)}else{if(a==2){return Math.max(0,this.vMax.y-this.vMin.z)}else{return Math.max(0,this.vMax.z-this.vMin.z)}}},getVolume:function(){return Math.max(0,(this.vMax.x-this.vMin.x))*Math.max(0,(this.vMax.y-this.vMin.y))*Math.max(0,(this.vMax.z-this.vMin.z))},getPoint:function(c){if(this.$p2){var o=this.$71[0];o.x=this.vMin.x;o.y=this.vMin.y;o.z=this.vMin.z;var n=this.$71[1];n.x=this.vMax.x;n.y=this.vMin.y;n.z=this.vMin.z;var m=this.$71[2];m.x=this.vMax.x;m.y=this.vMax.y;m.z=this.vMin.z;var k=this.$71[3];k.x=this.vMin.x;k.y=this.vMax.y;k.z=this.vMin.z;var h=this.$71[4];h.x=this.vMin.x;h.y=this.vMin.y;h.z=this.vMax.z;var f=this.$71[5];f.x=this.vMax.x;f.y=this.vMin.y;f.z=this.vMax.z;var e=this.$71[6];e.x=this.vMax.x;e.y=this.vMax.y;e.z=this.vMax.z;var d=this.$71[7];d.x=this.vMin.x;d.y=this.vMax.y;d.z=this.vMax.z;this.$p2=false}var a=this.$71[c];var l=okA.vec3();l.x=a.x;l.y=a.y;l.z=a.z;return l},transformMat:function(d){var f=okA.vec3();var e=okA.vec3();var a=okA.vec3();var c=okA.vec3();a.x=this.vMin.x;a.y=this.vMin.y;a.z=this.vMin.z;c.x=d.m00*a.x+d.m01*a.y+d.m02*a.z+d.m03;c.y=d.m10*a.x+d.m11*a.y+d.m12*a.z+d.m13;c.z=d.m20*a.x+d.m21*a.y+d.m22*a.z+d.m23;f.x=c.x;f.y=c.y;f.z=c.z;e.x=c.x;e.y=c.y;e.z=c.z;a.x=this.vMax.x;a.y=this.vMin.y;a.z=this.vMin.z;c.x=d.m00*a.x+d.m01*a.y+d.m02*a.z+d.m03;c.y=d.m10*a.x+d.m11*a.y+d.m12*a.z+d.m13;c.z=d.m20*a.x+d.m21*a.y+d.m22*a.z+d.m23;f.x=((f.x<c.x)?f.x:c.x);f.y=((f.y<c.y)?f.y:c.y);f.z=((f.z<c.z)?f.z:c.z);e.x=((e.x>c.x)?e.x:c.x);e.y=((e.y>c.y)?e.y:c.y);e.z=((e.z>c.z)?e.z:c.z);a.x=this.vMin.x;a.y=this.vMax.y;a.z=this.vMin.z;c.x=d.m00*a.x+d.m01*a.y+d.m02*a.z+d.m03;c.y=d.m10*a.x+d.m11*a.y+d.m12*a.z+d.m13;c.z=d.m20*a.x+d.m21*a.y+d.m22*a.z+d.m23;f.x=((f.x<c.x)?f.x:c.x);f.y=((f.y<c.y)?f.y:c.y);f.z=((f.z<c.z)?f.z:c.z);e.x=((e.x>c.x)?e.x:c.x);e.y=((e.y>c.y)?e.y:c.y);e.z=((e.z>c.z)?e.z:c.z);a.x=this.vMin.x;a.y=this.vMin.y;a.z=this.vMax.z;c.x=d.m00*a.x+d.m01*a.y+d.m02*a.z+d.m03;c.y=d.m10*a.x+d.m11*a.y+d.m12*a.z+d.m13;c.z=d.m20*a.x+d.m21*a.y+d.m22*a.z+d.m23;f.x=((f.x<c.x)?f.x:c.x);f.y=((f.y<c.y)?f.y:c.y);f.z=((f.z<c.z)?f.z:c.z);e.x=((e.x>c.x)?e.x:c.x);e.y=((e.y>c.y)?e.y:c.y);e.z=((e.z>c.z)?e.z:c.z);a.x=this.vMax.x;a.y=this.vMax.y;a.z=this.vMin.z;c.x=d.m00*a.x+d.m01*a.y+d.m02*a.z+d.m03;c.y=d.m10*a.x+d.m11*a.y+d.m12*a.z+d.m13;c.z=d.m20*a.x+d.m21*a.y+d.m22*a.z+d.m23;f.x=((f.x<c.x)?f.x:c.x);f.y=((f.y<c.y)?f.y:c.y);f.z=((f.z<c.z)?f.z:c.z);e.x=((e.x>c.x)?e.x:c.x);e.y=((e.y>c.y)?e.y:c.y);e.z=((e.z>c.z)?e.z:c.z);a.x=this.vMax.x;a.y=this.vMin.y;a.z=this.vMax.z;c.x=d.m00*a.x+d.m01*a.y+d.m02*a.z+d.m03;c.y=d.m10*a.x+d.m11*a.y+d.m12*a.z+d.m13;c.z=d.m20*a.x+d.m21*a.y+d.m22*a.z+d.m23;f.x=((f.x<c.x)?f.x:c.x);f.y=((f.y<c.y)?f.y:c.y);f.z=((f.z<c.z)?f.z:c.z);e.x=((e.x>c.x)?e.x:c.x);e.y=((e.y>c.y)?e.y:c.y);e.z=((e.z>c.z)?e.z:c.z);a.x=this.vMin.x;a.y=this.vMax.y;a.z=this.vMax.z;c.x=d.m00*a.x+d.m01*a.y+d.m02*a.z+d.m03;c.y=d.m10*a.x+d.m11*a.y+d.m12*a.z+d.m13;c.z=d.m20*a.x+d.m21*a.y+d.m22*a.z+d.m23;f.x=((f.x<c.x)?f.x:c.x);f.y=((f.y<c.y)?f.y:c.y);f.z=((f.z<c.z)?f.z:c.z);e.x=((e.x>c.x)?e.x:c.x);e.y=((e.y>c.y)?e.y:c.y);e.z=((e.z>c.z)?e.z:c.z);a.x=this.vMax.x;a.y=this.vMax.y;a.z=this.vMax.z;c.x=d.m00*a.x+d.m01*a.y+d.m02*a.z+d.m03;c.y=d.m10*a.x+d.m11*a.y+d.m12*a.z+d.m13;c.z=d.m20*a.x+d.m21*a.y+d.m22*a.z+d.m23;f.x=((f.x<c.x)?f.x:c.x);f.y=((f.y<c.y)?f.y:c.y);f.z=((f.z<c.z)?f.z:c.z);e.x=((e.x>c.x)?e.x:c.x);e.y=((e.y>c.y)?e.y:c.y);e.z=((e.z>c.z)?e.z:c.z);this.vMin.x=f.x;this.vMin.y=f.y;this.vMin.z=f.z;this.vMax.x=e.x;this.vMax.y=e.y;this.vMax.z=e.z;okA._vec3(f);okA._vec3(e);okA._vec3(a);okA._vec3(c);this.$p2=true},collideVertex:function(a){if(a.x>=this.vMin.x&&a.x<=this.vMax.x&&a.y>=this.vMin.y&&a.y<=this.vMax.y&&a.z>=this.vMin.z&&a.z<=this.vMax.z){return 1}return 0},collideLine:function(d,c,a){var h=-10000000000,k=10000000000;var p=c.x-d.x;var o=c.y-d.y;var m=c.z-d.z;var t=(this.vMin.x+this.vMax.x)*0.5-d.x;var x=(this.vMax.x-this.vMin.x)*0.5;var y=t;var v=p;if(v<-0.001||v>0.001){var n=(y+x)/v;var l=(y-x)/v;if(n>l){var z=n;n=l;l=z}h=(h<n?n:h);k=(k<l?k:l)}else{if(-y-x>0||-y+x<0){return 0}}var s=(this.vMin.y+this.vMax.y)*0.5-d.y;var w=(this.vMax.y-this.vMin.y)*0.5;var y=s;var v=o;if(v<-0.001||v>0.001){var n=(y+w)/v;var l=(y-w)/v;if(n>l){var z=n;n=l;l=z}h=(h<n?n:h);k=(k<l?k:l);if(h>k){return 0}}else{if(-y-w>0||-y+w<0){return 0}}var q=(this.vMin.z+this.vMax.z)*0.5-d.z;var u=(this.vMax.z-this.vMin.z)*0.5;var y=q;var v=m;if(v<-0.001||v>0.001){var n=(y+u)/v;var l=(y-u)/v;if(n>l){var z=n;n=l;l=z}h=(h<n?n:h);k=(k<l?k:l);if(h>k){return 0}}else{if(-y-u>0||-y+u<0){return 0}}if(a){a.fT0=h;a.fT1=k}return 1},collideRay:function(x,l,t){var a=-10000000000,m=10000000000;var s=l;var w=(this.vMin.x+this.vMax.x)*0.5-x.x;var q=(this.vMax.x-this.vMin.x)*0.5;var p=w;var o=s.x;if(o<-0.001||o>0.001){var k=(p+q)/o;var c=(p-q)/o;if(k>c){var y=k;k=c;c=y}a=(a<k?k:a);m=(m<c?m:c);if(m<0){return 0}}else{if(-p-q>0||-p+q<0){return 0}}var v=(this.vMin.y+this.vMax.y)*0.5-x.y;var n=(this.vMax.y-this.vMin.y)*0.5;var p=v;var o=s.y;if(o<-0.001||o>0.001){var k=(p+n)/o;var c=(p-n)/o;if(k>c){var y=k;k=c;c=y}a=(a<k?k:a);m=(m<c?m:c);if(a>m||m<0){return 0}}else{if(-p-n>0||-p+n<0){return 0}}var u=(this.vMin.z+this.vMax.z)*0.5-x.z;var h=(this.vMax.z-this.vMin.z)*0.5;var p=u;var o=s.z;if(o<-0.001||o>0.001){var k=(p+h)/o;var c=(p-h)/o;if(k>c){var y=k;k=c;c=y}a=(a<k?k:a);m=(m<c?m:c);if(a>m||m<0){return 0}}else{if(-p-h>0||-p+h<0){return 0}}if(t){t.fT0=a;t.fT1=m}return 1},collideAABBox:function(e){var d=okVec3Max(this.vMin,e.vMin);var a=okVec3Min(this.vMax,e.vMax);var c=0;if(d.x>a.x||d.y>a.y||d.z>a.z){c=0}else{if(d.equal(e.vMin)&&a.equal(e.vMax)){c=2}else{c=1}}okA._vec3(d);okA._vec3(a);return c}};okAABBox.prototype.transformMat43=okAABBox.prototype.transformMat;okAABBox.prototype.transformMat4=okAABBox.prototype.transformMat;function okOBBox(d,a,c){this.vMin=(d!=null)?d.clone():okA.vec3();this.vMax=(a!=null)?a.clone():okA.vec3();this.$g5=okA.mat43();if(c){c.clone(this.$g5)}this.$i2=true;this.$k2=true;this.$71=[new okVec3(this.vMin.x,this.vMin.y,this.vMin.z),new okVec3(this.vMax.x,this.vMin.y,this.vMin.z),new okVec3(this.vMax.x,this.vMax.y,this.vMin.z),new okVec3(this.vMin.x,this.vMax.y,this.vMin.z),new okVec3(this.vMin.x,this.vMin.y,this.vMax.z),new okVec3(this.vMax.x,this.vMin.y,this.vMax.z),new okVec3(this.vMax.x,this.vMax.y,this.vMax.z),new okVec3(this.vMin.x,this.vMax.y,this.vMax.z)];this.$p2=true}okOBBox.prototype={clone:function(a){var a=(a?a:new okOBBox());a.set(this.vMin,this.vMax,this.$g5);return a},set:function(d,a,c){d.clone(this.vMin);a.clone(this.vMax);if(c){c.clone(this.$g5)}this.$i2=true;this.$k2=true;this.$p2=true},setMin:function(d,c,a){if(c==null){d.clone(this.vMin)}else{this.vMin.set(d,c,a)}this.$k2=true;this.$p2=true},setMax:function(d,c,a){if(c==null){d.clone(this.vMax)}else{this.vMax.set(d,c,a)}this.$k2=true;this.$p2=true},setMat:function(a){a.clone(this.$g5);this.$i2=true;this.$k2=true;this.$p2=true},getExtent:function(a){if(a==1){return Math.max(0,this.vMax.x-this.vMin.x)}else{if(a==2){return Math.max(0,this.vMax.y-this.vMin.z)}else{return Math.max(0,this.vMax.z-this.vMin.z)}}},getVolume:function(){return Math.max(0,(this.vMax.x-this.vMin.x))*Math.max(0,(this.vMax.y-this.vMin.y))*Math.max(0,(this.vMax.z-this.vMin.z))},getPoint:function(c){if(this.$p2){var o=this.$71[0];o.x=this.$g5.m00*this.vMin.x+this.$g5.m01*this.vMin.y+this.$g5.m02*this.vMin.z+this.$g5.m03;o.y=this.$g5.m10*this.vMin.x+this.$g5.m11*this.vMin.y+this.$g5.m12*this.vMin.z+this.$g5.m13;o.z=this.$g5.m20*this.vMin.x+this.$g5.m21*this.vMin.y+this.$g5.m22*this.vMin.z+this.$g5.m23;var n=this.$71[1];n.x=this.$g5.m00*this.vMax.x+this.$g5.m01*this.vMin.y+this.$g5.m02*this.vMin.z+this.$g5.m03;n.y=this.$g5.m10*this.vMax.x+this.$g5.m11*this.vMin.y+this.$g5.m12*this.vMin.z+this.$g5.m13;n.z=this.$g5.m20*this.vMax.x+this.$g5.m21*this.vMin.y+this.$g5.m22*this.vMin.z+this.$g5.m23;var m=this.$71[2];m.x=this.$g5.m00*this.vMax.x+this.$g5.m01*this.vMax.y+this.$g5.m02*this.vMin.z+this.$g5.m03;m.y=this.$g5.m10*this.vMax.x+this.$g5.m11*this.vMax.y+this.$g5.m12*this.vMin.z+this.$g5.m13;m.z=this.$g5.m20*this.vMax.x+this.$g5.m21*this.vMax.y+this.$g5.m22*this.vMin.z+this.$g5.m23;var k=this.$71[3];k.x=this.$g5.m00*this.vMin.x+this.$g5.m01*this.vMax.y+this.$g5.m02*this.vMin.z+this.$g5.m03;k.y=this.$g5.m10*this.vMin.x+this.$g5.m11*this.vMax.y+this.$g5.m12*this.vMin.z+this.$g5.m13;k.z=this.$g5.m20*this.vMin.x+this.$g5.m21*this.vMax.y+this.$g5.m22*this.vMin.z+this.$g5.m23;var h=this.$71[4];h.x=this.$g5.m00*this.vMin.x+this.$g5.m01*this.vMin.y+this.$g5.m02*this.vMax.z+this.$g5.m03;h.y=this.$g5.m10*this.vMin.x+this.$g5.m11*this.vMin.y+this.$g5.m12*this.vMax.z+this.$g5.m13;h.z=this.$g5.m20*this.vMin.x+this.$g5.m21*this.vMin.y+this.$g5.m22*this.vMax.z+this.$g5.m23;var f=this.$71[5];f.x=this.$g5.m00*this.vMax.x+this.$g5.m01*this.vMin.y+this.$g5.m02*this.vMax.z+this.$g5.m03;f.y=this.$g5.m10*this.vMax.x+this.$g5.m11*this.vMin.y+this.$g5.m12*this.vMax.z+this.$g5.m13;f.z=this.$g5.m20*this.vMax.x+this.$g5.m21*this.vMin.y+this.$g5.m22*this.vMax.z+this.$g5.m23;var e=this.$71[6];e.x=this.$g5.m00*this.vMax.x+this.$g5.m01*this.vMax.y+this.$g5.m02*this.vMax.z+this.$g5.m03;e.y=this.$g5.m10*this.vMax.x+this.$g5.m11*this.vMax.y+this.$g5.m12*this.vMax.z+this.$g5.m13;e.z=this.$g5.m20*this.vMax.x+this.$g5.m21*this.vMax.y+this.$g5.m22*this.vMax.z+this.$g5.m23;var d=this.$71[7];d.x=this.$g5.m00*this.vMin.x+this.$g5.m01*this.vMax.y+this.$g5.m02*this.vMax.z+this.$g5.m03;d.y=this.$g5.m10*this.vMin.x+this.$g5.m11*this.vMax.y+this.$g5.m12*this.vMax.z+this.$g5.m13;d.z=this.$g5.m20*this.vMin.x+this.$g5.m21*this.vMax.y+this.$g5.m22*this.vMax.z+this.$g5.m23;this.$p2=false}var a=this.$71[c];var l=okA.vec3();l.x=a.x;l.y=a.y;l.z=a.z;return l},_updateData:function(){if(this.$i2){this.$i5=this.$g5.inverse().transpose(true);this.$i2=false}if(this.$k2){this.vMinW=okMat43MulVec3(this.$g5,this.vMin);this.vMaxW=okMat43MulVec3(this.$g5,this.vMax);this.$k2=false}},collideLine:function(d,c,a){this._updateData();var h=-10000000000,k=10000000000;var t=c.x-d.x;var q=c.y-d.y;var p=c.z-d.z;var s=this.$g5.getColumn(0).normalize(true);var o=this.$g5.getColumn(1).normalize(true);var m=this.$g5.getColumn(2).normalize(true);var w=(this.vMinW.x+this.vMaxW.x)*0.5-d.x;var v=(this.vMinW.y+this.vMaxW.y)*0.5-d.y;var u=(this.vMinW.z+this.vMaxW.z)*0.5-d.z;var B=(okVec3Dot(this.vMaxW,s)-okVec3Dot(this.vMinW,s))*0.5;var z=(okVec3Dot(this.vMaxW,o)-okVec3Dot(this.vMinW,o))*0.5;var x=(okVec3Dot(this.vMaxW,m)-okVec3Dot(this.vMinW,m))*0.5;var A=w*this.$g5.m00+v*this.$g5.m10+u*this.$g5.m20;var y=t*this.$g5.m00+q*this.$g5.m10+p*this.$g5.m20;if(y<-0.001||y>0.001){var n=(A+B)/y;var l=(A-B)/y;if(n>l){var C=n;n=l;l=C}h=(h<n?n:h);k=(k<l?k:l)}else{if(-A-B>0||-A+B<0){return 0}}var A=w*this.$g5.m01+v*this.$g5.m11+u*this.$g5.m21;var y=t*this.$g5.m01+q*this.$g5.m11+p*this.$g5.m21;if(y<-0.001||y>0.001){var n=(A+z)/y;var l=(A-z)/y;if(n>l){var C=n;n=l;l=C}h=(h<n?n:h);k=(k<l?k:l);if(h>k){return 0}}else{if(-A-z>0||-A+z<0){return 0}}var A=w*this.$g5.m02+v*this.$g5.m12+u*this.$g5.m22;var y=t*this.$g5.m02+q*this.$g5.m12+p*this.$g5.m22;if(y<-0.001||y>0.001){var n=(A+x)/y;var l=(A-x)/y;if(n>l){var C=n;n=l;l=C}h=(h<n?n:h);k=(k<l?k:l);if(h>k){return 0}}else{if(-A-x>0||-A+x<0){return 0}}if(a){a.fT0=h;a.fT1=k}return 1},collideRay:function(c,q,a){this._updateData();var h=-10000000000,k=10000000000;var B=q;var p=this.$g5.getColumn(0).normalize(true);var o=this.$g5.getColumn(1).normalize(true);var m=this.$g5.getColumn(2).normalize(true);var u=(this.vMinW.x+this.vMaxW.x)*0.5-c.x;var t=(this.vMinW.y+this.vMaxW.y)*0.5-c.y;var s=(this.vMinW.z+this.vMaxW.z)*0.5-c.z;var y=(okVec3Dot(this.vMaxW,p)-okVec3Dot(this.vMinW,p))*0.5;var w=(okVec3Dot(this.vMaxW,o)-okVec3Dot(this.vMinW,o))*0.5;var v=(okVec3Dot(this.vMaxW,m)-okVec3Dot(this.vMinW,m))*0.5;var z=u*p.x+t*p.y+s*p.z;var x=B.x*p.x+B.y*p.y+B.z*p.z;if(x<-0.001||x>0.001){var n=(z+y)/x;var l=(z-y)/x;if(n>l){var A=n;n=l;l=A}h=(h<n?n:h);k=(k<l?k:l);if(k<0){return 0}}else{if(-z-y>0||-z+y<0){return 0}}var z=u*o.x+t*o.y+s*o.z;var x=B.x*o.x+B.y*o.y+B.z*o.z;if(x<-0.001||x>0.001){var n=(z+w)/x;var l=(z-w)/x;if(n>l){var A=n;n=l;l=A}h=(h<n?n:h);k=(k<l?k:l);if(h>k||k<0){return 0}}else{if(-z-w>0||-z+w<0){return 0}}var z=u*m.x+t*m.y+s*m.z;var x=B.x*m.x+B.y*m.y+B.z*m.z;if(x<-0.001||x>0.001){var n=(z+v)/x;var l=(z-v)/x;if(n>l){var A=n;n=l;l=A}h=(h<n?n:h);k=(k<l?k:l);if(h>k||k<0){return 0}}else{if(-z-v>0||-z+v<0){return 0}}if(a){a.fT0=h;a.fT1=k}return 1}};function okFrustum(){this.$o5=okA.mat4();this.$31=[okA.plane(),okA.plane(),okA.plane(),okA.plane(),okA.plane(),okA.plane()];this.$71=[okA.vec3(),okA.vec3(),okA.vec3(),okA.vec3(),okA.vec3(),okA.vec3(),okA.vec3(),okA.vec3()];this.$p2=true}okFrustum.prototype={setByViewProjMat:function(a){a.clone(this.$o5);this.$31[3].setByCoefficients(a.m30-a.m00,a.m31-a.m01,a.m32-a.m02,a.m33-a.m03);this.$31[2].setByCoefficients(a.m30+a.m00,a.m31+a.m01,a.m32+a.m02,a.m33+a.m03);this.$31[5].setByCoefficients(a.m30+a.m10,a.m31+a.m11,a.m32+a.m12,a.m33+a.m13);this.$31[4].setByCoefficients(a.m30-a.m10,a.m31-a.m11,a.m32-a.m12,a.m33-a.m13);this.$31[1].setByCoefficients(a.m30-a.m20,a.m31-a.m21,a.m32-a.m22,a.m33-a.m23);this.$31[0].setByCoefficients(a.m30+a.m20,a.m31+a.m21,a.m32+a.m22,a.m33+a.m23);this.$p2=true},getPlane:function(a){return this.$31[a]},setPlane:function(c,a){a.clone(this.$31[c]);this.$p2=true},getPoint:function(a){if(this.$p2){this._genPointList();this.$p2=false}return this.$71[a]},collideVertex:function(a){if(this.$31[0].collideVertex(a)==0){return 0}if(this.$31[1].collideVertex(a)==0){return 0}if(this.$31[2].collideVertex(a)==0){return 0}if(this.$31[3].collideVertex(a)==0){return 0}if(this.$31[4].collideVertex(a)==0){return 0}if(this.$31[5].collideVertex(a)==0){return 0}return 1},collideAABBox:function(a){a.getPoint(0);return this._collideBox(a.$71)},collideOBBox:function(a){a.getPoint(0);return this._collideBox(a.$71)},_collideBox:function(d){var t=d[0];var p=d[1];var o=d[2];var n=d[3];var m=d[4];var l=d[5];var h=d[6];var e=d[7];var f=true;var c=true;var s=true;var a=this.$31[0];var k,q;q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*t.x+a.vNormal.y*t.y+a.vNormal.z*t.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*p.x+a.vNormal.y*p.y+a.vNormal.z*p.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*o.x+a.vNormal.y*o.y+a.vNormal.z*o.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*n.x+a.vNormal.y*n.y+a.vNormal.z*n.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*m.x+a.vNormal.y*m.y+a.vNormal.z*m.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*l.x+a.vNormal.y*l.y+a.vNormal.z*l.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*h.x+a.vNormal.y*h.y+a.vNormal.z*h.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*e.x+a.vNormal.y*e.y+a.vNormal.z*e.z;c=c&&(k>=q);s=s&&(k<q);if(s){return 0}s=true;var a=this.$31[1];var k,q;q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*t.x+a.vNormal.y*t.y+a.vNormal.z*t.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*p.x+a.vNormal.y*p.y+a.vNormal.z*p.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*o.x+a.vNormal.y*o.y+a.vNormal.z*o.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*n.x+a.vNormal.y*n.y+a.vNormal.z*n.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*m.x+a.vNormal.y*m.y+a.vNormal.z*m.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*l.x+a.vNormal.y*l.y+a.vNormal.z*l.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*h.x+a.vNormal.y*h.y+a.vNormal.z*h.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*e.x+a.vNormal.y*e.y+a.vNormal.z*e.z;c=c&&(k>=q);s=s&&(k<q);if(s){return 0}s=true;var a=this.$31[2];var k,q;q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*t.x+a.vNormal.y*t.y+a.vNormal.z*t.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*p.x+a.vNormal.y*p.y+a.vNormal.z*p.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*o.x+a.vNormal.y*o.y+a.vNormal.z*o.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*n.x+a.vNormal.y*n.y+a.vNormal.z*n.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*m.x+a.vNormal.y*m.y+a.vNormal.z*m.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*l.x+a.vNormal.y*l.y+a.vNormal.z*l.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*h.x+a.vNormal.y*h.y+a.vNormal.z*h.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*e.x+a.vNormal.y*e.y+a.vNormal.z*e.z;c=c&&(k>=q);s=s&&(k<q);if(s){return 0}s=true;var a=this.$31[3];var k,q;q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*t.x+a.vNormal.y*t.y+a.vNormal.z*t.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*p.x+a.vNormal.y*p.y+a.vNormal.z*p.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*o.x+a.vNormal.y*o.y+a.vNormal.z*o.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*n.x+a.vNormal.y*n.y+a.vNormal.z*n.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*m.x+a.vNormal.y*m.y+a.vNormal.z*m.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*l.x+a.vNormal.y*l.y+a.vNormal.z*l.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*h.x+a.vNormal.y*h.y+a.vNormal.z*h.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*e.x+a.vNormal.y*e.y+a.vNormal.z*e.z;c=c&&(k>=q);s=s&&(k<q);if(s){return 0}s=true;var a=this.$31[4];var k,q;q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*t.x+a.vNormal.y*t.y+a.vNormal.z*t.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*p.x+a.vNormal.y*p.y+a.vNormal.z*p.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*o.x+a.vNormal.y*o.y+a.vNormal.z*o.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*n.x+a.vNormal.y*n.y+a.vNormal.z*n.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*m.x+a.vNormal.y*m.y+a.vNormal.z*m.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*l.x+a.vNormal.y*l.y+a.vNormal.z*l.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*h.x+a.vNormal.y*h.y+a.vNormal.z*h.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*e.x+a.vNormal.y*e.y+a.vNormal.z*e.z;c=c&&(k>=q);s=s&&(k<q);if(s){return 0}s=true;var a=this.$31[5];var k,q;q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*t.x+a.vNormal.y*t.y+a.vNormal.z*t.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*p.x+a.vNormal.y*p.y+a.vNormal.z*p.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*o.x+a.vNormal.y*o.y+a.vNormal.z*o.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*n.x+a.vNormal.y*n.y+a.vNormal.z*n.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*m.x+a.vNormal.y*m.y+a.vNormal.z*m.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*l.x+a.vNormal.y*l.y+a.vNormal.z*l.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*h.x+a.vNormal.y*h.y+a.vNormal.z*h.z;c=c&&(k>=q);s=s&&(k<q);q=a.vNormal.x*a.vOrigin.x+a.vNormal.y*a.vOrigin.y+a.vNormal.z*a.vOrigin.z;k=a.vNormal.x*e.x+a.vNormal.y*e.y+a.vNormal.z*e.z;c=c&&(k>=q);s=s&&(k<q);if(s){return 0}if(c){return 2}return 1},_genPointList:function(){this.$71[0]=okPlaneIntersect3(this.$31[0],this.$31[5],this.$31[2]);this.$71[1]=okPlaneIntersect3(this.$31[0],this.$31[5],this.$31[3]);this.$71[2]=okPlaneIntersect3(this.$31[0],this.$31[4],this.$31[3]);this.$71[3]=okPlaneIntersect3(this.$31[0],this.$31[4],this.$31[2]);this.$71[4]=okPlaneIntersect3(this.$31[1],this.$31[5],this.$31[2]);this.$71[5]=okPlaneIntersect3(this.$31[1],this.$31[5],this.$31[3]);this.$71[6]=okPlaneIntersect3(this.$31[1],this.$31[4],this.$31[3]);this.$71[7]=okPlaneIntersect3(this.$31[1],this.$31[4],this.$31[2])}};function okRect(e,c,d,a){this.x=((e!=null)?e:0);this.y=((c!=null)?c:0);this.width=((d!=null)?d:0);this.height=((a!=null)?a:0)}okRect.prototype={set:function(d,c,e,a){this.x=d;this.y=c;this.width=width;this.height=height},clone:function(a){var a=(a?a:new okRect());a.set(this.x,this.y,this.width,this.height);return a}};function okRectMerge(e,d){var c=Math.min(e.x,d.x);var h=Math.min(e.y,d.y);var f=Math.max(e.x+e.width-c,d.x+d.width-c);var a=Math.max(e.y+e.height-h,d.y+d.height-h);return new okRect(c,h,f,a)}OAK.VEC2_ZERO=new okVec2(0,0);OAK.VEC2_ONE=new okVec2(1,1);OAK.VEC2_X=new okVec2(1,0);OAK.VEC2_Y=new okVec2(0,1);OAK.VEC3_ZERO=new okVec3(0,0,0);OAK.VEC3_ONE=new okVec3(1,1,1);OAK.VEC3_X=new okVec3(1,0,0);OAK.VEC3_Y=new okVec3(0,1,0);OAK.VEC3_Z=new okVec3(0,0,1);OAK.VEC3_INF=new okVec3(10000000000,10000000000,10000000000);OAK.VEC3_NINF=new okVec3(-10000000000,-10000000000,-10000000000);OAK.VEC3_RED=OAK.VEC3_X;OAK.VEC3_GREEN=OAK.VEC3_Y;OAK.VEC3_BLUE=OAK.VEC3_Z;OAK.VEC3_YELLOW=new okVec3(1,1,0);OAK.VEC3_BLACK=OAK.VEC3_ZERO;OAK.VEC3_WHITE=OAK.VEC3_ONE;OAK.VEC4_ZERO=new okVec4(0,0,0,0);OAK.VEC4_ONE=new okVec4(1,1,1,1);OAK.VEC4_X=new okVec3(1,0,0,0);OAK.VEC4_Y=new okVec3(0,1,0,0);OAK.VEC4_Z=new okVec3(0,0,1,0);OAK.VEC4_W=new okVec3(0,0,0,1);OAK.MAT3_ZERO=new okMat3(0);OAK.MAT3_I=new okMat4(1);OAK.MAT4_ZERO=new okMat4(0);OAK.MAT4_I=new okMat4(1);OAK.MAT43_ZERO=new okMat43(0);OAK.MAT43_I=new okMat43(1);function okXmlDoc(a){this.$W2=a}okXmlDoc.prototype={getRootNode:function(){return new okXmlNode(this.$W2.documentElement)}};function okXmlNode(c){this.element=c;this.childNodes=new Array();this.sText="";if(okIsIE()){for(var a=0;a<this.element.childNodes.length;++a){if(this.element.childNodes[a].nodeType==1){this.childNodes.push(this.element.childNodes[a])}else{if(this.element.childNodes[a].nodeType==3){this.sText+=this.element.childNodes[a].text}}}}else{for(var a=0;a<this.element.childNodes.length;++a){if(this.element.childNodes[a].nodeType==Node.ELEMENT_NODE){this.childNodes.push(this.element.childNodes[a])}else{if(this.element.childNodes[a].nodeType==Node.TEXT_NODE){this.sText+=this.element.childNodes[a].textContent}}}}}okXmlNode.prototype={getName:function(){return this.element.nodeName},getText:function(){return this.sText},getChildNum:function(){return this.childNodes.length},getChild:function(a,e){if(okIsNumber(a)){return new okXmlNode(this.childNodes[a])}else{if(e){a=a.toLowerCase()}for(var d=0;d<this.childNodes.length;++d){var c=e?(this.childNodes[d].nodeName.toLowerCase()==a):(this.childNodes[d].nodeName==a);if(c){return new okXmlNode(this.childNodes[d])}}return null}},getAttribNum:function(){return this.element.attributes.length},getAttribName:function(a){return this.element.attributes[a].name},getAttribValueString:function(d,e){if(okIsNumber(d)){return this.element.attributes[d].value}else{if(e){d=d.toLowerCase()}for(var c=0;c<this.element.attributes.length;++c){var a=e?(this.element.attributes[c].name.toLowerCase()==d):(this.element.attributes[c].name==d);if(a){return this.element.attributes[c].value}}}return null},getAttribValueInt:function(d,e){if(okIsNumber(d)){return parseInt(this.element.attributes[d].value)}else{if(e){d=d.toLowerCase()}for(var c=0;c<this.element.attributes.length;++c){var a=e?(this.element.attributes[c].name.toLowerCase()==d):(this.element.attributes[c].name==d);if(a){return parseInt(this.element.attributes[c].value)}}}return null},getAttribValueFloat:function(d,e){if(okIsNumber(d)){return parseFloat(this.element.attributes[d].value)}else{if(e){d=d.toLowerCase()}for(var c=0;c<this.element.attributes.length;++c){var a=e?(this.element.attributes[c].name.toLowerCase()==d):(this.element.attributes[c].name==d);if(a){return parseFloat(this.element.attributes[c].value)}}}return null},getAttribValueVec2:function(d,h){if(okIsNumber(d)){var f=this.element.attributes[d].value.split(" ");var e=okA.vec2();e.x=parseFloat(f[0]);e.y=parseFloat(f[1]);return e}else{if(h){d=d.toLowerCase()}for(var c=0;c<this.element.attributes.length;++c){var a=h?(this.element.attributes[c].name.toLowerCase()==d):(this.element.attributes[c].name==d);if(a){var f=this.element.attributes[c].value.split(" ");var e=okA.vec2();e.x=parseFloat(f[0]);e.y=parseFloat(f[1]);return e}}}return null},getAttribValueVec3:function(d,h){if(okIsNumber(d)){var f=this.element.attributes[d].value.split(" ");var e=okA.vec3();e.x=parseFloat(f[0]);e.y=parseFloat(f[1]);e.z=parseFloat(f[2]);return e}else{if(h){d=d.toLowerCase()}for(var c=0;c<this.element.attributes.length;++c){var a=h?(this.element.attributes[c].name.toLowerCase()==d):(this.element.attributes[c].name==d);if(a){var f=this.element.attributes[c].value.split(" ");var e=okA.vec3();e.x=parseFloat(f[0]);e.y=parseFloat(f[1]);e.z=parseFloat(f[2]);return e}}}return null},getAttribValueVec4:function(d,h){if(okIsNumber(d)){var f=this.element.attributes[d].value.split(" ");var e=okA.vec4();e.x=parseFloat(f[0]);e.y=parseFloat(f[1]);e.z=parseFloat(f[2]);e.w=parseFloat(f[3]);return e}else{if(h){d=d.toLowerCase()}for(var c=0;c<this.element.attributes.length;++c){var a=h?(this.element.attributes[c].name.toLowerCase()==d):(this.element.attributes[c].name==d);if(a){var f=this.element.attributes[c].value.split(" ");var e=okA.vec3();e.x=parseFloat(f[0]);e.y=parseFloat(f[1]);e.z=parseFloat(f[2]);e.w=parseFloat(f[3]);return e}}}return null},getAttribValueMat4:function(e,h){if(okIsNumber(e)){var f=this.element.attributes[e].value.split(" ");var c=okA.mat4();c.m00=parseFloat(f[0]);c.m10=parseFloat(f[1]);c.m20=parseFloat(f[2]);c.m30=parseFloat(f[3]);c.m01=parseFloat(f[4]);c.m11=parseFloat(f[5]);c.m21=parseFloat(f[6]);c.m31=parseFloat(f[7]);c.m02=parseFloat(f[8]);c.m12=parseFloat(f[9]);c.m22=parseFloat(f[10]);c.m32=parseFloat(f[11]);c.m03=parseFloat(f[12]);c.m13=parseFloat(f[13]);c.m23=parseFloat(f[14]);c.m33=parseFloat(f[15]);return c}else{if(h){e=e.toLowerCase()}for(var d=0;d<this.element.attributes.length;++d){var a=h?(this.element.attributes[d].name.toLowerCase()==e):(this.element.attributes[d].name==e);if(a){var f=this.element.attributes[d].value.split(" ");var c=okA.mat4();c.m00=parseFloat(f[0]);c.m10=parseFloat(f[1]);c.m20=parseFloat(f[2]);c.m30=parseFloat(f[3]);c.m01=parseFloat(f[4]);c.m11=parseFloat(f[5]);c.m21=parseFloat(f[6]);c.m31=parseFloat(f[7]);c.m02=parseFloat(f[8]);c.m12=parseFloat(f[9]);c.m22=parseFloat(f[10]);c.m32=parseFloat(f[11]);c.m03=parseFloat(f[12]);c.m13=parseFloat(f[13]);c.m23=parseFloat(f[14]);c.m33=parseFloat(f[15]);return c}}}return null},getAttribValueMat43:function(e,h){if(okIsNumber(e)){var f=this.element.attributes[e].value.split(" ");var c=okA.mat43();c.m00=parseFloat(f[0]);c.m10=parseFloat(f[1]);c.m20=parseFloat(f[2]);c.m01=parseFloat(f[3]);c.m11=parseFloat(f[4]);c.m21=parseFloat(f[5]);c.m02=parseFloat(f[6]);c.m12=parseFloat(f[7]);c.m22=parseFloat(f[8]);c.m03=parseFloat(f[9]);c.m13=parseFloat(f[10]);c.m23=parseFloat(f[11]);return c}else{if(h){e=e.toLowerCase()}for(var d=0;d<this.element.attributes.length;++d){var a=h?(this.element.attributes[d].name.toLowerCase()==e):(this.element.attributes[d].name==e);if(a){var f=this.element.attributes[d].value.split(" ");var c=okA.mat43();c.m00=parseFloat(f[0]);c.m10=parseFloat(f[1]);c.m20=parseFloat(f[2]);c.m01=parseFloat(f[3]);c.m11=parseFloat(f[4]);c.m21=parseFloat(f[5]);c.m02=parseFloat(f[6]);c.m12=parseFloat(f[7]);c.m22=parseFloat(f[8]);c.m03=parseFloat(f[9]);c.m13=parseFloat(f[10]);c.m23=parseFloat(f[11]);return c}}}return null},getAttribValueQuat:function(e,h){if(okIsNumber(e)){var f=this.element.attributes[e].value.split(" ");var c=okA.quat();c.s=parseFloat(f[0]);c.x=parseFloat(f[1]);c.y=parseFloat(f[2]);c.z=parseFloat(f[3]);return c}else{if(h){e=e.toLowerCase()}for(var d=0;d<this.element.attributes.length;++d){var a=h?(this.element.attributes[d].name.toLowerCase()==e):(this.element.attributes[d].name==e);if(a){var f=this.element.attributes[d].value.split(" ");var c=okA.quat();c.s=parseFloat(f[0]);c.x=parseFloat(f[1]);c.y=parseFloat(f[2]);c.z=parseFloat(f[3]);return c}}}return null},getAttribValueIntArray:function(e,h){if(okIsNumber(e)){var f=this.element.attributes[e].value.split(" ");var d=okA.array();for(var c=0;c<f.length;++c){d.push(parseInt(f[c]))}return d}else{if(h){e=e.toLowerCase()}for(var c=0;c<this.element.attributes.length;++c){var a=h?(this.element.attributes[c].name.toLowerCase()==e):(this.element.attributes[c].name==e);if(a){var f=this.element.attributes[c].value.split(" ");var d=okA.array();for(var c=0;c<f.length;++c){d.push(parseInt(f[c]))}return d}}}return null},getAttribValueFloatArray:function(e,h){if(okIsNumber(e)){var f=this.element.attributes[e].value.split(" ");var d=okA.array();for(var c=0;c<f.length;++c){d.push(parseFloat(f[c]))}return d}else{if(h){e=e.toLowerCase()}for(var c=0;c<this.element.attributes.length;++c){var a=h?(this.element.attributes[c].name.toLowerCase()==e):(this.element.attributes[c].name==e);if(a){var f=this.element.attributes[c].value.split(" ");var d=okA.array();for(var c=0;c<f.length;++c){d.push(parseFloat(f[c]))}return d}}}return null},getAttribValueStringArray:function(d,e){if(okIsNumber(d)){return this.element.attributes[d].value.split(" ")}else{if(e){d=d.toLowerCase()}for(var c=0;c<this.element.attributes.length;++c){var a=e?(this.element.attributes[c].name.toLowerCase()==d):(this.element.attributes[c].name==d);if(a){return this.element.attributes[c].value.split(" ")}}}return null}};function okParseXML(c){var a;if(okIsIE()){a=new ActiveXObject("Microsoft.XMLDOM");a.async="false";a.loadXML(c)}else{var d=new DOMParser();a=d.parseFromString(c,"text/xml")}return a}okPackXMLShaderSource=function(a){var f=a.split("");var e=f.length;for(var c=0;c<e;++c){if(f[c]=="<"){var h=c;c++;if(f[c]=="/"){while(c<e&&f[c]!=">"){++c}continue}while(c<e&&f[c]==" "){++c}for(;c<e;++c){var k=f[c];if(k==">"){break}else{if(k==" "){while(c<e&&f[c]==" "){++c}if(f[c]!=">"){f[h]="$0";--c}break}else{if(k<"0"||(k>"9"&&k<"A")||(k>"Z"&&k<"a")||k>"z"){f[h]="$0";--c;break}}}}}else{if(f[c]==">"){f[c]=="$1"}else{if(f[c]=="&"){f[c]="$2"}}}}var d="";for(var c=0;c<e;++c){d+=f[c]}return d};okUnpackXMLShaderSource=function(a){a=a.replace(/\$0/g,"<");a=a.replace(/\$1/g,">");a=a.replace(/\$2/g,"&");return a};function okBinDoc(a,d){this.$W2=new jDataView(a);if(d){var c=this.$W2.getString(d.length);if(c!=d){this.$W2=null;return}}this.$O5=new okBinNode(this.$W2,d?d.length:0)}okBinDoc.prototype={isValid:function(){return this.$W2!=null},getRootNode:function(){return this.$O5}};function okBinNode(c,l){this.$W2=c;c.seek(l);var a=c.getUint16();this.$56=c.getString(a);var k=okA.array();var h=okA.array();this.$O3=c.getUint16();for(var f=0;f<this.$O3;++f){k.push(c.getUint32())}this.$74=c.getUint16();for(var f=0;f<this.$74;++f){h.push(c.getUint32())}this.$L1=new Object;for(var f=0;f<this.$O3;++f){var e=new Object;e.iOffset=k[f];this.$W2.seek(k[f]);var d=c.getUint16();e.$56=c.getString(d);e.iOffset+=(2+d);this.$L1[e.$56]=e}this.$O2=new Object;this.$P2=new Array;for(var f=0;f<this.$74;++f){var e=new Object;e.iOffset=h[f];this.$W2.seek(h[f]);var d=c.getUint16();e.$56=c.getString(d);this.$O2[e.$56]=e;this.$P2.push(e.$56)}okA._array(k);okA._array(h);this.$Q2=new Object}okBinNode.prototype={getName:function(){return this.$56},getChildNum:function(){return this.$74},getChild:function(a){if(okIsNumber(a)){a=this.$P2[a]}if(this.$O2[a]==null){return null}if(this.$Q2[a]==null){this.$Q2[a]=new okBinNode(this.$W2,this.$O2[a].iOffset)}return this.$Q2[a]},getChildMap:function(){for(var a in this.$O2){if(this.$Q2[a]==null){this.$Q2[a]=new okBinNode(this.$W2,this.$O2[a].iOffset)}}return this.$Q2},getAttribNum:function(){return this.$O3},isAttribExisted:function(a){return this.$L1[a]!=null},getAttribValueString:function(c){if(this.$L1[c]==null){return null}this.$W2.seek(this.$L1[c].iOffset);var a=this.$W2.getUint16();return this.$W2.getString(a)},getAttribValueInt:function(a){if(this.$L1[a]==null){return null}this.$W2.seek(this.$L1[a].iOffset);return this.$W2.getInt32()},getAttribValueFloat:function(a){if(this.$L1[a]==null){return null}this.$W2.seek(this.$L1[a].iOffset);return this.$W2.getFloat32()},getAttribValueVec2:function(c){if(this.$L1[c]==null){return null}this.$W2.seek(this.$L1[c].iOffset);var a=okA.vec2();a.set(this.$W2.getFloat32(),this.$W2.getFloat32());return a},getAttribValueVec3:function(c){if(this.$L1[c]==null){return null}this.$W2.seek(this.$L1[c].iOffset);var a=okA.vec3();a.set(this.$W2.getFloat32(),this.$W2.getFloat32(),this.$W2.getFloat32());return a},getAttribValueVec4:function(c){if(this.$L1[c]==null){return null}this.$W2.seek(this.$L1[c].iOffset);var a=okA.vec4();a.set(this.$W2.getFloat32(),this.$W2.getFloat32(),this.$W2.getFloat32(),this.$W2.getFloat32());return a},getAttribValueMat4:function(c){if(this.$L1[c]==null){return null}this.$W2.seek(this.$L1[c].iOffset);var a=okA.mat4();a.m00=this.$W2.getFloat32();a.m10=this.$W2.getFloat32();a.m20=this.$W2.getFloat32();a.m30=this.$W2.getFloat32();a.m01=this.$W2.getFloat32();a.m11=this.$W2.getFloat32();a.m21=this.$W2.getFloat32();a.m31=this.$W2.getFloat32();a.m02=this.$W2.getFloat32();a.m12=this.$W2.getFloat32();a.m22=this.$W2.getFloat32();a.m32=this.$W2.getFloat32();a.m03=this.$W2.getFloat32();a.m13=this.$W2.getFloat32();a.m23=this.$W2.getFloat32();a.m33=this.$W2.getFloat32();return a},getAttribValueMat43:function(c){if(this.$L1[c]==null){return null}this.$W2.seek(this.$L1[c].iOffset);var a=okA.mat43();a.m00=this.$W2.getFloat32();a.m10=this.$W2.getFloat32();a.m20=this.$W2.getFloat32();a.m01=this.$W2.getFloat32();a.m11=this.$W2.getFloat32();a.m21=this.$W2.getFloat32();a.m02=this.$W2.getFloat32();a.m12=this.$W2.getFloat32();a.m22=this.$W2.getFloat32();a.m03=this.$W2.getFloat32();a.m13=this.$W2.getFloat32();a.m23=this.$W2.getFloat32();return a},getAttribValueQuat:function(c){if(this.$L1[c]==null){return null}this.$W2.seek(this.$L1[c].iOffset);var a=okA.quat();a.set(this.$W2.getFloat32(),this.$W2.getFloat32(),this.$W2.getFloat32(),this.$W2.getFloat32());return a},getAttribValueIntArray:function(e){if(this.$L1[e]==null){return null}this.$W2.seek(this.$L1[e].iOffset);var d=okA.array();var a=this.$W2.getInt32();for(var c=0;c<a;++c){d.push(this.$W2.getInt32())}return d},getAttribValueUshortArray:function(e){if(this.$L1[e]==null){return null}this.$W2.seek(this.$L1[e].iOffset);var d=okA.array();var a=this.$W2.getInt32();for(var c=0;c<a;++c){d.push(this.$W2.getUint16())}return d},getAttribValueFloatArray:function(e){if(this.$L1[e]==null){return null}this.$W2.seek(this.$L1[e].iOffset);var d=okA.array();var a=this.$W2.getInt32();for(var c=0;c<a;++c){d.push(this.$W2.getFloat32())}return d},getAttribValueStringArray:function(f){if(this.$L1[f]==null){return null}this.$W2.seek(this.$L1[f].iOffset);var e=okA.array();var a=this.$W2.getInt32();for(var d=0;d<a;++d){var c=this.$W2.getUint16();e.push(this.$W2.getString(c))}return e}};var okResourceParser=new Object;okResourceParser.loadModel=function(a,d,c,h,f,e){if(a==1){return okResourceParser._loadModelXML(d,c,h,f,e)}else{if(a==3){return okResourceParser._loadModelBinary(d,c,h,f,e)}else{return false}}};okResourceParser._loadModelBinary=function(e,o,m,v,q){var n=new okBinDoc(o,"OKMDBI");if(!n.isValid()){return false}var u=n.getRootNode();var s=u.getAttribValueString("Version");var y=s.split(".");e.clear();var d=new Array;var h=u.getChild("MaterialList");if(h){for(var c in h.getChildMap()){var a=h.getChild(c);var k=new okMaterial(e.rc);if(this._parseMaterialBinary(c,a,k,q)==false){return false}d[c]=k}}var p=u.getChild("MeshList");if(p){var x=okA.object();var l=okA.object();if(m){for(var w in p.getChildMap()){l[w]=true}}var f=p.getChildNum();for(var w in p.getChildMap()){var t=p.getChild(w);if(m&&l[w]==null){continue}x[w]=true}for(var w in p.getChildMap()){var t=p.getChild(w);if(m&&l[w]==null){continue}if(this._parseMeshBinary(w,t,e,d,x,v,q)==false){return false}}okA._object(x);okA._object(l)}e.computeBoundingInfo();return true};okResourceParser._parseMaterialBinary=function(t,k,s,d){s.setDesc(t);if(k.isAttribExisted("Emissive")){s.setEmissive(k.getAttribValueVec3("Emissive"))}if(k.isAttribExisted("Ambient")){s.setAmbient(k.getAttribValueVec3("Ambient"))}if(k.isAttribExisted("Diffuse")){s.setDiffuse(k.getAttribValueVec3("Diffuse"))}if(k.isAttribExisted("Specular")){s.setSpecular(k.getAttribValueVec3("Specular"))}if(k.isAttribExisted("SpecularLevel")){s.setSpecularLevel(k.getAttribValueFloat("SpecularLevel"))}if(k.isAttribExisted("Glossiness")){s.setGlossiness(k.getAttribValueFloat("Glossiness"))}if(k.isAttribExisted("Alpha")){s.setAlpha(k.getAttribValueFloat("Alpha"))}if(k.isAttribExisted("Blend")){s.enableBlend(k.getAttribValueInt("Blend")==1)}if(k.isAttribExisted("AlphaTest")){s.enableAlphaTest(k.getAttribValueInt("AlphaTest")==1)}if(k.isAttribExisted("AlphaTestValue")){s.setAlphaTestValue(k.getAttribValueFloat("AlphaTestValue"))}if(k.isAttribExisted("DynamicLighting")){s.enableDynamicLighting(k.getAttribValueInt("DynamicLighting")==1)}if(k.isAttribExisted("Wireframe")){s.enableWireframe(k.getAttribValueInt("Wireframe")==1)}if(k.isAttribExisted("VertexColor")){s.enableVertexColor(k.getAttribValueInt("VertexColor")==1)}if(k.isAttribExisted("DepthTest")){s.enableDepthTest(k.getAttribValueInt("DepthTest")==1)}if(k.isAttribExisted("TwoSide")){s.enableTwoSide(k.getAttribValueInt("TwoSide")==1)}var f=k.getChild("TextureList");if(f){for(var q in f.getChildMap()){var e=f.getChild(q);var p=0;if(q=="Albedo1"){p=0}else{if(q=="Albedo2"){p=1}else{if(q=="Albedo3"){p=2}else{if(q=="Albedo4"){p=3}else{if(q=="Normal"){p=4}else{if(q=="Opacity"){p=5}else{if(q=="SpecularLevel"){p=6}}}}}}}var c=e.getAttribValueString("Name");if(c){s.setTextureName(p,c)}var n=e.getAttribValueString("Texcoord");if(n){s.setTextureCoord(p,n)}var h=e.getAttribValueString("Tangent");if(h){s.setTextureTangent(p,h)}var m=e.getAttribValueString("Binormal");if(m){s.setTextureBinormal(p,m)}var a=e.getAttribValueString("Type");if(a){if(a=="2D"){s.setTextureType(p,3553)}else{if(a=="Cube"){s.setTextureType(p,34067)}}}var o=e.getAttribValueString("Filter");if(o){if(o=="Linear"){s.setTextureFilter(p,9729)}else{if(o=="Nearest"){s.setTextureFilter(p,9728)}}}var l=e.getAttribValueString("Wrap");if(l){if(l=="Repeat"){s.setTextureWrap(p,10497)}else{if(l=="Clamp"){s.setTextureWrap(p,33071)}else{if(l=="Mirror"){s.setTextureWrap(p,33648)}}}}var l=e.getAttribValueString("WrapU");if(l){if(l=="Repeat"){s.setTextureWrapU(p,10497)}else{if(l=="Clamp"){s.setTextureWrapU(p,33071)}else{if(l=="Mirror"){s.setTextureWrapU(p,33648)}}}}var l=e.getAttribValueString("WrapV");if(l){if(l=="Repeat"){s.setTextureWrapV(p,10497)}else{if(l=="Clamp"){s.setTextureWrapV(p,33071)}else{if(l=="Mirror"){s.setTextureWrapV(p,33648)}}}}}}return true};okResourceParser._parseMeshBinary=function(u,h,c,y,O,G,ah){var v=okA.array();var ad=(h.getAttribValueInt("VertexCount")?h.getAttribValueInt("VertexCount"):0);var T=(h.getChild("IndexList")?h.getChild("IndexList").getChildNum():0);var W=okA.object();var V=okA.object();var m=okA.object();var Z=okA.object();var Y=okA.object();var M={Triangles:4,TriangleStrip:5,TriangleFan:6,Lines:1,LineStrip:3,LineLoop:2,Points:0};var aa={Triangles:3,TriangleStrip:0,TriangleFan:0,Lines:2,LineStrip:0,LineLoop:0,Points:1};var n=h.getChild("AttributeList");for(var a in n.getChildMap()){var S=n.getChild(a);var ao=a;var p=S.getAttribValueFloatArray("Data");var s=p.length/ad;if(s-Math.floor(s)!=0){return false}W[ao]=p;V[ao]=s}var aj=h.getChild("IndexList");for(var t in aj.getChildMap()){var w=aj.getChild(t);var ao=t;var p=(ad<=65536?w.getAttribValueUshortArray("Data"):w.getAttribValueIntArray("Data"));var ab=w.getAttribValueString("Topology");m[ao]=p;Z[ao]=M[ab?ab:"Triangles"];Y[ao]=aa[ab?ab:"Triangles"]}if(ah){var ac=okA.array();var aq=okResourceParser._packMeshAttributes(ad,W,V,ac);okA._object(W);W=okA.object();W[aq]=ac;okA._object(V);V=okA.object();V[aq]=ac.length/ad}var e="";var R=null;var J=0;var d=0;var K=0;for(var t in Z){e=t;R=m[t];K=R.length;J=Z[t];d=Y[t];break}if(ad>65536&&T==1&&(J==4||J==1||J==0)){var F=0;while(F<K){var P=0;while(O[u+"_SV_"+P]!=null){P++}O[u+"_SV_"+P]=true;var C=c.createMesh(u+"_SV_"+P);var an=0;var H=new Array();for(var af=0;af<ad;++af){H.push(-1)}var q=okA.object();for(var a in W){q[a]=okA.array()}var x=okA.array();while(F<K){var o=F;var l=Math.min(F+d,K);var L=an;for(var af=o;af<l;++af){var ak=R[af];if(H[ak]==-1){H[ak]=an;for(var a in q){var s=V[a];var ag=W[a];var at=q[a];for(var ae=0;ae<s;++ae){at.push(ag[ak*s+ae])}}an+=1}x.push(H[ak])}if(an>65536){an=L;for(var a in q){var at=q[a];var s=V[a];while(at.length>65536*s){at.pop()}}for(var af=o;af<l;++af){x.pop()}break}F+=d}for(var a in q){var E=q[a];if(E.length>0){C.createAttribute(a,E.length,E)}}if(x.length>0){C.createIndex(e,x.length,x,35044,J)}C.setVertexNum(an);v.push(C)}}else{var C=c.createMesh(u);for(var a in W){var E=W[a];if(E.length>0){C.createAttribute(a,E.length,E)}}for(var t in m){var al=m[t];if(al.length>0){C.createIndex(t,al.length,al,35044,Z[t])}}C.setVertexNum(ad);v.push(C)}okA._object(W);okA._object(V);okA._object(m);okA._object(Z);okA._object(Y);var U=h.getChild("Skin");if(U){for(var u in v){var C=v[u];var A=C.getSkin();A.clear();var X=U.getChild("BoundingBox");A.setBoundingBox(X.getAttribValueVec3("Min"),X.getAttribValueVec3("Max"));var D=U.getChild("BoneList");for(var N in D.getChildMap()){var B=D.getChild(N);A.addBone(N,B.getAttribValueMat43("InitMatrix"))}A.setRefAttributeName(U.getAttribValueString("VertexBoneIndexAttribName"),U.getAttribValueString("VertexBoneWeightAttribName"))}}var X=h.getChild("BoundingBox");for(var u in v){var C=v[u];C.setBoundingBox(X.getAttribValueVec3("Min"),X.getAttribValueVec3("Max"))}var Q=h.getAttribValueString("Material");if(Q&&Q!=""){for(var u in v){var C=v[u];y[Q].clone(C.getMaterial())}}if(G!=false){for(var u in v){var C=v[u];var I=C.getIndexArray("Default");var z=new Array;var k=I.length/3;for(var ai=0;ai<k;++ai){var ar=I[ai*3];var ap=I[ai*3+1];var am=I[ai*3+2];z.push(ar,ap,ap,am,am,ar)}C.createIndex("Wireframe",z.length,z)}}};okResourceParser._loadModelXML=function(f,q,n,w,s){var C=q.indexOf("<");var c=q.lastIndexOf(">");if(C==-1||c==-1){return false}var o=okParseXML(q.substr(C,c-C+1));if(o==null){return false}var p=new okXmlDoc(o);var v=p.getRootNode();if(v.getName().toLowerCase()!="oak3dmodeldocument"){return false}var t=v.getAttribValueString("Version",true);var B=t.split(".");f.clear();var e=new Array;for(var A=0;A<v.getChildNum();++A){var d=v.getChild(A);if(d.getName()=="MaterialList"){var m=d.getChildNum();for(var y=0;y<m;++y){var a=d.getChild(y);var k=new okMaterial(f.rc);if(this._parseMaterialXML(a,k,s)==false){return false}e[a.getAttribValueString("Name")]=k}}else{if(d.getName()=="MeshList"){var z=okA.object();var l=okA.object();if(n){for(var y=0;y<n.length;++y){l[n[y]]=true}}var h=d.getChildNum();for(var y=0;y<h;++y){var u=d.getChild(y);var x=u.getAttribValueString("Name",true);if(x==null){return false}if(n&&l[x]==null){continue}z[x]=true}for(var y=0;y<h;++y){var u=d.getChild(y);var x=u.getAttribValueString("Name",true);if(n&&l[x]==null){continue}if(this._parseMeshXML(d.getChild(y),f,e,z,w,s)==false){return false}}okA._object(z);okA._object(l)}}}f.computeBoundingInfo();return true};okResourceParser._parseMaterialXML=function(a,p,o){var v=a.getAttribValueString("name",true);if(v==null){v=a.getAttribValueString("desc",true)}if(v){p.setDesc(v)}var h=a.getAttribNum();for(var t=0;t<h;++t){var m=a.getAttribName(t).toLowerCase();switch(m){case"emissive":p.setEmissive(a.getAttribValueVec3(t));break;case"ambient":p.setAmbient(a.getAttribValueVec3(t));break;case"diffuse":p.setDiffuse(a.getAttribValueVec3(t));break;case"specular":p.setSpecular(a.getAttribValueVec3(t));break;case"specularlevel":p.setSpecularLevel(a.getAttribValueFloat(t));break;case"glossiness":p.setGlossiness(a.getAttribValueFloat(t));break;case"alpha":p.setAlpha(a.getAttribValueFloat(t));break;case"blend":p.enableBlend(a.getAttribValueString(t).toLowerCase()=="true");break;case"alphatest":p.enableAlphaTest(a.getAttribValueString(t).toLowerCase()=="true");break;case"alphatestvalue":p.setAlphaTestValue(a.getAttribValueFloat(t));break;case"dynamiclighting":p.enableDynamicLighting(a.getAttribValueString(t).toLowerCase()=="true");break;case"wireframe":p.enableWireframe(a.getAttribValueString(t).toLowerCase()=="true");break;case"vertexcolor":p.enableVertexColor(a.getAttribValueString(t).toLowerCase()=="true");break;case"depthtest":p.enableDepthTest(a.getAttribValueString(t).toLowerCase()=="true");break;case"twoside":p.enableTwoSide(a.getAttribValueString(t).toLowerCase()=="true");break}}for(var t=0;t<a.getChildNum();++t){var c=a.getChild(t);if(c.getName()=="Texture"){var e=c.getAttribValueString("channel",true).toLowerCase();var w=0;if(e=="albedo1"){w=0}else{if(e=="albedo2"){w=1}else{if(e=="albedo3"){w=2}else{if(e=="albedo4"){w=3}else{if(e=="normal"){w=4}else{if(e=="opacity"){w=5}else{if(e=="specularlevel"){w=6}}}}}}}var h=c.getAttribNum();for(var s=0;s<h;++s){var m=c.getAttribName(s).toLowerCase();switch(m){case"name":p.setTextureName(w,c.getAttribValueString(s));break;case"texcoord":p.setTextureCoord(w,c.getAttribValueString(s));break;case"type":var f=c.getAttribValueString(s).toLowerCase();if(f=="2d"){p.setTextureType(w,3553)}else{if(f=="cube"){p.setTextureType(w,34067)}}break;case"filter":var k=c.getAttribValueString(s).toLowerCase();if(k=="linear"){p.setTextureFilter(w,9729)}else{if(k=="nearest"){p.setTextureFilter(w,9728)}}break;case"wrap":var q=c.getAttribValueString(s).toLowerCase();if(q=="repeat"){p.setTextureWrap(w,10497)}else{if(q=="clamp"){p.setTextureWrap(w,33071)}else{if(q=="mirror"){p.setTextureWrap(w,33648)}}}break;case"wrapu":var q=c.getAttribValueString(s).toLowerCase();if(q=="repeat"){p.setTextureWrapU(w,10497)}else{if(q=="clamp"){p.setTextureWrapU(w,33071)}else{if(q=="mirror"){p.setTextureWrapU(w,33648)}}}break;case"wrapv":var q=c.getAttribValueString(s).toLowerCase();if(q=="repeat"){p.setTextureWrapV(w,10497)}else{if(q=="clamp"){p.setTextureWrapV(w,33071)}else{if(q=="mirror"){p.setTextureWrapV(w,33648)}}}break;case"tangent":p.setTextureTangent(w,c.getAttribValueString(s));break;case"binormal":p.setTextureBinormal(w,c.getAttribValueString(s));break}}}else{if(c.getName().toLowerCase()==("Script").toLowerCase()){for(var s=0;s<c.getChildNum();++s){var n=c.getChild(s);var u=n.getName().toLowerCase();var d=n.getAttribValueString("Code",true);if(d==null){d=n.getText()}var l=n.getAttribValueString("Enable",true);if(u=="emissive"){if(d){p.setEmissiveScript(d)}if(l){p.enableEmissiveScript(l.toLowerCase()=="true")}}else{if(u=="diffuse"){if(d){p.setDiffuseScript(d)}if(l){p.enableDiffuseScript(l.toLowerCase()=="true")}}else{if(u=="specular"){if(d){p.setSpecularScript(d)}if(l){p.enableSpecularScript(l.toLowerCase()=="true")}}else{if(u=="specularpower"){if(d){p.setSpecularPowerScript(d)}if(l){p.enableSpecularPowerScript(l.toLowerCase()=="true")}}else{if(u=="normal"){if(d){p.setNormalScript(d)}if(l){p.enableNormalScript(l.toLowerCase()=="true")}}else{if(u=="alpha"){if(d){p.setAlphaScript(d)}if(l){p.enableAlphaScript(l.toLowerCase()=="true")}}else{if(u=="dctlight"){if(d){p.setDctLightScript(d)}if(l){p.enableDctLightScript(l.toLowerCase()=="true")}}else{if(u=="pointlight"){if(d){p.setPointLightScript(d)}if(l){p.enablePointLightScript(l.toLowerCase()=="true")}}else{if(u=="spotlight"){if(d){p.setSpotLightScript(d)}if(l){p.enableSpotLightScript(l.toLowerCase()=="true")}}}}}}}}}}}}}}return true};okResourceParser._packMeshAttributes=function(h,a,n,p){var f=new okList();for(var o in a){if(o.toLowerCase()=="position"||o.toLowerCase().indexOf("position/")==0){f.pushFront(o)}else{if(o!="Texcoord1"&&o!="Texcoord2"&&o!="Texcoord3"&&o!="Texcoord4"){f.pushBack(o)}}}if(a.Texcoord1){f.pushBack("Texcoord1")}if(a.Texcoord2){f.pushBack("Texcoord2")}if(a.Texcoord3){f.pushBack("Texcoord3")}if(a.Texcoord4){f.pushBack("Texcoord4")}for(var m=0;m<h;++m){var e=f.getRoot();while(e){var o=e.data;var l=a[o];var d=n[o];for(var k=0;k<d;++k){p.push(l[m*d+k])}e=e.next}}var c="";var e=f.getRoot();while(e){c+=(c!=""?"/":"")+e.data;e=e.next}return c};okResourceParser._parseMeshXML=function(k,c,z,N,G,af){if(k.getName()!="Mesh"){return false}var v=k.getAttribValueString("Name",true);var w=okA.array();var ab=(k.getAttribValueInt("VertexCount",true)?k.getAttribValueInt("VertexCount",true):0);var S=(k.getChild("IndexList",true)?k.getChild("IndexList",true).getChildNum():0);var V=okA.object();var U=okA.object();var n=okA.object();var X=okA.object();var W=okA.object();var M={triangles:4,trianglestrip:5,trianglefan:6,lines:1,linestrip:3,lineloop:2,points:0};var Y={triangles:3,trianglestrip:0,trianglefan:0,lines:2,linestrip:0,lineloop:0,points:1};var o=k.getChild("AttributeList",true);for(var ac=0;ac<o.getChildNum();++ac){var R=o.getChild(ac);if(R.getName().toLowerCase()=="attribute"){var am=R.getAttribValueString("Name",true);var q=R.getAttribValueFloatArray("Data",true);var t=q.length/ab;if(t-Math.floor(t)!=0){return false}V[am]=q;U[am]=t}}var ah=k.getChild("IndexList",true);for(var ac=0;ac<ah.getChildNum();++ac){var x=ah.getChild(ac);if(x.getName().toLowerCase()=="index"){var am=x.getAttribValueString("Name",true);var q=x.getAttribValueIntArray("Data",true);var Z=x.getAttribValueIntArray("Topology",true);n[am]=q;X[am]=M[Z?Z:"triangles"];W[am]=Y[Z?Z:"triangles"]}}if(af){var aa=okA.array();var ao=okResourceParser._packMeshAttributes(ab,V,U,aa);okA._object(V);V=okA.object();V[ao]=aa;okA._object(U);U=okA.object();U[ao]=aa.length/ab}var h="";var Q=null;var J=0;var e=0;var K=0;for(var u in X){h=u;Q=n[u];K=Q.length;J=X[u];e=W[u];break}if(ab>65536&&S==1&&(J==4||J==1||J==0)){var F=0;while(F<K){var O=0;while(N[v+"_SV_"+O]!=null){O++}N[v+"_SV_"+O]=true;var D=c.createMesh(v+"_SV_"+O);var al=0;var H=new Array();for(var ad=0;ad<ab;++ad){H.push(-1)}var s=okA.object();for(var a in V){s[a]=okA.array()}var y=okA.array();while(F<K){var p=F;var m=Math.min(F+e,K);var L=al;for(var ad=p;ad<m;++ad){var ai=Q[ad];if(H[ai]==-1){H[ai]=al;for(var a in s){var t=U[a];var ae=V[a];var aq=s[a];for(var ac=0;ac<t;++ac){aq.push(ae[ai*t+ac])}}al+=1}y.push(H[ai])}if(al>65536){al=L;for(var a in s){var aq=s[a];var t=U[a];while(aq.length>65536*t){aq.pop()}}for(var ad=p;ad<m;++ad){y.pop()}break}F+=e}for(var a in s){var E=s[a];if(E.length>0){D.createAttribute(a,E.length,E)}}if(y.length>0){D.createIndex(h,y.length,y,35044,J)}D.setVertexNum(al);w.push(D)}}else{var D=c.createMesh(v);for(var a in V){var E=V[a];if(E.length>0){D.createAttribute(a,E.length,E)}}for(var u in n){var aj=n[u];if(aj.length>0){D.createIndex(u,aj.length,aj,35044,X[u])}}D.setVertexNum(ab);w.push(D)}okA._object(V);okA._object(U);okA._object(n);okA._object(X);okA._object(W);for(var ad=0;ad<k.getChildNum();++ad){var C=k.getChild(ad);var d=C.getName();switch(d){case"Skin":var T=C;for(var v in w){var D=w[v];var B=D.getSkin();B.clear();for(var ac=0;ac<T.getChildNum();++ac){var C=T.getChild(ac);if(C.getName()=="Bone"){B.addBone(C.getAttribValueString("Name"),C.getAttribValueMat43("InitMatrix"))}else{if(C.getName()=="BoundingBox"){B.setBoundingBox(C.getAttribValueVec3("Min"),C.getAttribValueVec3("Max"))}}}B.setRefAttributeName(T.getAttribValueString("VertexBoneIndexAttribName"),T.getAttribValueString("VertexBoneWeightAttribName"))}break;case"BoundingBox":for(var v in w){var D=w[v];D.setBoundingBox(C.getAttribValueVec3("Min"),C.getAttribValueVec3("Max"))}break}}var P=k.getAttribValueString("Material");if(P!=""){for(var v in w){var D=w[v];z[P].clone(D.getMaterial())}}if(G!=false){for(var v in w){var D=w[v];var I=D.getIndexArray("Default");var A=new Array;var l=I.length/3;for(var ag=0;ag<l;++ag){var ap=I[ag*3];var an=I[ag*3+1];var ak=I[ag*3+2];A.push(ap,an,an,ak,ak,ap)}D.createIndex("Wireframe",A.length,A)}}};okResourceParser.loadSkAnimation=function(a,d,c){if(a==1){return okResourceParser._loadSkAnimationXML(d,c)}else{if(a==3){return okResourceParser._loadSkAnimationBinary(d,c)}else{return false}}};okResourceParser._loadSkAnimationXML=function(t,o){var z=o.indexOf("<");var d=o.lastIndexOf(">");if(z==-1||d==-1){return false}var m=okParseXML(o.substr(z,d-z+1));var n=new okXmlDoc(m);var s=n.getRootNode();if(s.getName()!="Oak3DAnimationDocument"){return false}var p=s.getAttribValueString("Version");var y=p.split(".");t.clear();for(var w=0;w<s.getChildNum();++w){var e=s.getChild(w);if(e.getName()=="AnimationInfo"){}else{if(e.getName()=="KeyFrameList"){t.setFrameNum(e.getAttribValueInt("Count"));if(e.getAttribValueFloat("FrameTime")!=null){t.setFrameTime(e.getAttribValueFloat("FrameTime"))}t.loadKeyFrameList(e.getAttribValueIntArray("KeyTimeList"))}else{if(e.getName()=="BoundingBox"){t.setBoundingBox(e.getAttribValueVec3("Min"),e.getAttribValueVec3("Max"))}else{if(e.getName()=="BoneList"){for(var v=0;v<e.getChildNum();++v){var c=e.getChild(v);if(c.getName()=="Bone"){var f=new okSkAnimBone();var x=new Array;var l=new Array;f.setName(c.getAttribValueString("Name"));for(var u=0;u<c.getChildNum();++u){var a=c.getChild(u);x.push(a.getAttribValueVec3("Translation"));l.push(a.getAttribValueQuat("Rotation"))}f.loadKeyTranslateList(x);f.loadKeyQuaternionList(l);t.addBone(f)}}for(var v=0;v<e.getChildNum();++v){var c=e.getChild(v);if(c.getName()=="Bone"){var h=t.getBone(c.getAttribValueString("Name"));var q=c.getAttribValueString("Parent");if(q!=""){h.setParent(t.getBone(q))}}}}}}}}return true};okResourceParser._loadSkAnimationBinary=function(u,n){var m=new okBinDoc(n,"OKAMBI");if(!m.isValid()){return false}var t=m.getRootNode();var p=t.getAttribValueString("Version");var y=p.split(".");u.clear();var d=t.getChild("AnimationInfo");var s=t.getChild("KeyFrameList");if(s){u.setFrameNum(s.getAttribValueInt("Count"));if(s.isAttribExisted("FrameTime")){u.setFrameTime(s.getAttribValueFloat("FrameTime"))}u.loadKeyFrameList(s.getAttribValueIntArray("KeyTimeList"))}var o=t.getChild("BoneList");if(o){for(var e in o.getChildMap()){var a=o.getChild(e);var f=new okSkAnimBone();var w=new Array;var l=new Array;f.setName(e);var h=a.getChild("KeyList");if(h){for(var v=0;v<h.getChildNum();++v){var c=h.getChild(v);var x=c.getAttribValueFloatArray("TQ");w.push(new okVec3(x[0],x[1],x[2]));l.push(new okQuat(x[3],x[4],x[5],x[6]))}f.loadKeyTranslateList(w);f.loadKeyQuaternionList(l)}u.addBone(f)}for(var e in o.getChildMap()){var a=o.getChild(e);var k=u.getBone(e);var q=a.getAttribValueString("Parent");if(q!=""){k.setParent(u.getBone(q))}}}return true};okResourceParser.loadShaderSource=function(l,q,m,d){var k=okPackXMLShaderSource(d);var h=new okXmlDoc(okParseXML(k));var a=h.getRootNode();if(a.getName().toLowerCase()!=("OakShader").toLowerCase()){return false}var f=a.getChild("Common",true);var o=okUnpackXMLShaderSource((f!=null)?f.getText():"");if(q!=null){var n=a.getChild("Vertex",true);if(n!=null){var e="";var c=okUnpackXMLShaderSource(n.getText());q.loadSource(o+"\n"+c)}else{return false}}if(m!=null){var p=a.getChild("Fragment",true);if(p!=null){var c=okUnpackXMLShaderSource(p.getText());m.loadSource(o+"\n"+c)}else{return false}}return true};okResourceParser.loadShaderSourceToMap=function(k,m,d){var f=okPackXMLShaderSource(d);var e=new okXmlDoc(okParseXML(f));var a=e.getRootNode();if(a.getName().toLowerCase()!=("OakShader").toLowerCase()){return false}if(m==null){return false}var l=a.getChildNum();for(var h=0;h<l;++h){var c=a.getChild(h);var d=okUnpackXMLShaderSource(c.getText());m[c.getName()]=d}return true};okResourceParser.loadTextureFromImage=function(d,e,c){if(!okIsPower2(e.width)||!okIsPower2(e.height)){if(okIsUndefined(this.texSupportedCanvas)&&!okIsIE()){this.texSupportedCanvas=document.createElement("canvas")}if(this.texSupportedCanvas){this.texSupportedCanvas.width=okAlignPower2(e.width);this.texSupportedCanvas.height=okAlignPower2(e.height);var a=this.texSupportedCanvas.getContext("2d");a.drawImage(e,0,0,e.width,e.height,0,0,this.texSupportedCanvas.width,this.texSupportedCanvas.height);e=this.texSupportedCanvas}else{return false}}d.createTexture(3553,e.width,e.height,c,5121,e);return true};okResourceParser.loadTextureFromVideo=function(d,c,a){d.createTexture(3553,c.width,c.height,a,5121,c);return true};okResourceParser.loadTerrainFromXml=function(e,t,p){var h=new okXmlDoc(t);var n=h.getRootNode();if(n.getName()!="Oak3DModelDocument"){return false}var m=n.getAttribValueString("Version");var w=m.split(".");for(var s=0;s<n.getChildNum();++s){var a=n.getChild(s);if(a.getName()=="terrainInfo"){var c=a.getAttribValueInt("cw");var k=a.getAttribValueInt("ch");var v=a.getAttribValueInt("ww");var f=a.getAttribValueInt("wh");e.setChunkSize(c,k);e.setWorldMapSize(v,f)}if(a.getName()=="WorldMap"){var x=new okTerrainTile(e.$L5.rc);var o=a.getAttribValueFloatArray("min");var q=a.getAttribValueFloatArray("max");x.setBoundingBox(new okVec3(o[0],o[1],o[2]),new okVec3(q[0],q[1],q[2]));var l=a.getAttribValueInt("i");var u=a.getAttribValueInt("j");x.setGlobalIndex(l,u);var d=a.getAttribValueString("url");x.setUrl(d);e.addWorldMap(x)}}return true},okResourceParser.loadWorldMapFromXml=function(e,h){var k=new okXmlDoc(h);var c=k.getRootNode();if(c.getName()!="Oak3DModelDocument"){return false}var n=c.getAttribValueString("Version");var p=n.split(".");var m;var d=c.getAttribValueString("n");for(var l=0;l<e.$G1.length;++l){if(e.$G1[l].getUrl()==d){m=e.$G1[l];break}}if(!m){return}for(var l=0;l<c.getChildNum();++l){var a=c.getChild(l);if(a.getName()=="Textures"){this._parseTerrainTextureInOmx(m,a)}if(a.getName()=="WorldMap"){var f=a.getAttribValueFloatArray("min");var o=a.getAttribValueFloatArray("max");m.setBoundingBox(new okVec3(f[0],f[1],f[2]),new okVec3(o[0],o[1],o[2]));m.setGlobalIndex(a.getAttribValueInt("i"),a.getAttribValueInt("j"));this._parseTerrainMeshInOmx(m,a);m.computeNormal();m.fixNormal(e.getWorldMapMap());m.createAttributeArrayBuffer("Normal")}}m.setState(3);return true};okResourceParser._parseTerrainMeshInOmx=function(u,o){for(var z=0;z<o.getChildNum();++z){var d=o.getChild(z);var c;if(d.getName()=="Mesh"){c=new okTerrainTile(u.rc)}else{c=new okTerrainMesh(u.rc)}u.addChlidMesh(c);var t=d.getAttribValueFloatArray("min");var v=d.getAttribValueFloatArray("max");c.setBoundingBox(new okVec3(t[0],t[1],t[2]),new okVec3(v[0],v[1],v[2]));var k=d.getAttribValueInt("i");var f=d.getAttribValueInt("j");c.setGlobalIndex(k,f);if(d.getName()=="Mesh"){this._parseTerrainMeshInOmx(c,d)}else{c.setName("chunk_"+k.toString()+"_"+f.toString());var e=new Array;var E=d.getAttribValueFloat("sx");var D=d.getAttribValueFloat("sy");var l=c.getChunkWidth();var A=c.getChunkHeight();var p=d.getAttribValueFloatArray("data");for(var q=0;q<A;++q){for(var s=0;s<l;++s){var B=new Array;B[0]=E*(k*(l-1)+s);B[1]=D*(f*(A-1)+q);B[2]=p[q*l+s];for(var C=0;C<B.length;C++){e.push(B[C])}}}c.createAttribute("Position",e.length,e,35044)}}};okResourceParser._parseTerrainTextureInOmx=function(m,c){for(var f=0;f<c.getChildNum();++f){var h=c.getChild(f);var d=h.getAttribValueFloatArray("data");m.loadTextureFromXml("Texcoord1",d);var k=h.getAttribValueString("name");var l=m.getMaterialArray();for(var e=0;e<l.length;++e){var a=l[e];if(!a){continue}a.setTextureName(0,k)}}};okResourceParser.loadTerrainFromBmp=function(d){var c=d.width;var a=d.height};function okArrayBuffer(a){this.rc=a;this.$D3=null;this.$14=0;this.$h4=0;this.$g4=0;this.$04=0}okArrayBuffer.prototype={createBuffer:function(c,a,d,e){this.releaseBuffer();this.$D3=this.rc.createBuffer();this.$14=c;this.rc.bindBuffer(this.$14,this.$D3);this.$h4=a;this.$g4=((a==5123)?2:4);if(okIsNumber(e)){this.$04=e;this.rc.bufferData(this.$14,e*this.$g4,d)}else{this.$04=e.length;if(okIsArray(e)){if(a==5126){this.rc.bufferData(this.$14,new Float32Array(e),d)}else{if(a==5123){this.rc.bufferData(this.$14,new Uint16Array(e),d)}}}else{this.rc.bufferData(this.$14,e,d)}}},releaseBuffer:function(){if(this.$D3!=null){this.rc.deleteBuffer(this.$D3)}this.$D3=null},updateBuffer:function(a,c,d){this.rc.bindBuffer(this.$14,this.$D3);if(okIsArray(d)){if(this.$h4==5126){this.rc.bufferSubData(this.$14,a*this.$g4,new Float32Array(d))}else{if(this.$h4==5123){this.rc.bufferSubData(this.$14,a*this.$g4,new Uint16Array(d))}}}else{this.rc.bufferSubData(this.$14,a*this.$g4,d)}},getLength:function(){return this.$04},bindAttrib:function(d,c,e,a){this.rc.bindBuffer(this.$14,this.$D3);this.rc.enableVertexAttribArray(d);this.rc.vertexAttribPointer(d,c,this.$h4,false,a*this.$g4,e*this.$g4)},bind:function(){this.rc.bindBuffer(this.$14,this.$D3)},drawIndex:function(a,c,d){this.rc.bindBuffer(this.$14,this.$D3);this.rc.drawElements(a,d?d:this.$04,this.$h4,c?c*this.$g4:0)}};function okRenderBuffer(a){this.rc=a;this.$F3=null;this.$Z3=0;this.$Y4=0;this.$q4=0}okRenderBuffer.prototype={createBuffer:function(a,c,d){this.releaseBuffer();this.$F3=this.rc.createRenderbuffer();this.rc.bindRenderbuffer(36161,this.$F3);this.rc.renderbufferStorage(36161,a,c,d);this.$Z3=a;this.$Y4=c;this.$q4=d},releaseBuffer:function(){if(this.$F3!=null){this.rc.deleteRenderbuffer(this.$F3)}this.$F3=null;this.$Z3=0;this.$Y4=0;this.$q4=0}};function okFrameBuffer(a){this.rc=a;this.glFrameBufferObj=null}okFrameBuffer.prototype={createBuffer:function(){this.glFrameBufferObj=this.rc.createFramebuffer()},releaseBuffer:function(){if(this.glFrameBufferObj!=null){this.rc.deleteFramebuffer(this.glFrameBufferObj)}this.glFrameBufferObj=null},bind:function(){this.rc.bindFramebuffer(36160,this.glFrameBufferObj)},unbind:function(){this.rc.bindFramebuffer(36160,null)},attachRenderTexture:function(c,a){this.rc.framebufferTexture2D(36160,36064+c,3553,a?a.$H3:null,0)},attachDepthBuffer:function(a){this.rc.framebufferRenderbuffer(36160,36096,36161,a.$F3)},attachStencilBuffer:function(a){this.rc.framebufferRenderbuffer(36160,36128,36161,a.$F3)},attachDepthStencilBuffer:function(a){this.rc.framebufferRenderbuffer(36160,33306,36161,a?a.$F3:null)}};function okShader(c,a){this.$G4=a;this.rc=c;this.$G3=this.rc.createShader(this.$G4);this.$j6="";this.$16="mediump"}okShader.prototype={releaseShader:function(){if(this.$G3!=null){this.rc.deleteShader(this.$G3)}this.$G3=null},releaseSource:function(){this.$j6=""},loadSource:function(c,a){if(a){this.$j6=this._processInc(c,a)}else{this.$j6=c.substr(0,c.length)}},setFloatPrecision:function(a){this.$16=a},compile:function(f,a){var h="";if(f!=null){for(var e in f){h+=("\n#define "+e+" "+f[e]+"\n")}}var d="";if(this.$G4==35632){d="\nprecision "+this.$16+" float;\n"}if(this.$G3==null){this.$G3=this.rc.createShader(this.$G4)}var c=d+((f!=null)?h+this.$j6:this.$j6);this.rc.shaderSource(this.$G3,c);this.rc.compileShader(this.$G3);if(!this.rc.getShaderParameter(this.$G3,35713)){if(a){a.errorMsg=shaderInfo}return false}return true},_processInc:function(d,l){var e=okA.array();var k=okA.array();var q=okA.array();var p=-1;p=d.indexOf("#include");while(p!=-1){var o=p+8;while(d[o]!='"'&&o<d.length){++o}if(d[o]!='"'){return""}var u=o+1;while(d[u]!='"'&&u<d.length){++u}if(d[u]!='"'){return""}if(u==(o+1)){return""}var c=d.substr(o+1,u-(o+1));e.push(p);k.push(u);q.push(c);if(u<d.length-1){p=d.indexOf("#include",u)}else{p=-1}}var n=0;var f="";var t=e.length;for(var m=0;m<t;++m){var h=e[m];var v=k[m];var a=q[m];var s=l[a];if(h-n>0){f+=d.substr(n,h-n)}if(s){f+=s}n=v+1}if(n<d.length){f+=d.substr(n)}okA._array(e);okA._array(k);okA._array(q);return f}};function okProgram(a){this.rc=a;this.$E3=this.rc.createProgram();this.$27=null;this.$z3=null;this.$4=okA.object();this.$5=okA.object();this.$s1=okA.object();this.$G6=[0,0,0,0,0,0,0,0,0];this.$H6=[0,0,0,0,0,0,0,0,0,0,0,0];this.$I6=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.$F6=new Array}okProgram.prototype={releaseProgram:function(){if(this.$E3!=null){this.rc.deleteProgram(this.$E3)}this.$E3=null},attachVertexShader:function(a){this.$27=a},attachFragmentShader:function(a){this.$z3=a},link:function(a){if(this.$E3==null){this.$E3=this.rc.createProgram()}okA._object(this.$4);okA._object(this.$5);okA._object(this.$s1);this.$4=okA.object();this.$5=okA.object();this.$s1=okA.object();this.rc.attachShader(this.$E3,this.$27.$G3);this.rc.attachShader(this.$E3,this.$z3.$G3);this.rc.linkProgram(this.$E3);if(!this.rc.getProgramParameter(this.$E3,35714)){if(a){a.errorMsg=programInfo}return false}var d=this.rc.getProgramParameter(this.$E3,35721);var h=this.rc.getProgramParameter(this.$E3,35718);for(var e=0;e<d;++e){var k=this.rc.getActiveAttrib(this.$E3,e);var c=k.name.replace(/\[\d*\]/g,"");this.$4[c]=this.rc.getAttribLocation(this.$E3,c)}var f=0;for(var e=0;e<h;++e){var k=this.rc.getActiveUniform(this.$E3,e);var c=k.name.replace(/\[\d*\]/g,"");this.$5[c]=this.rc.getUniformLocation(this.$E3,c);if(k.type==35678||k.type==35680){this.$s1[c]=f;f+=k.size}}return true},setUniformInt:function(a,c){this.rc.uniform1i(this.$5[a],c)},setUniformInt2:function(c,a,d){if(typeof a=="number"){this.rc.uniform2i(this.$5[c],a,d)}else{this.rc.uniform2i(this.$5[c],a.x,a.y)}},setUniformInt3:function(c,a,e,d){if(typeof a=="number"){this.rc.uniform3i(this.$5[c],a,e,d)}else{this.rc.uniform3i(this.$5[c],a.x,a.y,a.z)}},setUniformInt4:function(d,a,f,e,c){if(typeof a=="number"){this.rc.uniform4i(this.$5[d],a,f,e,c)}else{this.rc.uniform4i(this.$5[d],a.x,a.y,a.z,a.w)}},setUniformIntArray:function(c,a){this.rc.uniform1iv(this.$5[c],a)},setUniformInt2Array:function(c,a){this.rc.uniform2iv(this.$5[c],a)},setUniformInt3Array:function(c,a){this.rc.uniform3iv(this.$5[c],a)},setUniformInt4Array:function(c,a){this.rc.uniform4iv(this.$5[c],a)},setUniformFloat:function(c,a){this.rc.uniform1f(this.$5[c],a)},setUniformFloat2:function(d,c,a){if(typeof c=="number"){this.rc.uniform2f(this.$5[d],c,a)}else{this.rc.uniform2f(this.$5[d],c.x,c.y)}},setUniformFloat3:function(e,d,c,a){if(typeof d=="number"){this.rc.uniform3f(this.$5[e],d,c,a)}else{this.rc.uniform3f(this.$5[e],d.x,d.y,d.z)}},setUniformFloat4:function(f,d,c,a,e){if(typeof d=="number"){this.rc.uniform4f(this.$5[f],d,c,a,e)}else{this.rc.uniform4f(this.$5[f],d.x,d.y,d.z,d.w)}},setUniformFloatArray:function(c,a){this.rc.uniform1fv(this.$5[c],a)},setUniformFloat2Array:function(c,a){this.rc.uniform2fv(this.$5[c],a)},setUniformFloat3Array:function(c,a){this.rc.uniform3fv(this.$5[c],a)},setUniformFloat4Array:function(c,a){this.rc.uniform4fv(this.$5[c],a)},setUniformVec2Array:function(e,d){var f=okA.array();var a=d.length;for(var c=0;c<a;++c){var h=d[c];f.push(h.x,h.y)}this.rc.uniform2fv(this.$5[e],f);okA._array(f)},setUniformVec3Array:function(e,d){var f=okA.array();var a=d.length;for(var c=0;c<a;++c){var h=d[c];f.push(h.x,h.y,h.z)}this.rc.uniform3fv(this.$5[e],f);okA._array(f)},setUniformVec4Array:function(e,d){var f=okA.array();var a=d.length;for(var c=0;c<a;++c){var h=d[c];f.push(h.x,h.y,h.z,h.w)}this.rc.uniform4fv(this.$5[e],f);okA._array(f)},setUniformMat3:function(c,a){var d=this.$G6;d[0]=a.m00;d[1]=a.m10;d[2]=a.m20;d[3]=a.m01;d[4]=a.m11;d[5]=a.m21;d[6]=a.m02;d[7]=a.m12;d[8]=a.m22;this.rc.uniformMatrix3fv(this.$5[c],false,d)},setUniformMat3Array:function(f,e){var h=this.$F6;h.length=0;var c=e.length;for(var d=0;d<c;++d){var a=e[d];h.push(a.m00,a.m10,a.m20,a.m01,a.m11,a.m21,a.m02,a.m12,a.m22)}this.rc.uniformMatrix3fv(this.$5[f],false,h)},setUniformMat4:function(c,a){var d=this.$I6;d[0]=a.m00;d[1]=a.m10;d[2]=a.m20;d[3]=a.m30;d[4]=a.m01;d[5]=a.m11;d[6]=a.m21;d[7]=a.m31;d[8]=a.m02;d[9]=a.m12;d[10]=a.m22;d[11]=a.m32;d[12]=a.m03;d[13]=a.m13;d[14]=a.m23;d[15]=a.m33;this.rc.uniformMatrix4fv(this.$5[c],false,d)},setUniformMat4Array:function(f,e){var h=this.$F6;h.length=0;var c=e.length;for(var d=0;d<c;++d){var a=e[d];h.push(a.m00,a.m10,a.m20,a.m30,a.m01,a.m11,a.m21,a.m31,a.m02,a.m12,a.m22,a.m32,a.m03,a.m13,a.m23,a.m33)}this.rc.uniformMatrix4fv(this.$5[f],false,h)},setUniformMat43:function(d,c,a){if(!a){var e=this.$H6;e[0]=c.m00;e[1]=c.m01;e[2]=c.m02;e[3]=c.m03;e[4]=c.m10;e[5]=c.m11;e[6]=c.m12;e[7]=c.m13;e[8]=c.m20;e[9]=c.m21;e[10]=c.m22;e[11]=c.m23;this.rc.uniform4fv(this.$5[d],e)}else{var e=this.$I6;e[0]=c.m00;e[1]=c.m10;e[2]=c.m20;e[3]=0;e[4]=c.m01;e[5]=c.m11;e[6]=c.m21;e[7]=0;e[8]=c.m02;e[9]=c.m12;e[10]=c.m22;e[11]=0;e[12]=c.m03;e[13]=c.m13;e[14]=c.m23;e[15]=1;this.rc.uniformMatrix4fv(this.$5[d],false,e)}},setUniformMat43Array:function(h,f,d){var k=this.$F6;k.length=0;if(!d){var c=f.length;for(var e=0;e<c;++e){var a=f[e];k.push(a.m00,a.m01,a.m02,a.m03,a.m10,a.m11,a.m12,a.m13,a.m20,a.m21,a.m22,a.m23)}this.rc.uniform4fv(this.$5[h],k)}else{var c=f.length;for(var e=0;e<c;++e){var a=f[e];k.push(a.m00,a.m10,a.m20,0,a.m01,a.m11,a.m21,0,a.m02,a.m12,a.m22,0,a.m03,a.m13,a.m23,1)}this.rc.uniformMatrix4fv(this.$5[h],false,k)}},setSampler:function(a,c){this.rc.uniform1i(this.$5[a],c)},setSamplerArray:function(a,c){this.rc.uniform1iv(this.$5[a],c)},setTexture:function(h,d,f,c,e){if(d){var l=this.$5[h];var k=this.$s1[h];this.rc.uniform1i(this.$5[h],k);d.bind(k);var a=d.getType();f=f?f:10497;this.rc.texParameteri(a,10242,f);this.rc.texParameteri(a,10243,f);if(d.isMipMap()){if(c==9728||c==9729){c+=9984-9728}else{if(c==null){c=9985}}}else{c=c?c:9729}this.rc.texParameteri(a,10241,c);e=e?e:9729;this.rc.texParameteri(a,10240,e)}},setTextureArray:function(t,n,a,e,k){var f=this.$5[t];var s=this.$s1[t];var m=okA.array();var s=this.$s1[t];var c=n.length;for(var h=0;h<c;++h){var q=n[h];var d=(a?(okIsNumber(a)?a:a[h]):null);var l=(e?(okIsNumber(e)?e:e[h]):null);var o=(k?(okIsNumber(k)?k:k[h]):null);q.bind(s);var p=q.getType();d=d?d:10497;this.rc.texParameteri(p,10242,d);this.rc.texParameteri(p,10243,d);if(q.isMipMap()){if(l==9728||l==9729){l+=9984-9728}else{if(l==null){l=9985}}}else{l=l?l:9729}this.rc.texParameteri(p,10241,l);o=o?o:9729;this.rc.texParameteri(p,10240,o);m.push(s++)}this.rc.uniform1iv(this.$5[t],m);okA._array(m)},setAttribute:function(f,e,d,c,a){var h=this.$4[f];if(h!=null){e.bindAttrib(h,d,(c!=null)?c:0,(a!=null)?a:0)}},bind:function(){this.rc.useProgram(this.$E3)}};function okTexture(a){this.rc=a;this.$H3=null;this.$S4=0;this.$J4=0;this.$K4=0;this.$n4=0;this.$l2=false;this.$37=null}okTexture.prototype={isValid:function(){return(this.$H3!=null)},getType:function(){return this.$S4},createTexture:function(n,o,h,f,c,m,e,l,d,k,a){this.releaseTexture();this.$H3=this.rc.createTexture();this.$S4=n;this.$J4=o;this.$K4=h;this.$n4=f;this.$l2=false;if(n==3553){this.rc.bindTexture(3553,this.$H3);if(m==null){this.rc.texImage2D(3553,0,f,o,h,0,f,c?c:5121,null)}else{if(m.width!=null&&m.height!=null){this.rc.texImage2D(3553,0,f,f,c?c:5121,m)}else{if(okIsArray(m)){switch(c){case 5126:m=new Float32Array(m);break;default:m=new Uint8Array(m)}}this.rc.texImage2D(3553,0,f,o,h,0,f,c?c:5121,m)}}}else{if(n==34067){this.rc.bindTexture(34067,this.$H3);switch(c){case 5126:m=okIsArray(m)?new Float32Array(m):m;e=okIsArray(e)?new Float32Array(e):e;l=okIsArray(l)?new Float32Array(l):l;d=okIsArray(d)?new Float32Array(d):d;k=okIsArray(k)?new Float32Array(k):k;a=okIsArray(a)?new Float32Array(a):a;break;default:m=okIsArray(m)?new Uint8Array(m):m;e=okIsArray(e)?new Uint8Array(e):e;l=okIsArray(l)?new Uint8Array(l):l;d=okIsArray(d)?new Uint8Array(d):d;k=okIsArray(k)?new Uint8Array(k):k;a=okIsArray(a)?new Uint8Array(a):a}if(m.width!=null&&m.height!=null){this.rc.texImage2D(34069,0,f,f,c?c:5121,m)}else{this.rc.texImage2D(34069,0,f,o,h,0,f,c?c:5121,m)}if(e.width!=null&&e.height!=null){this.rc.texImage2D(34070,0,f,f,c?c:5121,e)}else{this.rc.texImage2D(34070,0,f,o,h,0,f,c?c:5121,e)}if(l.width!=null&&l.height!=null){this.rc.texImage2D(34071,0,f,f,c?c:5121,l)}else{this.rc.texImage2D(34071,0,f,o,h,0,f,c?c:5121,l)}if(d.width!=null&&d.height!=null){this.rc.texImage2D(34072,0,f,f,c?c:5121,d)}else{this.rc.texImage2D(34072,0,f,o,h,0,f,c?c:5121,d)}if(k.width!=null&&k.height!=null){this.rc.texImage2D(34073,0,f,f,c?c:5121,k)}else{this.rc.texImage2D(34073,0,f,o,h,0,f,c?c:5121,k)}if(a.width!=null&&a.height!=null){this.rc.texImage2D(34074,0,f,f,c?c:5121,a)}else{this.rc.texImage2D(34074,0,f,o,h,0,f,c?c:5121,a)}}}},releaseTexture:function(){if(this.$H3!=null){this.rc.deleteTexture(this.$H3);this.$H3=null}this.$S4=0;this.$J4=0;this.$K4=0;this.$n4=0;this.$l2=false},updateTexture:function(h,f,o,k,c,n,e,m,d,l,a){if(this.$S4==3553){this.rc.bindTexture(3553,this.$H3);if(n.width!=null&&n.height!=null){this.rc.texSubImage2D(3553,0,h,f,this.$n4,c?c:5121,n)}else{if(okIsArray(n)){switch(c){case 5126:n=new Float32Array(n);break;default:n=new Uint8Array(n)}}this.rc.texSubImage2D(3553,0,h,f,o,k,this.$n4,c?c:5121,n)}}else{if(this.$S4==34067){this.rc.bindTexture(34067,this.$H3);switch(c){case 5126:n=okIsArray(n)?new Float32Array(n):n;e=okIsArray(e)?new Float32Array(e):e;m=okIsArray(m)?new Float32Array(m):m;d=okIsArray(d)?new Float32Array(d):d;l=okIsArray(l)?new Float32Array(l):l;a=okIsArray(a)?new Float32Array(a):a;break;default:n=okIsArray(n)?new Uint8Array(n):n;e=okIsArray(e)?new Uint8Array(e):e;m=okIsArray(m)?new Uint8Array(m):m;d=okIsArray(d)?new Uint8Array(d):d;l=okIsArray(l)?new Uint8Array(l):l;a=okIsArray(a)?new Uint8Array(a):a}if(n){if(n.width!=null&&n.height!=null){this.rc.texSubImage2D(34069,0,h,f,this.$n4,c?c:5121,n)}else{this.rc.texSubImage2D(34069,0,h,f,o,k,this.$n4,c?c:5121,n)}}if(e){if(e.width!=null&&e.height!=null){this.rc.texSubImage2D(34070,0,h,f,this.$n4,c?c:5121,e)}else{this.rc.texSubImage2D(34070,0,h,f,o,k,this.$n4,c?c:5121,e)}}if(m){if(m.width!=null&&m.height!=null){this.rc.texSubImage2D(34071,0,h,f,this.$n4,c?c:5121,m)}else{this.rc.texSubImage2D(34071,0,h,f,o,k,this.$n4,c?c:5121,m)}}if(d){if(d.width!=null&&d.height!=null){this.rc.texSubImage2D(34072,0,h,f,this.$n4,c?c:5121,d)}else{this.rc.texSubImage2D(34072,0,h,f,o,k,this.$n4,c?c:5121,d)}}if(l){if(l.width!=null&&l.height!=null){this.rc.texSubImage2D(34073,0,h,f,this.$n4,c?c:5121,l)}else{this.rc.texSubImage2D(34073,0,h,f,o,k,this.$n4,c?c:5121,l)}}if(a){if(a.width!=null&&a.height!=null){this.rc.texSubImage2D(34074,0,h,f,this.$n4,c?c:5121,a)}else{this.rc.texSubImage2D(34074,0,h,f,o,k,this.$n4,c?c:5121,a)}}}}},getSizeU:function(a){var c=(this.$J4>>((a!=null)?a:0));return(c>0)?c:1},getSizeV:function(a){var c=(this.$K4>>((a!=null)?a:0));return(c>0)?c:1},bind:function(a){this.rc.activeTexture(33984+((a!=null)?a:0));this.rc.bindTexture(this.$S4,this.$H3)},updateVideoTexture:function(){if(!this.$37){return}if(this.$37.readyState===this.$37.HAVE_ENOUGH_DATA){this.updateTexture(0,0,0,0,5121,this.$37);this.rc.texParameteri(3553,10242,33071);this.rc.texParameteri(3553,10243,33071);this.rc.texParameteri(3553,10240,9729);this.rc.texParameteri(3553,10241,9729)}},isVideoTexture:function(){if(!this.$37){return false}return true},genMipMap:function(){this.rc.generateMipmap(this.$S4);this.$l2=true},isMipMap:function(){return this.$l2}};function okCamera(a){this.rc=a;this.$56="";this.$z6=null;this.$b5=new okMat43(1);this.$m5=new okMat43(1);this.$E2=true;this.$E4=1;this.$k5=new okMat4(1);this.$r2=true;this.$o5=new okMat4(1);this.$n5=new okMat4(1);this.$F2=true;this.$A3=new okFrustum();this.$c2=true;this.$W4=0;this.$X4=0;this.$V4=0;this.$U4=0;this.$S6=new okVec3(0,0,0);this.$R5="";this.$P3=-1;this.$a3=45;this.$t3=1;this.$s3=10000}okCamera.prototype={clear:function(){this.$56="";this.$b5.identity();this.$m5.identity();this.$E2=true;this.$E4=1;this.$k5.identity();this.$r2=true;this.$o5.identity();this.$n5.identity();this.$F2=true;this.$A3=new okFrustum();this.$c2=true;this.$W4=0;this.$X4=0;this.$V4=0;this.$U4=0;this.$S6.set(0,0,0);this.$R5="";if(this.$P3!=-1){var a=this.$z6.$L5;a.deleteResource(this.$P3);this.$P3=-1}this.$a3=45;this.$t3=1;this.$s3=10000},reset:function(c,a){if(c!=false){this.$b5.setColumn(3,0,0,0)}if(a!=false){this.$b5.setColumn(0,1,0,0);this.$b5.setColumn(1,0,1,0);this.$b5.setColumn(2,0,0,1)}this.$E2=true;this.$F2=true;this.$c2=true},setName:function(a){this.$56=a},getName:function(){return this.$56},setMat:function(a){a.clone(this.$b5);this.$E2=true;this.$F2=true;this.$c2=true},setPos:function(d,c,a){if(d!=null&&a!=null){this.$b5.m03=d;this.$b5.m13=c;this.$b5.m23=a}else{this.$b5.m03=d.x;this.$b5.m13=d.y;this.$b5.m23=d.z}this.$E2=true;this.$F2=true;this.$c2=true},getPos:function(){return this.$b5.getColumn(3)},move:function(e,d,c,a){if(e==3){if(d!=null&&a!=null){this.$b5.m03+=d;this.$b5.m13+=c;this.$b5.m23+=a}else{this.$b5.m03+=d.x;this.$b5.m13+=d.y;this.$b5.m23+=d.z}}else{if(d!=null&&a!=null){this.$b5.m03+=(d*this.$b5.m00+c*this.$b5.m01+a*this.$b5.m02);this.$b5.m13+=(d*this.$b5.m10+c*this.$b5.m11+a*this.$b5.m12);this.$b5.m23+=(d*this.$b5.m20+c*this.$b5.m21+a*this.$b5.m22)}else{this.$b5.m03+=(d.x*this.$b5.m00+d.y*this.$b5.m01+d.z*this.$b5.m02);this.$b5.m13+=(d.x*this.$b5.m10+d.y*this.$b5.m11+d.z*this.$b5.m12);this.$b5.m23+=(d.x*this.$b5.m20+d.y*this.$b5.m21+d.z*this.$b5.m22)}}this.$E2=true;this.$F2=true;this.$c2=true},moveRight:function(a){this.$b5.m03+=a*this.$b5.m00;this.$b5.m13+=a*this.$b5.m10;this.$b5.m23+=a*this.$b5.m20;this.$E2=true;this.$F2=true;this.$c2=true},moveUp:function(a){this.$b5.m03+=a*this.$b5.m01;this.$b5.m13+=a*this.$b5.m11;this.$b5.m23+=a*this.$b5.m21;this.$E2=true;this.$F2=true;this.$c2=true},moveForward:function(a){this.$b5.m03-=a*this.$b5.m02;this.$b5.m13-=a*this.$b5.m12;this.$b5.m23-=a*this.$b5.m22;this.$E2=true;this.$F2=true;this.$c2=true},rotX:function(k,h){var a=okMat43RotX(h);if(k==3){var e=this.$b5.m03;var d=this.$b5.m13;var c=this.$b5.m23;var f=okMat43Mul(a,this.$b5);okA._mat43(this.$b5);this.$b5=f;this.$b5.m03=e;this.$b5.m13=d;this.$b5.m23=c}else{var f=okMat43Mul(this.$b5,a);okA._mat43(this.$b5);this.$b5=f}okA._mat43(a);this.$E2=true;this.$F2=true;this.$c2=true},rotY:function(k,h){var a=okMat43RotY(h);if(k==3){var e=this.$b5.m03;var d=this.$b5.m13;var c=this.$b5.m23;var f=okMat43Mul(a,this.$b5);okA._mat43(this.$b5);this.$b5=f;this.$b5.m03=e;this.$b5.m13=d;this.$b5.m23=c}else{var f=okMat43Mul(this.$b5,a);okA._mat43(this.$b5);this.$b5=f}okA._mat43(a);this.$E2=true;this.$F2=true;this.$c2=true},rotZ:function(k,h){var a=okMat43RotZ(h);if(k==3){var e=this.$b5.m03;var d=this.$b5.m13;var c=this.$b5.m23;var f=okMat43Mul(a,this.$b5);okA._mat43(this.$b5);this.$b5=f;this.$b5.m03=e;this.$b5.m13=d;this.$b5.m23=c}else{var f=okMat43Mul(this.$b5,a);okA._mat43(this.$b5);this.$b5=f}okA._mat43(a);this.$E2=true;this.$F2=true;this.$c2=true},rotRight:function(d){var a=okMat43RotX(d);var c=okMat43Mul(this.$b5,a);okA._mat43(this.$b5);this.$b5=c;this.$E2=true;this.$F2=true;this.$c2=true},rotUp:function(d){var a=okMat43RotY(d);var c=okMat43Mul(this.$b5,a);okA._mat43(this.$b5);this.$b5=c;this.$E2=true;this.$F2=true;this.$c2=true},rotForward:function(d){var a=okMat43RotZ(-d);var c=okMat43Mul(this.$b5,a);okA._mat43(this.$b5);this.$b5=c;this.$E2=true;this.$F2=true;this.$c2=true},rotTarget:function(e,h,f){var c=okA.mat43();this.$b5.clone(c);c.m03-=h.x;c.m13-=h.y;c.m23-=h.z;var a=okMat43Rot(e,f);var d=okMat43Mul(a,c);okA._mat43(c);d.m03+=h.x;d.m13+=h.y;d.m23+=h.z;d.clone(this.$b5);okA._mat43(d);this.$E2=true;this.$F2=true;this.$c2=true},getRightDir:function(){var a=okA.vec3();a.x=this.$b5.m00;a.y=this.$b5.m10;a.z=this.$b5.m20;return a},getUpDir:function(){var a=okA.vec3();a.x=this.$b5.m01;a.y=this.$b5.m11;a.z=this.$b5.m21;return a},getForwardDir:function(){var a=okA.vec3();a.x=-this.$b5.m02;a.y=-this.$b5.m12;a.z=-this.$b5.m22;return a},lookAt:function(n,l,h,k,f,e){var m=okA.vec3();var c=okA.vec3();if(typeof n=="number"){m.x=n;m.y=l;m.z=h;if(f){c.x=k;c.y=f;c.z=e}else{if(k){c.x=k.x;c.y=k.y;c.z=k.z}else{c.x=this.$b5.m01;c.y=this.$b5.m11;c.z=this.$b5.m21}}}else{m.x=n.x;m.y=n.y;m.z=n.z;if(h){c.x=l;c.y=h;c.z=k}else{if(l){c.x=l.x;c.y=l.y;c.z=l.z}else{c.x=this.$b5.m01;c.y=this.$b5.m11;c.z=this.$b5.m21}}}var a=okA.vec3();a.x=this.$b5.m03-m.x;a.y=this.$b5.m13-m.y;a.z=this.$b5.m23-m.z;a.normalize(true);var d=okVec3Cross(c,a);if(d.equal(OAK.VEC3_ZERO)){d.x=this.$b5.m00;d.y=this.$b5.m10;d.z=this.$b5.m20;d.normalize(true);c=okVec3Cross(a,d);okA._vec3(d);d=okVec3Cross(c,a)}else{okA._vec3(c);c=okVec3Cross(a,d)}d.normalize(true);c.normalize(true);this.$b5.m00=d.x;this.$b5.m10=d.y;this.$b5.m20=d.z;this.$b5.m01=c.x;this.$b5.m11=c.y;this.$b5.m21=c.z;this.$b5.m02=a.x;this.$b5.m12=a.y;this.$b5.m22=a.z;this.$E2=true;this.$F2=true;this.$c2=true},getViewMat4:function(){if(this.$E2){okA._mat43(this.$m5);this.$m5=this.$b5.inverse();this.$E2=false}var a=okA.mat4();this.$m5.toMat4(a);return a},getViewMat43:function(){if(this.$E2){okA._mat43(this.$m5);this.$m5=this.$b5.inverse();this.$E2=false}var a=okA.mat43();this.$m5.clone(a);return a},getMat4:function(){var a=okA.mat4();this.$b5.toMat4(a);return a},getMat43:function(){var a=okA.mat43();this.$b5.clone(a);return a},getViewInvMat4:function(){var a=okA.mat4();this.$b5.toMat4(a);return a},getViewInvMat43:function(){var a=okA.mat43();this.$b5.clone(a);return a},setViewport:function(e,d,a,c){this.$W4=e;this.$X4=d;this.$V4=a;this.$U4=c;this.$r2=true;this.$F2=true;this.$c2=true},getViewportLeft:function(){return this.$W4},getViewportTop:function(){return this.$X4},getViewportWidth:function(){return this.$V4},getViewportHeight:function(){return this.$U4},bindViewport:function(){var a=this.rc.canvas.clientHeight;this.rc.viewport(this.$W4,a-(this.$X4+this.$U4),this.$V4,this.$U4);this.rc.scissor(this.$W4,a-(this.$X4+this.$U4),this.$V4,this.$U4)},setBackColor:function(c,a,d,e){if(a==null){this.$S6.x=c.x;this.$S6.y=c.y;this.$S6.z=c.z;this.$S6.w=(c.w?c.w:1)}else{this.$S6.x=c;this.$S6.y=a;this.$S6.z=d;this.$S6.w=((e!=null)?e:1)}},getBackColor:function(){return this.$S6},setBackTexture:function(a){var e=this.$z6.$L5;if(a!=""){var d=this.$z6._packTextureUrl(a);this.$P3=e.createResource(2,d);var c=e.getResourceState(this.$P3);if(c==2){e.loadTextureByUrl(this.$P3,d,6408)}}else{if(this.$P3!=-1){e.deleteResource(this.$P3)}this.$P3=-1}this.$R5=a},getBackTextureResourceId:function(){return this.$P3},setFov:function(a){this.$a3=a;this.$r2=true;this.$F2=true},getFov:function(){return this.$a3},setVisibleRange:function(a,c){this.$t3=Math.max(0.01,a);this.$s3=c;this.$r2=true;this.$F2=true},setVisibleNear:function(a){this.$t3=a},setVisibleFar:function(a){this.$s3=a},getVisibleNear:function(){return this.$t3},getVisibleFar:function(){return this.$s3},setProjMode:function(a){if(a==2){a=3}this.$E4=a;this.$r2=true;this.$F2=true},getProjMode:function(){return this.$E4},getProjMat4:function(){if(this.$r2){if(this.$E4==1){okA._mat4(this.$k5);this.$k5=okMat4Proj(this.$a3,this.$V4/this.$U4,this.$t3,this.$s3);this.$r2=false}else{if(this.$E4==3){okA._mat4(this.$k5);this.$k5=okMat4Ortho(-this.$V4/this.$U4,this.$V4/this.$U4,1,-1,this.$t3,this.$s3);this.$r2=false}else{if(this.$E4==4){okA._mat4(this.$k5);this.$k5=okMat4Ortho(0,this.$V4,0,this.$U4,this.$t3,this.$s3);this.$r2=false}}}}return this.$k5},getViewProjMat4:function(){if(this.$F2){okA._mat4(this.$o5);okA._mat4(this.$n5);this.$o5=okMat4Mul(this.getProjMat4(),this.getViewMat4());this.$n5=this.$o5.inverse();this.$F2=false}return this.$o5},getViewProjInvMat4:function(){if(this.$F2){okA._mat4(this.$o5);okA._mat4(this.$n5);this.$o5=okMat4Mul(this.getProjMat4(),this.getViewMat4());this.$n5=this.$o5.inverse();this.$F2=false}return this.$n5},getFrustum:function(){if(this.$c2){this.$A3.setByViewProjMat(this.getViewProjMat4());this.$c2=false}return this.$A3},getPickPoint:function(c,h){var a=c-this.$W4;var f=this.$U4-(h-this.$X4);var d=okA.vec3();d.x=a/this.$V4*2-1;d.y=f/this.$U4*2-1;d.z=-0.99;var e=okMat4MulVec3(this.getViewProjInvMat4(),d);okA._vec3(d);return e},getPickDir:function(c,k){var e=okA.vec3();if(this.$E4==1){var a=c-this.$W4;var h=this.$U4-(k-this.$X4);var d=okA.vec3();d.x=a/this.$V4*2-1;d.y=h/this.$U4*2-1;d.z=-0.99;var f=okMat4MulVec3(this.getViewProjInvMat4(),d);e.x=f.x-this.$b5.m03;e.y=f.y-this.$b5.m13;e.z=f.z-this.$b5.m23;okA._vec3(d);okA._vec3(f)}else{e.x=-this.$b5.m02;e.y=-this.$b5.m12;e.z=-this.$b5.m22}return e},getPickFrustum:function(v,u,k,q){var p=v+((k>0)?0:k);var o=u+((q>0)?0:q);k=(k>0)?k:-k;q=(q>0)?q:-q;var s=okA.vec3();s.x=this.$b5.m03;s.y=this.$b5.m13;s.z=this.$b5.m23;var f=this.getPickPoint(p,o);var d=this.getPickPoint(p+k,o);var c=this.getPickPoint(p+k,o+q);var a=this.getPickPoint(p,o+q);var n=okA.vec3();var m=okA.vec3();var h=okA.vec3();var e=okA.vec3();n.x=f.x-s.x;n.y=f.y-s.y;n.z=f.z-s.z;m.x=d.x-s.x;m.y=d.y-s.y;m.z=d.z-s.z;h.x=c.x-s.x;h.y=c.y-s.y;h.z=c.z-s.z;e.x=a.x-s.x;e.y=a.y-s.y;e.z=a.z-s.z;var l=new okFrustum();l.setByViewProjMat(this.getViewProjMat4());var t=okA.plane();var w=okVec3Cross(n,m);t.set(s,w);okA._vec3(w);l.setPlane(4,t);var w=okVec3Cross(h,e);t.set(s,w);okA._vec3(w);l.setPlane(5,t);var w=okVec3Cross(e,n);t.set(s,w);okA._vec3(w);l.setPlane(2,t);var w=okVec3Cross(m,h);t.set(s,w);okA._vec3(w);l.setPlane(3,t);okA._vec3(s);okA._vec3(f);okA._vec3(d);okA._vec3(c);okA._vec3(a);okA._vec3(n);okA._vec3(m);okA._vec3(h);okA._vec3(e);return l}};function okMaterial(){this.$W5="";this.$V6=new okVec3(0,0,0);this.$Q6=new okVec3(0,0,0);this.$U6=new okVec3(1,1,1);this.$17=new okVec3(0,0,0);this.$p3=1;this.$c3=8;this.$23=1;this.$V1=false;this.$S3=32774;this.$T3=32774;this.$V3=770;this.$Q3=771;this.$W3=1;this.$R3=1;this.$O1=false;this.$33=0;this.$62=true;this.$I2=false;this.$g3=1;this.$D2=false;this.$22=true;this.$32=true;this.$A2=false;this.$X6=new okVec3(1,1,1);this.$d2=false;this.$a2=true;this.$u1=["","","","","","",""];this.$w1=[3553,3553,3553,3553,3553,3553,3553];this.$t1=[9729,9729,9729,9729,9729,9729,9729];this.$x1=[33071,33071,33071,33071,33071,33071,33071];this.$y1=[33071,33071,33071,33071,33071,33071,33071];this.$A1=["Texcoord1","Texcoord1","Texcoord1","Texcoord1","Texcoord1","Texcoord1","Texcoord1"];this.$r1=["","","","","","",""];this.$c=["","","","","","",""];this.$72=true;this.$52=true;this.$42=true;this.$y2=true;this.$x2=true;this.$n2=true;this.$N1=true;this.$e2=true;this.$12=true;this.$q2=true;this.$z2=true;this.$06="";this.$Y5="";this.$X5="";this.$s6="";this.$r6="";this.$66="";this.$P5="";this.$26="";this.$V5="";this.$i6="";this.$t6="";this.$b6="";this.$a6="";this.$96="";this.$g6="";this.$f6="";this.$d6="";this.$76="";this.$c6="";this.$86="";this.$e6="";this.$h6="";this.$03=null;this.$v1=[-1,-1,-1,-1,-1,-1,-1];this.$p6="";this.$l6="";this.$n6="";this.$k1=okA.object();this.$v2=true;this.$u2=true}okMaterial.prototype={clear:function(){this.$W5="";this.$V6.set(0,0,0);this.$Q6.set(0,0,0);this.$U6.set(1,1,1);this.$17.set(0,0,0);this.$p3=1;this.$c3=8;this.$23=1;this.$V1=false;this.$S3=32774;this.$T3=32774;this.$V3=770;this.$Q3=771;this.$W3=1;this.$R3=1;this.$O1=false;this.$33=0;this.$62=true;this.$I2=false;this.$g3=1;this.$D2=false;this.$22=true;this.$32=true;this.$A2=false;this.$X6.set(1,1,1);this.$d2=false;this.$a2=true;for(var a=0;a<7;++a){this.$u1[a]="";this.$w1[a]=3553;this.$t1[a]=9729;this.$x1[a]=33071;this.$y1[a]=33071;this.$A1[a]="Texcoord1";this.$r1[a]="";this.$c[a]=""}this.$72=true;this.$52=true;this.$42=true;this.$y2=true;this.$x2=true;this.$n2=true;this.$N1=true;this.$e2=true;this.$12=true;this.$q2=true;this.$z2=true;this.$06="";this.$Y5="";this.$X5="";this.$s6="";this.$r6="";this.$66="";this.$P5="";this.$26="";this.$V5="";this.$i6="";this.$t6="";this.$b6="";this.$a6="";this.$96="";this.$g6="";this.$f6="";this.$d6="";this.$76="";this.$c6="";this.$86="";this.$e6="";this.$h6="";for(var a=0;a<7;++a){this.$v1[a]=-1}this.$p6="";this.$l6="";this.$n6="";okA._object(this.$k1);this.$k1=okA.object();this.$v2=true;this.$u2=true},clone:function(a){var a=(a?a:new okMaterial());a.$W5=this.$W5;a.$V6=this.$V6.clone();a.$Q6=this.$Q6.clone();a.$U6=this.$U6.clone();a.$17=this.$17.clone();a.$p3=this.$p3;a.$c3=this.$c3;a.$23=this.$23;a.$V1=this.$V1;a.$S3=this.$S3;a.$T3=this.$T3;a.$V3=this.$V3;a.$Q3=this.$Q3;a.$W3=this.$W3;a.$R3=this.$R3;a.$O1=this.$O1;a.$33=this.$33;a.$62=this.$62;a.$I2=this.$I2;a.$g3=this.$g3;a.$D2=this.$D2;a.$22=this.$22;a.$32=this.$32;a.$A2=this.$A2;this.$X6.clone(a.$X6);a.$d2=this.$d2;a.$a2=this.$a2;for(var c=0;c<7;++c){a.setTextureName(c,this.$u1[c]);a.setTextureType(c,this.$w1[c]);a.setTextureFilter(c,this.$t1[c]);a.setTextureWrapU(c,this.$x1[c]);a.setTextureWrapV(c,this.$y1[c]);a.setTextureCoord(c,this.$A1[c]);a.setTextureTangent(c,this.$r1[c]);a.setTextureBinormal(c,this.$c[c])}a.$72=this.$72;a.$52=this.$52;a.$42=this.$42;a.$y2=this.$y2;a.bGlossinessScript=this.bGlossinessScript;a.$N1=this.$N1;a.$n2=this.$n2;a.$e2=this.$e2;a.$12=this.$12;a.$q2=this.$q2;a.$z2=this.$z2;a.$06=this.$06;a.$Y5=this.$Y5;a.$X5=this.$X5;a.$s6=this.$s6;a.$r6=this.$r6;a.$P5=this.$P5;a.$66=this.$66;a.$26=this.$26;a.$V5=this.$V5;a.$i6=this.$i6;a.$t6=this.$t6;a.$b6=this.$b6;a.$a6=this.$a6;a.$96=this.$96;a.$g6=this.$g6;a.$f6=this.$f6;a.$76=this.$76;a.$d6=this.$d6;a.$c6=this.$c6;a.$86=this.$86;a.$e6=this.$e6;a.$h6=this.$h6;a.$v2=true;a.$u2=true;return a},setDesc:function(a){this.$W5=a},getDesc:function(){return this.$W5},setEmissive:function(c,a,d){if(a!=null&&d!=null){this.$V6.set(c,a,d)}else{this.$V6=c.clone()}},getEmissive:function(){return this.$V6.clone()},setAmbient:function(c,a,d){if(a!=null&&d!=null){this.$Q6.set(c,a,d)}else{this.$Q6=c.clone()}},getAmbient:function(){return this.$Q6.clone()},setDiffuse:function(c,a,d){if(a!=null&&d!=null){this.$U6.set(c,a,d)}else{this.$U6=c.clone()}},getDiffuse:function(){return this.$U6.clone()},setSpecular:function(c,a,d){if(a!=null&&d!=null){this.$17.set(c,a,d)}else{this.$17=c.clone()}},getSpecular:function(){return this.$17.clone()},setSpecularLevel:function(a){this.$p3=a},getSpecularLevel:function(){return this.$p3},setGlossiness:function(a){this.$c3=a},getGlossiness:function(){return this.$c3},setAlpha:function(a){this.$23=a},getAlpha:function(){return this.$23},enableBlend:function(a){this.$V1=a},isBlend:function(){return this.$V1},isBlendEnabled:function(){return this.$V1},setBlendEquation:function(a,c){if(a==3||a==1){this.$S3=c}if(a==3||a==2){this.$T3=c}},getBlendEquation:function(a){if(a==1||a==3){return this.$S3}else{if(a==2){return this.$T3}}},setBlendFunc:function(a,d,c){if(a==3||a==1){this.$V3=d;this.$Q3=c}if(a==3||a==2){this.$W3=d;this.$R3=c}},getBlendFuncSrc:function(a){if(a==1||a==3){return this.$V3}else{if(a==2){return this.$W3}}},getBlendFuncDest:function(a){if(a==1||a==3){return this.$Q3}else{if(a==2){return this.$R3}}},enableFog:function(a){this.$a2=a;this.$v2=true;this.$u2=true},isFogEnabled:function(){return this.$a2},enableAlphaTest:function(a){this.$O1=a;this.$v2=true;this.$u2=true},isAlphaTest:function(){return this.$O1},isAlphaTestEnabled:function(){return this.$O1},setAlphaTestValue:function(a){this.$33=a},getAlphaTestValue:function(a){return this.$33},enableDynamicLighting:function(a){this.$62=a;this.$v2=true;this.$u2=true},isDynamicLighting:function(){return this.$62},isDynamicLightingEnabled:function(){return this.$62},enableWireframe:function(a){this.$I2=a;this.$v2=true;this.$u2=true},isWireframe:function(){return this.$I2},isWireframeEnabled:function(){return this.$I2},setLineWidth:function(a){this.$g3=a},getLineWidth:function(){return this.$g3},enableVertexColor:function(a){this.$D2=a;this.$v2=true;this.$u2=true},isVertexColor:function(){return this.$D2},isVertexColorEnabled:function(){return this.$D2},enableDepthTest:function(a){this.$22=a},isDepthTest:function(){return this.$22},isDepthTestEnabled:function(){return this.$22},enableDepthWrite:function(a){this.$32=a},isDepthWrite:function(){return this.$32},isDepthWriteEnabled:function(){return this.$32},enableTwoSide:function(a){this.$A2=a;this.$v2=true;this.$u2=true},isTwoSide:function(){return this.$A2},isTwoSideEnabled:function(){return this.$A2},enableGlow:function(a){this.$d2=a;this.$v2=true;this.$u2=true},isGlow:function(){return this.$d2},isGlowEnabled:function(){return this.$d2},setGlowColor:function(c,a,d){if(a!=null&&d!=null){this.$X6.set(c,a,d)}else{c.clone(this.$X6)}},getGlowColor:function(){return this.$X6},setTextureName:function(h,f){f=f.replace(/\\/g,"/");f=f.replace(/^\/+/g,"");this.$u1[h]=f;if(f!=""){var n=f.split(" ");if(n.length==6){this.$w1[h]=34067}}if(this.$03!=null){var k=this.$03;var c=k.$57.$z6.$L5;var a=k.$57.$z6;if(f!=""){var d=k.$57.$z6._packTextureUrl(f);var o=c.createResource(2,d);k.addResourceRef(o);this.$v1[h]=o;var l=c.getResourceState(o);if(l==2){if(this.$w1[h]==3553){c.loadTextureByUrl(o,d,6408)}else{if(this.$w1[h]==34067){var m=f.split(" ");if(m.length==6){c.loadCubeTextureByUrl(o,a._packTextureUrl(m[0]),a._packTextureUrl(m[1]),a._packTextureUrl(m[2]),a._packTextureUrl(m[3]),a._packTextureUrl(m[4]),a._packTextureUrl(m[5]))}else{}}}}}else{this.$v1[h]=-1}}this.$v2=true;this.$u2=true;this.$b6="";this.$a6="";this.$96="";this.$g6="";this.$f6="";this.$d6="";this.$76="";this.$c6="";this.$86="";this.$e6="";this.$h6=""},getTextureName:function(a){return this.$u1[a]},getTextureResourceId:function(a){return this.$v1[a]},setTextureType:function(c,a){this.$w1[c]=a;if(this.$u1[c]!=""){this.setTextureName(c,this.$u1[c])}this.$b6="";this.$a6="";this.$96="";this.$g6="";this.$f6="";this.$d6="";this.$76="";this.$86="";this.$e6="";this.$h6="";this.$v2=true;this.$u2=true;this.$b6="";this.$a6="";this.$96="";this.$g6="";this.$f6="";this.$d6="";this.$76="";this.$c6="";this.$86="";this.$e6="";this.$h6=""},getTextureType:function(a){return this.$w1[a]},setTextureFilter:function(c,a){this.$t1[c]=a},getTextureFilter:function(a){return this.$t1[a]},setTextureWrap:function(c,a){this.$x1[c]=a;this.$y1[c]=a},setTextureWrapU:function(c,a){this.$x1[c]=a},setTextureWrapV:function(c,a){this.$y1[c]=a},getTextureWrapU:function(a){return this.$x1[a]},getTextureWrapV:function(a){return this.$y1[a]},setTextureCoord:function(c,a){this.$A1[c]=a;this.$v2=true;this.$u2=true},getTextureCoord:function(a){return this.$A1[a]},setTextureTangent:function(c,a){this.$r1[c]=a;this.$v2=true;this.$u2=true},getTextureTangent:function(a){return this.$r1[a]},setTextureBinormal:function(c,a){this.$c[c]=a;this.$v2=true;this.$u2=true},getTextureBinormal:function(a){return this.$c[a]},enableEmissiveScript:function(a){this.$72=a;this.$v2=true;this.$u2=true},isEmissiveScriptEnabled:function(){return this.$72},enableDiffuseScript:function(a){this.$52=a;this.$v2=true;this.$u2=true},isDiffuseScriptEnabled:function(){return this.$52},enableDiffusePowerScript:function(a){this.$42=a;this.$v2=true;this.$u2=true},isDiffusePowerScriptEnabled:function(){return this.$42},enableSpecularScript:function(a){this.$y2=a;this.$v2=true;this.$u2=true},isSpecularScriptEnabled:function(){return this.$y2},enableSpecularPowerScript:function(a){this.$x2=a;this.$v2=true;this.$u2=true},isSpecularPowerScriptEnabled:function(){return this.$x2},enableAlphaScript:function(a){this.$N1=a;this.$v2=true;this.$u2=true},isAlphaScriptEnabled:function(){return this.$N1},enableNormalScript:function(a){this.$n2=a;this.$v2=true;this.$u2=true},isNormalScriptEnabled:function(){return this.$n2},enableDctLightScript:function(a){this.$12=a;this.$v2=true;this.$u2=true},isDctLightScriptEnabled:function(){return this.$12},enablePointLightScript:function(a){this.$q2=a;this.$v2=true;this.$u2=true},isPointLightScriptEnabled:function(){return this.$q2},enableSpotLightScript:function(a){this.$z2=a;this.$v2=true;this.$u2=true},isSpotLightScriptEnabled:function(){return this.$z2},setEmissiveScript:function(a){this.$06=a;this.$b6="";this.$v2=true;this.$u2=true},getEmissiveScript:function(){return this.$06},getPackedEmissiveScript:function(){if(this.$06!=""&&this.$b6==""){this.$b6=this._processScript(this.$06,true,"vec3")}return this.$b6},setDiffuseScript:function(a){this.$Y5=a;this.$a6="";this.$v2=true;this.$u2=true},getDiffuseScript:function(){return this.$Y5},getPackedDiffuseScript:function(){if(this.$Y5!=""&&this.$a6==""){this.$a6=this._processScript(this.$Y5,true,"vec3")}return this.$a6},setDiffusePowerScript:function(a){this.$X5=a;this.$96="";this.$v2=true;this.$u2=true},getDiffusePowerScript:function(){return this.$X5},getPackedDiffusePowerScript:function(){if(this.$X5!=""&&this.$96==""){this.$96=this._processScript(this.$X5,true,"float")}return this.$96},setSpecularScript:function(a){this.$s6=a;this.$g6="";this.$v2=true;this.$u2=true},getSpecularScript:function(){return this.$s6},getPackedSpecularScript:function(){if(this.$s6!=""&&this.$g6==""){this.$g6=this._processScript(this.$s6,true,"vec3")}return this.$g6},setSpecularPowerScript:function(a){this.$r6=a;this.$f6="";this.$v2=true;this.$u2=true},getSpecularPowerScript:function(){return this.$r6},getPackedSpecularPowerScript:function(){if(this.$r6!=""&&this.$f6==""){this.$f6=this._processScript(this.$r6,true,"float")}return this.$f6},setNormalScript:function(a){this.$66=a;this.$d6="";this.$v2=true;this.$u2=true},getNormalScript:function(){return this.$66},getPackedNormalScript:function(){if(this.$66!=""&&this.$d6==""){this.$d6=this._processScript(this.$66,true,"vec3")}return this.$d6},setAlphaScript:function(a){this.$P5=a;this.$76="";this.$v2=true;this.$u2=true},getAlphaScript:function(){return this.$P5},getPackedAlphaScript:function(){if(this.$P5!=""&&this.$76==""){this.$76=this._processScript(this.$P5,true,"float")}return this.$76},setDctLightScript:function(a){this.$V5=a;this.$86="";this.$v2=true;this.$u2=true},getDctLightScript:function(){return this.$V5},getPackedDctLightScript:function(){if(this.$V5!=""&&this.$86==""){this.$86=this._processScript(this.$V5,false)}return this.$86},setPointLightScript:function(a){this.$i6=a;this.$e6="";this.$v2=true;this.$u2=true},getPointLightScript:function(){return this.$i6},getPackedPointLightScript:function(){if(this.$i6!=""&&this.$e6==""){this.$e6=this._processScript(this.$i6,false)}return this.$e6},setSpotLightScript:function(a){this.$t6=a;this.$h6="";this.$v2=true;this.$u2=true},getSpotLightScript:function(){return this.$t6},getPackedSpotLightScript:function(){if(this.$t6!=""&&this.$h6==""){this.$h6=this._processScript(this.$t6,false)}return this.$h6},_setEntity:function(a){this.$03=a},_processScript:function(k,f,n){var u="";var h=k.length;var s=false;for(var o=0;o<h;++o){var v=k.charAt(o);if(v=="\n"){s=false;continue}if(s){continue}if(v==" "){if(u.length>0&&o<(h-1)){var l=u.charCodeAt(u.length-1);var q=k.charCodeAt(o+1);if(((l>=48&&l<=57)||(l>=65&&l<=90)||(l>=97&&l<=122))&&((q>=48&&q<=57)||(q>=65&&q<=90)||(q>=97&&q<=122))){u+=" "}}}else{if(v=="/"){if(o==h-1){u+="/"}else{if(k.charAt(o+1)=="/"){s=true}else{u+="/"}}}else{u+=v}}}if(u==""){return""}if(f){var p=u.match(/\breturn\b/g);if(p==null){u="return "+n+"("+u+");"}}u=u.replace(/(^|[^a-zA-Z0-9_\.])(\d+)(?![0-9]|\.)/g,"$1$2.0");u=u.replace(/\[(\d+)\.(\d*)\]/g,"[$1]");if(this.$u1[0]){u=u.replace(/\(ALBEDO1,/g," okFunc_FetchTexture(okUni_Sampler0,")}else{u=u.replace(/\(ALBEDO1,/g," okFunc_FetchDummyTexture(")}if(this.$u1[1]){u=u.replace(/\(ALBEDO2,/g," okFunc_FetchTexture(okUni_Sampler1,")}else{u=u.replace(/\(ALBEDO2,/g," okFunc_FetchDummyTexture(")}if(this.$u1[2]){u=u.replace(/\(ALBEDO3,/g," okFunc_FetchTexture(okUni_Sampler2,")}else{u=u.replace(/\(ALBEDO3,/g," okFunc_FetchDummyTexture(")}if(this.$u1[3]){u=u.replace(/\(ALBEDO4,/g," okFunc_FetchTexture(okUni_Sampler3,")}else{u=u.replace(/\(ALBEDO4,/g," okFunc_FetchDummyTexture(")}if(this.$u1[4]){u=u.replace(/\(NORMAL,/g," okFunc_FetchTexture(okUni_Sampler4,")}else{u=u.replace(/\(NORMAL,/g," okFunc_FetchDummyTexture(")}if(this.$u1[5]){u=u.replace(/\(OPACITY,/g," okFunc_FetchTexture(okUni_Sampler5,")}else{u=u.replace(/\(OPACITY,/g," okFunc_FetchDummyTexture(")}if(this.$u1[6]){u=u.replace(/\(SPECULARLEVEL,/g," okFunc_FetchTexture(okUni_Sampler6,")}else{u=u.replace(/\(SPECULARLEVEL,/g," okFunc_FetchDummyTexture(")}u=u.replace(/texture2D okFunc_FetchTexture\(/g,"texture2D");u=u.replace(/textureCube okFunc_FetchTexture\(/g,"textureCube");var m=okA.array();var e=okA.array();var d=okA.array();var a=-1;var t=-1;var h=u.length;for(var o=0;o<h;++o){switch(u.charAt(o)){case"[":m.push("[");d.push(a);e.push(t);a=0;t=m.length-1;break;case"]":if(t!=-1){if(a>=1){m[t]=" vec"+(a+1)+"(";m.push(")")}else{m.push("]")}if(e.length>0){t=e.pop()}else{return""}a=d.pop()}else{return""}break;case"(":m.push("(");d.push(a);e.push(t);a=0;t=m.length-1;break;case")":if(t!=-1){m.push(")");if(e.length>0){t=e.pop()}else{return""}a=d.pop()}else{return""}break;case",":a+=1;m.push(",");break;default:m.push(u.charAt(o))}}u=m.join("");okA._array(m);okA._array(d);okA._array(e);return u},_genShdKey:function(){var o=this.$72?this.getPackedEmissiveScript():"";var k=this.$52?this.getPackedDiffuseScript():"";var q=this.$42?this.getPackedDiffusePowerScript():"";var f=this.$y2?this.getPackedSpecularScript():"";var p=this.$x2?this.getPackedSpecularPowerScript():"";var n=this.$N1?this.getPackedAlphaScript():"";var m=this.$n2?this.getPackedNormalScript():"";var l=this.$12?this.getPackedDctLightScript():"";var s=this.$q2?this.getPackedPointLightScript():"";var c=this.$z2?this.getPackedSpotLightScript():"";var h=0;for(var e=0;e<7;++e){if(this.$u1[e]!=""){h+=(2<<(e*2));if(this.$w1[0]==34067){h+=(2<<(e*2+1))}}}var a=""+((this.$A1[0]!="")?this.$A1[0].charAt(8):0)+((this.$A1[1]!="")?this.$A1[1].charAt(8):0)+((this.$A1[2]!="")?this.$A1[2].charAt(8):0)+((this.$A1[3]!="")?this.$A1[3].charAt(8):0)+((this.$A1[4]!="")?this.$A1[4].charAt(8):0)+((this.$A1[5]!="")?this.$A1[5].charAt(8):0)+((this.$A1[6]!="")?this.$A1[6].charAt(8):0);var d=(this.$u1[4]!="")?1:0;this.$p6=d;this.$l6=""+h+"_"+a+"_"+d+(this.$62?1:0)+(this.$V1?1:0)+(this.$O1?1:0)+(this.$D2?1:0)+(this.$A2?1:0)+(this.$a2?1:0)+"_"+o+"_"+k+"_"+q+"_"+f+"_"+p+"_"+n+"_"+m+"_"+l+"_"+s+"_"+c;this.$n6=this.$l6},_genShdDef:function(){for(var p in this.$k1){delete this.$k1[p]}var k=this.$72?this.getPackedEmissiveScript():"";var d=this.$52?this.getPackedDiffuseScript():"";var n=this.$42?this.getPackedDiffusePowerScript():"";var c=this.$y2?this.getPackedSpecularScript():"";var l=this.$x2?this.getPackedSpecularPowerScript():"";var h=this.$N1?this.getPackedAlphaScript():"";var f=this.$n2?this.getPackedNormalScript():"";var e=this.$12?this.getPackedDctLightScript():"";var o=this.$q2?this.getPackedPointLightScript():"";var a=this.$z2?this.getPackedSpotLightScript():"";var m=this.$k1;if(this.$62){m.OK_DYNAMICLIGHTING=1}if(this.$D2){m.OK_AUTO_VERTEX_COLOR=1}if(this.bTwoSidey){m.OK_TWO_SIDE=1}if(this.$V1){m.OK_BLEND=1}if(this.$O1){m.OK_ALPHA_TEST=1}if(this.$a2){m.OK_FOG=1}if(this.$u1[0]!=""){m.OK_TEX_ALBEDO1=1}if(this.$u1[1]!=""){m.OK_TEX_ALBEDO2=1}if(this.$u1[2]!=""){m.OK_TEX_ALBEDO3=1}if(this.$u1[3]!=""){m.OK_TEX_ALBEDO4=1}if(this.$u1[4]!=""){m.OK_TEX_NORMALMAP=1}if(this.$u1[5]!=""){m.OK_TEX_OPACITY=1}if(this.$u1[6]!=""){m.OK_TEX_SPECULAR_LEVEL=1}if(this.$r1[4]!=""){m.OK_TANGENT=1}if(this.$c[4]!=""){m.OK_BINORMAL=1}if(this.$w1[0]==34067){m.OK_TEX_ALBEDO1_CUBE=1}if(this.$w1[1]==34067){m.OK_TEX_ALBEDO2_CUBE=1}if(this.$w1[2]==34067){m.OK_TEX_ALBEDO3_CUBE=1}if(this.$w1[3]==34067){m.OK_TEX_ALBEDO4_CUBE=1}if(k!=""){m.OK_SCRIPT_EMISSIVE_CODE=k}if(d!=""){m.OK_SCRIPT_DIFFUSE_CODE=d}if(n!=""){m.OK_SCRIPT_DIFFUSEPOWER_CODE=n}if(c!=""){m.OK_SCRIPT_SPECULAR_CODE=c}if(l!=""){m.OK_SCRIPT_SPECULARPOWER_CODE=l}if(h!=""){m.OK_SCRIPT_ALPHA_CODE=h}if(f!=""){m.OK_SCRIPT_NORMAL_CODE=f}if(e!=""){m.OK_SCRIPT_DCTLIGHT_CODE=e}if(o!=""){m.OK_SCRIPT_POINTLIGHT_CODE=o}if(a!=""){m.OK_SCRIPT_SPOTLIGHT_CODE=a}},_getShdKeyV:function(){if(this.$v2){this._genShdKey();this.$v2=false}return this.$p6},_getShdKeyF:function(){if(this.$v2){this._genShdKey();this.$v2=false}return this.$l6},_getShdKeyP:function(){if(this.$v2){this._genShdKey();this.$v2=false}return this.$n6},_getShdDef:function(c){if(this.$u2){this._genShdDef();this.$u2=false}for(var a in this.$k1){c[a]=this.$k1[a]}}};function okMeshSkin(){this.$h=new Array;this.$g=new Object;this.$i=new Array;this.$J2=new okAABBox(new okVec3(10000000000,10000000000,10000000000),new okVec3(-10000000000,-10000000000,-10000000000));this.$x6="";this.$y6=""}okMeshSkin.prototype={clear:function(){this.$h=new Array;this.$g=new Object;this.$i=new Array;this.$J2.set(new okVec3(10000000000,10000000000,10000000000),new okVec3(-10000000000,-10000000000,-10000000000));this.$x6="";this.$y6=""},setBoundingBox:function(c,a){this.$J2.set(c,a)},getBoundingBox:function(){return this.$J2},addBone:function(a,c){this.$g[a]=this.$h.length;this.$h.push(a);this.$i.push(c.clone())},getBoneNum:function(){return this.$h.length},setRefAttributeName:function(a,c){this.$x6=a;this.$y6=c},getVertexBoneIdxAttribName:function(){return this.$x6},getVertexBoneWeightAttribName:function(){return this.$y6},getBoneNameArray:function(){return this.$h},getSkinMat:function(a){return this.$i[this.$g[a]]},getSkinMatArray:function(){return this.$i}};function okMesh(a){this.rc=a;this.$56="";this.$q5=new okMaterial(a);this.$J2=new okAABBox();this.$9=okA.object();this.$8=okA.object();this.$N3=0;this.$T4=0;this.$K1=okA.object();this.$P1=true;this.$I=okA.object();this.$H=okA.object();this.$J=okA.object();this.$s4=0;this.$I1=new okMeshSkin}okMesh.prototype={clear:function(){this.$56="";this.$q5=new okMaterial(this.rc);this.$J2.set(OAK.VEC3_ZERO,OAK.VEC3_ZERO);this.$T4=0;this.deleteAttribute();this.$P1=true;this.deleteIndex();this.$I1.clear()},setVertexNum:function(a){this.$T4=a;this.$P1=true},getVertexNum:function(){return this.$T4},createAttribute:function(h,a,f,k){if(this.$9[h]==null){this.$N3+=1}var e=new Array(a);this.$9[h]=e;if(f){for(var d=0;d<a;++d){e[d]=f[d]}}var c=new okArrayBuffer(this.rc);c.createBuffer(34962,5126,(k!=null)?k:35044,f?e:a);if(this.$8[h]){this.$8[h].releaseBuffer()}this.$8[h]=c;this.$P1=true},loadAttribute:function(h,c,a,d){var f=this.$9[h];if(f){if(a<0){a=f.length-c}for(var e=c;e<c+a;++e){f[e]=d[e-c]}this.$8[h].updateBuffer(c,a,d)}},deleteAttribute:function(a){if(a==null){this.$9=new Object;this.$8=new Object;this.$N3=0}else{if(this.$9[a]){delete this.$9[a];delete this.$8[a];this.$N3-=1}}this.$P1=true},_getAttribFmt:function(){if(this.$P1){okA._object(this.$K1);this.$K1=okA.object();var c=this.$8;var o=okA.array();for(var n in c){var d=c[n];var l=n.split("/");var h=0;o.length=0;var e=l.length;for(var f=0;f<e;++f){var m=new okAttribFormat();var a=l[f];o.push(m);this.$K1[a]=m;m.$56=a;m.iIdx=f;m.iOffset=h;m.buf=d;switch(a){case"Position":case"Normal":case"Color":case"Texcoord1_Tangent":case"Texcoord1_Binormal":case"Texcoord2_Tangent":case"Texcoord2_Binormal":case"Texcoord3_Tangent":case"Texcoord3_Binormal":case"Texcoord4_Tangent":case"Texcoord4_Binormal":m.$I4=3;h+=3;break;case"Texcoord1":case"Texcoord2":case"Texcoord3":case"Texcoord4":m.$I4=2;h+=2;break;case"BoneIndex":case"BoneWeight":m.$I4=4;h+=4;break;default:}}e=o.length;for(var f=0;f<e;++f){o[f].iStride=h}}okA._array(o);this.$P1=false}return this.$K1},createIndex:function(f,a,k,l,h){if(this.$I[f]==null){this.$s4+=1}var c=new Array(a);this.$I[f]=c;if(k){for(var e=0;e<a;++e){c[e]=k[e]}}var d=new okArrayBuffer(this.rc);d.createBuffer(34963,5123,(l!=null)?l:35044,k?c:a);if(this.$H[f]){this.$H[f].releaseBuffer()}this.$H[f]=d;this.$J[f]=(h!=null?h:4)},loadIndex:function(h,d,a,e){var c=this.$I[h];if(c){if(a<0){a=c.length-d}for(var f=d;f<d+a;++f){c[f]=e[f-d]}this.$H[h].updateBuffer(d,a,e)}},deleteIndex:function(a){for(var c in this.$I){if(a==null||c==a){delete this.$I[c];this.$H[c].releaseBuffer();delete this.$H[c];delete this.$J[c];this.$s4-=1}}},setIndexTopology:function(a,c){if(this.$J[a]){this.$J[a]=c}},getIndexTopology:function(a){return this.$J[a]},setName:function(a){this.$56=a},getName:function(){return this.$56},getAttributeNum:function(){return this.$N3},getIndexNum:function(){return this.$s4},getAttributeArray:function(a){return this.$9[a]},getAttributeArrayMap:function(){return this.$9},getAttributeArrayBuffer:function(a){return this.$8[a]},getAttributeArrayBufferMap:function(){return this.$8},getIndexArray:function(a){return this.$I[a]},getIndexArrayMap:function(){return this.$I},getIndexArrayBuffer:function(a){return this.$H[a]},getIndexArrayBufferMap:function(){return this.$H},getMaterial:function(){return this.$q5},computeBoundingInfo:function(){this.$J2.set(OAK.VEC3_ZERO,OAK.VEC3_ZERO);for(var f in this.$9){if(f.indexOf("Position")==0){var a=new okVec3(100000,100000,100000);var k=new okVec3(-100000,-100000,-100000);var h=this.$9[f];var d=this.$T4?(h.length/this.$T4):3;for(var c=0;c<h.length;c+=d){var e=new okVec3(h[c],h[c+1],h[c+2]);a=okVec3Min(a,e);k=okVec3Max(k,e)}this.$J2.set(a,k);return}}},setBoundingBox:function(c,a){if(a==null){c.clone(this.$J2)}else{this.$J2.set(c,a)}},getBoundingBox:function(){return this.$J2},getBoundingSphereCenter:function(){return okVec3MulVal(okVec3Add(this.$J2.vMin,this.$J2.vMax),0.5)},getBoundingSphereRadius:function(){return okVec3Sub(this.$J2.vMax,this.$J2.vMin).len()*0.5},getSkin:function(){return this.$I1},draw:function(a,c,d,e){var a=a!=null?a:"Default";this.$H[a].drawIndex(c!=null?c:this.$J[a],d,e)}};function okModel(a){this.rc=a;this.$W=new Object;this.$B4=0;this.$J2=new okAABBox(OAK.VEC3_ZERO,OAK.VEC3_ZERO)}okModel.prototype={clear:function(){for(var a in this.$W){this.$W[a].clear()}this.$W=new Object;this.$B4=0;this.$J2=new okAABBox(OAK.VEC3_ZERO,OAK.VEC3_ZERO)},createMesh:function(a){if(this.$W[a]==null){var c=new okMesh(this.rc);c.$56=a;this.$W[a]=c;this.$B4+=1}return this.$W[a]},deleteMesh:function(a){for(var c in this.$W){if(a==null||c==a){this.$W[c].clear();delete this.$W[c]}}},getMesh:function(c){if(c){return this.$W[c]}for(var a in this.$W){return this.$W[a]}return null},getMeshMap:function(){return this.$W},getMeshNum:function(){return this.$B4},computeBoundingInfo:function(){if(this.$B4==0){this.$J2.set(OAK.VEC3_ZERO,OAK.VEC3_ZERO);return}var c=new okVec3(100000,100000,100000);var e=new okVec3(-100000,-100000,-100000);for(var d in this.$W){var a=this.$W[d];c=okVec3Min(c,a.getBoundingBox().vMin);e=okVec3Max(e,a.getBoundingBox().vMax)}this.$J2.set(c,e)},setBoundingBox:function(c,a){if(a==null){c.clone(this.$J2)}else{this.$J2.set(c,a)}},getBoundingBox:function(){return this.$J2},getBoundingSphereCenter:function(){return okVec3MulVal(okVec3Add(this.$J2.vMin,this.$J2.vMax),0.5)},getBoundingSphereRadius:function(){return okVec3Sub(this.$J2.vMax,this.$J2.vMin).len()*0.5}};function okSkAnimBone(){this.$56="";this.$N=new Array;this.$M=new Array;this.$w5=null;this.$c5=okA.mat43();this.$Z1=true}okSkAnimBone.prototype={clone:function(){var c=new okSkAnimBone();c.$56=this.$56;for(var a=0;a<this.mMtList.length;++a){c.$N.push(this.$N[a].clone());c.$M.push(this.$M[a].clone())}c.$w5=this.$w5;c.$c5=new okMat4();c.$Z1=true},clear:function(){this.$56="";this.$N.clear();this.$M.clear();this.$w5=null;this.$c5.identity();this.$Z1=true},setName:function(a){this.$56=a},getName:function(){return this.$56},setParent:function(a){this.$w5=a},getParent:function(){return this.$w5},loadKeyTranslateList:function(c){this.$N=new Array;for(var a=0;a<c.length;++a){this.$N.push(c[a].clone())}},loadKeyQuaternionList:function(a){this.$M=new Array;for(var c=0;c<a.length;++c){this.$M.push(a[c].normalize())}},dirty:function(){this.$Z1=true},update:function(e,d,k){if(this.$Z1){var c=okQuatSlerp(this.$M[e],this.$M[d],k);c.normalize(true);c.toMat43(this.$c5);okA._quat(c);var h=this.$N[e],f=this.$N[d];this.$c5.m03=h.x*(1-k)+f.x*k;this.$c5.m13=h.y*(1-k)+f.y*k;this.$c5.m23=h.z*(1-k)+f.z*k;if(this.$w5){if(this.$w5.$Z1){this.$w5.update(e,d,k)}var a=okMat43Mul(this.$w5.$c5,this.$c5);okA._mat43(this.$c5);this.$c5=a}this.$Z1=false}},getMat43:function(){var a=new okMat43();this.$c5.clone(a);return a},getMat4:function(){var a=new okMat4();this.$c5.toMat4(a);return a}};function okSkAnimation(){this.$K=new Array;this.$J2=new okAABBox();this.$e=new Object;this.$Y3=0;this.$o4=0;this.$b3=33;this.$b4=-1;this.$w4=-1;this.$v4=-1;this.$f3=0}okSkAnimation.prototype={clear:function(){this.$K=new Array;this.$J2=new okAABBox();this.$e=new Object;this.$Y3=0;this.$o4=0;this.$b3=33;this.$b4=-1;this.$w4=-1;this.$v4=-1;this.$f3=0},setBoundingBox:function(c,a){this.$J2.set(c,a)},getBoundingBox:function(){return this.$J2},loadKeyFrameList:function(c){this.$K=new Array;for(var a=0;a<c.length;++a){this.$K.push(c[a])}},addBone:function(a){if(this.$e[a.getName()]==null){this.$Y3+=1}this.$e[a.getName()]=a},getBone:function(a){return this.$e[a]},getBoneMat43:function(a){if(this.$e[a]){return this.$e[a].getMat43()}return okA.mat43()},getBoneMat4:function(a){if(this.$e[a]){return this.$e[a].getMat4()}return okA.mat4()},getBoneNum:function(){return this.$Y3},getBoneList:function(){return this.$e},setFrameNum:function(a){this.$o4=a},getFrameNum:function(){return this.$o4},setFrameTime:function(a){this.$b3=a},getFrameTime:function(){return this.$b3},getAnimLength:function(){return this.$o4*this.$b3},setCurTime:function(c){if(this.$b4!=c){this.$b4=c;for(var a in this.$e){this.$e[a].dirty()}this._upBL(this.$b4/this.$b3)}},setCurFrame:function(c){if(this.$b4!=c*this.$b3){this.$b4=c*this.$b3;for(var a in this.$e){this.$e[a].dirty()}this._upBL(c)}},getCurTime:function(){return this.$b4},_lpF:function(c){var e=this.$K;var a=e.length;for(var d=0;d<a;++d){if(e[d]>c){if(d>0){this.$w4=d-1;this.$v4=d}else{this.$w4=this.$v4=0}this.$f3=(c-e[d-1])/(e[d]-e[d-1]);return}}this.$w4=this.$v4=e.length-1;this.$f3=0},_upBL:function(a){this._lpF(a);for(var c in this.$e){var d=this.$e[c];if(d.$Z1){d.update(this.$w4,this.$v4,this.$f3)}}}};function okSkAnimSubChannel(){this.$J1=null;this.$g2=false;this.$q3=1;this.$b4=0}okSkAnimSubChannel.prototype={clone:function(a){var a=a?a:new okSkAnimSubChannel();a.$J1=this.$J1;a.$g2=this.$g2;a.$q3=this.$q3;a.$b4=this.$b4;return a},attachAnim:function(a){this.$J1=a},getAnim:function(){return this.$J1},isActive:function(){return(this.$J1!=null)&&(this.$b4<this.$J1.getAnimLength())},setSpeed:function(a){this.$q3=a},getSpeed:function(){return this.$q3},enableLoop:function(a){this.$g2=a},isLoop:function(){return this.$g2},getFrameTime:function(){if(this.$J1){return this.$J1.getFrameTime()}return 0},setCurTime:function(a){this.$b4=a;if(this.$J1){this.$J1.setCurTime(a)}},update:function(a){if(this.$J1){this.$b4+=(a*this.$q3);this.$J1.setCurTime(this.$g2?(this.$b4%this.$J1.getAnimLength()):this.$b4)}},getBoneMat43:function(a){if(this.$J1){return this.$J1.getBoneMat43(a)}return okA.mat43()}};function okSkAnimChannel(){this.$M1=false;this.$p5=new okSkAnimSubChannel();this.$P6=new okSkAnimSubChannel();this.$R4=0;this.$c4=0}okSkAnimChannel.prototype={clone:function(a){a=a?a:new okSkAnimChannel();a.$M1=this.$M1;this.$p5.clone(a.$p5);this.$P6.clone(a.$P6);a.$R4=this.$R4;a.$c4=this.$c4;return a},activate:function(a){this.$M1=a},isActive:function(){return this.$M1},attachAnim:function(c,a){this.$p5.clone(this.$P6);this.$R4=((a!=null)?a:0);this.$c4=0;this.$p5.attachAnim(c)},getAnim:function(){return this.$p5.getAnim()},setSpeed:function(a){this.$p5.setSpeed(a)},getSpeed:function(){return this.$p5.getSpeed()},enableLoop:function(a){this.$p5.enableLoop(a)},isLoop:function(){return this.$p5.isLoop()},getFrameTime:function(){if(this.$p5){return this.$p5.getFrameTime()}return 0},setCurTime:function(a){this.$p5.setCurTime(a)},update:function(a){this.$p5.update(a);if(this.$c4<this.$R4){this.$P6.update(a)}this.$c4=Math.min(this.$c4+a,this.$R4)},getBoneMat43:function(h){var c=this.$p5.getBoneMat43(h);if(this.$c4>=this.$R4||!this.$P6.isActive()){return c}var l=this.$P6.getBoneMat43(h);var f=okA.quat();var d=okA.quat();c.toQuat(f);l.toQuat(d);var k=this.$c4/this.$R4;var a=okQuatSlerp(d,f,k);var e=a.toMat43();e.m03=l.m03*(1-k)+c.m03*k;e.m13=l.m13*(1-k)+c.m13*k;e.m23=l.m23*(1-k)+c.m23*k;okA._quat(f);okA._quat(d);okA._quat(a);return e}};function okSkAnimPlayer(){this.$C6=null;this.$f=new Array;this.$X1=false;this.$d=new Array;this.$W1=false;this.$k=new Array;this.$k.push(new okSkAnimChannel());this.$k.push(new okSkAnimChannel());this.$U3=1;this.$J2=new okAABBox();this.$S1=true}okSkAnimPlayer.prototype={clear:function(){this.$C6=null;this.$f=new Array;this.$X1=false;this.$d=new Array;this.$W1=false;this.$k=new Array;this.$k.push(new okSkAnimChannel());this.$k.push(new okSkAnimChannel());this.$U3=1;this.$J2.set(OAK.VEC3_ZERO,OAK.VEC3_ZERO);this.$S1=true},clone:function(a){a=a?a:new okSkAnimPlayer();a.$C6=this.$C6;a.$X1=true;a.$W1=true;a.$k=[this.$k[0].clone(),this.$k[1].clone()];a.$U3=this.$U3;a.$S1=this.$S1;return a},setSkin:function(a){this.$C6=a;this.$X1=true;this.$W1=true;this.update(-1,0);this.$S1=true},getSkin:function(){return this.$C6},getBoundingBox:function(){if(this.$S1){var c=okA.vec3(),a=okA.vec3();c.set(10000000000,10000000000,10000000000);a.set(-10000000000,-10000000000,-10000000000);this.$J2.set(c,a);if(this.$k[0].isActive()&&this.$k[0].getAnim()){this.$J2=this.$J2.union(this.$k[0].getAnim().getBoundingBox())}if(this.$k[1].isActive()&&this.$k[1].getAnim()){this.$J2=this.$J2.union(this.$k[1].getAnim().getBoundingBox())}this.$S1=false;okA._vec3(c);okA._vec3(a)}return this.$J2},activateChannel:function(c,a){this.$k[c].activate(a);this.$X1=true;this.$W1=true;this.$S1=true},isActive:function(a){return this.$k[a].isActive()},attachAnim:function(d,c,a){this.$k[d].attachAnim(c,a);this.$X1=true;this.$W1=true;this.$S1=true},getAnim:function(a){return this.$k[a].getAnim()},setSpeed:function(c,a){this.$k[c].setSpeed(a)},getSpeed:function(a){return this.$k[a].getSpeed()},enableLoop:function(c,a){this.$k[c].enableLoop(a)},isLoop:function(a){return this.$k[a].isLoop()},setBlendMode:function(a){this.$U3=a;this.$X1=true;this.$W1=true},getBlendMode:function(){return this.$U3},getFrameTime:function(a){if(this.$k[a]){return this.$k[a].getFrameTime()}return 0},setTime:function(c,d){if(c==-1){for(var a=0;a<this.$k.length;++a){if(this.$k[a].isActive()){this.$k[a].setCurTime(d)}}}else{this.$k[c].setCurTime(d)}this.$X1=true;this.$W1=true},update:function(e,c){if(e==-1){var a=this.$k.length;for(var d=0;d<a;++d){if(this.$k[d].isActive()){this.$k[d].update(c)}}}else{this.$k[e].update(c)}this.$X1=true;this.$W1=true},getBoneMat43:function(h){var m=this.$k[0].isActive();var l=this.$k[1].isActive();if(m&&!l){return this.$k[0].getBoneMat43(h)}else{if(!m&&l){return this.$k[1].getBoneMat43(h)}else{if(!m&&!l){return new okMat4()}}}var k=okA.mat43();var d=this.$k[0].getBoneMat43(h);var c=this.$k[1].getBoneMat43(h);var f=okA.quat();var e=okA.quat();d.toQuat(f);c.toQuat(e);if(this.$U3==1){var a=okQuatMul(e,f);a.toMat43(k);k.m03=d.m03+c.m03;k.m13=d.m13+c.m13;k.m23=d.m23+c.m23}else{if(this.$U3==2){var a=okQuatSlerp(e,f,0.5);a.toMat43(k);k.m03=(d.m03+c.m03)*0.5;k.m13=(d.m13+c.m13)*0.5;k.m23=(d.m23+c.m23)*0.5}}okA._quat(f);okA._quat(e);return k},getBoneFinalMat43:function(k){var n=this.$k[0].isActive();var m=this.$k[1].isActive();if(n&&!m){return okMat43Mul(this.$k[0].getBoneMat43(k),this.$C6?this.$C6.getSkinMat(k):okA.mat43())}else{if(!n&&m){return okMat43Mul(this.$k[1].getBoneMat43(k),this.$C6?this.$C6.getSkinMat(k):okA.mat43())}else{if(!n&&!m){return(this.$C6?this.$C6.getSkinMat(k):okA.mat43())}}}var l=okA.mat43();var e=this.$k[0].getBoneMat43(k);var c=this.$k[1].getBoneMat43(k);var h=okA.quat();var f=okA.quat();e.toQuat(h);c.toQuat(f);if(this.$U3==1){var a=okQuatMul(f,h);a.toMat43(l);l.m03=e.m03+c.m03;l.m13=e.m13+c.m13;l.m23=e.m23+c.m23}else{if(this.$U3==2){var a=okQuatSlerp(f,h,0.5);a.toMat43(l);l.m03=(e.m03+c.m03)*0.5;l.m13=(e.m13+c.m13)*0.5;l.m23=(e.m23+c.m23)*0.5}}okA._quat(h);okA._quat(f);if(this.$C6){var d=okMat43Mul(l,this.$C6.getSkinMat(k));okA._mat43(l);return d}else{return l}},getBoneFinalMat43Array:function(){if(this.$W1){this.$d.length=0;var d=this.$C6.getBoneNameArray();var l=this.$C6.getSkinMatArray();var f=d.length;var p=this.$k[0].isActive();var o=this.$k[1].isActive();if(p&&!o){for(var m=0;m<f;++m){this.$d.push(okMat43Mul(this.$k[0].getBoneMat43(d[m]),l[m]))}}else{if(p&&o){for(var m=0;m<f;++m){var n=okA.mat43();var e=this.$k[0].getBoneMat43(sBoneName);var c=this.$k[1].getBoneMat43(sBoneName);var k=okA.quat();var h=okA.quat();e.toQuat(k);c.toQuat(h);if(this.$U3==1){var a=okQuatMul(h,k);a.toMat43(n);n.m03=e.m03+c.m03;n.m13=e.m13+c.m13;n.m23=e.m23+c.m23}else{if(this.$U3==2){var a=okQuatSlerp(h,k,0.5);a.toMat43(n);n.m03=(e.m03+c.m03)*0.5;n.m13=(e.m13+c.m13)*0.5;n.m23=(e.m23+c.m23)*0.5}}okA._quat(k);okA._quat(h);this.$d.push(okMat43Mul(n,l[m]));okA._mat43(n)}}else{if(!p&&o){for(var m=0;m<f;++m){this.$d.push(okMat43Mul(this.$k[1].getBoneMat43(d[m]),l[m]))}}else{okA._array(this.$d);this.$d=l.slice()}}}this.$W1=false}return this.$d}};function okCharMetaData(e,c,f,d,a){this.code=0;this.tex=e;this.x=c;this.y=f;this.width=d;this.height=a}okCharMetaData.prototype={clone:function(){var c=new this.constructor();for(var a in this){if(c[a]!=this[a]){c[a]=this[a]}}return c}};function okFontTexture(d,c,a){this.rc=d;this.width=c;this.height=a;this.ok2DLayoutHelper=new okLayout2DHelper(c,a);this.texData=new okTexture(d);this.texData.createTexture(3553,c,a,6408,5121);this.charsList=new okList()}okFontTexture.prototype={addTex:function(a,c,k){var f=this.ok2DLayoutHelper.add(c,k);if(f!=null){var h=new Array();for(var e=0;e<a.length;++e){h.push(a[e])}this.texData.updateTexture(f.x,f.y,f.width,f.height,5121,h);var d=new okCharMetaData(this,f.x,f.y,c,k);this.charsList.pushFront(d);return this.charsList.getRoot()}else{return null}},updateCharNode:function(a){var c=a.data;this.charsList.remove(a);this.charsList.pushFront(c);return this.charsList.getRoot()},clearRoom:function(){var c=this.charsList.getTail();if(c!=null){var d=c.data;var a=new okRect(d.x,d.y,d.width,d.height);if(this.ok2DLayoutHelper.remove(a)){this.charsList.popBack();return{opFlag:true,codeRemoved:d.code}}}return{opFlag:false}}};function okGetFontName(d,e,c,a,f){return f+" "+c+" "+e+" "+a+" "+d}function okFont(){this.$u3="";this.$v3=40;this.$y3="normal";this.$x3="";this.$w3="normal";this.$R1=true;this.$N6=512;this.$M6=512;this.rc=null;this.$s5=5;this.$K6=new Array();this.$L6=new okList();this.$R2=new Object();this.$C5=null}okFont.prototype={setCodePageSize:function(e,a){var c=okAlignPower2(e);var d=okAlignPower2(a);if(c!=this.$N6||d!=this.$M6){this.clearAll();this.$N6=c;this.$M6=d}},setCodePageMaxNum:function(a){if(this.$K6.length>a){this.clearAll()}this.$s5=a},enableAutoWrap:function(a){this.$R1=a},isAutoWrapEnabled:function(){return this.$R1},drawText:function(x,v,C,d){var E=this.rc.canvas.width;var c=this.rc.canvas.height;var y;if(d!=null){E=d.$J4;c=d.$K4;y=new okFrameBuffer(this.rc);y.createBuffer();y.bind();y.attachRenderTexture(0,d)}var w;if(x==null){w=new okRect(0,0,E,c)}else{if(x.width<=0||x.height<=0){return}w=new okRect(x.x,x.y,x.x+x.width,x.y+x.height)}this.$C5.bind();var h=okMat4Trans(0,0,-3);this.$C5.setUniformMat4("matWorld",h);var p=okMat4Ortho(0,E,0,c,0.1,10);this.$C5.setUniformMat4("matProj",p);var A=new okMat4(1);if(C!=null){A.m00=C.x;A.m11=C.y;A.m22=C.z;if(C.w){A.m33=C.w}}this.$C5.setUniformMat4("matColor",A);var q=new okVec2(w.x,w.y);var e=new okVec2(0,0);var I=new okVec2(0,0);var l=new okVec2(0,0);var H;var f;var n=new Array();var s=0;var G=null;var u;var F;for(var D=0;D<v.length;++D){if(v.charAt(D)!="\n"){G=this.getCharTextureInfo(v.charAt(D),false);if(G==null){for(var o=0;o<n.length;++o){u=new okArrayBuffer(this.rc);u.createBuffer(34962,5126,35044,n[o].vertexArray);F=new okArrayBuffer(this.rc);F.createBuffer(34962,5126,35044,n[o].coordArray);this.$C5.setAttribute("position",u,3);this.$C5.setAttribute("vertex_coord",F,2);this.$C5.setSampler("tex",0);n[o].okTex.bind(0);this.rc.texParameteri(3553,10240,9729);this.rc.texParameteri(3553,10241,9729);this.rc.drawArrays(4,0,n[o].vertexArray.length/3)}n.splice(0,n.length);this.addIndividualCode(v.charAt(D));--D;continue}e.x=q.x+G.width-1;e.y=q.y+G.height-1;if(e.x>=w.width){if(this.$R1){var a=w.x;if(q.x-a>0.000001){q.x=w.x;q.y+=s;s=0;if(q.y>=w.height){break}else{--D;continue}}}e.x=w.width-1}if(e.y>=w.height){e.y=w.height-1}H=[e.x,q.y,0,q.x,q.y,0,e.x,e.y,0,q.x,q.y,0,q.x,e.y,0,e.x,e.y,0];I.x=G.x/G.tex.width;I.y=G.y/G.tex.height;l.x=(G.x+e.x-q.x)/G.tex.width;l.y=(G.y+e.y-q.y)/G.tex.height;f=[l.x,I.y,I.x,I.y,l.x,l.y,I.x,I.y,I.x,l.y,l.x,l.y];for(var B=0;B<n.length;++B){if(n[B].fontTex===G.tex){break}}if(B==n.length){var t=new Object();t.okTex=G.tex.texData;t.fontTex=G.tex;t.vertexArray=new Array();t.coordArray=new Array();n.push(t)}for(var z=0;z<H.length;++z){n[B].vertexArray.push(H[z])}for(z=0;z<f.length;++z){n[B].coordArray.push(f[z])}if(s<G.height){s=G.height}if(e.x>=w.width){if(this.$R1){q.x=w.x;q.y+=s;s=0;if(q.y>=w.height){break}}else{for(D=D+1;D<v.length;++D){if(v.charAt(D)=="\n"){break}}}}else{q.x+=G.width}}else{q.x=w.x;q.y+=s;s=0;if(q.y>=w.height){break}}}if(n.length>0){for(var o=0;o<n.length;++o){u=new okArrayBuffer(this.rc);u.createBuffer(34962,5126,35044,n[o].vertexArray);F=new okArrayBuffer(this.rc);F.createBuffer(34962,5126,35044,n[o].coordArray);this.$C5.setAttribute("position",u,3);this.$C5.setAttribute("vertex_coord",F,2);this.$C5.setSampler("tex",0);n[o].okTex.bind(0);this.rc.texParameteri(3553,10240,9729);this.rc.texParameteri(3553,10241,9729);this.rc.drawArrays(4,0,n[o].vertexArray.length/3)}}if(d!=null){y.unbind()}},getFontName:function(){return okGetFontName(this.$u3,this.$v3,this.$y3,this.$x3,this.$w3)},isTexFull:function(){return this.$K6.length>=this.$s5},increaseFontTex:function(){if(!this.isTexFull()){var a=new okFontTexture(this.rc,this.$N6,this.$M6);this.$K6.push(a);return true}else{return false}},getFirstBlankTex:function(){if(this.$K6.length<=0){if(!this.increaseFontTex()){return null}}return this.$K6[this.$K6.length-1]},getFirstReplacableTex:function(){if(this.$K6.length<=0){return null}if(this.$L6.getRoot()!=null){return this.$L6.getRoot().data}else{return this.$K6[0]}},getTexture:function(c){var a=this.getCharTextureInfo(c);if(a!=null){return a.tex}else{return null}},updateTexTimeStamp:function(a){var c=this.$L6.find(a);this.$L6.remove(c);this.$L6.pushFront(a)},addIndividualCode:function(d,l){if(okIsUndefined(this.$R2[d.toString()])){var n=okFontManager.get2DContext();okFontManager.clear2DContext();var h=n.font;n.font=this.getFontName();n.fillText(d,0,0);var e=n.measureText(d).width;if(e<=0){e=1}var f=n.getImageData(0,0,e,this.$v3);n.font=h;var a=this.getFirstBlankTex();if(a==null){return false}var c=a.addTex(f.data,f.width,f.height);if(c==null){if(this.increaseFontTex()){a=this.getFirstBlankTex();c=a.addTex(f.data,f.width,f.height)}else{var m=true;if(!(l==null||okIsUndefined(l))){m=l}if(m){a=this.getFirstReplacableTex();if(a){do{var k=a.clearRoom();if(k.opFlag){delete this.$R2[k.codeRemoved];c=a.addTex(f.data,f.width,f.height)}else{break}}while(c==null)}}}}if(c!=null){c.data.code=d.toString();this.$R2[d.toString()]=c}else{return false}}return true},getCharTextureInfo:function(d,f){var c=this.$R2[d.toString()];if(okIsUndefined(c)){if(this.addIndividualCode(d,f)){c=this.$R2[d.toString()]}else{return null}}var a=c.data;var e=a.tex;this.updateTexTimeStamp(e);this.$R2[d.toString()]=e.updateCharNode(c);return a.clone()},initProgram:function(){var c=new okShader(this.rc,35633);c.loadSource("                       attribute vec3 position;                       attribute vec2 vertex_coord;                       uniform mat4 matWorld, matProj;                       varying vec2 pixel_coord;                       void main(void) {                            gl_Position = matProj * matWorld * vec4(position, 1.0);                            pixel_coord = vertex_coord;                       }                       ");c.compile();var a=new okShader(this.rc,35632);a.loadSource("                        precision highp float;                        varying vec2 pixel_coord;                        uniform sampler2D tex;                        uniform mat4 matColor;                        void main(void) {                        gl_FragColor = texture2D(tex, pixel_coord) * matColor;                         }                      ");a.compile();this.$C5=new okProgram(this.rc);this.$C5.attachVertexShader(c);this.$C5.attachFragmentShader(a);this.$C5.link()},clearAll:function(){this.$K6=new Array();this.$L6=new okList();this.$R2=new Object()}};var okFontManager=(function(){var a={};var e=null;var c=null;var d=false;return{createFont:function(o,m,n,l,h,p){var k=o.canvas.getAttribute("ID")+okGetFontName(m,n,l,h,p);if(a[k]!=undefined){return a[k]}else{var f=new okFont();f.$u3=m;f.$v3=n;f.$y3=l;f.$x3=h;f.$w3=p;f.rc=o;f.initProgram();a[k]=f;return f}},deleteFont:function(n,l,m,k,f,o){if(arguments.length==1){var h=n.rc.canvas.getAttribute("ID")+okGetFontName(n.$u3,n.$v3,n.$y3,n.$x3,n.$w3)}else{var h=n.canvas.getAttribute("ID")+okGetFontName(l,m,k,f,o)}if(a[h]!=undefined){delete a[h]}},get2DContext:function(){if(c==null){e=document.createElement("canvas");e.width=512;e.height=512;c=e.getContext("2d");c.fillStyle="#ffffff";c.strokeStyle="#ffffff";c.textBaseline="top"}return c},clear2DContext:function(){c.clearRect(0,0,e.width,e.height)}}})();function okBillBoard(a){this.$C5=a;this.text="";this.font=null;this.posAttributeName="position";this.texcoordAttributeName="vertex_coord";this.samplertexAttributeName="tex"}okBillBoard.prototype={setText:function(a){this.text=a},getText:function(){return this.text},setFont:function(a){this.font=a},getFont:function(){return this.font},setPositionAttrName:function(a){this.posAttributeName=a},getPositionAttrName:function(){return this.posAttributeName},setTexcoordAttrName:function(a){this.texcoordAttributeName=a},getTexcoordAttrName:function(){return this.texcoordAttributeName},setSamplertexAttrName:function(a){this.samplertexAttributeName=a},getSamplertexAttrName:function(){return this.samplertexAttributeName},render:function(){if(this.font==null){return}var e=new Array();for(var p=0;p<this.text.length;++p){if(this.text.charAt(p)!="\n"){e.push(this.font.getCharTextureInfo(this.text.charAt(p)))}else{e.push(null)}}var q=new okVec2(0,0);var u=new okVec2(0,0);var o=new okVec2(0,0);var h=new okVec2(0,0);var c;var n;var v,s;var t=new Array();var a=0;for(var p=0;p<e.length;++p){if(e[p]!=null){u.x=q.x+e[p].width-1;u.y=q.y+e[p].height-1;c=[u.x,q.y,0,q.x,q.y,0,u.x,u.y,0,q.x,q.y,0,q.x,u.y,0,u.x,u.y,0];o.x=e[p].x/e[p].tex.width;o.y=e[p].y/e[p].tex.height;h.x=(e[p].x+e[p].width-1)/e[p].tex.width;h.y=(e[p].y+e[p].height-1)/e[p].tex.height;n=[h.x,o.y,o.x,o.y,h.x,h.y,o.x,o.y,o.x,h.y,h.x,h.y];for(var f=0;f<t.length;++f){if(t[f].fontTex===e[p].tex){break}}if(f==t.length){var l=new Object();l.okTex=e[p].tex.texData;l.fontTex=e[p].tex;l.vertexArray=new Array();l.coordArray=new Array();t.push(l)}for(var d=0;d<c.length;++d){t[f].vertexArray.push(c[d])}for(d=0;d<n.length;++d){t[f].coordArray.push(n[d])}q.x+=e[p].width;if(a<e[p].height){a=e[p].height}}else{q.x=0;q.y+=a;a=0}}this.$C5.bind();for(var p=0;p<t.length;++p){v=new okArrayBuffer(this.$C5.rc);v.createBuffer(34962,5126,35044,t[p].vertexArray);s=new okArrayBuffer(this.$C5.rc);s.createBuffer(34962,5126,35044,t[p].coordArray);this.$C5.setAttribute(this.posAttributeName,v,3);this.$C5.setAttribute(this.texcoordAttributeName,s,2);this.$C5.setSampler(this.samplertexAttributeName,0);t[p].okTex.bind(0);this.$C5.rc.texParameteri(3553,10240,9729);this.$C5.rc.texParameteri(3553,10241,9729);this.$C5.rc.drawArrays(4,0,t[p].vertexArray.length/3)}}};function okRenderEnvironment(){this.rc=null;this.$N2=null;this.$z6=null;this.canvas=null;this.$34=0;this.$24=0;this.$07=new okVec3(1,1,1);this.$Y6=new okVec3(0.5,0.5,0.5);this.$b2=false;this.$W6=new okVec3(1,1,1);this.$73=3.5;this.$93=0.1;this.$83=1;this.$t2=true;this.$q1=[true,true,true];this.$L4=0;this.$b4=0;this.$i3=0}okRenderEnvironment.prototype.clear=function(){this.$N2=null;this.$z6=null;this.$07.set(1,1,1);this.$Y6.set(0.3,0.3,0.3);this.$b2=false;this.$W6.set(1,1,1);this.$73=3.5;this.$93=0.1;this.$83=1;this.$t2=true;this.$q1=[true,true,true];this.$L4=0;this.$b4=0;this.$i3=0};function okBaseEntity(a){this.$S4=0;this.$r4=-1;this.$57=a;this.$L5=a.$z6.$L5;this.$56="";this.$j5=okA.mat43();this.$g5=okA.mat43();this.$i5=okA.mat43();this.$h5=okA.mat43();this.$i2=true;this.$h2=true;this.$J2=new okAABBox();this.$v5=new okOBBox();this.$R6=new okVec3();this.$43=0;this.$S1=true;this.$o2=true;this.$U1=true;this.$w5=null;this.$m=new okList();this.$g1=okA.object()}okBaseEntity.prototype.clear=function(){this.$j5.identity();this.$g5.identity();this.$i2=true;this.$h2=true;this.$S1=true;this.$o2=true;this.$U1=true;this.clearChild();this.releaseResource()};okBaseEntity.prototype._loadBaseEntityXML=function(c){this.setName(c.getAttribValueString("Name"));var a=c.getAttribValueMat43("Matrix");if(a){this.setMat(a);okA._mat43(a)}};okBaseEntity.prototype.getType=function(){return this.$S4};okBaseEntity.prototype.setId=function(a){this.$r4=a};okBaseEntity.prototype.getId=function(){return this.$r4};okBaseEntity.prototype.setName=function(a){this.$56=a};okBaseEntity.prototype.getName=function(){return this.$56};okBaseEntity.prototype.getResourceRefCount=function(a){if(this.$g1[a]==null){return 0}return this.$g1[a]};okBaseEntity.prototype.addResourceRef=function(a){if(this.$g1[a]==null){this.$g1[a]=1}else{this.$g1[a]+=1}};okBaseEntity.prototype.releaseResource=function(){var e=this.$L5;for(var a in this.$g1){var d=this.$g1[a];for(var c=0;c<d;++c){e.deleteResource(parseInt(a))}}okA._object(this.$g1);this.$g1=okA.object()};okBaseEntity.prototype.getState=function(){return 4};okBaseEntity.prototype.attachChild=function(a){if(a.$w5!=this){this.$m.pushBack(a);a.$w5=this;a._updateMat(true)}};okBaseEntity.prototype.detachChild=function(a){if(a.$w5==this){this.$m.remove(this.$m.find(a));a.$w5=null;a._updateMat(true)}};okBaseEntity.prototype.clearChild=function(){var a=this.$m.getRoot();while(a){var c=a.data;c.$w5=null;c._updateMat(true);a=a.next}this.$m.clear()};okBaseEntity.prototype.getChildArray=function(c){if(c==null){c=okA.array()}var a=this.$m.getRoot();while(a){c.push(a.data);a=a.next}return c};okBaseEntity.prototype._updateMat=function(a){if(!a){if(this.$w5){var c=okMat43Mul(this.$j5,this.$g5);this.$j5=this.$w5.$g5.inverse();this.$g5=okMat43Mul(this.$w5.$g5,c);okA._mat43(c);this.$i2=true;this.$h2=true;this.$S1=true;this.$o2=true;this.$U1=true;this.dirtyMatFunc();this.$57.dirtyEntity(this);var d=this.$m.getRoot();while(d){d.data._updateMat(a);d=d.next}}else{this.$j5.identity()}}else{if(this.$w5){this.$j5=this.$w5.$g5.inverse()}else{this.$j5.identity()}}};okBaseEntity.prototype.getBoundingBox=function(a){if(a==2){if(this.$o2){this.$v5.setMin(-0.01,-0.01,-0.01);this.$v5.setMax(0.01,0.01,0.01);this.$v5.setMat(this.$g5);this.$o2=false}return this.$v5}else{if(this.$S1){this.$J2.setMin(-0.01,-0.01,-0.01);this.$J2.setMax(0.01,0.01,0.01);this.$S1=false}return this.$J2}};okBaseEntity.prototype.getBoundingSphereCenter=function(){if(this.$U1){var c=this.getBoundingBox(2);var a=okMat43MulVec3(c.$g5,c.vMin);var d=okMat43MulVec3(c.$g5,c.vMax);this.$R6.x=(a.x+d.x)*0.5;this.$R6.y=(a.y+d.y)*0.5;this.$R6.z=(a.z+d.z)*0.5;this.$43=Math.sqrt((d.x-a.x)*(d.x-a.x)+(d.y-a.y)*(d.y-a.y)+(d.z-a.z)*(d.z-a.z))*0.5;okA._vec3(a);okA._vec3(d);this.$U1=false}return this.$R6.clone()};okBaseEntity.prototype.getBoundingSphereRadius=function(){if(this.$U1){var c=this.getBoundingBox(2);var a=okMat43MulVec3(c.$g5,c.vMin);var d=okMat43MulVec3(c.$g5,c.vMax);this.$R6.x=(a.x+d.x)*0.5;this.$R6.y=(a.y+d.y)*0.5;this.$R6.z=(a.z+d.z)*0.5;this.$43=Math.sqrt((d.x-a.x)*(d.x-a.x)+(d.y-a.y)*(d.y-a.y)+(d.z-a.z)*(d.z-a.z))*0.5;okA._vec3(a);okA._vec3(d);this.$U1=false}return this.$43};okBaseEntity.prototype.genRenderBatch=function(a,c,d){};okBaseEntity.prototype.setMat=function(c){c.clone(this.$g5);this.$i2=true;this.$h2=true;this.$S1=true;this.$o2=true;this.$U1=true;this.dirtyMatFunc();this.$57.dirtyEntity(this);var a=this.$m.getRoot();while(a){a.data._updateMat(false);a=a.next}};okBaseEntity.prototype.getMat43=function(){var a=okA.mat43();this.$g5.clone(a);return a};okBaseEntity.prototype.getMat4=function(){var a=okA.mat4();this.$g5.toMat4(a);return a};okBaseEntity.prototype.getNormalMat3=function(){if(this.$i2){var c=okA.mat43();c=this.$g5.inverse();okA._mat43(this.$i5);this.$i5=c.transpose();okA._mat43(c);this.$i2=false}var a=okA.mat3();this.$i5.toMat3(a);return a};okBaseEntity.prototype.getNormalMat43=function(){if(this.$i2){var c=okA.mat43();c=this.$g5.inverse();okA._mat43(this.$i5);this.$i5=c.transpose();okA._mat43(c);this.$i2=false}var a=okA.mat43();this.$i5.clone(a);return a};okBaseEntity.prototype.getNormalMat4=function(){if(this.$i2){var c=okA.mat43();c=this.$g5.inverse();okA._mat43(this.$i5);this.$i5=c.transpose();okA._mat43(c);this.$i2=false}var a=okA.mat4();this.$i5.toMat4(a);return a};okBaseEntity.prototype.getInvMat43=function(){if(this.$h2){okA._mat43(this.$h5);this.$h5=this.$g5.inverse();this.$h2=false}var a=okA.mat43();this.$h5.clone(a);return a};okBaseEntity.prototype.getInvMat4=function(){if(this.$h2){okA._mat43(this.$h5);this.$h5=this.$g5.inverse();this.$h2=false}var a=okA.mat4();this.$h5.toMat4(a);return a};okBaseEntity.prototype.setPos=function(d,c,a){if(c==null){this.$g5.m03=d.x;this.$g5.m13=d.y;this.$g5.m23=d.z}else{this.$g5.m03=d;this.$g5.m13=c;this.$g5.m23=a}this.$i2=true;this.$h2=true;this.$S1=true;this.$o2=true;this.$U1=true;this.dirtyMatFunc();this.$57.dirtyEntity(this);var e=this.$m.getRoot();while(e){e.data._updateMat(false);e=e.next}};okBaseEntity.prototype.getPos=function(){var a=okA.vec3();a.x=this.$g5.m03;a.y=this.$g5.m13;a.z=this.$g5.m23;return a};okBaseEntity.prototype.move=function(l,h,f,e){var c=null;if(f!=null){c=okMat43Trans(h,f,e)}else{c=okMat43Trans(h.x,h.y,h.z)}if(l==3){var a=okMat43Mul(c,this.$g5);okA._mat43(this.$g5);this.$g5=a}else{if(l==2&&this.$w5){var d=okMat43Mul(this.$j5,this.$g5);d=okMat43Mul(c,d);okA._mat43(this.$g5);this.$g5=okMat43Mul(this.$w5.$g5,d)}else{var a=okMat43Mul(this.$g5,c);okA._mat43(this.$g5);this.$g5=a}}okA._mat43(c);this.$i2=true;this.$h2=true;this.$S1=true;this.$o2=true;this.$U1=true;this.dirtyMatFunc();this.$57.dirtyEntity(this);var k=this.$m.getRoot();while(k){k.data._updateMat(false);k=k.next}};okBaseEntity.prototype.rotTarget=function(f,k,h){var c=okA.mat43();this.$g5.clone(c);c.m03-=k.x;c.m13-=k.y;c.m23-=k.z;var a=okMat43Rot(f,h);var d=okMat43Mul(a,c);okA._mat43(c);d.m03+=k.x;d.m13+=k.y;d.m23+=k.z;d.clone(this.$g5);okA._mat43(d);this.$i2=true;this.$h2=true;this.$S1=true;this.$o2=true;this.$U1=true;this.dirtyMatFunc();this.$57.dirtyEntity(this);var e=this.$m.getRoot();while(e){e.data._updateMat(false);e=e.next}};okBaseEntity.prototype.getDir=function(a){return this.$g5.getColumn(a-1).normalize(true)};okBaseEntity.prototype.setDir=function(f,e,d,c,a){this._rotToDir(f,e,d,c,a);var h=this.$m.getRoot();while(h){h.data._updateMat(false);h=h.next}};okBaseEntity.prototype._rotToDir=function(c,k,e,d,f){var a=okA.array();a.push(this.$g5.getColumn(0),this.$g5.getColumn(1),this.$g5.getColumn(2));var m=a[0].len();var l=a[1].len();var h=a[2].len();a[0].normalize(true);a[1].normalize(true);a[2].normalize(true);var n=c-1;if(typeof k=="number"){a[n].x=k;a[n].y=e;a[n].z=d}else{a[n].x=k.x;a[n].y=k.y;a[n].z=k.z;f=e}a[n].normalize(true);if(c==f){return}var o=((f!=null)?(f-1):null);if(o==null||o==((n+2)%3)){var p=a[(n+1)%3].clone();a[(n+1)%3]=okVec3Cross(a[(n+2)%3],a[n]);if(a[(n+1)%3].equal(OAK.VEC3_ZERO)){okA._vec3(a[(n+1)%3]);a[(n+1)%3]=p;okA._vec3(a[(n+2)%3]);a[(n+2)%3]=okVec3Cross(a[n],a[(n+1)%3]);okA._vec3(a[(n+1)%3]);a[(n+1)%3]=okVec3Cross(a[(n+2)%3],a[n])}else{okA._vec3(p);okA._vec3(a[(n+2)%3]);a[(n+2)%3]=okVec3Cross(a[n],a[(n+1)%3])}}else{var p=a[(n+2)%3].clone();a[(n+2)%3]=okVec3Cross(a[n],a[(n+1)%3]);if(a[(n+2)%3].equal(OAK.VEC3_ZERO)){okA._vec3(a[(n+2)%3]);a[(n+2)%3]=p;okA._vec3(a[(n+1)%3]);a[(n+1)%3]=okVec3Cross(a[(n+2)%3],a[n]);okA._vec3(a[(n+2)%3]);a[(n+2)%3]=okVec3Cross(a[n],a[(n+1)%3])}else{okA._vec3(p);okA._vec3(a[(n+1)%3]);a[(n+1)%3]=okVec3Cross(a[(n+2)%3],a[n])}}a[0].normalize(true);a[1].normalize(true);a[2].normalize(true);this.$g5.m00=a[0].x*m;this.$g5.m10=a[0].y*m;this.$g5.m20=a[0].z*m;this.$g5.m01=a[1].x*l;this.$g5.m11=a[1].y*l;this.$g5.m21=a[1].z*l;this.$g5.m02=a[2].x*h;this.$g5.m12=a[2].y*h;this.$g5.m22=a[2].z*h;this.$i2=true;this.$h2=true;this.$S1=true;this.$o2=true;this.$U1=true;this.dirtyMatFunc();this.$57.dirtyEntity(this);okA._vec3(a[0]);okA._vec3(a[1]);okA._vec3(a[2]);okA._array(a)};okBaseEntity.prototype.rotQuat=function(h,f){var a=f.toMat43();if(h==3){var c=okMat43Mul(a,this.$g5);okA._mat43(this.$g5);this.$g5=c}else{if(h==2&&this.$w5){var d=okMat43Mul(this.$j5,this.$g5);d=okMat43Mul(a,d);okA._mat43(this.$g5);this.$g5=okMat43Mul(this.$w5.$g5,d)}else{var c=okMat43Mul(this.$g5,a);okA._mat43(this.$g5);this.$g5=c}}okA._mat43(a);this.$i2=true;this.$h2=true;this.$S1=true;this.$o2=true;this.$U1=true;this.dirtyMatFunc();this.$57.dirtyEntity(this);var e=this.$m.getRoot();while(e){e.data._updateMat(false);e=e.next}};okBaseEntity.prototype.rotX=function(h,f){var a=okMat43RotX(f);if(h==3){var c=okMat43Mul(a,this.$g5);okA._mat43(this.$g5);this.$g5=c}else{if(h==2&&this.$w5){var d=okMat43Mul(this.$j5,this.$g5);d=okMat43Mul(a,d);okA._mat43(this.$g5);this.$g5=okMat43Mul(this.$w5.$g5,d)}else{var c=okMat43Mul(this.$g5,a);okA._mat43(this.$g5);this.$g5=c}}okA._mat43(a);this.$i2=true;this.$h2=true;this.$S1=true;this.$o2=true;this.$U1=true;this.dirtyMatFunc();this.$57.dirtyEntity(this);var e=this.$m.getRoot();while(e){e.data._updateMat(false);e=e.next}};okBaseEntity.prototype.rotY=function(h,f){var a=okMat43RotY(f);if(h==3){var c=okMat43Mul(a,this.$g5);okA._mat43(this.$g5);this.$g5=c}else{if(h==2&&this.$w5){var d=okMat43Mul(this.$j5,this.$g5);d=okMat43Mul(a,d);okA._mat43(this.$g5);this.$g5=okMat43Mul(this.$w5.$g5,d)}else{var c=okMat43Mul(this.$g5,a);okA._mat43(this.$g5);this.$g5=c}}okA._mat43(a);this.$i2=true;this.$h2=true;this.$S1=true;this.$o2=true;this.$U1=true;this.dirtyMatFunc();this.$57.dirtyEntity(this);var e=this.$m.getRoot();while(e){e.data._updateMat(false);e=e.next}};okBaseEntity.prototype.rotZ=function(h,f){var a=okMat43RotZ(f);if(h==3){var c=okMat43Mul(a,this.$g5);okA._mat43(this.$g5);this.$g5=c}else{if(h==2&&this.$w5){var d=okMat43Mul(this.$j5,this.$g5);d=okMat43Mul(a,d);okA._mat43(this.$g5);this.$g5=okMat43Mul(this.$w5.$g5,d)}else{var c=okMat43Mul(this.$g5,a);okA._mat43(this.$g5);this.$g5=c}}okA._mat43(a);this.$i2=true;this.$h2=true;this.$S1=true;this.$o2=true;this.$U1=true;this.dirtyMatFunc();this.$57.dirtyEntity(this);var e=this.$m.getRoot();while(e){e.data._updateMat(false);e=e.next}};okBaseEntity.prototype.scale=function(l,f,e,d){var k=null;if(e!=null){k=okMat43Scale(f,e,d)}else{if(f.x){k=okMat43Scale(f.x,f.y,f.z)}else{k=okMat43Scale(f,f,f)}}if(l==3){var a=okMat43Mul(k,this.$g5);okA._mat43(this.$g5);this.$g5=a}else{if(l==2&&this.$w5){var c=okMat43Mul(this.$j5,this.$g5);c=okMat43Mul(k,c);okA._mat43(this.$g5);this.$g5=okMat43Mul(this.$w5.$g5,c)}else{var a=okMat43Mul(this.$g5,k);okA._mat43(this.$g5);this.$g5=a}}okA._mat43(k);this.$i2=true;this.$h2=true;this.$S1=true;this.$o2=true;this.$U1=true;this.dirtyMatFunc();this.$57.dirtyEntity(this);var h=this.$m.getRoot();while(h){h.data._updateMat(false);h=h.next}};okBaseEntity.prototype.dirtyMatFunc=function(){};function okVisibleEntity(a){okBaseCall(this,a);this.$S4=(1|2|32|64|128|256);this.$G2=true;this.$r3=-1;this.$Y1=false;this.$s2=true;this.$m3=0.06;this.$n3=1;this.$u4=1;this.$w2=false;this.$u=okA.array();this.$61=okA.array();this.$p1=okA.array()}okExtend(okVisibleEntity,okBaseEntity);okVisibleEntity.prototype.clear=function(){this.$G2=true;this.$r3=-1;if(this.$Y1){this.$57.$44-=1}this.$Y1=false;this.$s2=true;this.$m3=0.0001;this.$n3=1;this.$u4=1;this.$w2=false;this.clearLight();okBaseCall(this,"clear")};okVisibleEntity.prototype._loadVisibleEntityXML=function(d){okBaseCall(this,"_loadBaseEntityXML");var f=(d.getAttribValueInt("Visible")==1);if(f!=null){this.enableVisible(f)}var a=d.getAttribValueInt("VisibleDistance");if(a!=null){this.setVisibleDistance(a)}var l=(d.getAttribValueInt("CastShadow")==1);if(l!=null){this.enableCastShadow(l)}var h=(d.getAttribValueInt("ReceiveShadow")==1);if(h!=null){this.enableReceiveShadow(h)}var k=d.getAttribValueFloat("ShadowFade");if(k!=null){this.setShadowFade(k)}var e=d.getAttribValueFloat("ShadowResolution");if(e!=null){this.setShadowResolution(e)}var m=d.getAttribValueInt("LightGroup");if(m!=null){this.setLightGroup(m)}var c=(d.getAttribValueInt("SkyBox")==1);if(c!=null){this.enableSkyBox(c)}};okVisibleEntity.prototype.addLight=function(a){if(a.$S4==4){this.$u.push(a)}else{if(a.$S4==8){this.$61.push(a)}else{if(a.$S4==16){this.$p1.push(a)}}}};okVisibleEntity.prototype.removeLight=function(e){var d=null;if(e.$S4==4){d=this.$u}else{if(e.$S4==8){d=this.$61}else{if(e.$S4==16){d=this.$p1}}}if(d==null){return}var a=d.length;for(var c=0;c<a;++c){if(d[c]==e){d[c]=d[a-1];d.pop();break}}};okVisibleEntity.prototype.findLight=function(e){var d=null;if(e.$S4==4){d=this.$u}else{if(e.$S4==8){d=this.$61}else{if(e.$S4==16){d=this.$p1}}}if(d==null){return false}var a=d.length;for(var c=0;c<a;++c){if(d[c]==e){return true}}};okVisibleEntity.prototype.clearLight=function(){this.$u.length=0;this.$61.length=0;this.$p1.length=0};okVisibleEntity.prototype.enableVisible=function(a){this.$G2=a};okVisibleEntity.prototype.isVisible=function(){return this.$G2};okVisibleEntity.prototype.setVisibleDistance=function(a){this.$r3=a};okVisibleEntity.prototype.getVisibleDistance=function(){return this.$r3};okVisibleEntity.prototype.enableSkyBox=function(a){this.$w2=a;this.$57.forceVisibleEntity(this,a)};okVisibleEntity.prototype.isSkyBox=function(){return this.$w2};okVisibleEntity.prototype.enableCastShadow=function(a){if(a!=this.$Y1){if(a){this.$57.$44+=1}else{this.$57.$44-=1}this.$Y1=a}};okVisibleEntity.prototype.isCastShadow=function(){return this.$Y1};okVisibleEntity.prototype.enableReceiveShadow=function(a){this.$s2=a};okVisibleEntity.prototype.isReceiveShadow=function(){return this.$s2};okVisibleEntity.prototype.setShadowFade=function(a){this.$m3=a};okVisibleEntity.prototype.getShadowFade=function(){return this.$m3};okVisibleEntity.prototype.setShadowResolution=function(a){this.$n3=a};okVisibleEntity.prototype.getShadowResolution=function(){return this.$n3};okVisibleEntity.prototype.setLightGroup=function(a){this.$u4=a};okVisibleEntity.prototype.getLightGroup=function(a){return this.$u4};function okStaticEntity(a){okBaseCall(this,a);this.$S4=1;this.$C4=-1;this.$Y=okA.object()}okExtend(okStaticEntity,okVisibleEntity);okStaticEntity.prototype.clear=function(){var a=this.$L5;this.deleteModel();if(this.$Y){okA._object(this.$Y)}this.$Y=okA.object();this.onLoad=null;this.onload=null;okBaseCall(this,"clear")};okStaticEntity.prototype.loadEntity=function(c,a){switch(c){case 1:this._loadStaticEntityXML(a);break}};okStaticEntity.prototype._loadStaticEntityXML=function(k){okBaseCall(this,"_loadVisibleEntityXML");var h=k.getAttribValueString("Model");if(h!=null){this.loadModel(h,null,null,true)}okA._object(this.$Y);this.$Y=okA.object();var d=k.getChild("MtrlList");if(d!=null){var a=d.getChildNum();for(var f=0;f<a;++f){var e=d.getChild(f);var c=new okMaterial(this.$L5.rc);okResourceParser._parseMaterialXML(e,c,true);this.$Y[e.getAttribValueString("Mesh")]=c}}};okStaticEntity.prototype.getState=function(){if(this.$C4==-1){return 1}var a=this.$L5.getResourceState(this.$C4);if(a!=5){return 1}return 4};okStaticEntity.prototype.loadModel=function(e,c,f,a){this.deleteModel();var d=this.$57.$z6._packModelUrl(e);this.$C4=this.$L5.createResource(1,d);this.$L5.registerListener(this.$C4,this);if(this.$L5.getResourceState(this.$C4)==2){if(c==null){this.$L5.loadModelByUrl(this.$C4,d,f)}else{this.$L5.loadModelByText(this.$C4,c,f)}}if(this.$L5.getResourceState(this.$C4)==5){this._postLoadModel(a)}return true};okStaticEntity.prototype.getModel=function(){if(this.$C4==-1||this.$L5.getResourceState(this.$C4)!=5){return null}return this.$L5.getResource(this.$C4)};okStaticEntity.prototype.deleteModel=function(){if(this.$C4!=-1){this.$L5.deleteResource(this.$C4);this.$L5.removeListener(this.$C4,this);this.$C4=-1;this.$Y=new Object;this.$S1=true;this.$o2=true;this.$U1=true}};okStaticEntity.prototype.getMaterialMap=function(){return this.$Y};okStaticEntity.prototype.getMaterial=function(c){if(c==null){for(var a in this.$Y){return this.$Y[a]}return null}return this.$Y[c]};okStaticEntity.prototype.getBoundingBox=function(d){if(d==2){if(this.$o2){var a=this.getModel();if(a==null){var c=this.$g5.getColumn(3);this.$v5.setMin(c);this.$v5.setMax(c);this.$v5.setMat(this.$g5);okA._vec3(c)}else{var e=a.getBoundingBox();this.$v5.setMin(e.vMin);this.$v5.setMax(e.vMax);this.$v5.setMat(this.$g5);this.$o2=false}}return this.$v5}else{if(this.$S1){var a=this.getModel();if(a==null){var c=this.$g5.getColumn(3);this.$J2.set(c,c);okA._vec3(c)}else{a.getBoundingBox().clone(this.$J2);this.$J2.transformMat(this.$g5);this.$S1=false}}return this.$J2}};okStaticEntity.prototype.genRenderBatch=function(v,w){var f=this.$57.$z6;var p=this.$L5;var d=this.getModel();if(d==null){return}var l=w.$N2;if(this.$r3>0){var c=l.getPos();var m=(c.x-this.$g5.m03)*(c.x-this.$g5.m03)+(c.y-this.$g5.m13)*(c.y-this.$g5.m13)+(c.z-this.$g5.m23)*(c.z-this.$g5.m23);if(m>this.$r3*this.$r3){return}}var k=d.getMeshMap();for(var s in k){var e=k[s];var o=this.getMaterial(s);var h=okA.renderBatch();for(var q=0;q<7;++q){var t=o.getTextureResourceId(q);if(t==-1){continue}var n=p.getResource(t);if(!n){continue}if(n.isVideoTexture()){n.updateVideoTexture()}}h.$a=e._getAttribFmt();if(o.$I2&&e.$H.Wireframe){h.$25=e.$H.Wireframe;h.$k4=1}else{h.$25=e.$H.Default;h.$k4=4}h.$l4=0;h.$j4=h.$25.getLength();h.$r5=o;var u=this.getMat4();if(this.$w2){u.m03+=l.$b5.m03;u.m13+=l.$b5.m13;u.m23+=l.$b5.m23}h.$g5=u;h.$i5=this.getNormalMat4();h.$t=this.$u;h.$51=this.$61;h.$o1=this.$p1;var a=new okAABBox();e.getBoundingBox().clone(a);if(this.$w2){a.set(new okVec3(a.vMin.x+l.$b5.m03,a.vMin.y+l.$b5.m13,a.vMin.z+l.$b5.m23),new okVec3(a.vMax.x+l.$b5.m03,a.vMax.y+l.$b5.m13,a.vMax.z+l.$b5.m23))}a.transformMat(this.$g5);h.$L2=a;h.$s2=this.$s2;h.$u4=this.$u4;v.push(h)}};okStaticEntity.prototype.onMessage=function(a){switch(a.sMsg){case"RES_READY":if(this.$C4==a.aArgs[0]){this._postLoadModel(a.aArgs[0])}break}};okStaticEntity.prototype._postLoadModel=function(a){this.$S1=true;this.$o2=true;this.$U1=true;this.$57.dirtyEntity(this);if(a!=true){var d=this.$L5.getResource(this.$C4);if(d){for(var e in d.getMeshMap()){var c=new okMaterial();c.$03=this;d.getMesh(e).getMaterial().clone(c);this.$Y[e]=c}}}if(this.onLoad){this.onLoad(this.getId(),this.$C4)}else{if(this.onload){this.onload(this.getId(),this.$C4)}}};function okDynamicEntity(a){okBaseCall(this,a);this.$S4=2;this.$C4=-1;this.$Y=new Object;this.$S2=new okSkAnimPlayer();this.$41=new Object;this.$K2=new okAABBox();this.$T1=true;this.$X3=(this.$57.$z6.$Y2.$Z2.iVertexUniformNum>=220?64:32)}okExtend(okDynamicEntity,okVisibleEntity);okDynamicEntity.prototype.clear=function(){this.deleteModel();this.$S2.clear();for(var a in this.$41){this.$41[a].clear()}okA._object(this.$41);this.$41=okA.object();this.$T1=true;okBaseCall(this,"clear")};okDynamicEntity.prototype.getState=function(){if(this.$C4==-1){return 1}var a=this.$L5.getResourceState(this.$C4);if(a!=5){return 1}return 4};okDynamicEntity.prototype.loadModel=function(d,a,e){this.deleteModel();var c=this.$57.$z6._packModelUrl(d);this.$C4=this.$L5.createResource(1,c);this.$L5.registerListener(this.$C4,this);if(this.$L5.getResourceState(this.$C4)==2){if(a==null){this.$L5.loadModelByUrl(this.$C4,c,e)}else{this.$L5.loadModelByText(this.$C4,a,e)}}if(this.$L5.getResourceState(this.$C4)==5){this._postLoadModel(this.$C4)}return true};okDynamicEntity.prototype.getModel=function(){if(this.$C4==-1||this.$L5.getResourceState(this.$C4)!=5){return null}return this.$L5.getResource(this.$C4)};okDynamicEntity.prototype.loadSkAnimation=function(h,a,l,e,k){var c=this.$L5;var d=this.$57.$z6._packSkAnimationUrl(l);var m=c.createResource(3,d);this.addResourceRef(m);if(c.getResourceState(m)==2){if(e==null){c.loadSkAnimationByUrl(m,d,true)}else{c.loadSkAnimationByText(m,e)}}var f=c.getResource(m);if(k){if(this.$41[k]==null){this.$41[k]=this.$S2.clone()}this.$41[k].activateChannel(h,true);this.$41[k].attachAnim(h,f,a)}else{for(var k in this.$41){this.$41[k].activateChannel(h,true);this.$41[k].attachAnim(h,f,a)}this.$S2.activateChannel(h,true);this.$S2.attachAnim(h,f,a)}if(c.getResourceState(m)==5){this._postLoadAnim(m)}return true};okDynamicEntity.prototype.deleteModel=function(){if(this.$C4!=-1){this.$L5.removeListener(this.$C4,this);this.$L5.deleteResource(this.$C4);this.$C4=-1;this.$Y=new Object}};okDynamicEntity.prototype.deleteSkAnimation=function(d,c){if(c==null){for(var c in this.$41){for(var a=0;a<2;++a){if(d==-1||a==d){this.$41[c].activateChannel(a,false);this.$41[c].attachAnim(a,null)}}}}else{if(this.$41[c]){for(var a=0;a<2;++a){if(d==-1||a==d){this.$41[c].activateChannel(a,false);this.$41[c].attachAnim(a,null)}}}}};okDynamicEntity.prototype.getMaterialMap=function(){return this.$Y};okDynamicEntity.prototype.getMaterial=function(c){if(c==null){for(var a in this.$Y){return this.$Y[a]}return null}return this.$Y[c]};okDynamicEntity.prototype.getBoundingBox=function(h){if(this.$T1){if(this.$L5.getResourceState(this.$C4)==5){var c=this.$L5.getResource(this.$C4);okA._aabbox(this.$K2);this.$K2=c.getBoundingBox();this.$K2=this.$K2.union(this.$S2.getBoundingBox());for(var f in c.getMeshMap()){var a=c.getMesh(f);var e=this.$41[f];if(e){this.$K2=this.$K2.union(e.getBoundingBox())}}}else{this.$K2.set(OAK.VEC3_ZERO,OAK.VEC3_ZERO)}this.$T1=false;this.$S1=true;this.$o2=true;this.$U1=true}if(h==2){if(this.$o2){var c=this.getModel();if(c==null){var d=this.$g5.getColumn(3);this.$v5.setMin(d);this.$v5.setMax(d);this.$v5.setMat(this.$g5);okA._vec3(d)}else{this.$v5.setMin(this.$K2.vMin);this.$v5.setMax(this.$K2.vMax);this.$v5.setMat(this.$g5);this.$o2=false}}return this.$v5}else{if(this.$S1){var c=this.getModel();if(c==null){var d=this.$g5.getColumn(3);this.$J2.set(d,d);okA._vec3(d)}else{this.$K2.clone(this.$J2);this.$J2.transformMat(this.$g5);this.$S1=false}}return this.$J2}};okDynamicEntity.prototype.genRenderBatch=function(C,D){var s=this.$L5;var e=this.getModel();if(e==null){return}var l=D.$N2;if(this.$r3>0){var c=l.getPos();var n=(c.x-this.$g5.m03)*(c.x-this.$g5.m03)+(c.y-this.$g5.m13)*(c.y-this.$g5.m13)+(c.z-this.$g5.m23)*(c.z-this.$g5.m23);if(n>this.$r3*this.$r3){return}}var k=e.getMeshMap();for(var z in k){var f=k[z];var p=this.getMaterial(z);var h=okA.renderBatch();for(var x=0;x<7;++x){var A=p.getTextureResourceId(x);if(A==-1){continue}var o=s.getResource(A);if(!o){continue}if(o.isVideoTexture()){o.updateVideoTexture()}}h.$a=f._getAttribFmt();if(p.$I2&&f.$H.Wireframe){h.$25=f.$H.Wireframe;h.$k4=1}else{h.$25=f.$H.Default;h.$k4=4}h.$l4=0;h.$j4=h.$25.getLength();h.$r5=p;var B=this.getMat4();if(this.$w2){B.m03+=l.$b5.m03;B.m13+=l.$b5.m13;B.m23+=l.$b5.m23}h.$g5=B;h.$i5=this.getNormalMat4();h.$t=this.$u;h.$51=this.$61;h.$o1=this.$p1;var w=(this.$41[z]?this.$41[z]:this.$S2);if(w.getAnim(0)||w.getAnim(1)){var v=f.getSkin();if(w.getSkin()!=v){w.setSkin(v)}var d=w.getBoneFinalMat43Array();var u=d.length;if(u>0){var t=okA.array();t.push(0,0,0,0,0,0,0,0,0,0,0,0);for(var y=0;y<u;++y){var q=d[y];t.push(q.m00,q.m01,q.m02,q.m03,q.m10,q.m11,q.m12,q.m13,q.m20,q.m21,q.m22,q.m23)}for(var y=u;y<this.$X3;++y){t.push(0,0,0,0,0,0,0,0,0,0,0,0)}h.$f=t;h.$T5=v.getVertexBoneIdxAttribName();h.$U5=v.getVertexBoneWeightAttribName()}}var a=new okAABBox();f.getBoundingBox().clone(a);a.transformMat(this.$g5);h.$L2=a;h.$s2=this.$s2;h.$u4=this.$u4;C.push(h)}};okDynamicEntity.prototype.activateChannel=function(e,a,d){if(d){if(this.$41[d]==null){this.$41[d]=this.$S2.clone()}this.$41[d].activateChannel(e,a)}else{for(var c in this.$41){this.$41[c].activateChannel(e,a)}this.$S2.activateChannel(e,a)}};okDynamicEntity.prototype.isActive=function(c,a){if(a){if(this.$41[a]==null){return this.$S2.isActive(c)}return this.$41[a].isActive(c)}else{return this.$S2.isActive(c)}};okDynamicEntity.prototype.setSpeed=function(e,d,c){if(c){if(this.$41[c]==null){this.$41[c]=this.$S2.clone()}this.$41[c].setSpeed(e,d)}else{for(var a in this.$41){this.$41[a].setSpeed(e,d)}this.$S2.setSpeed(e,d)}};okDynamicEntity.prototype.getSpeed=function(c,a){if(a){if(this.$41[a]==null){return this.$S2.getSpeed(c)}return this.$41[a].getSpeed(c)}else{return this.$S2.getSpeed(c)}};okDynamicEntity.prototype.enableLoop=function(e,a,d){if(d){if(this.$41[d]==null){this.$41[d]=this.$S2.clone()}this.$41[d].enableLoop(e,a)}else{for(var c in this.$41){this.$41[c].enableLoop(e,a)}this.$S2.enableLoop(e,a)}};okDynamicEntity.prototype.isLoop=function(c,a){if(a){if(this.$41[a]==null){return this.$S2.isLoop(c)}return this.$41[a].isLoop(c)}else{return this.$S2.isLoop(c)}return 0};okDynamicEntity.prototype.setBlendMode=function(d,c){if(c){if(this.$41[c]==null){this.$41[c]=this.$S2.clone()}this.$41[c].setBlendMode(d)}else{for(var a in this.$41){this.$41[a].setBlendMode(d)}this.$S2.setBlendMode(d)}};okDynamicEntity.prototype.getBlendMode=function(a){if(a){if(this.$41[a]==null){return this.$S2.getBlendMode()}return this.$41[a].getBlendMode()}else{return this.$S2.getBlendMode()}return 0};okDynamicEntity.prototype.getFrameTime=function(c,a){if(a){if(this.$41[a]==null){return this.$S2.getFrameTime(c)}return this.$41[a].getFrameTime(c)}else{return this.$S2.getFrameTime(c)}return 0};okDynamicEntity.prototype.setTime=function(d,e,c){if(c){if(this.$41[c]==null){this.$41[c]=this.$S2.clone()}this.$41[c].setTime(d,e)}else{for(var a in this.$41){this.$41[a].setTime(d,e)}this.$S2.setTime(d,e)}};okDynamicEntity.prototype.update=function(a,d){if(d){if(this.$41[d]==null){this.$41[d]=this.$S2.clone()}this.$41[d].update(-1,a)}else{for(var c in this.$41){this.$41[c].update(-1,a)}this.$S2.update(-1,a)}};okDynamicEntity.prototype.onMessage=function(a){switch(a.sMsg){case"RES_READY":if(this.$C4==a.aArgs[0]){this._postLoadModel(a.aArgs[0])}else{this._postLoadAnim(a.aArgs[0])}break}};okDynamicEntity.prototype._postLoadModel=function(d){var c=this.$L5.getResource(this.$C4);var c=this.$L5.getResource(this.$C4);if(c){for(var e in c.getMeshMap()){var a=new okMaterial();a.$03=this;c.getMesh(e).getMaterial().clone(a);this.$Y[e]=a}}this.$T1=true;this.$S1=true;this.$o2=true;this.$U1=true;this.$57.dirtyEntity(this);if(this.onLoad){this.onLoad(this.getId(),d)}if(this.onload){this.onload(this.getId(),d)}};okDynamicEntity.prototype._postLoadAnim=function(a){this.$T1=true;this.$S1=true;this.$o2=true;this.$U1=true;this.$57.dirtyEntity(this);if(this.onLoad){this.onLoad(this.getId(),a)}if(this.onload){this.onload(this.getId(),a)}};function okCustomMeshEntity(a){okBaseCall(this,a);this.$S4=64;this.$t5=new okMesh(this.$L5.rc);this.$u5=new okMaterial();this.$u5.$03=this;this.$Z5="";this.$k4=0;this.$l4=0;this.$j4=0;this.$K2=new okAABBox()}okExtend(okCustomMeshEntity,okVisibleEntity);okCustomMeshEntity.prototype.clear=function(){this.$t5.clear();this.$u5.clear();this.$Z5="";this.$k4=0;this.$l4=0;this.$j4=0;this.$K2=new okAABBox();okBaseCall(this,"clear")};okCustomMeshEntity.prototype.getMesh=function(){return this.$t5};okCustomMeshEntity.prototype.setVertexNum=function(a){this.$t5.setVertexNum(a)};okCustomMeshEntity.prototype.getVertexNum=function(){return this.$t5.getVertexNum()};okCustomMeshEntity.prototype.createAttribute=function(d,a,c,e){this.$t5.createAttribute(d,a,c,e)};okCustomMeshEntity.prototype.loadAttribute=function(e,c,a,d){this.$t5.loadAttribute(e,c,a,d)};okCustomMeshEntity.prototype.deleteAttribute=function(a){this.$t5.deleteAttribute(a)};okCustomMeshEntity.prototype.createIndex=function(c,a,e,f,d){this.$t5.createIndex(c,a,e,f,d)};okCustomMeshEntity.prototype.loadIndex=function(e,c,a,d){this.$t5.loadIndex(e,c,a,d)};okCustomMeshEntity.prototype.deleteIndex=function(a){this.$t5.deleteIndex(a)};okCustomMeshEntity.prototype.setIndexTopology=function(a,c){this.$t5.setIndexTopology(a,c)};okCustomMeshEntity.prototype.getIndexTopology=function(a){return this.$t5.getIndexTopology(a)},okCustomMeshEntity.prototype.setActiveIndex=function(c,d,a,e){this.$Z5=((c!=null)?c:"");this.$k4=((d!=null)?d:this.$t5.getIndexTopology());this.$l4=((a!=null)?a:0);this.$j4=((e!=null)?e:0)};okCustomMeshEntity.prototype.getAttributeNum=function(){return this.$t5.$N3};okCustomMeshEntity.prototype.getIndexNum=function(){return this.$t5.$s4};okCustomMeshEntity.prototype.getAttributeArray=function(a){return this.$t5.$9[a]};okCustomMeshEntity.prototype.getAttributeArrayBuffer=function(a){return this.$t5.$8[a]};okCustomMeshEntity.prototype.getIndexArray=function(a){return this.$t5.$I[a]};okCustomMeshEntity.prototype.getIndexArrayBuffer=function(a){return this.$t5.$H[a]};okCustomMeshEntity.prototype.getMaterial=function(){return this.$u5};okCustomMeshEntity.prototype.setBoundingBox=function(e,d,c){if(e==1){this.$K2.set(d,c)}else{if(e==3){var h=this.$g5.inverse();var a=okMat43MulVec3(h,d);var f=okMat43MulVec3(h,c);this.$K2.set(a,f);okA._vec3(a);okA._vec3(f)}}this.$S1=true;this.$o2=true;this.$U1=true;this.$57.dirtyEntity(this)};okCustomMeshEntity.prototype.computeBoundingBox=function(){this.$t5.computeBoundingInfo();this.$t5.getBoundingBox().clone(this.$K2);this.$S1=true;this.$o2=true;this.$U1=true;this.$57.dirtyEntity(this)};okCustomMeshEntity.prototype.getBoundingBox=function(a){if(a==2){if(this.$o2){this.$v5.setMin(this.$K2.vMin);this.$v5.setMax(this.$K2.vMax);this.$v5.setMat(this.$g5);this.$o2=false}return this.$v5}else{if(this.$S1){this.$K2.clone(this.$J2);this.$J2.transformMat(this.$g5);this.$S1=false}return this.$J2}};okCustomMeshEntity.prototype.genRenderBatch=function(d,n){var a=n.$N2;var c=this.$L5;if(this.$r3>0){var h=a.getPos();var o=(h.x-this.$g5.m03)*(h.x-this.$g5.m03)+(h.y-this.$g5.m13)*(h.y-this.$g5.m13)+(h.z-this.$g5.m23)*(h.z-this.$g5.m23);if(o>this.$r3*this.$r3){return}}var e=this.$t5;var p=this.$u5;var m=okA.renderBatch();for(var f=0;f<7;++f){var s=p.getTextureResourceId(f);if(s==-1){continue}var k=c.getResource(s);if(!k){continue}if(k.isVideoTexture()){k.updateVideoTexture()}}m.$a=e._getAttribFmt();if(this.$Z5==""){if(p.$I2&&e.$H.Wireframe){m.$25=e.$H.Wireframe;m.$k4=1}else{m.$25=e.$H.Default;m.$k4=4}m.$l4=0;if(m.$25){m.$j4=m.$25.getLength()}}else{m.$25=e.getIndexArrayBuffer(this.$Z5);m.$k4=this.$k4;m.$l4=this.$l4;m.$j4=this.$j4}if(m.$25==null){okA._renderBatch(m);return}m.$r5=p;var l=this.getMat4();if(this.$w2){l.m03+=a.$b5.m03;l.m13+=a.$b5.m13;l.m23+=a.$b5.m23}m.$g5=l;m.$i5=this.getNormalMat4();m.$t=this.$u;m.$51=this.$61;m.$o1=this.$p1;var q=new okAABBox();e.getBoundingBox().clone(q);q.transformMat(this.$g5);m.$L2=q;m.$s2=this.$s2;m.$u4=this.$u4;d.push(m)};function okParticle(){this.lf=0;this.tlf=0;this.m=new okMat43();this.v=new okVec3();this.ac=new okVec3();this.s=new okVec2(0.1,0.1);this.s0=new okVec2(0.1,0.1);this.s1=new okVec2(0.1,0.1);this.c=new okVec3(1,1,1);this.c0=new okVec3();this.c1=new okVec3();this.a=0;this.fdi=0;this.fdo=0}function okParticleEntity(c){okBaseCall(this,c);this.$S4=256;this.$t5=new okMesh(this.$L5.rc);this.$v6="";var a=this.$t5.getMaterial();a.$03=this;a.setEmissive(0,0,0);a.setDiffuse(1,1,1);a.enableBlend(true);a.enableDynamicLighting(false);a.enableTwoSide(true);a.enableDepthWrite(false);a.setDiffuseScript("VC");a.setAlphaScript("TC2.x * ALPHA");this.$11=new okList();this.$y4=-1;this.$Q1=true;this.$j2=true;this.$P=[3000,3000];this.$53=50;this.$m4=1;this.$63=50;this.$w=[0,30];this.$x=[new okVec3(0,0,0),new okVec3(0,0,0)];this.$y=[1,1];this.$2=[new okVec3(0,0,0),new okVec3(0,0,0)];this.$m1=[new okVec2(0.5,0.5),new okVec2(0.5,0.5)];this.$n1=[new okVec2(0.5,0.5),new okVec2(0.5,0.5)];this.$C2=false;this.$q=[new okVec3(1,1,1),new okVec3(1,1,1)];this.$r=[new okVec3(1,1,1),new okVec3(1,1,1)];this.$B2=false;this.$B=[1000,1000];this.$C=[1000,1000];this.$M3=1;this.$L3=1;this.$K3=1;this.$a=okA.object();this.$a.Position=new okAttribFormat();this.$a.Color=new okAttribFormat();this.$a.Texcoord1=new okAttribFormat();this.$a.Texcoord2=new okAttribFormat();this.$a.Position=new okAttribFormat();this.$a.Position.$56="Position";this.$a.Position.iIdx=0;this.$a.Position.iOffset=0;this.$a.Position.$I4=3;this.$a.Position.iStride=3;this.$a.Color=new okAttribFormat();this.$a.Color.$56="Color";this.$a.Color.iIdx=0;this.$a.Color.iOffset=0;this.$a.Color.$I4=3;this.$a.Color.iStride=7;this.$a.Texcoord1=new okAttribFormat();this.$a.Texcoord1.$56="Texcoord1";this.$a.Texcoord1.iIdx=1;this.$a.Texcoord1.iOffset=3;this.$a.Texcoord1.$I4=2;this.$a.Texcoord1.iStride=7;this.$a.Texcoord2=new okAttribFormat();this.$a.Texcoord2.$56="Texcoord2";this.$a.Texcoord2.iIdx=2;this.$a.Texcoord2.iOffset=5;this.$a.Texcoord2.$I4=2;this.$a.Texcoord2.iStride=7;this.$M1=true}okExtend(okParticleEntity,okVisibleEntity);okParticleEntity.prototype.setTexture=function(f,a,e,h,d){var c=this.$t5.getMaterial();c.setTextureName(0,f);c.setTextureCoord(0,"Texcoord1");if(f!=""){c.setDiffuseScript("VC * (ALBEDO1, TC1).rgb")}else{c.setDiffuseScript("VC")}if(f!=""){c.setAlphaScript("TC2.x * ALPHA * (ALBEDO1, TC1)."+(okIsString(a)?a.toLowerCase():"a"))}else{c.setAlphaScript("TC2.x * ALPHA")}this.$M3=(e?e:1);this.$L3=(h?h:1);this.$K3=(d?d:1)};okParticleEntity.prototype.setParticleMaxNum=function(a){if(a!=this.$y4){this.$y4=Math.min(a,16384);this.$Q1=(this.$y4<0);this.$j2=true}};okParticleEntity.prototype._evalMaxNum=function(){if(this.$Q1){this.$y4=Math.floor(this.$P[1]/this.$53*this.$m4)+1;this.$y4=Math.min(this.$y4,16384)}this.$t5.createAttribute("Position",this.$y4*4*3,null,35048);this.$t5.createAttribute("Color/Texcoord1/Texcoord2",this.$y4*4*7,null,35048);var a=okA.array();for(var c=0;c<this.$y4;++c){a.push(c*4,c*4+1,c*4+3,c*4+3,c*4+1,c*4+2)}this.$t5.createIndex("Default",this.$y4*2*3,a,35048,4);okA._array(a)};okParticleEntity.prototype.getParticleMaxNum=function(){return this.$y4};okParticleEntity.prototype.setEmitDir=function(d,c,a){this._rotToDir(2,d,c,a)};okParticleEntity.prototype.getEmitDir=function(){return this.$g5.getColumn(2)};okParticleEntity.prototype.setEmitDirRange=function(a,c){this.$w[0]=a;this.$w[1]=((c!=null)?c:a)};okParticleEntity.prototype.getEmitDirRangeMin=function(){return this.$w[0]};okParticleEntity.prototype.getEmitDirRangeMax=function(){return this.$w[1]};okParticleEntity.prototype.setEmitCycle=function(a){this.$53=a;this.$63=a;if(this.$Q1){this.$j2=true}};okParticleEntity.prototype.getEmitCycle=function(){return this.$53};okParticleEntity.prototype.setEmitFlow=function(a){this.$m4=a;if(this.$Q1){this.$j2=true}};okParticleEntity.prototype.getEmitFlow=function(){return this.$m4};okParticleEntity.prototype.setEmitPos=function(d,c,a){this.setPos(d,c,a)};okParticleEntity.prototype.getEmitPos=function(){return this.$g5.getColumn(3)};okParticleEntity.prototype.setEmitPosRange=function(c,e,h,a,d,f){if(f!=null){this.$x[0].x=c;this.$x[0].y=e;this.$x[0].z=h;this.$x[1].x=a;this.$x[1].y=d;this.$x[1].z=f}else{if(fZ!=null){this.$x[0].x=c;this.$x[0].y=e;this.$x[0].z=h;this.$x[1].x=c;this.$x[1].y=e;this.$x[1].z=h}else{if(fY!=null){this.$x[0].x=c.x;this.$x[0].y=c.y;this.$x[0].z=c.z;this.$x[1].x=e.x;this.$x[1].y=e.y;this.$x[1].z=e.z}else{this.$x[0].x=c.x;this.$x[0].y=c.y;this.$x[0].z=c.z;this.$x[1].x=c.x;this.$x[1].y=c.y;this.$x[1].z=c.z}}}};okParticleEntity.prototype.getEmitPosRangeMin=function(){return this.aEmitOffset[0].clone()};okParticleEntity.prototype.getEmitPosRangeMax=function(){return this.aEmitOffset[1].clone()};okParticleEntity.prototype.setEmitVelocity=function(a,c){this.$y[0]=a;this.$y[1]=(c!=null?c:a)};okParticleEntity.prototype.getEmitVelocityMin=function(){return this.$y[0]};okParticleEntity.prototype.getEmitVelocityMax=function(){return this.$y[1]};okParticleEntity.prototype.setParticleLife=function(a,c){this.$P[0]=a;this.$P[1]=((c!=null)?c:a);if(this.$Q1){this.$j2=true}};okParticleEntity.prototype.getParticleLifeMin=function(){return this.$P[0]};okParticleEntity.prototype.getParticleLifeMax=function(){return this.$P[1]};okParticleEntity.prototype.setParticleAcceleration=function(c,e,h,a,d,f){if(f!=null){this.$2[0].x=c;this.$2[0].y=e;this.$2[0].z=h;this.$2[1].x=a;this.$2[1].y=d;this.$2[1].z=f}else{if(h!=null){this.$2[0].x=c;this.$2[0].y=e;this.$2[0].z=h;this.$2[1].x=c;this.$2[1].y=e;this.$2[1].z=h}else{if(e!=null){this.$2[0].x=c.x;this.$2[0].y=c.y;this.$2[0].z=c.z;this.$2[1].x=e.x;this.$2[1].y=e.y;this.$2[1].z=e.z}else{this.$2[0].x=c.x;this.$2[0].y=c.y;this.$2[0].z=c.z;this.$2[1].x=c.x;this.$2[1].y=c.y;this.$2[1].z=c.z}}}};okParticleEntity.prototype.getParticleAccelerationMin=function(){return this.$2[0].clone()};okParticleEntity.prototype.getParticleAccelerationMax=function(){return this.$2[1].clone()};okParticleEntity.prototype.setParticleSize=function(a,d,f,c,e){if(a&1){if(e!=null){this.$m1[0].x=d;this.$m1[0].y=f;this.$m1[1].x=c;this.$m1[1].y=e}else{if(okIsNumber(f)){this.$m1[0].x=d;this.$m1[0].y=f;this.$m1[1].x=d;this.$m1[1].y=f}else{if(f){this.$m1[0].x=d.x;this.$m1[0].y=d.y;this.$m1[1].x=f.x;this.$m1[1].y=f.y}else{this.$m1[0].x=d.x;this.$m1[0].y=d.y;this.$m1[1].x=d.x;this.$m1[1].y=d.y}}}}if(a&2){if(e!=null){this.$n1[0].x=d;this.$n1[0].y=f;this.$n1[1].x=c;this.$n1[1].y=e}else{if(okIsNumber(f)){this.$n1[0].x=d;this.$n1[0].y=f;this.$n1[1].x=d;this.$n1[1].y=f}else{if(f){this.$n1[0].x=d.x;this.$n1[0].y=d.y;this.$n1[1].x=f.x;this.$n1[1].y=f.y}else{this.$n1[0].x=d.x;this.$n1[0].y=d.y;this.$n1[1].x=d.x;this.$n1[1].y=d.y}}}}};okParticleEntity.prototype.getParticleSizeMin=function(a){if(a==1){return this.$m1[0].clone()}else{return this.$n1[0].clone()}};okParticleEntity.prototype.getParticleSizeMax=function(a){if(a==OAK.PTIME_BEGIN){return this.$m1[1].clone()}else{return this.$n1[1].clone()}};okParticleEntity.prototype.enableVarySize=function(a){this.$C2=a};okParticleEntity.prototype.isVarySize=function(){return this.$C2};okParticleEntity.prototype.setParticleColor=function(a,h,f,k,d,c,e){if(a&1){if(e!=null){this.$q[0].x=h;this.$q[0].y=f;this.$q[0].z=k;this.$q[1].x=d;this.$q[1].y=c;this.$q[1].z=e}else{if(k!=null){this.$q[0].x=h;this.$q[0].y=f;this.$q[0].z=k;this.$q[1].x=h;this.$q[1].y=f;this.$q[1].z=k}else{if(f!=null){this.$q[0].x=h.x;this.$q[0].y=h.y;this.$q[0].z=h.z;this.$q[1].x=f.x;this.$q[1].y=f.y;this.$q[1].z=f.z}else{this.$q[0].x=h.x;this.$q[0].y=h.y;this.$q[0].z=h.z;this.$q[1].x=h.x;this.$q[1].y=h.y;this.$q[1].z=h.z}}}}if(a&2){if(e!=null){this.$r[0].x=h;this.$r[0].y=f;this.$r[0].z=k;this.$r[1].x=d;this.$r[1].y=c;this.$r[1].z=e}else{if(k!=null){this.$r[0].x=h;this.$r[0].y=f;this.$r[0].z=k;this.$r[1].x=h;this.$r[1].y=f;this.$r[1].z=k}else{if(f!=null){this.$r[0].x=h.x;this.$r[0].y=h.y;this.$r[0].z=h.z;this.$r[1].x=f.x;this.$r[1].y=f.y;this.$r[1].z=f.z}else{this.$r[0].x=h.x;this.$r[0].y=h.y;this.$r[0].z=h.z;this.$r[1].x=h.x;this.$r[1].y=h.y;this.$r[1].z=h.z}}}}};okParticleEntity.prototype.getParticleColorMin=function(a){if(a==1){return this.$q[0].clone()}else{return this.$r[0].clone()}};okParticleEntity.prototype.getParticleColorMax=function(a){if(a==1){return this.$q[1].clone()}else{return this.$r[1].clone()}};okParticleEntity.prototype.enableVaryColor=function(a){this.$B2=a};okParticleEntity.prototype.isVaryColor=function(){return this.$B2};okParticleEntity.prototype.setParticleFadeInTime=function(a,c){this.$B[0]=a;this.$B[1]=((c!=null)?c:a)};okParticleEntity.prototype.getParticleFadeInTimeMin=function(){return this.$B[0]};okParticleEntity.prototype.getParticleFadeInTimeMax=function(){return this.$B[1]};okParticleEntity.prototype.setParticleFadeOutTime=function(a,c){this.$C[0]=a;this.$C[1]=((c!=null)?c:a)};okParticleEntity.prototype.getParticleFadeOutTimeMin=function(){return this.$C[0]};okParticleEntity.prototype.getParticleFadeOutTimeMax=function(){return this.$C[1]};okParticleEntity.prototype.getMaterial=function(){return this.$t5.getMaterial()};okParticleEntity.prototype.getBoundingBox=function(a){if(a==2){if(this.$o2){this.$o2=false}return this.$v5}else{if(this.$S1){this.$S1=false}return this.$J2}};okParticleEntity.prototype.update=function(n){if(!this.$M1){return}if(this.$j2){this._evalMaxNum();this.$j2=false}var e=okA.array();var a=this.getNormalMat43();var q=this.$g5.getColumn(3);var u=this.$g5.getColumn(3);var v=this.$11.getRoot();while(v){var s=v.data;s.lf+=n;if(s.lf>s.tlf){var x=v.next;okA._particle(s);this.$11.remove(v);v=x;continue}s.m.m03+=s.v.x*n/1000;s.m.m13+=s.v.y*n/1000;s.m.m23+=s.v.z*n/1000;s.v.x+=s.ac.x*n/1000;s.v.y+=s.ac.y*n/1000;s.v.z+=s.ac.z*n/1000;var o=s.lf/s.tlf;if(this.$C2){s.s.x=(1-o)*s.s0.x+o*s.s1.x;s.s.y=(1-o)*s.s0.y+o*s.s1.y}if(this.$B2){s.c.x=(1-o)*s.c0.x+o*s.c1.x;s.c.y=(1-o)*s.c0.y+o*s.c1.y;s.c.z=(1-o)*s.c0.z+o*s.c1.z}if(s.lf<=s.fdi){s.a=s.lf/s.fdi}else{if(s.lf>=s.tlf-s.fdo){s.a=(s.tlf-s.lf)/s.fdo}else{s.a=1}}q.x=(q.x<s.m.m03?q.x:s.m.m03);q.y=(q.y<s.m.m13?q.y:s.m.m13);q.z=(q.z<s.m.m23?q.z:s.m.m23);u.x=(u.x>s.m.m03?u.x:s.m.m03);u.y=(u.y>s.m.m13?u.y:s.m.m13);u.z=(u.z>s.m.m23?u.z:s.m.m23);var k=Math.floor(s.lf/s.tlf*this.$K3);var h=Math.floor(k/this.$M3);var l=k-h*this.$M3;var c=l/this.$M3,f=(l+1)/this.$M3;var z=h/this.$L3,m=(h+1)/this.$L3;e.push(s.c.x,s.c.y,s.c.z,c,z,s.a,0,s.c.x,s.c.y,s.c.z,c,m,s.a,0,s.c.x,s.c.y,s.c.z,f,m,s.a,0,s.c.x,s.c.y,s.c.z,f,z,s.a,0);v=v.next}this.$63+=n;if(this.$63>=this.$53){this.$63-=this.$53;var d=this.$m4;while(d>0&&this.$11.getSize()<this.$y4){d-=1;var s=okA.particle();this.$11.pushBack(s);var A=Math.random();s.tlf=(1-A)*this.$P[0]+A*this.$P[1];s.lf=0;this.$g5.clone(s.m);A=Math.random();s.m.m03+=(1-A)*this.$x[0].x+A*this.$x[1].x;A=Math.random();s.m.m13+=(1-A)*this.$x[0].y+A*this.$x[1].y;A=Math.random();s.m.m23+=(1-A)*this.$x[0].z+A*this.$x[1].z;A=Math.random();var w=new okVec3(0,1,0);w.rotZ((1-A)*this.$w[0]+A*this.$w[1],true);w.rotY(Math.random()*360,true);w=okMat43MulVec3(a,w);A=Math.random();var y=(1-A)*this.$y[0]+A*this.$y[1];s.v.x=w.x*y;s.v.y=w.y*y;s.v.z=w.z*y;A=Math.random();s.ac.x=(1-A)*this.$2[0].x+A*this.$2[1].x;s.ac.y=(1-A)*this.$2[0].y+A*this.$2[1].y;s.ac.z=(1-A)*this.$2[0].z+A*this.$2[1].z;A=Math.random();s.s0.x=(1-A)*this.$m1[0].x+A*this.$m1[1].x;A=Math.random();s.s0.y=(1-A)*this.$m1[0].y+A*this.$m1[1].y;A=Math.random();s.s1.x=(1-A)*this.$n1[0].x+A*this.$n1[1].x;A=Math.random();s.s1.y=(1-A)*this.$n1[0].x+A*this.$n1[1].x;s.s.x=s.s0.x;s.s.y=s.s0.y;A=Math.random();s.c0.x=(1-A)*this.$q[0].x+A*this.$q[1].x;A=Math.random();s.c0.y=(1-A)*this.$q[0].y+A*this.$q[1].y;A=Math.random();s.c0.z=(1-A)*this.$q[0].z+A*this.$q[1].z;A=Math.random();s.c1.x=(1-A)*this.$r[0].x+A*this.$r[1].x;A=Math.random();s.c1.y=(1-A)*this.$r[0].y+A*this.$r[1].y;A=Math.random();s.c1.z=(1-A)*this.$r[0].z+A*this.$r[1].z;s.c.x=s.c0.x;s.c.y=s.c0.y;s.c.z=s.c0.z;A=Math.random();s.fdi=(1-A)*this.$B[0]+A*this.$B[1];A=Math.random();s.fdo=(1-A)*this.$C[0]+A*this.$C[1];s.a=0;q.x=(q.x<s.m.m03?q.x:s.m.m03);q.y=(q.y<s.m.m13?q.y:s.m.m13);q.z=(q.z<s.m.m23?q.z:s.m.m23);u.x=(u.x>s.m.m03?u.x:s.m.m03);u.y=(u.y>s.m.m13?u.y:s.m.m13);u.z=(u.z>s.m.m23?u.z:s.m.m23);var k=Math.floor(s.lf/s.tlf*this.$K3);var h=Math.floor(k/this.$M3);var l=k-h*this.$M3;var c=l/this.$M3,f=(l+1)/this.$M3;var z=h/this.$L3,m=(h+1)/this.$L3;e.push(s.c.x,s.c.y,s.c.z,c,z,s.a,0,s.c.x,s.c.y,s.c.z,c,m,s.a,0,s.c.x,s.c.y,s.c.z,f,m,s.a,0,s.c.x,s.c.y,s.c.z,f,z,s.a,0)}}this.$t5.loadAttribute("Color/Texcoord1/Texcoord2",0,this.$11.getSize()*4*7,e);this.$J2.set(q,u);this.$v5.setMin(q);this.$v5.setMax(u);this.$R6.x=(q.x+u.x)*0.5;this.$R6.y=(q.y+u.y)*0.5;this.$R6.z=(q.z+u.z)*0.5;this.$43=Math.sqrt((u.x-q.x)*(u.x-q.x)+(u.y-q.y)*(u.y-q.y)+(u.z-q.z)*(u.z-q.z))*0.5;this.$S1=false;this.$o2=false;this.$U1=false;okA._array(e);okA._vec3(q);okA._vec3(u)};okParticleEntity.prototype.genRenderBatch=function(z,A){if(this.iCount==0||!this.$M1){return}if(this.$j2){this._evalMaxNum();this.$j2=false}var v=this.$L5;var h=A.$N2;var c=this.$t5;var s=this.$t5.getMaterial();var f=okA.renderBatch();for(var w=0;w<7;++w){var x=s.getTextureResourceId(w);if(x==-1){continue}var n=v.getResource(x);if(!n){continue}if(n.isVideoTexture()){n.updateVideoTexture()}}var e=h.getRightDir();var d=h.getUpDir();var m=okA.vec3();var k=okA.vec3();var l=okA.array();var u=this.$11.getRoot();while(u){var t=u.data;var a=t.s.x*0.5,q=t.s.y*0.5;m.x=e.x*a;m.y=e.y*a;m.z=e.z*a;k.x=d.x*q;k.y=d.y*q;k.z=d.z*q;l.push(t.m.m03-m.x+k.x,t.m.m13-m.y+k.y,t.m.m23-m.z+k.z,t.m.m03-m.x-k.x,t.m.m13-m.y-k.y,t.m.m23-m.z-k.z,t.m.m03+m.x-k.x,t.m.m13+m.y-k.y,t.m.m23+m.z-k.z,t.m.m03+m.x+k.x,t.m.m13+m.y+k.y,t.m.m23+m.z+k.z);u=u.next}this.$t5.loadAttribute("Position",0,this.$11.getSize()*4*3,l);okA._vec3(e);okA._vec3(d);okA._vec3(m);okA._vec3(k);okA._array(l);f.$a=okA.object();var o=this.$t5.$8;this.$a.Position.buf=o.Position;this.$a.Color.buf=o["Color/Texcoord1/Texcoord2"];this.$a.Texcoord1.buf=o["Color/Texcoord1/Texcoord2"];this.$a.Texcoord2.buf=o["Color/Texcoord1/Texcoord2"];f.$a.Position=this.$a.Position;f.$a.Color=this.$a.Color;f.$a.Texcoord1=this.$a.Texcoord1;f.$a.Texcoord2=this.$a.Texcoord2;f.$25=c.$H.Default;f.$k4=4;f.$l4=0;f.$j4=this.$11.getSize()*6;f.$r5=s;var y=okA.mat4();if(this.$w2){y.m03+=cam.$b5.m03;y.m13+=cam.$b5.m13;y.m23+=cam.$b5.m23}f.$g5=y;f.$i5=okA.mat4();f.$t=this.$u;f.$51=this.$61;f.$o1=this.$p1;f.$L2=this.$J2;f.$s2=false;f.$u4=this.$u4;z.push(f)};okParticleEntity.prototype.activate=function(a){this.$M1=a;if(this.$M1=false){var c=this.$11.getRoot();while(c){var d=c.data;okA._particle(d);c=c.next}this.$11.clear();this.$63=this.$53}};okParticleEntity.prototype.isActive=function(){return this.$M1};function okTerrainMesh(a){this.rc=a;this.$q5=new okMaterial(a);this.$x5;this.$l=new Array;this.$a5=new okArray2D;this.$56;this.$J2=new okAABBox();this.$9=new Object;this.$8=new Object;this.$N3=0;this.$I=new Object;this.$H=new Object;this.$s4=0;this.$94;this.$84;this.$Q4;this.$P4;this.$J3=new okVec2;this.$I3=new okVec2;this.$a4;this.$z4;this.$O6=false;this.$M2=false;this.$45=false;this.$M5=false}okTerrainMesh.prototype={clear:function(){for(var e in this.$9){if(sAttribName==null||e==sAttribName){delete this.$9[e];this.$8[e].releaseBuffer();delete this.$8[e];this.$N3-=1}}for(var d in this.$I){if(sIndexName==null||d==sIndexName){delete this.$I[d];this.$H[d].releaseBuffer();delete this.$H[d];this.$s4-=1}}for(var a=0;a<this.$l.length;++a){var c=this.$l[a];c.clear()}this.$q5.clear()},setBoundingBox:function(c,a){var e=new okVec3(c.x,c.y,c.z);var d=new okVec3(a.x,a.y,a.z);if(d==null){e.clone(this.$J2)}else{this.$J2.set(e,d)}},getBoundingBox:function(){return this.$J2},setParentTerrain:function(a){this.$x5=a;if(this.$q5){this.$q5.$03=a}},getParentTerrain:function(){return this.$x5},getMaterial:function(){return this.$q5},setGlobalIndex:function(c,a){this.$I3.set(c,a)},getGlobalIndex:function(){return this.$I3},setChunkSize:function(a,c){this.$94=a;this.$84=c;this.computeMaxLOD()},getChunkWidth:function(){return this.$94},getChunkHeight:function(){return this.$84},setTerrainSize:function(a,c){this.$Q4=a;this.$P4=c},setGridSpace:function(a){this.$J3=a},setName:function(a){this.$56=a},getName:function(){return this.$56},detectCollision:function(n){var A=this.$94;var p=this.$84;var e=this.$J2.vMax.x-this.$J2.vMin.x;var B=this.$J2.vMax.y-this.$J2.vMin.y;var t=e/(A-1);var q=B/(p-1);var o=(n.x-this.$J2.vMin.x)/t;var k=(n.y-this.$J2.vMin.y)/q;i=Math.floor(o);j=Math.floor(k);if(i==o&&j==k){var f=this.$9.Position;if(!f){return}var v=f[(i+j*A)*3+2];return v}var l=new okVec2(n.x,n.y);var y=i+j*A;var x=(i+1)+(j+1)*A;var u=i+(j+1)*A;var s=(i+1)+j*A;if((i+j)%2==0){if(this._insideTriangle(x,u,y,l)){return this._intersectedPoint(x,u,y,l)}else{if(this._insideTriangle(y,s,x,l)){return this._intersectedPoint(y,s,x,l)}}}else{if(this._insideTriangle(s,y,u,l)){return this._intersectedPoint(s,y,u,l)}else{if(this._insideTriangle(u,x,s,l)){return this._intersectedPoint(u,x,s,l)}}}},_insideTriangle:function(s,p,o,l){var f=this.$9.Position;if(!f){return}var d=new okVec2(f[s*3+0],f[s*3+1]);var t=new okVec2(f[p*3+0],f[p*3+1]);var n=new okVec2(f[o*3+0],f[o*3+1]);var v=okVec2Sub(l,d);var u=okVec2Sub(l,t);var q=okVec2Sub(l,n);var k=okVec2Cross(v,u);var h=okVec2Cross(u,q);var e=okVec2Cross(q,v);if(k>=0&&h>=0&&e>=0){return true}if(k<=0&&h<=0&&e<=0){return true}return false},_intersectedPoint:function(v,s,o,f){var e=this.$9.Position;if(!e){return}var w=f.x;var q=f.y;var d=new okVec3(e[v*3+0],e[v*3+1],e[v*3+2]);var u=new okVec3(e[s*3+0],e[s*3+1],e[s*3+2]);var l=new okVec3(e[o*3+0],e[o*3+1],e[o*3+2]);var k=d.z-(d.z-u.z)*(d.x-w)/(d.x-u.x);var t=d.y-(d.y-u.y)*(d.x-w)/(d.x-u.x);var h=d.z-(d.z-l.z)*(d.x-w)/(d.x-l.x);var p=d.y-(d.y-l.y)*(d.x-w)/(d.x-l.x);var n=k-(k-h)*(t-q)/(t-p);return n},createAttribute:function(h,a,f,k){if(!this.$9[h]){this.$9[h]=new Array}for(var d=0;d<f.length;++d){this.$9[h].push(f[d])}var e=this.$9[h];var c=new okArrayBuffer(this.rc);c.createBuffer(34962,5126,(k!=null)?k:35044,new Float32Array(e));if(this.$8[h]){this.$8[h].releaseBuffer()}this.$8[h]=c},createAttributeData:function(d,a){this.releaseAttributeArrayBuffer(d);if(!this.$9[d]){this.$9[d]=new Array}for(var c=0;c<a.length;++c){this.$9[d].push(a[c])}},releaseAttributeData:function(c){this.releaseAttributeArrayBuffer(c);for(var d in this.$9){if(c==null||d==c){var a=this.$9[d];delete a;a=[]}}},createAttributeArrayBuffer:function(d,e){for(var f in this.$9){if(d==null||f==d){var c=this.$9[f];var a=new okArrayBuffer(this.rc);a.createBuffer(34962,5126,(e!=null)?e:35044,new Float32Array(c));if(this.$8[f]){this.$8[f].releaseBuffer()}this.$8[f]=a}}},releaseAttributeArrayBuffer:function(a){for(var c in this.$8){if(a==null||c==a){this.$8[c].releaseBuffer();delete this.$8[c]}}},createIndexData:function(d,a){this.releaseIndexArrayBuffer(d);if(!this.$I[d]){this.$I[d]=new Array}for(var c=0;c<a.length;++c){this.$I[d].push(a[c])}},releaseIndexData:function(a){this.releaseIndexArrayBuffer(a);for(var d in this.$I){if(a==null||d==a){var c=this.$I[curAttribName];delete c;c=[]}}},createIndexArrayBuffer:function(d){for(var e in this.$I){if(d==null||e==d){var a=this.$I[e];var c=new okArrayBuffer(this.rc);c.createBuffer(34963,5123,35044,new Uint16Array(a));if(this.$H[e]){this.$H[e].releaseBuffer()}this.$H[e]=c}}},releaseIndexArrayBuffer:function(a){for(var c in this.$H){if(a==null||c==a){this.$H[c].releaseBuffer();delete this.$H[c]}}},distributeAttribute:function(l,o){var n=new Array(this.$94*this.$84);var m=this.$I3.x;var f=this.$I3.y;var k=m*(this.$94-1);var h=f*(this.$84-1);for(var d=0;d<this.$94;++d){for(var c=0;c<this.$84;++c){var q=k+d;var p=h+c;var a=p*this.$Q4+q;var e=c*this.$94+d;if(l=="Normal"){n[e*3+0]=o[a*3+0];n[e*3+1]=o[a*3+1];n[e*3+2]=o[a*3+2]}else{if(l=="Texcoord1"){n[e*3+0]=o[a*3+0];n[e*3+1]=o[a*3+1]}}}}this.createAttribute(l,n.length,n)},clearFillCrashFlag:function(){this.$O6=false;this.$M2=false;this.$45=false;this.$M5=false},computeMaxLOD:function(){var c=this.$94-1;var d=1;for(var a=0;;++a){d=d*2;if(d>=c){this.$z4=a+1;return}}},cullByFrustum:function(f,e,a,h){if(a.collideAABBox(this.getBoundingBox())==0){return}this.computeLOD(h);var d=this.$I3.x;var c=this.$I3.y;f.addElement(d,c,this)},getCurrentLOD:function(){return this.$a4},setCurrentLOD:function(a){this.$a4=a},computeLOD:function(d){var e=this.getBoundingBox();var m=80;var a=new okVec3((e.vMin.x+e.vMax.x)/2,(e.vMin.y+e.vMax.y)/2,e.vMax.z);var l=okVec3Len(a,d);var k=Math.abs(e.vMax.x-e.vMin.x);var h=k*2;for(var f=0;f<=this.$z4;++f){h=h/2;if(l>=m*h){return}this.$a4=f}},computePosInIndexArray:function(){var c=this.$I3.x;var a=this.$I3.y;if(this.$a4==0){if((c+a)%2==0){return 0}else{return 1}}else{return(this.$a4<<4)+(8*this.$M2+4*this.$M5+2*this.$O6+1*this.$45)}},computeNormal:function(){var C=this.$9.Position;if(!C){return}var B=this.$94;var I=this.$84;var A;var v;var u;var F;var E=new Array(B*I);for(var H=0;H<B;++H){for(var G=0;G<I;++G){if(H==0||H==B-1||G==0||G==I-1){A=0;v=0;u=1;F=H+G*B}else{var k=(H-1)+(G-1)*B;var e=H+(G-1)*B;var d=(H+1)+(G-1)*B;var c=(H-1)+G*B;F=H+G*B;var a=(H+1)+G*B;var L=(H-1)+(G+1)*B;var K=H+(G+1)*B;var J=(H+1)+(G+1)*B;var t=C[k*3+2];var s=C[e*3+2];var q=C[d*3+2];var o=C[c*3+2];var D=C[F*3+2];var n=C[a*3+2];var m=C[L*3+2];var l=C[K*3+2];var f=C[J*3+2];A=(t*1+o*2+m*1+q*(-1)+n*(-2)+f*(-1))/8/2;v=(t*1+s*2+q*1+m*(-1)+l*(-2)+f*(-1))/8/2;u=1}E[F*3+0]=A;E[F*3+1]=v;E[F*3+2]=u}}this._normalizeNormals();this.createAttributeData("Normal",E)},computeNormalOfTriangle:function(n,m,l){var k=this.$94*this.$84;if(n<0||n>=k||m<0||m>=k||l<0||l>=k){return okVec3(0,0,0)}var e=this.$9["Position/Normal"];if(!e){return okVec3(0,0,0)}var d=new okVec3(e[n*6],e[n*6+1],e[n*6+2]);var o=new okVec3(e[m*6],e[m*6+1],e[m*6+2]);var h=new okVec3(e[l*6],e[l*6+1],e[l*6+2]);var p=okVec3Sub(d,o);var f=okVec3Sub(h,o);return okVec3Cross(f,p)},_normalizeNormals:function(a){if(!a){return}var e=this.$94*this.$84;for(var d=0;d<e;++d){var c=new okVec3(a[d*3+0],a[d*3+1],a[d*3+2]);c=c.normalize();a[d*3+0]=c.x;a[d*3+1]=c.y;a[d*3+2]=c.z}},fixNormal:function(f,h){var c=h.x;var k=h.y;var e=f.getElement(c,k-1);this.fixTopNormal(e);var a=f.getElement(c-1,k);this.fixLeftNormal(a);var d=f.getElement(c-1,k-1);this.fixTopLeftNormal(e,a,d)},fixTopNormal:function(k){if(!k){return}var m=this.$9.Position;if(!m){return}var l=k.$9.Position;if(!l){return}var d=this.$9.Normal;if(!d){return}var c=k.$9.Normal;if(!c){return}var H=k.$94*(k.$94-2);var V=k.$94*(k.$94-1);for(var O=1;O<this.$94-1;++O){var U=H+(O-1);var T=H+O;var S=H+(O+1);var e=V+(O-1);var f=V+O;var K=V+(O+1);var R=O-1;var I=O;var Q=O+1;var N=this.$94+(O-1);var M=this.$94+O;var L=this.$94+(O+1);var B=l[U*3+2];var A=l[T*3+2];var w=l[S*3+2];var a=l[e*3+2];var J=l[f*3+2];var G=l[K*3+2];var u=m[R*3+2];var P=m[I*3+2];var t=m[Q*3+2];var q=m[N*3+2];var o=m[M*3+2];var n=m[L*3+2];var E=(B*1+u*2+q*1+w*(-1)+t*(-2)+n*(-1))/8/2;var D=(B*1+A*2+w*1+q*(-1)+o*(-2)+n*(-1))/8/2;var C=1;var F=new okVec3(E,D,C);F=F.normalize();d[I*3+0]=c[f*3+0]=F.x;d[I*3+1]=c[f*3+1]=F.y;d[I*3+2]=c[f*3+2]=F.z}},fixLeftNormal:function(q){if(!q){return}var O=this.$9.Position;if(!O){return}var N=q.$9.Position;if(!N){return}var c=this.$9.Normal;if(!c){return}var U=q.$9.Normal;if(!U){return}var G=this.$94;for(var L=1;L<this.$84-1;++L){var k=L*G-2;var f=L*G-1;var l=(L-1)*G;var e=(L-1)*G+1;var d=(L+1)*G-2;var I=(L+1)*G-1;var J=L*G;var a=L*G+1;var T=(L+2)*G-2;var S=(L+2)*G-1;var P=(L+1)*G;var R=(L+1)*G+1;var B=N[k*3+2];var A=N[f*3+2];var K=O[l*3+2];var u=O[e*3+2];var t=N[d*3+2];var M=N[I*3+2];var Q=O[J*3+2];var s=O[a*3+2];var o=N[T*3+2];var n=N[S*3+2];var F=O[P*3+2];var m=O[R*3+2];var E=(B*1+t*2+o*1+u*(-1)+s*(-2)+m*(-1))/8/2;var D=(B*1+A*2+u*1+o*(-1)+n*(-2)+m*(-1))/8/2;var C=1;var H=new okVec3(E,D,C);H=H.normalize();U[I*3+0]=c[J*3+0]=H.x;U[I*3+1]=c[J*3+1]=H.y;U[I*3+2]=c[J*3+2]=H.z}},fixTopLeftNormal:function(H,B,u){if(!H||!B||!u){return}var O=this.$9.Position;if(!O){return}var N=H.$9.Position;if(!N){return}var L=B.$9.Position;if(!L){return}var K=u.$9.Position;if(!K){return}var c=this.$9.Normal;if(!c){return}var U=H.$9.Normal;if(!U){return}var S=B.$9.Normal;if(!S){return}var Q=u.$9.Normal;if(!Q){return}var M=this.$84;var F=this.$94;var l=(M-1)*F-2;var f=(M-1)*F-1;var e=(M-2)*F+1;var d=F-2;var J=0;var a=1;var T=2*F-2;var R=F;var P=F+1;var A=K[l*3+2];var t=K[f*3+2];var s=N[e*3+2];var q=L[d*3+2];var I=O[J*3+2];var o=O[a*3+2];var n=L[T*3+2];var m=O[R*3+2];var k=O[P*3+2];var E=(A*1+q*2+n*1+s*(-1)+o*(-2)+k*(-1))/8/2;var D=(A*1+t*2+s*1+n*(-1)+m*(-2)+k*(-1))/8/2;var C=1;var G=new okVec3(E,D,C);G=G.normalize();c[0+0]=U[(M-1)*F*3+0]=S[(F-1)*3+0]=Q[(M*F-1)*3+0]=G.x;c[0+1]=U[(M-1)*F*3+1]=S[(F-1)*3+1]=Q[(M*F-1)*3+1]=G.y;c[0+2]=U[(M-1)*F*3+2]=S[(F-1)*3+2]=Q[(M*F-1)*3+2]=G.z}};function okTerrainTile(a){this.rc=a;this.$l=new Array;this.$a5=new okArray2D;this.$J2=new okAABBox();this.$M4=1;this.sUrl="";this.$x5;this.$94;this.$84;this.$Q4;this.$P4;this.$15;this.$Z4;this.$I3=new okVec2}okTerrainTile.prototype={setParentTerrain:function(a){this.$x5=a},getParentTerrain:function(){return this.$x5},setBoundingBox:function(c,a){var e=new okVec3(c.x,c.y,c.z);var d=new okVec3(a.x,a.y,a.z);if(d==null){e.clone(this.$J2)}else{this.$J2.set(e,d)}},getBoundingBox:function(){var a=new okAABBox();this.$J2.clone(a);return a},setUrl:function(a){this.sUrl=a},getUrl:function(){return this.sUrl},setGlobalIndex:function(c,a){this.$I3.set(c,a)},getGlobalIndex:function(){return this.$I3},setChunkSize:function(a,c){this.$94=a;this.$84=c},getChunkWidth:function(){return this.$94},getChunkHeight:function(){return this.$84},setWorldMapSize:function(a,c){this.$15=a;this.$Z4=c},setTerrainSize:function(a,c){this.$Q4=a;this.$P4=c},setGridSpace:function(a){this.$J3=a},setState:function(a){this.$M4=a},getState:function(){return this.$M4},getMaterialArray:function(){var h=new Array;this.createLocalLeafMeshMap();var a=this.$a5.getOneDimLength();var f=this.$a5.getTwoDimLength();for(var e=0;e<a;++e){for(var d=0;d<f;++d){var c=this.$a5.getElement(e,d);if(!c){continue}h.push(c.getMaterial())}}return h},getMaterialMap:function(){var k=new Array;this.createLocalLeafMeshMap();var a=this.$a5.getOneDimLength();var h=this.$a5.getTwoDimLength();for(var e=0;e<a;++e){for(var d=0;d<h;++d){var c=this.$a5.getElement(e,d);if(!c){continue}var f=c.getName();k[f]=c.getMaterial()}}return k},getMaterial:function(f){this.createLocalLeafMeshMap();var a=this.$a5.getOneDimLength();var h=this.$a5.getTwoDimLength();for(var e=0;e<a;++e){for(var d=0;d<h;++d){var c=this.$a5.getElement(e,d);if(!c){continue}if(c.getName()==f){return c.getMaterial()}}}return null},getLeafChunkMap:function(){this.createLocalLeafMeshMap();return this.$a5},addChlidMesh:function(a){a.setParentTerrain(this.$x5);a.setChunkSize(this.$94,this.$84);this.$l.push(a)},createLeafMesh:function(o,e,l,t,u){var f=new okVec3(-100000,-100000,-100000);var v=new okVec3(100000,100000,100000);var p=new okTerrainMesh(this.rc);p.setParentTerrain(this.$x5);p.setName("chunk_"+o.toString()+"_"+e.toString());p.setGlobalIndex(o,e);p.setChunkSize(this.$94,this.$84);p.setTerrainSize(this.$Q4,this.$P4);p.setGridSpace(this.$J3);this.$l.push(p);var q=new Array;for(var k=0;k<this.$84;++k){for(var n=0;n<this.$94;++n){var d=o*(this.$94-1)+n;var m=e*(this.$84-1)+k;var c=d+m*this.$Q4;var s=u[c];var h=d*this.$J3.x;var a=m*this.$J3.y;q.push(h);q.push(a);q.push(s);v=okVec3Min(v,new okVec3(h,a,s));f=okVec3Max(f,new okVec3(h,a,s))}}p.setBoundingBox(v,f);l.set(v.x,v.y,v.z);t.set(f.x,f.y,f.z);p.createAttribute("Position",q.length,q,35044)},createChildMesh:function(l,a,h,o,e,q,s){var c=new okVec3(-100000,-100000,-100000);var u=new okVec3(100000,100000,100000);var p=new okTerrainTile(this.rc);p.setParentTerrain(this.$x5);p.setGlobalIndex(l,a);p.setWorldMapSize(this.$15,this.$Z4);p.setTerrainSize(this.$Q4,this.$P4);p.setChunkSize(this.$94,this.$84);p.setGridSpace(this.$J3);this.$l.push(p);for(var k=0;k<2;++k){for(var f=0;f<2;++f){var m=l*2+k;var t=a*2+f;var d=new okVec3;var n=new okVec3;if(e>=q-1){p.createLeafMesh(m,t,d,n,s)}else{p.createChildMesh(m,t,d,n,e+1,q,s)}u=okVec3Min(u,d);c=okVec3Max(c,n)}}p.setBoundingBox(u,c);h.set(u.x,u.y,u.z);o.set(c.x,c.y,c.z)},detectCollision:function(e){for(var c=0;c<this.$l.length;++c){var d=this.$l[c];var a=d.getBoundingBox();if(e.x>=a.vMin.x&&e.x<=a.vMax.x&&e.y>=a.vMin.y&&e.y<=a.vMax.y){return d.detectCollision(e)}}},computeNormal:function(){this.createLocalLeafMeshMap();var a=this.$a5.getOneDimLength();var f=this.$a5.getTwoDimLength();for(var e=0;e<a;++e){for(var d=0;d<f;++d){var c=this.$a5.getElement(e,d);if(!c){continue}c.computeNormal();c.fixNormal(this.$a5,new okVec2(e,d))}}},fixNormal:function(e){var s=this.$I3.x;var q=this.$I3.y;var l=e.getElement(s-1,q);if(l&&l.getState()==3){l.createLocalLeafMeshMap();var f=l.$a5.getOneDimLength();var u=l.$a5.getTwoDimLength();for(var p=0;p<u;++p){var t=l.$a5.getElement(f-1,p);var k=this.$a5.getElement(0,p);k.fixLeftNormal(t)}}var z=e.getElement(s+1,q);if(z&&z.getState()==3){z.createLocalLeafMeshMap();var f=z.$a5.getOneDimLength();var u=z.$a5.getTwoDimLength();for(var p=0;p<u;++p){var v=z.$a5.getElement(0,p);var k=this.$a5.getElement(f-1,p);v.fixLeftNormal(k)}}var n=e.getElement(s,q-1);if(n&&n.getState()==3){n.createLocalLeafMeshMap();var f=n.$a5.getOneDimLength();var u=n.$a5.getTwoDimLength();for(var p=0;p<f;++p){var d=n.$a5.getElement(p,u-1);var k=this.$a5.getElement(p,0);k.fixTopNormal(d)}}var a=e.getElement(s,q+1);if(a&&a.getState()==3){a.createLocalLeafMeshMap();var f=a.$a5.getOneDimLength();var u=a.$a5.getTwoDimLength();for(var p=0;p<f;++p){var y=a.$a5.getElement(p,0);var k=this.$a5.getElement(p,u-1);y.fixTopNormal(k)}}var o=e.getElement(s-1,q-1);if(o&&o.getState()==3&&n&&n.getState()==3&&l&&l.getState()==3){this.createLocalLeafMeshMap();var f=this.$a5.getOneDimLength();var u=this.$a5.getTwoDimLength();var k=this.$a5.getElement(0,0);var d=n.$a5.getElement(0,u-1);var t=l.$a5.getElement(f-1,0);var x=o.$a5.getElement(f-1,u-1);k.fixTopLeftNormal(d,t,x)}if(n&&n.getState()==3){var c=new Array;var f=n.$a5.getOneDimLength();var u=n.$a5.getTwoDimLength();for(var p=0;p<f;++p){c.push(new okVec2(p,u-1))}n.createAttributeArrayBuffer("Normal",c)}if(l&&l.getState()==3){var c=new Array;var f=l.$a5.getOneDimLength();var u=l.$a5.getTwoDimLength();for(var p=0;p<u;++p){c.push(new okVec2(f-1,p))}l.createAttributeArrayBuffer("Normal",c)}if(a&&a.getState()==3){var c=new Array;var f=a.$a5.getOneDimLength();var u=a.$a5.getTwoDimLength();for(var p=0;p<f;++p){c.push(new okVec2(p,0))}a.createAttributeArrayBuffer("Normal",c)}if(z&&z.getState()==3){var c=new Array;var f=z.$a5.getOneDimLength();var u=z.$a5.getTwoDimLength();for(var p=0;p<u;++p){c.push(new okVec2(0,p))}z.createAttributeArrayBuffer("Normal",c)}if(o&&o.getState()==3){var c=new Array;var f=o.$a5.getOneDimLength();var u=o.$a5.getTwoDimLength();c.push(new okVec2(f-1,u-1));o.createAttributeArrayBuffer("Normal",c)}},distributeAttribute:function(h,d){this.createLocalLeafMeshMap();var a=this.$a5.getOneDimLength();var k=this.$a5.getTwoDimLength();for(var f=0;f<a;++f){for(var e=0;e<k;++e){var c=this.$a5.getElement(f,e);if(!c){continue}c.distributeAttribute(h,d)}}},createLocalLeafMeshMap:function(){var a=this.$l;var c=new Array;while(1){for(var k=0;k<a.length;++k){var f=a[k];for(var h=0;h<f.$l.length;h++){c.push(f.$l[h])}}if(c.length==0){break}a=c;c=[]}var d=0;var l=0;this.$a5.clear();if(a.length>0){var e=a[0].getGlobalIndex();d=e.x;l=e.y}for(var k=0;k<a.length;++k){var f=a[k];var e=f.getGlobalIndex();var n=e.x-d;var m=e.y-l;this.$a5.addElement(n,m,f)}},loadTextureFromXml:function(n,z){this.createLocalLeafMeshMap();var f=this.$a5.getElement(0,0);var t=f.getGlobalIndex();var l=t.x;var q=t.y;var h=(z[14]-z[2])/(z[12]-z[0]);var y=(z[15]-z[3])/(z[13]-z[1]);var a=z[12]/(this.$94-1);var e=z[13]/(this.$84-1);var A=z[0]/(this.$94-1);var d=z[1]/(this.$84-1);for(var v=A;v<a;++v){for(var u=d;u<e;++u){var m=this.$a5.getElement(v-l,u-q);if(!m){continue}var x=(v*(this.$94-1)+z[0])*h+z[2];var k=(u*(this.$84-1)+z[1])*y+z[3];var c=new Array;for(var w=0;w<this.$84;++w){for(var o=0;o<this.$94;++o){var p=(w*this.$94+o)*2;c[p]=x+o*h;c[p+1]=k+w*y}}m.createAttribute(n,c.length,c);var s=m.getMaterial();s.$03=m.$x5;s.setEmissive(OAK.VEC3_ZERO);s.setAmbient(0.01,0.01,0.01);s.setDiffuse(0.976471,0.990196,0.901961);s.setSpecular(0.01,0.01,0.01);s.setTextureCoord(0,n)}}},cullByFrustum:function(f,d,a,h){if(a.collideAABBox(this.getBoundingBox())==0){return}for(var c=0;c<this.$l.length;++c){var e=this.$l[c];if(!e){continue}e.cullByFrustum(f,d,a,h)}},createAttributeArrayBuffer:function(k,n){this.createLocalLeafMeshMap();var l=this.$a5.getOneDimLength();var h=this.$a5.getTwoDimLength();for(var f=0;f<l;++f){for(var e=0;e<h;++e){var c=this.$a5.getElement(f,e);if(!c){continue}if(!n||n.length==0){c.createAttributeArrayBuffer(k)}else{for(var d=0;d<n.length;++d){var a=n[d];if(f==a.x&&e==a.y){c.createAttributeArrayBuffer(k);break}}}}}}};function okTerrainEntity(a){okBaseCall(this,a);this.$S4=32;this.$94;this.$84;this.$15;this.$Z4;this.$Q4;this.$P4;this.$O4;this.$N4;this.$05;this.$J3=new okVec2;this.$p=new Array;this.$G1=new Array;this.$47=new okArray2D;this.$X=new Object;this.$f2=false;this.$H2=false}okExtend(okTerrainEntity,okVisibleEntity);okTerrainEntity.prototype.clear=function(){var e=this.$L5;if(this.$X){okA._object(this.$X)}this.$X=okA.object();for(var d=0;d<this.$p.length;++d){var a=this.$p[d];a.releaseBuffer();delete a}for(var d=0;d<this.$G1.length;d++){var c=this.$G1[d];c.clear()}okBaseCall(this,"clear")};okTerrainEntity.prototype.setChunkSize=function(a,d){if(a>129||d>129||a<3||d<3){return false}if(!okIsInt(Math.log(a-1)/Math.log(2))){return false}if(!okIsInt(Math.log(d-1)/Math.log(2))){return false}this.$94=a;this.$84=d;var c;if(this.$H2==false||this.$H2==null){c="Default"}else{c="Wireframe"}this.createChunkIndexBufferArray(a,d,c);return true};okTerrainEntity.prototype.setWorldMapSize=function(a,c){this.$15=a;this.$Z4=c};okTerrainEntity.prototype.setTerrainSize=function(a,d){this.$O4=a;this.$N4=d;var c=Math.ceil(Math.log(a-1)/Math.log(2));var e=Math.ceil(Math.log(d-1)/Math.log(2));this.$Q4=Math.pow(2,c)+1;this.$P4=Math.pow(2,e)+1;this.setWorldMapSize(this.$Q4,this.$P4)};okTerrainEntity.prototype.setGridSpacing=function(a,c){this.$J3.set(a,c)};okTerrainEntity.prototype.getMaterialMap=function(){var e=new Object;for(var f=0;f<this.$G1.length;++f){var h=this.$G1[f];if(!h){continue}var a=h.getLeafChunkMap();var o=a.getOneDimLength();var k=a.getTwoDimLength();for(var d=0;d<o;++d){for(var c=0;c<k;++c){var l=a.getElement(d,c);e[l.getName()]=l.getMaterial()}}}return e};okTerrainEntity.prototype.getMaterial=function(d){for(var c=0;c<this.$G1.length;++c){var a=this.$G1[c];if(!a){continue}var e=a.getMaterial(d);if(e){return e}}return NULL};okTerrainEntity.prototype.loadAttribute=function(m,o){o=this._fillData(m,o);if(m=="Height"){this.rotX(1,-90);this.$f2=false;this.$05=Math.log((this.$15-1)/(this.$94-1))/Math.log(2);var n=(this.$Q4-1)/(this.$15-1);var k=(this.$P4-1)/(this.$Z4-1);var d=new okVec3(10000,10000,10000);var l=new okVec3(-10000,-10000,-10000);for(var f=0;f<n;++f){for(var e=0;e<k;++e){var a=new okVec3;var c=new okVec3;this.createWorldMap(f,e,0,a,c,o);d=okVec3Min(d,a);l=okVec3Max(l,c)}}this.$J2.set(d,l);this.$f2=true}else{if(m=="Normal"||m=="Texcoord1"){for(var f=0;f<this.$G1.length;++f){var h=this.$G1[f];if(!h){continue}h.distributeAttribute(m,o)}}}};okTerrainEntity.prototype._fillData=function(h,l){var a=this.$Q4;var m=this.$P4;var f=this.$O4;var k=this.$N4;if(h=="Height"&&l.length<a*m){var e=new Array;for(var c=0;c<m;++c){for(var d=0;d<a;++d){if(d<f&&c<k){e.push(l[c*f+d])}else{e.push(0)}}}return e}else{if(h=="Normal"&&l.length<a*m*3){var e=new Array;for(var c=0;c<m;++c){for(var d=0;d<a;++d){if(d<f&&c<k){e.push(l[(c*f+d)*3+0]);e.push(l[(c*f+d)*3+1]);e.push(l[(c*f+d)*3+2])}else{e.push(0);e.push(0);e.push(1)}}}return e}else{if(h=="Texcoord1"&&l.length<a*m*2){var e=new Array;for(var c=0;c<m;++c){for(var d=0;d<a;++d){if(d<f&&c<k){e.push(l[(c*f+d)*2+0]);e.push(l[(c*f+d)*2+1])}else{e.push(0);e.push(0)}}}return e}else{return l}}}};okTerrainEntity.prototype.computeNormal=function(){var f=this.$47.getOneDimLength();var a=this.$47.getTwoDimLength();for(var e=0;e<f;++e){for(var c=0;c<a;++c){var d=this.$47.getElement(e,c);if(!d){continue}d.computeNormal();d.fixNormal(this.$47)}}for(var e=0;e<f;++e){for(var c=0;c<a;++c){var d=this.$47.getElement(e,c);if(!d){continue}d.createAttributeArrayBuffer("Normal")}}};okTerrainEntity.prototype.enableWireframe=function(a){this.$H2=a};okTerrainEntity.prototype.getState=function(){if(!this.$f2){return 1}else{return 4}};okTerrainEntity.prototype.cullByFrustum=function(c){if(c.collideAABBox(this.getBoundingBox(1))==0){return 0}for(var f=0;f<this.$G1.length;++f){var e=this.$G1[f];var d=e.getBoundingBox();d.transformMat43(this.$g5);if(c.collideAABBox(d)==0){continue}if(e.getState()==1){var k=this;var h=okGenXmlHttpRequest();var a=this.$57.$z6.getTerrainUrl()+"/"+e.getUrl();h.open("GET",a,true);if(okIsIE()){h.onreadystatechange=function(){if(h.readyState==4){if(h.status==200||h.status==0){okResourceParser.loadWorldMapFromXml(k,okParseXML(h.responseText));k.$57.dirtyEntity(k)}}}}else{h.onload=function(){okResourceParser.loadWorldMapFromXml(k,okParseXML(h.responseText));k.$57.dirtyEntity(k)}}h.send();e.setState(2)}}return 1};okTerrainEntity.prototype.load=function(c){this.rotX(1,-90);this.$f2=false;c=this.$57.$z6.getTerrainUrl()+"/"+c;var a=okGenXmlHttpRequest();a.open("GET",c,false);a.send();okResourceParser.loadTerrainFromXml(this,okParseXML(a.responseText),this.$H2);this.$f2=true};okTerrainEntity.prototype.getWorldMaps=function(){return this.$G1};okTerrainEntity.prototype.getWorldMapMap=function(){return this.$47};okTerrainEntity.prototype.createWorldMap=function(n,d,f,k,q,s){if(f>this.$05){return}var o=new okTerrainTile(this.$L5.rc);o.setGlobalIndex(n,d);this.addWorldMap(o);o.setWorldMapSize(this.$15,this.$Z4);o.setTerrainSize(this.$Q4,this.$P4);o.setChunkSize(this.$94,this.$84);o.setGridSpace(this.$J3);var l=new okVec3(-100000,-100000,-100000);var a=new okVec3(100000,100000,100000);if(this.$05==0){o.createLeafMesh(n,d,a,l,s)}else{for(var m=0;m<2;++m){for(var h=0;h<2;++h){var t=n*2+m;var e=d*2+h;var p=new okVec3;var c=new okVec3;if(this.$05==1){o.createLeafMesh(t,e,p,c,s)}else{o.createChildMesh(t,e,p,c,f+1,this.$05,s)}a=okVec3Min(a,p);l=okVec3Max(l,c)}}}o.setBoundingBox(a,l);k.set(a.x,a.y,a.z);q.set(l.x,l.y,l.z);o.setState(3)};okTerrainEntity.prototype.addWorldMap=function(c){c.setParentTerrain(this);c.setChunkSize(this.$94,this.$84);this.$G1.push(c);var a=c.getGlobalIndex();this.$47.addElement(a.x,a.y,c)};okTerrainEntity.prototype.addTexture=function(a){};okTerrainEntity.prototype.createChunkIndexBufferArray=function(t,C,m){var d;var x=1;for(var B=0;;++B){x=x*2;if(x>=t-1){d=B+1;break}}var F=new Array;for(var z=0;z<=d;++z){var q=1;for(var B=0;B<z;B++){q*=2}var E=(t-1)/q;if(z==0){var B=0;var A=0;var c=new Array;c[0]=(B+(A+1)*t)*E;c[1]=(B+A*t)*E;c[2]=((B+1)+A*t)*E;this._addToIndexArrayList(F,m,c,0);var a=new Array;a[0]=(B+(A+1)*t)*E;a[1]=((B+1)+A*t)*E;a[2]=((B+1)+(A+1)*t)*E;this._addToIndexArrayList(F,m,a,0);var c=new Array;c[0]=(B+(A+1)*t)*E;c[1]=(B+A*t)*E;c[2]=((B+1)+(A+1)*t)*E;this._addToIndexArrayList(F,m,c,1);var a=new Array;a[0]=(B+A*t)*E;a[1]=((B+1)+A*t)*E;a[2]=((B+1)+(A+1)*t)*E;this._addToIndexArrayList(F,m,a,1)}else{for(var o=0;o<16;++o){var p=(z<<4)+o;var s=0;var u=0;var f=q;var n=q;var v=o&1;var y=(o>>1)&1;var H=(o>>2)&1;var e=(o>>3)&1;if(v==1){s=1}if(H==1){f=q-1}if(y==1){u=1}if(e==1){n=q-1}for(var B=s;B<f;++B){for(var A=u;A<n;++A){if((B+A)%2==0){var c=new Array;c[0]=(B+A*t)*E;c[1]=((B+1)+(A+1)*t)*E;c[2]=(B+(A+1)*t)*E;this._addToIndexArrayList(F,m,c,p);var a=new Array;a[0]=(B+A*t)*E;a[1]=((B+1)+A*t)*E;a[2]=((B+1)+(A+1)*t)*E;this._addToIndexArrayList(F,m,a,p)}else{var c=new Array;c[0]=(B+A*t)*E;c[1]=((B+1)+A*t)*E;c[2]=(B+(A+1)*t)*E;this._addToIndexArrayList(F,m,c,p);var a=new Array;a[0]=(B+(A+1)*t)*E;a[1]=((B+1)+A*t)*E;a[2]=((B+1)+(A+1)*t)*E;this._addToIndexArrayList(F,m,a,p)}}}if(y==1){var A=0;for(var B=0;B<q;B+=2){if(B!=0||v==0){var c=new Array;c[0]=(B+A*t)*E;c[1]=((B+1)+(A+1)*t)*E;c[2]=(B+(A+1)*t)*E;this._addToIndexArrayList(F,m,c,p)}var a=new Array;a[0]=(B+A*t)*E;a[1]=((B+2)+A*t)*E;a[2]=((B+1)+(A+1)*t)*E;this._addToIndexArrayList(F,m,a,p);if(B!=q-2||H==0){var G=new Array;G[0]=((B+1)+(A+1)*t)*E;G[1]=((B+2)+A*t)*E;G[2]=((B+2)+(A+1)*t)*E;this._addToIndexArrayList(F,m,G,p)}}}if(e==1){var A=q-1;for(var B=0;B<q;B+=2){if(B!=0||v==0){var c=new Array;c[0]=(B+A*t)*E;c[1]=((B+1)+A*t)*E;c[2]=(B+(A+1)*t)*E;this._addToIndexArrayList(F,m,c,p)}var a=new Array;a[0]=(B+(A+1)*t)*E;a[1]=((B+1)+A*t)*E;a[2]=((B+2)+(A+1)*t)*E;this._addToIndexArrayList(F,m,a,p);if(B!=q-2||H==0){var G=new Array;G[0]=((B+1)+A*t)*E;G[1]=((B+2)+A*t)*E;G[2]=((B+2)+(A+1)*t)*E;this._addToIndexArrayList(F,m,G,p)}}}if(v==1){var B=0;for(var A=0;A<q;A+=2){if(A!=0||y==0){var c=new Array;c[0]=(B+A*t)*E;c[1]=((B+1)+A*t)*E;c[2]=((B+1)+(A+1)*t)*E;this._addToIndexArrayList(F,m,c,p)}var a=new Array;a[0]=(B+A*t)*E;a[1]=((B+1)+(A+1)*t)*E;a[2]=(B+(A+2)*t)*E;this._addToIndexArrayList(F,m,a,p);if(A!=q-2||e==0){var G=new Array;G[0]=(B+(A+2)*t)*E;G[1]=((B+1)+(A+1)*t)*E;G[2]=((B+1)+(A+2)*t)*E;this._addToIndexArrayList(F,m,G,p)}}}if(H==1){var B=q-1;for(var A=0;A<q;A+=2){if(A!=0||y==0){var c=new Array;c[0]=(B+A*t)*E;c[1]=((B+1)+A*t)*E;c[2]=(B+(A+1)*t)*E;this._addToIndexArrayList(F,m,c,p)}var a=new Array;a[0]=(B+(A+1)*t)*E;a[1]=((B+1)+A*t)*E;a[2]=((B+1)+(A+2)*t)*E;this._addToIndexArrayList(F,m,a,p);if(A!=q-2||e==0){var G=new Array;G[0]=(B+(A+2)*t)*E;G[1]=(B+(A+1)*t)*E;G[2]=((B+1)+(A+2)*t)*E;this._addToIndexArrayList(F,m,G,p)}}}}}}for(var B=0;B<F.length;++B){var D=F[B];if(!D){continue}var k=new okArrayBuffer(this.$L5.rc);k.createBuffer(34963,5123,35044,new Uint16Array(D));this.$p[B]=k}};okTerrainEntity.prototype._addToIndexArrayList=function(f,d,l,a){if(!f[a]){f[a]=new Array}var e=new Array;if(d=="Wireframe"){var m=l[0];var k=l[1];var h=l[2];e.push(m,k,k,h,h,m)}else{var m=l[0];var k=l[1];var h=l[2];e.push(m,k,h)}for(var c=0;c<e.length;c++){f[a].push(e[c])}};okTerrainEntity.prototype.createMaterial=function(c){var a="EntityMtrl"+this.$56+c;this.$X[c]=this.$L5.createMaterial(a)};okTerrainEntity.prototype.getBoundingBox=function(d){if(d==2){if(this.$o2){if(this.$G1.length==0){this.$v5.setMin(OAK.VEC3_ZERO);this.$v5.setMax(OAK.VEC3_ZERO);this.$v5.setMat(this.$g5)}else{var e=okA.aabbox();for(var c=0;c<this.$G1.length;++c){var a=this.$G1[c];if(c==0){a.getBoundingBox().clone(e)}else{e=e.union(a.getBoundingBox())}}this.$v5.setMin(e.vMin);this.$v5.setMax(e.vMax);this.$v5.setMat(this.$g5);this.$o2=false;okA._aabbox(e)}}return this.$v5}else{if(this.$S1){if(this.$G1.length==0){this.$J2.set(OAK.VEC3_ZERO,OAK.VEC3_ZERO)}else{for(var c=0;c<this.$G1.length;++c){var a=this.$G1[c];if(c==0){a.getBoundingBox().clone(this.$J2)}else{this.$J2=this.$J2.union(a.getBoundingBox())}}this.$J2.transformMat(this.$g5);this.$S1=false}}return this.$J2}};okTerrainEntity.prototype.detectCollision=function(k){var e=this.getInvMat43();var h=okMat43MulVec3(e,k);for(var d=0;d<this.$G1.length;++d){var c=this.$G1[d];var a=c.getBoundingBox();if(h.x>=a.vMin.x&&h.x<=a.vMax.x&&h.y>=a.vMin.y&&h.y<=a.vMax.y){var f=c.detectCollision(h);h.z=f;return okMat43MulVec3(this.getMat43(),h)}}return null};okTerrainEntity.prototype.genRenderBatch=function(D,f){if(this.$G1.length==0){return}var O=f.$N2;var d=O.getPos();d=okMat43MulVec3(this.$g5.inverse(),d);var c=new okFrustum();var h=new okMat4();okMat43Mul(this.$g5.inverse(),O.$b5).toMat4(h);var t=h.inverse();c.setByViewProjMat(okMat4Mul(O.$k5,t));var U=new okArray2D;for(var T=0;T<this.$G1.length;++T){var o=this.$G1[T];if(o.getState()==3){o.cullByFrustum(U,O,c,d)}}var q=false;var K=U.getOneDimLength();var J=U.getTwoDimLength();while(!q){q=true;for(var T=0;T<K;++T){for(var S=0;S<J;++S){var v=U.getElement(T,S);if(!v){continue}v.clearFillCrashFlag();var F=v.getGlobalIndex().x;var s=v.getGlobalIndex().y;var Q=U.getElement(F-1,s);if(Q){if(Q.getCurrentLOD()-v.getCurrentLOD()<=-2){Q.setCurrentLOD(Q.getCurrentLOD()+1);q=false}else{if(Q.getCurrentLOD()-v.getCurrentLOD()==-1){v.$45=true}}}var P=U.getElement(F,s-1);if(P){if(P.getCurrentLOD()-v.getCurrentLOD()<=-2){P.setCurrentLOD(P.getCurrentLOD()+1);q=false}else{if(P.getCurrentLOD()-v.getCurrentLOD()==-1){v.$O6=true}}}var N=U.getElement(F+1,s);if(N){if(N.getCurrentLOD()-v.getCurrentLOD()<=-2){N.setCurrentLOD(N.getCurrentLOD()+1);q=false}else{if(N.getCurrentLOD()-v.getCurrentLOD()==-1){v.$M5=true}}}var M=U.getElement(F,s+1);if(M){if(M.getCurrentLOD()-v.getCurrentLOD()<=-2){M.setCurrentLOD(M.getCurrentLOD()+1);q=false}else{if(M.getCurrentLOD()-v.getCurrentLOD()==-1){v.$M2=true}}}}}}var H=new Object;var B=new Object;var I=this.$L5;var K=U.getOneDimLength();var J=U.getTwoDimLength();for(var T=0;T<K;++T){for(var S=0;S<J;++S){var v=U.getElement(T,S);if(!v){continue}var e=v.getMaterial();e.enableWireframe(this.$H2);var E=v.computePosInIndexArray();var a=this.$p[E];if(!e.isWireframeEnabled()){v.$H.Default=a}else{v.$H.Wireframe=a}var w=this.$57.$z6.$w6;var p=okA.renderBatch();p.$a=okA.object();var W=v.$8;var z=okA.array();for(var L in W){var u=W[L];var m=L.split("/");var A=0;z.length=0;var n=m.length;for(var R=0;R<n;++R){var V=new okAttribFormat();var C=m[R];z.push(V);p.$a[C]=V;V.$56=C;V.iIdx=R;V.iOffset=A;V.buf=u;switch(C){case"Position":case"Normal":case"Color":case"Texcoord1_Tangent":case"Texcoord1_Binormal":case"Texcoord2_Tangent":case"Texcoord2_Binormal":case"Texcoord3_Tangent":case"Texcoord3_Binormal":case"Texcoord4_Tangent":case"Texcoord4_Binormal":V.$I4=3;A+=3;break;case"Texcoord1":case"Texcoord2":case"Texcoord3":case"Texcoord4":V.$I4=2;A+=2;break;case"BoneIndex":case"BoneWeight":V.$I4=4;A+=4;break;default:}}n=z.length;for(var R=0;R<n;++R){z[R].iStride=A}}okA._array(z);if(e.$I2&&v.$H.Wireframe){p.$25=v.$H.Wireframe;p.$k4=1;p.$l4=0;p.$j4=p.$25.getLength()}else{p.$25=v.$H.Default;p.$k4=4;p.$l4=0;p.$j4=p.$25.getLength()}p.$r5=e;var G=this.getMat4();if(this.$w2){G.m03+=cam.$b5.m03;G.m13+=cam.$b5.m13;G.m23+=cam.$b5.m23}p.$g5=G;p.$i5=this.getNormalMat4();p.$t=this.$u;p.$51=this.$61;p.$o1=this.$p1;var l=new okAABBox();v.getBoundingBox().clone(l);l.transformMat(this.$g5);p.$L2=l;p.$s2=this.$s2;p.$u4=this.$u4;D.push(p)}}};function okVideoEntity(a){okBaseCall(this,a);this.$S4=128;this.$t5=new okMesh(this.$L5.rc);this.$u5=new okMaterial();this.$u5.$03=this;this.$u5.setTextureWrap(0,33071);this.$K2=new okAABBox();this.$35=new Date();this._init()}okExtend(okVideoEntity,okVisibleEntity);okVideoEntity.prototype.clear=function(){var a=this.$L5;this.$t5.clear();this.$u5.clear();this.$u5.setTextureWrap(0,33071);this.$K2=new okAABBox();okBaseCall(this,"clear")};okVideoEntity.prototype.getState=function(){var c=this.$u5.getTextureResourceId(0);if(c==-1){return 1}var a=this.$L5.getResourceState(c);if(a!=5){return 1}return 4};okVideoEntity.prototype._init=function(){var a=new Array;a.push(-1);a.push(-1);a.push(0);a.push(0);a.push(0);a.push(1);a.push(1);a.push(-1);a.push(0);a.push(0);a.push(0);a.push(1);a.push(-1);a.push(1);a.push(0);a.push(0);a.push(0);a.push(1);a.push(1);a.push(1);a.push(0);a.push(0);a.push(0);a.push(1);this.$t5.deleteAttribute("Position/Normal");this.$t5.createAttribute("Position/Normal",a.length,a,35044);var d=new Array;d.push(0);d.push(1);d.push(1);d.push(1);d.push(0);d.push(0);d.push(1);d.push(0);this.$t5.deleteAttribute("Texcoord1");this.$t5.createAttribute("Texcoord1",d.length,d,35044);this.$K2.set(new okVec3(-1,-1,-0.001),new okVec3(1,1,0.001));this.$S1=true;this.$o2=true;this.$U1=true;var c=new Array;c.push(1);c.push(2);c.push(0);c.push(1);c.push(3);c.push(2);this.$t5.deleteIndex("Default");this.$t5.createIndex("Default",c.length,c,35044,4);this.$u5.$23=1;this.$u5.$I2=false;this.$u5.$V6=new okVec3(0,0,0);this.$u5.$Q6=new okVec3(0,0,0);this.$u5.$U6=new okVec3(1,1,1);this.$u5.$17=new okVec3(0,0,0);this.$u5.enableDynamicLighting(false);this.$u5.setTextureType(0,3553);this.$u5.setTextureCoord(0,"Texcoord1")};okVideoEntity.prototype.setScreenBoard=function(a,k,c,e,f){f=f?f:0;var d=new Array;d.push(a);d.push(k);d.push(f);d.push(0);d.push(0);d.push(1);d.push(a+c);d.push(k);d.push(f);d.push(0);d.push(0);d.push(1);d.push(a);d.push(k+e);d.push(f);d.push(0);d.push(0);d.push(1);d.push(a+c);d.push(k+e);d.push(f);d.push(0);d.push(0);d.push(1);this.$t5.deleteAttribute("Position/Normal");this.$t5.createAttribute("Position/Normal",d.length,d,35044);this.$K2.set(new okVec3(a,k,f-0.001),new okVec3(a+c,k+e,f+0.001));this.$S1=true;this.$o2=true;this.$U1=true};okVideoEntity.prototype.loadVideo=function(a){this.$u5.setTextureName(0,a)};okVideoEntity.prototype.getVideo=function(){var e=this.$L5;var c=this.$u5;var f=this.$u5.getTextureResourceId(0);if(f==-1){return null}var d=e.getResource(f);if(!d){return null}var a=d.$37;if(!a){return null}return a};okVideoEntity.prototype.getVideoName=function(){var d=this.$L5;var a=this.$u5;var c=a.getTextureName(0);return c};okVideoEntity.prototype.getVideoTexture=function(){var d=this.$L5;var a=this.$u5;var e=a.getTextureResourceId(0);if(e==-1){return null}var c=d.getResource(e);return c};okVideoEntity.prototype.setTime=function(e){var f=this.$u5.getTextureResourceId(0);var d=this.getVideoTexture();var c=d.$37;if(!c){return}if(e>c.duration*1000){e=c.duration*1000}if(e<0){e=0}function a(){c.currentTime=e/1000;c.removeEventListener("canplaythrough",a,false)}if(c.readyState===0){c.addEventListener("canplaythrough",a,false)}else{a()}};okVideoEntity.prototype.getTime=function(){var a=this.getVideo();if(!a){return -1}return a.currentTime*1000};okVideoEntity.prototype.getVideoLength=function(){var a=this.getVideo();if(!a){return -1}return a.duration*1000};okVideoEntity.prototype.enableMute=function(c){var a=this.getVideo();if(!a){return}a.muted=c};okVideoEntity.prototype.isMute=function(){var a=this.getVideo();if(!a){return true}return a.muted};okVideoEntity.prototype.pause=function(){var a=this.getVideo();if(!a){return}function c(){a.pause();a.removeEventListener("canplaythrough",c,false)}if(a.readyState===0){a.addEventListener("canplaythrough",c,false)}else{c()}};okVideoEntity.prototype.stop=function(){var a=this.getVideo();if(!a){return}var d=this.getVideoLength();function c(){a.pause();a.currentTime=d/1000;a.removeEventListener("canplaythrough",c,false)}if(a.readyState===0){a.addEventListener("canplaythrough",c,false)}else{c()}};okVideoEntity.prototype.play=function(){var a=this.getVideo();if(!a){return}function c(){a.play();a.removeEventListener("canplaythrough",c,false)}if(a.readyState===0){a.addEventListener("canplaythrough",c,false)}else{c()}};okVideoEntity.prototype.getMaterial=function(){return this.$u5};okVideoEntity.prototype.getMesh=function(){return this.$t5};okVideoEntity.prototype.getBoundingBox=function(a){if(a==2){if(this.$o2){this.$v5.setMin(this.$K2.vMin);this.$v5.setMax(this.$K2.vMax);this.$v5.setMat(this.$g5);this.$o2=false}return this.$v5}else{if(this.$S1){this.$K2.clone(this.$J2);this.$J2.transformMat(this.$g5);this.$S1=false}return this.$J2}};okVideoEntity.prototype.genRenderBatch=function(d,m){var a=m.$N2;if(this.$r3>0){var f=a.getPos();var n=(f.x-this.$g5.m03)*(f.x-this.$g5.m03)+(f.y-this.$g5.m13)*(f.y-this.$g5.m13)+(f.z-this.$g5.m23)*(f.z-this.$g5.m23);if(n>this.$r3*this.$r3){return}}var c=this.$L5;var e=this.$t5;var o=this.$u5;var l=okA.renderBatch();var s=o.getTextureResourceId(0);if(s!=-1){var h=c.getResource(s);if(h&&h.isVideoTexture()){curTime=new Date();var q=curTime.getTime()-this.$35.getTime();if(q>=1000/24){this.$35=new Date();h.updateVideoTexture()}}}l.$a=e._getAttribFmt();if(o.$I2&&e.$H.Wireframe){l.$25=e.$H.Wireframe;l.$k4=1;l.$l4=0;l.$j4=l.$25.getLength()}else{l.$25=e.$H.Default;l.$k4=4;l.$l4=0;l.$j4=l.$25.getLength()}l.$r5=o;var k=this.getMat4();if(this.$w2){k.m03+=a.$b5.m03;k.m13+=a.$b5.m13;k.m23+=a.$b5.m23}l.$g5=k;l.$i5=this.getNormalMat4();l.$t=this.$u;l.$51=this.$61;l.$o1=this.$p1;var p=new okAABBox();this.getBoundingBox().clone(p);l.$L2=p;l.$u4=this.$u4;d.push(l)};function okLightEntity(a){okBaseCall(this,a);this.$S4=(4|8|16);this.$G2=true;this.$T6=new okVec3(1,1,1);this.$e3=1;this.$Y1=false;this.$Z6=new okVec3(0.5,0.5,0.5);this.$H4=3;this.$m3=0.06;this.$O=okA.object();this.$O[1]=true;this.$6=okA.array()}okExtend(okLightEntity,okBaseEntity);okLightEntity.prototype.clear=function(){this.$G2=true;this.$T6=new okVec3(1,1,1);this.$e3=1;if(this.$Y1){this.$57.$54-=1}this.$Y1=false;this.$Z6.set(0.5,0.5,0.5);this.$H4=3;this.$m3=0.006;this.$O=okA.object();this.$O[1]=true;this.clearAffectEntity();okBaseCall(this,"clear")};okLightEntity.prototype.addAffectEntity=function(a){this.$6.push(a)};okLightEntity.prototype.removeAffectEntity=function(d){var a=this.$6.length;for(var c=0;c<a;++c){if(this.$6[c]==d){this.$6[c]=this.$6[a-1];this.$6.pop();return}}};okLightEntity.prototype.findAffectEntity=function(d){var a=this.$6.length;for(var c=0;c<a;++c){if(this.$6[c]==d){return true}}return false};okLightEntity.prototype.clearAffectEntity=function(){this.$6.length=0};okLightEntity.prototype.enableVisible=function(a){this.$G2=a};okLightEntity.prototype.isVisible=function(){return this.$G2};okLightEntity.prototype.enableCastShadow=function(a){if(a!=this.$Y1){if(a){this.$57.$54+=1}else{this.$57.$54-=1}this.$Y1=a}};okLightEntity.prototype.isCastShadow=function(){return this.$Y1};okLightEntity.prototype.setShadowColor=function(d,c,a){if(c==null){d.clone(this.$Z6)}else{this.$Z6.set(d,c,a)}};okLightEntity.prototype.setShadowFade=function(a){this.$m3=a};okLightEntity.prototype.getShadowFade=function(){return this.$m3};okLightEntity.prototype.setColor=function(d,c,a){if(c==null){d.x=(d.x>1?1:d.x);d.x=(d.x<0?0:d.x);d.y=(d.y>1?1:d.y);d.y=(d.y<0?0:d.y);d.z=(d.z>1?1:d.z);d.z=(d.z<0?0:d.z);d.clone(this.$T6)}else{d=(d>1?1:d);d=(d<0?0:d);c=(c>1?1:c);c=(c<0?0:c);a=(a>1?1:a);a=(a<0?0:a);this.$T6.set(d,c,a)}};okLightEntity.prototype.getColor=function(){return this.$T6.clone()};okLightEntity.prototype.setIntensity=function(a){this.$e3=(a<0?0:a)};okLightEntity.prototype.getIntensity=function(){return this.$e3};okLightEntity.prototype.isAffectEntity=function(a){return true};okVisibleEntity.prototype.enableLightGroup=function(a,c){this.$O[a]=c};okVisibleEntity.prototype.isLightGroupEnabled=function(a){return this.$O[a]==true};function okDctLightEntity(a){okBaseCall(this,a);this.$S4=4}okExtend(okDctLightEntity,okLightEntity);okDctLightEntity.prototype.clear=function(){okBaseCall(this,"clear")};okDctLightEntity.prototype.setLightDir=function(e,d,c){var a=okA.vec3();if(d==null){a.x=-e.x;a.y=-e.y;a.z=-e.z}else{a.x=-e;a.y=-d;a.z=-c}this.setDir(3,a);okA._vec3(a)};okDctLightEntity.prototype.getLightDir=function(){var a=this.$g5.getColumn(2);a.x=-a.x;a.y=-a.y;a.z=-a.z;a.normalize(true);return a};function okPointLightEntity(a){okBaseCall(this,a);this.$S4=8;this.$j3=10}okExtend(okPointLightEntity,okLightEntity);okPointLightEntity.prototype.clear=function(){this.$j3=10;okBaseCall(this,"clear")};okPointLightEntity.prototype.setRange=function(a){this.$j3=a;this.$S1=true;this.$o2=true;this.$U1=true;this.$57.dirtyEntity(this)};okPointLightEntity.prototype.getRange=function(){return this.$j3};okPointLightEntity.prototype.isAffectEntity=function(h){var a=h.getBoundingSphereCenter();var e=this.$g5.getColumn(3);var c=(a.x-e.x)*(a.x-e.x)+(a.y-e.y)*(a.y-e.y)+(a.z-e.z)*(a.z-e.z);var f=this.$j3+h.getBoundingSphereRadius();okA._vec3(a);okA._vec3(e);return(c<=f*f)};function okSpotLightEntity(a){okBaseCall(this,a);this.$S4=16;this.$g5.identity();this.$g5.setColumn(0,1,0,0);this.$g5.setColumn(1,0,0,-1);this.$g5.setColumn(2,0,1,0);this.$j3=10;this.$d3=Math.PI*60/180;this.$h3=Math.PI*75/180;this.$A3=new okFrustum();this.$c2=true}okExtend(okSpotLightEntity,okLightEntity);okSpotLightEntity.prototype.clear=function(){this.$j3=10;this.$d3=Math.PI*60/180;this.$h3=Math.PI*75/180;this.$c2=true;okBaseCall(this,"clear")};okSpotLightEntity.prototype.setLightDir=function(e,d,c){var a=okA.vec3();if(d==null){a.x=-e.x;a.y=-e.y;a.z=-e.z}else{a.x=-e;a.y=-d;a.z=-c}this.setDir(3,a);okA._vec3(a)};okSpotLightEntity.prototype.getLightDir=function(){var a=this.$g5.getColumn(2);a.x=-a.x;a.y=-a.y;a.z=-a.z;a.normalize(true);return a};okSpotLightEntity.prototype.setRange=function(a){this.$j3=a;this.$S1=true;this.$o2=true;this.$U1=true;this.$c2=true;this.$57.dirtyEntity(this)};okSpotLightEntity.prototype.getRange=function(){return this.$j3};okSpotLightEntity.prototype.setInnerCone=function(a){var c=a*Math.PI/180;this.$d3=c;this.$c2=true};okSpotLightEntity.prototype.getInnerCone=function(){return this.$d3*180/Math.PI};okSpotLightEntity.prototype.setOuterCone=function(a){var c=a*Math.PI/180;this.$h3=c;this.$c2=true};okSpotLightEntity.prototype.getOuterCone=function(){return this.$h3*180/Math.PI};okSpotLightEntity.prototype.getLightFrustum=function(){if(this.$c2){var c=okMat4Proj(this.$h3*180/Math.PI,1,0.01,this.$j3);var d=this.getInvMat4();var a=okMat4Mul(c,d);this.$A3.setByViewProjMat(a);this.$c2=false}return this.$A3};okSpotLightEntity.prototype.isAffectEntity=function(a){return(this.getLightFrustum().collideAABBox(a.getBoundingBox())!=0)};okSpotLightEntity.prototype.dirtyMatFunc=function(){this.$c2=true};function okConfigEntity(a){okBaseCall(this,a);this.$S4=512;this.$07=new okVec3(0.3,0.3,0.3);this.$Y6=new okVec3(0.3,0.3,0.3);this.$t2=true;this.$b2=false;this.$W6=new okVec3(1,1,1);this.$73=3.5;this.$93=0.1;this.$83=1}okExtend(okConfigEntity,okBaseEntity);okConfigEntity.prototype.setSkyColor=function(c,a,d){if(fY!=null){this.$07.set(c,a,d)}else{c.clone(this.$07)}};okConfigEntity.prototype.getSkyColor=function(){return this.$07};okConfigEntity.prototype.setGroundColor=function(c,a,d){if(fY!=null){this.$Y6.set(c,a,d)}else{c.clone(this.$Y6)}};okConfigEntity.prototype.getGroundColor=function(){return this.$Y6};okConfigEntity.prototype.enableShadow=function(a){this.$t2=a};okConfigEntity.prototype.isShadowEnabled=function(){return this.$t2};okConfigEntity.prototype.enableFog=function(c,a){this.$b2=a};okConfigEntity.prototype.isFogEnabled=function(a){return this.$b2};okConfigEntity.prototype.setFogColor=function(e,c,a,d){if(fY==null){this.$W6.x=c.x;this.$W6.y=c.y;this.$W6.z=c.z}else{this.$W6.x=c;this.$W6.y=a;this.$W6.z=d}};okConfigEntity.prototype.getFogColor=function(a){var c=okA.vec3();return this.$W6.clone(c)};okConfigEntity.prototype.setFogDistanceNear=function(c,a){this.$93=Math.max(0.001,a)};okConfigEntity.prototype.setFogDistanceFar=function(c,a){this.$83=Math.max(0.001,a)};okConfigEntity.prototype.getFogDistanceNear=function(a){return this.$93};okConfigEntity.prototype.getFogDistanceFar=function(a){return this.$83};okConfigEntity.prototype.setFogDensity=function(c,a){this.$73=a};okConfigEntity.prototype.getFogDensity=function(a){return this.$73};function okSceneNode(){this.$w5=null;this.$D4=-1;this.$o=[null,null,null,null,null,null,null,null];this.$64=0;this.$J2=okA.aabbox();this.$n=[okA.aabbox(),okA.aabbox(),okA.aabbox(),okA.aabbox(),okA.aabbox(),okA.aabbox(),okA.aabbox(),okA.aabbox()];this.$z=okA.array();this.$x4=0}okSceneNode.prototype={clear:function(){this.$w5=null;this.$D4=-1;for(var a=0;a<8;++a){if(this.$o[a]){this.deleteChild(a)}}this.$J2.set(OAK.VEC3_ZERO,OAK.VEC3_ZERO);this.$n[0].set(OAK.VEC3_ZERO,OAK.VEC3_ZERO);this.$n[1].set(OAK.VEC3_ZERO,OAK.VEC3_ZERO);this.$n[2].set(OAK.VEC3_ZERO,OAK.VEC3_ZERO);this.$n[3].set(OAK.VEC3_ZERO,OAK.VEC3_ZERO);this.$n[4].set(OAK.VEC3_ZERO,OAK.VEC3_ZERO);this.$n[5].set(OAK.VEC3_ZERO,OAK.VEC3_ZERO);this.$n[6].set(OAK.VEC3_ZERO,OAK.VEC3_ZERO);this.$n[7].set(OAK.VEC3_ZERO,OAK.VEC3_ZERO);this.$z.length=0;this.$x4=0},setBoundingBox:function(c){c.clone(this.$J2);var h=(c.vMin.x+c.vMax.x)*0.5;var e=(c.vMin.y+c.vMax.y)*0.5;var d=(c.vMin.z+c.vMax.z)*0.5;var f=okA.vec3();var a=okA.vec3();f.x=c.vMin.x;f.y=c.vMin.y;f.z=c.vMin.z;a.x=h;a.y=e;a.z=d;this.$n[0].set(f,a);f.x=h;f.y=c.vMin.y;f.z=c.vMin.z;a.x=c.vMax.x;a.y=e;a.z=d;this.$n[1].set(f,a);f.x=c.vMin.x;f.y=c.vMin.y;f.z=d;a.x=h;a.y=e;a.z=c.vMax.z;this.$n[2].set(f,a);f.x=h;f.y=c.vMin.y;f.z=d;a.x=c.vMax.x;a.y=e;a.z=c.vMax.z;this.$n[3].set(f,a);f.x=c.vMin.x;f.y=e;f.z=c.vMin.z;a.x=h;a.y=c.vMax.y;a.z=d;this.$n[4].set(f,a);f.x=h;f.y=e;f.z=c.vMin.z;a.x=c.vMax.x;a.y=c.vMax.y;a.z=d;this.$n[5].set(f,a);f.x=c.vMin.x;f.y=e;f.z=d;a.x=h;a.y=c.vMax.y;a.z=c.vMax.z;this.$n[6].set(f,a);f.x=c.vMin.x;f.y=e;f.z=d;a.x=c.vMax.x;a.y=c.vMax.y;a.z=c.vMax.z;this.$n[7].set(f,a);okA._vec3(f);okA._vec3(a)},createChild:function(a){if(this.$o[a]!=null){return this.$o[a]}var c=okA.sceneNode();c.$w5=this;c.$D4=a;c.$x4=this.$x4+1;c.setBoundingBox(this.$n[a]);this.$o[a]=c;this.$64+=1;return this.$o[a]},deleteChild:function(a){if(this.$o[a]!=null){this.$o[a].clear();okA._sceneNode(this.$o[a]);this.$o[a]=null;this.$64-=1}},getChild:function(a){return this.$o[a]},getChildNum:function(){return this.$64},attachEntity:function(a){if(a==null){alert(0)}this.$z.push(a)},removeEntity:function(d){var a=this.$z.length;for(var c=0;c<a;++c){if(this.$z[c]==d){this.$z[c]=this.$z[a-1];this.$z.pop();break}}},getEntityNum:function(){return this.$z.length},getBoundingBox:function(){return this.$J2},traverseTree:function(d){var e=new Array;e.push(this);while(e.length!=0){var c=e.shift();for(var a=0;a<8;++a){if(c.$o[a]!=null){e.push(c.$o[a])}}d(c)}}};function okSceneZone(a){this.$56="";this.$z6=a;this.$A4=4;this.$p4=16;this.$O5=okA.sceneNode();this.$A=new okCollection();this.$Q=new okList();this.$54=0;this.$44=0;this.$D=new Object;this.$v=new Object;this.$z1=new okList();this.$d4=0}okSceneZone.prototype={clear:function(){this.$A4=4;this.$p4=1;this.$O5.clear();this.$Q.clear();okA._object(this.$v);this.$v=okA.object();this.$z1.clear();this.$A.resetIterator();var a;while(a=this.$A.iterate()){a.clear()}this.$A.clear();this.$D=new Object},setName:function(a){this.$56=a},getName:function(a){return this.$56},getScene:function(){return this.$z6},getRootNode:function(){return this.$O5},setBoundingBox:function(d,c){this.$O5.clear();this.$O5.setBoundingBox(d,c);this.$A.resetIterator();var a;while(a=this.$A.iterate()){a.__aSceneNodes.length=0;this.$v[a.getId()]=a}},getBoundingBox:function(){return this.$O5.getBoundingBox()},setMaxLevel:function(a){this.$A4=a},getMaxLevel:function(){return this.$A4},setGranularity:function(a){this.$p4=a},getGranularity:function(){return this.$p4},createEntity:function(a){var f=null;switch(a){case 1:f=new okStaticEntity(this);break;case 2:f=new okDynamicEntity(this);break;case 256:f=new okParticleEntity(this);break;case 32:f=new okTerrainEntity(this);break;case 128:f=new okVideoEntity(this);break;case 4:f=new okDctLightEntity(this);this.$Q.pushBack(f);break;case 8:f=new okPointLightEntity(this);this.$Q.pushBack(f);break;case 16:f=new okSpotLightEntity(this);this.$Q.pushBack(f);break;case 64:f=new okCustomMeshEntity(this);break;case 512:f=new okConfigEntity(this);break}f.setId(this.$A.add(f));f.__iSceneVisitFlag=-1;if((a&(1|2|32|64|128|256))!=0){f.__aSceneNodes=okA.array();this._addEntityToTree(this.$O5,f)}if((a&(2|256))!=0){this.$z1.pushBack(f)}if((a&(1|2|32|64|128|256))!=0){var d=this.$Q.getRoot();while(d){var e=d.data;if(e.isAffectEntity(f)){f.addLight(e)}e.addAffectEntity(f);d=d.next}}else{if((a&(4|8|16))!=0){var e=f;this.$A.resetIterator();var c;while(c=this.$A.iterate()){if(((c.$S4&(1|2|32|64|128|256))!=0)&&e.isAffectEntity(c)){c.addLight(e);e.addAffectEntity(c)}}}}return f},deleteEntity:function(d){var m=d;if(okIsNumber(d)){m=this.$A.getDataByIndex(d)}else{if(okIsString(d)){this.$A.resetIterator();var l;while(l=this.$A.iterate()){if(l.$56==d){m=l;break}}}}m.clear();if((m.$S4&(4|8|16))!=0){var a=m;var c=a.$6.length;for(var f=0;f<c;++f){a.$6[f].removeLight(a)}a.clearAffectEntity();this.$Q.remove(this.$Q.find(a))}else{if((m.$S4&(1|2|32|64|128|256))!=0){this._removeEntityFromTree(m)}var h=m.$u.length;for(var f=0;f<h;++f){m.$u[f].removeAffectEntity(m)}var k=m.$61.length;for(var f=0;f<k;++f){m.$61[f].removeAffectEntity(m)}var e=m.$p1.length;for(var f=0;f<e;++f){m.$p1[f].removeAffectEntity(m)}m.clearLight()}if(this.$v[m.getId()]!=null){delete this.$v[m.getId()]}if((m.$S4&(2|256))!=0){this.$z1.remove(this.$z1.find(m))}this.$A.removeByIndex(m.getId())},getEntity:function(a){if(okIsNumber(a)){return this.$A.getDataByIndex(a)}else{if(okIsString(a)){this.$A.resetIterator();var c;while(c=this.$A.iterate()){if(c.$56==a){return c}}}}return null},getEntityArray:function(d,e,c){d=((d!=null)?d:okA.array());e=((e!=null)?e:-1);this.$A.resetIterator();var a;while(a=this.$A.iterate()){if(e&a.$S4){if(c&&!c(a)){continue}d.push(a)}}return d},dirtyEntity:function(c){var a=c.getId();if(this.$v[a]==null){this.$v[a]=c}},forceVisibleEntity:function(c,a){if(a){this.$D[c.getId()]=c.getId()}else{if(this.$D[c.getId()]){delete this.$D[c.getId()]}}},cullByFrustum:function(p,a,o,m,d){this._upDE();if(o==null){o=-1}if(d==null){d=1}this.$d4+=1;var l=[this.$O5];while(l.length!=0){var c=l.shift();var f=c.$z.length;for(var e=0;e<f;++e){var n=c.$z[e];if(n.__iSceneVisitFlag<this.$d4&&(n.$S4&o)&&(m==null||m(n))&&(n.getState()!=1)){var h=false;if(d==1){h=p.collideAABBox(n.getBoundingBox(d))}else{h=p.collideOBBox(n.getBoundingBox(d))}if(h!=0){a.push(n)}n.__iSceneVisitFlag=this.$d4}}for(var e=0;e<8;++e){if(c.$o[e]==null){continue}var k=p.collideAABBox(c.$n[e]);if(k==1){l.push(c.$o[e])}else{if(k==2){this._dumpTree(c.$o[e],a)}}}}},pick:function(p,f,s,n,c){if(s==null){s=-1}if(c==null){c=1}this._upDE();this.$d4+=1;var h=null;var q=10000000000;var m=new Object;var l=[this.$O5];while(l.length!=0){var a=l.shift();var e=a.$z.length;for(var d=0;d<e;++d){var o=a.$z[d];if(o.__iSceneVisitFlag<this.$d4&&o.getState()!=1&&(o.$S4&s)&&(n==null||n(o))){if(o.getBoundingBox(c).collideRay(p,f,m)!=0){if(m.fT0>0&&m.fT0<q){h=o;q=m.fT0}}o.__iSceneVisitFlag=this.$d4}}for(var d=0;d<8;++d){if(a.$o[d]==null){continue}var k=a.$n[d].collideRay(p,f);if(k!=0){l.push(a.$o[d])}}}return h},update:function(a){var c=this.$z1.getRoot();while(c){c.data.update(a);c=c.next}},_visCull:function(x,I){this._upDE();this.$d4+=1;for(var m in this.$D){var H=this.getEntity(this.$D[m]);H.__iSceneVisitFlag+=1;I.push(H)}var K=x.getFrustum();var d=x.getPos();var c=x.getForwardDir();var D=x.getUpDir();var F=x.getRightDir();var G=x.getVisibleFar();var k=x.getViewportWidth()/x.getViewportHeight();var a=x.getFov()*Math.PI/360;var w=Math.tan(a);var o=Math.cos(a);var q=Math.cos(Math.atan(w*k));var B=x.getProjMode();var v,u;if(B){v=k*w;u=w}else{v=x.getViewportWidth()/x.getViewportHeight();u=1}var J=okA.array();J.push(this.$O5);while(J.length!=0){var C=J.shift();var f=C.$z.length;for(var E=0;E<f;++E){var h=C.$z[E];if(h.__iSceneVisitFlag<this.$d4){if(h.getState()!=1){var A=false;var l=h.getBoundingSphereCenter();l.x-=d.x;l.y-=d.y;l.z-=d.z;var L=h.getBoundingSphereRadius();var t=F.x*l.x+F.y*l.y+F.z*l.z;var s=D.x*l.x+D.y*l.y+D.z*l.z;var p=c.x*l.x+c.y*l.y+c.z*l.z;if(B){var z=L/q;var y=L/o;if(t>=-p*v-z&&t<=p*v+z&&s>=-p*u-y&&s<=p*u+y&&p>=-L&&p<=G+L){A=true}}else{if(t>=-v-L&&t<=v+L&&s>=-u-L&&s<=u+L&&p>=-L&&p<=G+L){A=true}}okA._vec3(l);if(A){if(h.$S4!=32){I.push(h)}else{if(h.cullByFrustum(K)!=0){I.push(h)}}}}h.__iSceneVisitFlag=this.$d4}}for(var E=0;E<8;++E){if(C.$o[E]==null){continue}var n=K.collideAABBox(C.$n[E]);if(n==1){J.push(C.$o[E])}else{if(n==2){this._dumpTree(C.$o[E],I)}}}}okA._array(J);okA._vec3(d);okA._vec3(c);okA._vec3(D);okA._vec3(F)},_logTree:function(d){this._upDE();var a=new Array;a.push((d!=null)?d:this.$O5);while(a.length!=0){var h=a.pop();var k="";for(var f=0;f<h.$x4;++f){k+="________"}k+="[Min:"+h.$J2.vMin.x+","+h.$J2.vMin.y+","+h.$J2.vMin.z+"  Max:"+h.$J2.vMax.x+","+h.$J2.vMax.y+","+h.$J2.vMax.z+"]";k+="[E:";var e=true;var c=h.$z.length;for(var f=0;f<c;++f){if(!e){k+=","}e=false;k+=h.$z[f].getId()}k+="]";window.console.log(k);for(var f=0;f<h.$o.length;++f){if(h.$o[f]!=null){a.push(h.$o[f])}}}},_addEntityToTree:function(c,f){var e=f.getBoundingBox();if(c.$x4==this.$A4||e.collideAABBox(c.$J2)!=1){c.attachEntity(f);f.__aSceneNodes.push(c);return}else{if(c.$z.length<=this.$p4&&c.getChildNum()==0){c.attachEntity(f);f.__aSceneNodes.push(c);if(c.$z.length>this.$p4){this._splitNode(c)}return}}for(var a=0;a<8;++a){var d=c.$n[a].collideAABBox(e);if(d==1){this._addEntityToTree(c.createChild(a),f)}else{if(d==2){this._addEntityToTree(c.createChild(a),f);break}}}},_splitNode:function(c){var l=okA.array();var h=c.$z.length;for(var d=0;d<h;++d){var m=c.$z[d];var n=m.getBoundingBox();if(n.collideAABBox(c.$J2)!=1){l.push(m)}else{var a=m.__aSceneNodes.length;for(var f=0;f<a;++f){if(m.__aSceneNodes[f]==c){m.__aSceneNodes[f]=m.__aSceneNodes[a-1];m.__aSceneNodes.pop();break}}c.$z[d]=c.$z[h-1];c.$z.pop();h-=1;--d;for(var e=0;e<8;++e){var k=c.$n[e].collideAABBox(n);if(k==1){this._addEntityToTree(c.createChild(e),m)}else{if(k==2){this._addEntityToTree(c.createChild(e),m);break}}}}}okA._array(c.$z);c.$z=l},_removeEntityFromTree:function(h){var a=h.__aSceneNodes.length;for(var d=0;d<a;++d){var f=h.__aSceneNodes[d];f.removeEntity(h);if(f.$z.length==0&&f.getChildNum()==0){var c=f;while(c!=null){var e=c.$w5;if(e!=null){e.deleteChild(c.$D4);if(e.getEntityNum()==0&&e.getChildNum()==0){c=e}else{c=null}}else{c=null}}}}h.__aSceneNodes.length=0},_upDE:function(){var c=okA.array();for(var d in this.$v){var f=this.$v[d];c.push(f);if((f.$S4&(1|2|32|64|128|256))!=0){this._removeEntityFromTree(f)}delete this.$v[d]}var e=c.length;for(var a=0;a<e;++a){var f=c[a];if((f.$S4&(1|2|32|64|128|256))!=0){this._addEntityToTree(this.$O5,f)}this._evalLE(f)}okA._array(c)},_evalLE:function(k){var c=k.getType();if((c&(4|8|16))!=0){var f=k;var a=f.$6.length;for(var e=0;e<a;++e){f.$6[e].removeLight(f)}f.clearAffectEntity();this.$A.resetIterator();var d;while(d=this.$A.iterate()){if(((d.$S4&(1|2|32|64|128|256))!=0)&&f.isAffectEntity(d)){d.addLight(f);f.addAffectEntity(d)}}}else{if((c&(1|2|32|64|128|256))!=0){var h=k.$u.length;for(var e=0;e<h;++e){k.$u[e].removeAffectEntity(k)}var h=k.$61.length;for(var e=0;e<h;++e){k.$61[e].removeAffectEntity(k)}var h=k.$p1.length;for(var e=0;e<h;++e){k.$p1[e].removeAffectEntity(k)}k.clearLight();lightNode=this.$Q.getRoot();while(lightNode){var f=lightNode.data;if(f.isAffectEntity(k)){k.addLight(f);f.addAffectEntity(k)}lightNode=lightNode.next}}}},_dumpTree:function(e,f){var h=okA.array();h.push(e);while(h.length!=0){var d=h.shift();var a=d.$z.length;for(var c=0;c<a;++c){var k=d.$z[c];if(k.__iSceneVisitFlag<this.$d4){if(k.getState()!=1){f.push(k)}k.__iSceneVisitFlag=this.$d4}}for(var c=0;c<8;++c){if(d.$o[c]==null){continue}h.push(d.$o[c])}}okA._array(h)}};function okScene(d,a){this.$Y2=a;this.$L5=a.$L5;this.$56=d;this.$H1=new Object;var c=new okSceneZone(this);c.setName("Default");this.$H1.Default=c;this.$S5="";this.$46="";this.$Q5="";this.$u6="";this.$w6="";this.$j=new okList()}okScene.prototype={clear:function(){this.clearEntity();this.clearCamera()},clearEntity:function(){for(var c in this.$H1){this.$H1[c].clear()}okA._object(this.$H1);this.$H1=okA.object();var a=new okSceneZone(this);a.setName("Default");this.$H1.Default=a},clearCamera:function(){var a=this.$j.getRoot();while(a){a.data.clear();a=a.next}this.$j.clear()},getName:function(){return this.$56},setBaseUrl:function(a){a=a.replace(/\\/g,"/");a=a.replace(/\/$/g,"");this.$S5=a},getBaseUrl:function(a){return this.$S5},setModelUrl:function(a){a=a.replace(/\\/g,"/");a=a.replace(/\/$/g,"");this.$46=a},_packModelUrl:function(c){c=c.replace(/\\/g,"/");c=c.replace(/^\/+/g,"");if(c.indexOf(":")!=-1){return c}var a=this.$S5;a+=((a!="")?("/"+this.$46):this.$46);a+=((a!="")?("/"+c):c);return a},getModelUrl:function(){return this.$46},setSkAnimationUrl:function(a){a=a.replace(/\\/g,"/");a=a.replace(/\/$/g,"");this.$Q5=a},getSkAnimationUrl:function(){return this.$Q5},_packSkAnimationUrl:function(c){c=c.replace(/\\/g,"/");c=c.replace(/^\/+/g,"");if(c.indexOf(":")!=-1){return c}var a=this.$S5;a+=((a!="")?("/"+this.$Q5):this.$Q5);a+=((a!="")?("/"+c):c);return a},setTerrainUrl:function(a){a=a.replace(/\\/g,"/");a=a.replace(/\/$/g,"");this.$u6=a},getTerrainUrl:function(){return this.$u6},_packTerrainUrl:function(c){c=c.replace(/\\/g,"/");c=c.replace(/^\/+/g,"");if(c.indexOf(":")!=-1){return c}var a=this.$S5;a+=((a!="")?("/"+this.$u6):this.$u6);a+=((a!="")?("/"+c):c);return a},setTextureUrl:function(a){a=a.replace(/\\/g,"/");a=a.replace(/\/$/g,"");this.$w6=a},getTextureUrl:function(){return this.$w6},_packTextureUrl:function(c){c=c.replace(/\\/g,"/");c=c.replace(/^\/+/g,"");if(c.indexOf(":")!=-1){return c}var a=this.$S5;a+=((a!="")?("/"+this.$w6):this.$w6);a+=((a!="")?("/"+c):c);return a},getZone:function(a){return this.$H1[(a!=null)?a:"Default"]},setZoneBoundingBox:function(e,c,d){var a=this.$H1[(d!=null)?d:"Default"];a.setBoundingBox(new okAABBox(e,c))},getZoneBoundingBox:function(c){var a=this.$H1[(c!=null)?c:"Default"];return a.getBoundingBox()},setZoneGranularity:function(c,d){var a=this.$H1[(d!=null)?d:"Default"];a.setGranularity(c)},getZoneGranularity:function(c){var a=this.$H1[(c!=null)?c:"Default"];return a.getGranularity()},setZoneMaxLevel:function(d,c){var a=this.$H1[(c!=null)?c:"Default"];a.setMaxLevel(d)},getZoneMaxLevel:function(c){var a=this.$H1[(c!=null)?c:"Default"];return a.getMaxLevel()},createCamera:function(a){var c=new okCamera(this.$L5.rc);c.$z6=this;if(a!=null){c.setName(a)}this.$j.pushBack(c);return c},deleteCamera:function(c){if(okIsString(c)){var a=this.$j.getRoot();while(a){if(a.data.getName()==c){a.data.clear();this.$j.remove(a);return}a=a.next}}else{c.clear();this.$j.remove(this.$j.find(c))}},getCamera:function(c){var a=this.$j.getRoot();while(a){if(a.data.getName()==c){return a.data}a=a.next}return null},getCameraArray:function(c,a){if(c==null){c=okA.array()}var d=this.$j.getRoot();while(d){if(a==null||a(d.data)){c.push(d.data)}d=d.next}return c},createEntity:function(a,f,d){var c=this.$H1[(d!=null)?d:"Default"];var h=c.createEntity(a);if(f){h.setName(f)}return h},deleteEntity:function(d,c){var a=this.$H1[(c!=null)?c:"Default"];return a.deleteEntity(d)},getEntity:function(a,d){var c=this.$H1[(d!=null)?d:"Default"];return c.getEntity(a)},getEntityArray:function(c,f,a,e){if(c==null){c=okA.array()}var d=this.$H1[(e!=null)?e:"Default"];d.getEntityArray(c,f,a);return c},cullByFrustum:function(a,d,k,c,f,h){var e=this.$H1[(h!=null)?h:"Default"];return e.cullByFrustum(a,d,k,c,f)},pick:function(c,k,h,a,e,f){var d=this.$H1[(f!=null)?f:"Default"];return d.pick(c,k,h,a,e)},update:function(a,d){var c=this.$H1[(d!=null)?d:"Default"];c.update(a)}};function okSceneManager(a,c){this.$Y2=c;this.aSceneList=new Object}okSceneManager.prototype={clear:function(){for(var a in this.aSceneList){this.aSceneList[a].clear()}okA._object(this.aSceneList);this.aSceneList=okA.object()},createScene:function(a){var c=this.aSceneList[a];if(!c){c=new okScene(a,this.$Y2);this.aSceneList[a]=c}return c},deleteScene:function(a){var c=this.aSceneList[a];if(c){c.clear();delete this.aSceneList[a]}},getScene:function(a){return this.aSceneList[a]}};function okResource(){this.$S4=0;this.$36=null;this.$F4=0;this.$M4=1;this.$02=false;this.$S=new okList();this.data=null}okResource.prototype={clear:function(){if(this.data){if(this.$S4==1){this.data.clear()}else{if(this.$S4==2){this.data.releaseTexture()}else{if(this.$S4==3){this.data.clear()}}}this.data=null}this.$S4=0;this.$36=null;this.$F4=0;this.$M4=1;this.$02=false;this.$S.clear()}};function okResourceManager(a,c){this.rc=c;this.$f1=new okCollection();this.$L=new Object;this.bAsyncLoad=a.bAsyncLoad}okResourceManager.prototype={clear:function(){this.$f1.resetIterator();var a;while(a=this.$f1.iterate()){a.clear()}this.$f1.clear();okA._object(this.$L);this.$L=okA.object()},getResourceType:function(a){if(!this.$f1.isIndexValid(a)){return 0}return this.$f1.getDataByIndex(a).$S4},getResourceState:function(a){if(!this.$f1.isIndexValid(a)){return 1}return this.$f1.getDataByIndex(a).$M4},getResourceNum:function(){return this.$f1.getSize()},setCustomResourceState:function(d,a){if(!this.$f1.isIndexValid(d)){return false}var c=this.$f1.getDataByIndex(d);if(!c.$02){return false}c.$M4=a;return true},createResource:function(e,d,c){var a=this.$L[d];if(a!=null){var f=this.$f1.getDataByIndex(a);f.$F4+=1;return a}var f=new okResource();f.$S4=e;f.$F4=1;f.$M4=(c==true)?5:2;f.$36=d;f.$02=c==true?true:false;if(e==1){f.data=new okModel(this.rc)}else{if(e==2){f.data=new okTexture(this.rc)}else{if(e==3){f.data=new okSkAnimation()}}}var h=this.$f1.add(f);this.$L[d]=h;return h},getResource:function(c){if(okIsNumber(c)){if(c<0){return null}return this.$f1.getDataByIndex(c).data}var a=this.$L[c];if(a!=null){return this.$f1.getDataByIndex(a).data}return null},getResourceId:function(a){if(this.$L[a]!=null){return this.$L[a]}return -1},deleteResource:function(c){var d=null;var e=-1;if(okIsNumber(c)){d=this.$f1.getDataByIndex(c);e=c}else{var a=this.$L[c];if(a!=null){d=this.$f1.getDataByIndex(a);e=a}}if(d){d.$F4-=1;if(d.$F4==0){this.postMessage(e,"RES_DELETED",[e]);delete this.$L[d.$36];d.clear();this.$f1.removeByIndex(e)}}},registerListener:function(d,c){if(this.$f1.isIndexValid(d)){var a=this.$f1.getDataByIndex(d);if(a.$S.find(c)==null){a.$S.pushBack(c)}}},removeListener:function(d,c){if(this.$f1.isIndexValid(d)){var a=this.$f1.getDataByIndex(d);a.$S.remove(a.$S.find(c))}},loadModelByUrl:function(h,a,d,e){if(!this.$f1.isIndexValid(h)){return false}var c=this.$f1.getDataByIndex(h);if(c.$S4!=1||c.$02){return false}if(c.$M4!=3){c.$M4=3;var f=this;var k=okGenXmlHttpRequest();k.open("GET",a,this.bAsyncLoad&&(e!=true));k.overrideMimeType("text/plain; charset=x-user-defined");if(okIsIE()){k.onreadystatechange=function(){if(k.readyState==4){if(k.status==200||k.status==0){var l=k.responseText.substr(0,6);if(l=="OKMDBI"){if(okResourceParser.loadModel(3,c.data,k.responseText,d,true,true)==false){c.$M4=2;return}}else{if(okResourceParser.loadModel(1,c.data,k.responseText,d,true,true)==false){c.$M4=2;return false}}c.$M4=5;f.postMessage(h,"RES_READY",[h])}}}}else{k.onload=function(){var l=k.responseText.substr(0,6);if(l=="OKMDBI"){if(okResourceParser.loadModel(3,c.data,k.responseText,d,true,true)==false){c.$M4=2;return false}}else{if(okResourceParser.loadModel(1,c.data,k.responseText,d,true,true)==false){c.$M4=2;return false}}c.$M4=5;f.postMessage(h,"RES_READY",[h])};k.onerror=function(){c.$M4=2}}k.send()}else{return false}return true},loadModelByText:function(f,a,d){if(!this.$f1.isIndexValid(f)){return false}var c=this.$f1.getDataByIndex(f);if(c.$S4!=1||c.$02){return false}if(c.$M4!=3){c.$M4=3;var e=a.substr(0,6);if(e=="OKMDBI"){if(okResourceParser.loadModel(3,c.data,a,d,true,true)==false){c.$M4=2;return false}}else{if(okResourceParser.loadModel(1,c.data,a,d,true,true)==false){c.$M4=2;return false}}c.$M4=5;this.postMessage(f,"RES_READY",[f])}else{return false}return true},loadSkAnimationByUrl:function(h,a,e){if(!this.$f1.isIndexValid(h)){return false}var d=this.$f1.getDataByIndex(h);if(d.$S4!=3||d.$02){return false}if(d.$M4!=3){d.$M4=3;var f=this;var c=new okGenXmlHttpRequest();c.open("GET",a,this.bAsyncLoad&&(e!=true));c.overrideMimeType("text/plain; charset=x-user-defined");if(okIsIE()){c.onreadystatechange=function(){if(c.readyState==4){if(c.status==200||c.status==0){var k=c.responseText.substr(0,6);if(k=="OKAMBI"){if(okResourceParser.loadSkAnimation(3,d.data,c.responseText)==false){d.$M4=2;return}}else{if(okResourceParser.loadSkAnimation(1,d.data,c.responseText)==false){d.$M4=2;return false}}d.$M4=5;f.postMessage(h,"RES_READY",[h])}}}}else{c.onload=function(){var k=c.responseText.substr(0,6);if(k=="OKAMBI"){if(okResourceParser.loadSkAnimation(3,d.data,c.responseText)==false){d.$M4=2;return}}else{if(okResourceParser.loadSkAnimation(1,d.data,c.responseText)==false){d.$M4=2;return false}}d.$M4=5;f.postMessage(h,"RES_READY",[h])};c.onerror=function(){d.$M4=2}}c.send()}else{return false}return true},loadSkAnimationByText:function(e,a){if(!this.$f1.isIndexValid(e)){return false}var c=this.$f1.getDataByIndex(e);if(c.$S4!=3||c.$02){return false}if(c.$M4!=3){c.$M4=3;var d=a.substr(0,6);if(d=="OKAMBI"){if(okResourceParser.loadSkAnimation(3,c.data,a)==false){c.$M4=2;return false}}else{if(okResourceParser.loadSkAnimation(1,c.data,a)==false){c.$M4=2;return false}}c.$M4=5;this.postMessage(e,"RES_READY",[e])}else{return false}return true},loadTextureByUrl:function(p,f,o){if(!this.$f1.isIndexValid(p)){return false}var l=this.$f1.getDataByIndex(p);if(l.$S4==0){l.$S4=2;l.data=new okTexture(this.rc)}if(l.$S4!=2||l.$02){return false}if(l.$M4!=3){l.$M4=3;var a=this;var c=okFileFilter(f);if(c!="mp4"&&c!="ogg"&&c!="ogv"){var d=new Image();d.onload=function(){okResourceParser.loadTextureFromImage(l.data,d,o);l.data.genMipMap();l.$M4=5;a.postMessage(p,"RES_READY",[p])};d.onerror=function(){l.$M4=2};d.src=f}else{var h=f;var f=f.substring(0,f.lastIndexOf("."));f.replace("\\","/");f=f.substring(f.lastIndexOf("/")+1,f.length);var n=document.getElementById(f);if(!n){n=document.createElement("video");n.src=h;n.id=f;n.autoplay=true;n.preload="auto";n.loop=true;l.data.$37=n}function k(q){okResourceParser.loadTextureFromVideo(l.data,n,o);l.$M4=5;l.data.$37=n;a.postMessage(p,"RES_READY",[p])}function e(q){n.play()}function m(q){l.$M4=2}n.addEventListener("canplaythrough",k,false);n.addEventListener("error",m,false);n.addEventListener("ended",e,false)}}else{return false}return true},loadTextureByImage:function(e,d,a){if(!this.$f1.isIndexValid(e)){return false}var c=this.$f1.getDataByIndex(e);if(c.$S4==0){c.$S4=2;c.data=new okTexture(this.rc)}if(c.$S4!=2||c.$02){return false}if(c.$M4!=3){c.$M4=3;okResourceParser.loadTextureFromImage(c.data,d,a);c.data.genMipMap();c.$M4=5;this.postMessage(e,"RES_READY",[e])}else{return false}return true},loadTextureByVideo:function(e,c,a){if(!this.$f1.isIndexValid(e)){return false}var d=this.$f1.getDataByIndex(e);if(d.$S4==0){d.$S4=2;d.data=new okTexture(this.rc)}if(d.$S4!=2||d.$02){return false}if(d.$M4!=3){d.$M4=3;okResourceParser.loadTextureFromVideo(d.data,c,a);d.data.$37=c;d.$M4=5;this.postMessage(e,"RES_READY",[e])}else{return false}return true},loadCubeTextureByUrl:function(t,p,e,m,d,k,c,q){if(!this.$f1.isIndexValid(t)){return false}var f=this.$f1.getDataByIndex(t);if(f.$S4==0){f.$S4=2;f.data=new okTexture(this.rc)}if(f.$S4!=2||f.$02){return false}if(f.$M4!=3){f.$M4=3;var o=f.data;var a=this;var n=new Image();n.onerror=function(){f.$M4=2};var v=new Image();v.onerror=function(){f.$M4=2};var l=new Image();l.onerror=function(){f.$M4=2};var u=new Image();u.onerror=function(){f.$M4=2};var h=new Image();h.onerror=function(){f.$M4=2};var s=new Image();s.onerror=function(){f.$M4=2};n.onload=function(){v.onload=function(){l.onload=function(){u.onload=function(){h.onload=function(){s.onload=function(){o.createTexture(34067,n.width,n.height,6408,5121,n,v,l,u,h,s);o.genMipMap();f.$M4=5;a.postMessage(t,"RES_READY",[t])};s.src=c};h.src=k};u.src=d};l.src=m};v.src=e};n.src=p}else{return false}return true},postMessage:function(f,a,h){if(!this.$f1.isIndexValid(f)){return false}var e=new Object;e.sMsg=a;e.aArgs=h.slice();var c=this.$f1.getDataByIndex(f);var d=c.$S.getRoot();while(d){d.data.onMessage(e);d=d.next}}};function okShaderManager(a){this.rc=a.rc;this.$Z2=a.$Z2;this.$k6="";this.$16="mediump";this.$G=null;this.$F1=new Object;this.$E=new Object;this.$81=new Object;this.$F=okA.object();this.$F.OK_VERTEX_UNIFORM_NUM=this.$Z2.iVertexUniformNum;if(this.$Z2.bFloatRt){this.$F.OK_SUPPORT_FLOAT_RT=1}this.aVertexSourceMap=new Object;this.aFragmentSourceMap=new Object;this.$G=new Object;this.$G.HeaderCommon="varying vec3 okVary_Pos;varying vec4 okVary_ScrTC;\n#ifdef OK_NORMAL\nvarying vec3 okVary_Normal;\n#endif\n#ifdef OK_VERTEX_COLOR\nvarying vec3 okVary_Color;\n#endif\n#ifdef OK_TC12\nvarying vec4 okVary_TC12;\n#else\n#ifdef OK_TC1\nvarying vec2 okVary_TC1;\n#endif\n#ifdef OK_TC2\nvarying vec2 okVary_TC2;\n#endif\n#endif\n#ifdef OK_TC34\nvarying vec4 okVary_TC34;\n#else\n#ifdef OK_TC3\nvarying vec2 okVary_TC3;\n#endif\n#ifdef OK_TC4\nvarying vec2 okVary_TC4;\n#endif\n#endif\n#ifdef OK_TANGENT\nvarying vec3 okVary_Tangent;\n#endif\n#ifdef OK_BINORMAL\nvarying vec3 okVary_Binormal;\n#endif\n";this.$G.HeaderFS="uniform vec4 okUni_General[51];\n#ifdef OK_TEX_ALBEDO1\n#ifdef OK_TEX_ALBEDO1_CUBE\nuniform samplerCube okUni_Sampler0;\n#else\nuniform sampler2D okUni_Sampler0;\n#endif\n#endif\n#ifdef OK_TEX_ALBEDO2\n#ifdef OK_TEX_ALBEDO2_CUBE\nuniform samplerCube okUni_Sampler1;\n#else\nuniform sampler2D okUni_Sampler1;\n#endif\n#endif\n#ifdef OK_TEX_ALBEDO3\n#ifdef OK_TEX_ALBEDO3_CUBE\nuniform samplerCube okUni_Sampler2;\n#else\nuniform sampler2D okUni_Sampler2;\n#endif\n#endif\n#ifdef OK_TEX_ALBEDO4\n#ifdef OK_TEX_ALBEDO4_CUBE\nuniform samplerCube okUni_Sampler3;\n#else\nuniform sampler2D okUni_Sampler3;\n#endif\n#endif\n#ifdef OK_TEX_NORMALMAP\nuniform sampler2D okUni_Sampler4;\n#endif\n#ifdef OK_TEX_OPACITY\nuniform sampler2D okUni_Sampler5;\n#endif\n#ifdef OK_TEX_SPECULAR_LEVEL\nuniform sampler2D okUni_Sampler6;\n#endif\nvec3 okGlb_P;vec2 okGlb_ScrTC;vec3 okGlb_N;vec3 okGlb_V;vec3 okGlb_R;\n#define P okGlb_P\n#define SCRTC okGlb_ScrTC\n#define CP okUni_General[8].xyz\n#define N okGlb_N\n#define V okGlb_V\n#define R okGlb_R\n#define T okUni_General[5].w\n#define RAND okUni_General[6].w\n#define EMI okUni_General[0].xyz\n#define AMB okUni_General[1].xyz\n#define DIF okUni_General[2].xyz\n#define SPE okUni_General[3].xyz\n#define GLO okUni_General[0].w\n#define ALPHA okUni_General[2].w\n#define GROUND okUni_General[5].xyz\n#define SKY okUni_General[6].xyz\n#ifdef OK_VERTEX_COLOR\n#define VC okVary_Color\n#else\n#define VC vec3(0.0,0.0,0.0)\n#endif\n#ifdef OK_TC12\n#define TC1 okVary_TC12.xy\n#define TC2 okVary_TC12.zw\n#else\n#ifdef OK_TC1\n#define TC1 okVary_TC1\n#else\n#define TC1 vec2(0.0)\n#endif\n#ifdef OK_TC2\n#define TC2 okVary_TC2\n#else\n#define TC2 vec2(0.0)\n#endif\n#endif\n#ifdef OK_TC34\n#define TC3 okVary_TC34.xy\n#define TC4 okVary_TC34.zw\n#else\n#ifdef OK_TC3\n#define TC3 okVary_TC3\n#else\n#define TC3 vec2(0.0)\n#endif\n#ifdef OK_TC4\n#define TC4 okVary_TC4\n#else\n#define TC4 vec2(0.0)\n#endif\n#endif\nvec2 okRotTC(vec2 d,float e){float a=cos(e);float b=sin(e);mat2 c=mat2(a,b,-b,a);return(c*(d-0.5))+0.5;}vec3 okFunc_GetMaterialEmissive(){\n#ifdef OK_SCRIPT_EMISSIVE_CODE\n{OK_SCRIPT_EMISSIVE_CODE}\n#else\nreturn okUni_General[0].xyz;\n#endif\n}vec3 okFunc_GetMaterialDiffuse(){\n#ifdef OK_SCRIPT_DIFFUSE_CODE\n{OK_SCRIPT_DIFFUSE_CODE}\n#else\n#if defined(OK_TEX_ALBEDO1)||defined(OK_TEX_ALBEDO2)||defined(OK_TEX_ALBEDO3)||defined(OK_TEX_ALBEDO4)\nvec3 albedo=vec3(1,1,1);\n#ifdef OK_TEX_ALBEDO1\n#ifdef OK_TEX_ALBEDO1_CUBE\nalbedo=textureCube(okUni_Sampler0,R).xyz;\n#else\nalbedo=texture2D(okUni_Sampler0,OK_ALBEDO1_TC).xyz;\n#endif\n#endif\n#ifdef OK_TEX_ALBEDO2\n#ifdef OK_TEX_ALBEDO2_CUBE\nvec4 albedo2=textureCube(okUni_Sampler1,R);\n#else\nvec4 albedo2=texture2D(okUni_Sampler1,OK_ALBEDO2_TC);\n#endif\nalbedo=albedo.xyz*albedo2.xyz;\n#endif\n#ifdef OK_TEX_ALBEDO3\n#ifdef OK_TEX_ALBEDO3_CUBE\nvec4 albedo3=textureCube(okUni_Sampler2,R);\n#else\nvec4 albedo3=texture2D(okUni_Sampler2,OK_ALBEDO3_TC);\n#endif\nalbedo=albedo.xyz*albedo3.xyz;\n#endif\n#ifdef OK_TEX_ALBEDO4\n#ifdef OK_TEX_ALBEDO4_CUBE\nvec4 albedo4=textureCube(okUni_Sampler3,R);\n#else\nvec4 albedo4=texture2D(okUni_Sampler3,OK_ALBEDO4_TC);\n#endif\nalbedo=albedo.xyz*albedo4.xyz;\n#endif\nreturn albedo*okUni_General[2].xyz;\n#else\nreturn okUni_General[2].xyz;\n#endif\n#endif\n}float okFunc_GetMaterialDiffusePower(){\n#ifdef OK_SCRIPT_DIFFUSEPOWER_CODE\n{OK_SCRIPT_DIFFUSEPOWER_CODE}\n#else\nreturn 1.0;\n#endif\n}vec3 okFunc_GetMaterialSpecular(){\n#ifdef OK_SCRIPT_SPECULAR_CODE\n{OK_SCRIPT_SPECULAR_CODE}\n#else\n#ifdef OK_TEX_SPECULAR_LEVEL\nreturn texture2D(okUni_Sampler6,OK_SPECULAR_LEVEL_TC).xyz*okUni_General[3].xyz;\n#else\nreturn vec3(okUni_General[1].w)*okUni_General[3].xyz;\n#endif\n#endif\n}float okFunc_GetMaterialSpecularPower(){\n#ifdef OK_SCRIPT_SPECULARPOWER_CODE\n{OK_SCRIPT_SPECULARPOWER_CODE}\n#else\nreturn okUni_General[0].w;\n#endif\n}float okFunc_GetMaterialAlpha(){\n#ifdef OK_SCRIPT_ALPHA_CODE\n{OK_SCRIPT_ALPHA_CODE}\n#else\n#ifdef OK_TEX_OPACITY\nreturn texture2D(okUni_Sampler5,OK_OPACITY_TC).a;\n#else\nreturn okUni_General[2].a;\n#endif\n#endif\n}\n#ifdef OK_SCRIPT_NORMAL_CODE\nvec3 okFunc_GetNormalScript(){OK_SCRIPT_NORMAL_CODE}\n#endif\nvec3 okFunc_GetMaterialNormal(){\n#ifdef OK_NORMAL\nvec3 vertexNormal=okVary_Normal;\n#else\nvec3 vertexNormal=vec3(0.0,1.0,0.0);\n#endif\n#ifdef OK_SCRIPT_NORMAL_CODE\nvec3 normalT=okFunc_GetNormalScript();mat3 matTangent=mat3(\n#ifdef OK_TANGENT\nokVary_Tangent,\n#else\nvec3(1.0,0.0,0.0),\n#endif\n#ifdef OK_BINORMAL\nokVary_Binormal,\n#else\nvec3(0.0,1.0,0.0),\n#endif\nvertexNormal);vec3 retNormal=normalize(matTangent*normalT);\n#else\n#ifdef OK_TEX_NORMALMAP\nvec3 normalT=texture2D(okUni_Sampler4,OK_NORMALMAP_TC).xyz;normalT=normalT*2.0-1.0;mat3 matTangent=mat3(\n#ifdef OK_TANGENT\nokVary_Tangent,\n#else\nvec3(1.0,0.0,0.0),\n#endif\n#ifdef OK_BINORMAL\nokVary_Binormal,\n#else\nvec3(0.0,1.0,0.0),\n#endif\nvertexNormal);vec3 retNormal=normalize(matTangent*normalT);\n#else\nvec3 retNormal=normalize(vertexNormal);\n#endif\n#endif\n#ifdef OK_TWO_SIDE\nreturn retNormal*(gl_FrontFacing?1.0:-1.0);\n#else\nreturn retNormal;\n#endif\n}void okFunc_GetMaterialDctLighting(vec3 LDIR,vec3 LCOLOR,inout vec3 LDIFFUSE,inout vec3 LSPECULAR){\n#ifdef OK_SCRIPT_DCTLIGHT_CODE\n{OK_SCRIPT_DCTLIGHT_CODE}\n#endif\n}void okFunc_GetMaterialPointLighting(vec3 LPOS,vec3 LCOLOR,vec3 LRANGE,inout vec3 LDIFFUSE,inout vec3 LSPECULAR){\n#ifdef OK_SCRIPT_POINTLIGHT_CODE\n{OK_SCRIPT_POINTLIGHT_CODE}\n#endif\n}void okFunc_GetMaterialSpotLighting(vec3 LPOS,vec3 LCOLOR,vec3 LDIR,float LINCONE,float LOUTCONE,inout vec3 LDIFFUSE,inout vec3 LSPECULAR){\n#ifdef OK_SCRIPT_SPOTLIGHT_CODE\n{OK_SCRIPT_SPOTLIGHT_CODE}\n#endif\n}void okFunc_ProcessFragment(){P=okVary_Pos;SCRTC=okUni_General[7].xy+(okVary_ScrTC.xy/okVary_ScrTC.w+1.0)*0.5*okUni_General[7].zw;vec3 normal=okFunc_GetMaterialNormal();N=normal;vec3 camVec=normalize(okUni_General[8].xyz-P);V=-camVec;vec3 reflectVec=normalize(reflect(-camVec,normal));R=reflectVec;\n#ifdef OK_ALPHA_TEST\nif(okFunc_GetMaterialAlpha()<=okUni_General[3].w)discard;\n#endif\n}";this.$G.HeaderVS="attribute vec3 okAttr_Pos;\n#ifdef OK_NORMAL\nattribute vec3 okAttr_Normal;\n#endif\n#ifdef OK_VERTEX_COLOR\nattribute vec3 okAttr_Color;\n#endif\n#ifdef OK_TC12\nattribute vec4 okAttr_TC12;\n#else\n#ifdef OK_TC1\nattribute vec2 okAttr_TC1;\n#endif\n#ifdef OK_TC2\nattribute vec2 okAttr_TC2;\n#endif\n#endif\n#ifdef OK_TC34\nattribute vec4 okAttr_TC34;\n#else\n#ifdef OK_TC3\nattribute vec2 okAttr_TC3;\n#endif\n#ifdef OK_TC4\nattribute vec2 okAttr_TC4;\n#endif\n#endif\n#ifdef OK_TANGENT\nattribute vec3 okAttr_Tangent;\n#endif\n#ifdef OK_BINORMAL\nattribute vec3 okAttr_Binormal;\n#endif\n#ifdef OK_SKANIMATION\nattribute vec4 okAttr_BoneIdx;attribute vec4 okAttr_BoneWeight;\n#if OK_VERTEX_UNIFORM_NUM>=220\nuniform vec4 okUni_BoneMat[64*3];\n#else\nuniform vec4 okUni_BoneMat[32*3];\n#endif\n#endif\nuniform mat4 okUni_TransMat[4];void okFunc_ProcessVertex(){\n#ifdef OK_SKANIMATION\nmat4 a=mat4(0.0);ivec4 b=ivec4(okAttr_BoneIdx)+ivec4(1);{int d=b[0];vec4 e=vec4(okUni_BoneMat[d*3].x,okUni_BoneMat[d*3+1].x,okUni_BoneMat[d*3+2].x,0.0);vec4 f=vec4(okUni_BoneMat[d*3].y,okUni_BoneMat[d*3+1].y,okUni_BoneMat[d*3+2].y,0.0);vec4 g=vec4(okUni_BoneMat[d*3].z,okUni_BoneMat[d*3+1].z,okUni_BoneMat[d*3+2].z,0.0);vec4 h=vec4(okUni_BoneMat[d*3].w,okUni_BoneMat[d*3+1].w,okUni_BoneMat[d*3+2].w,1.0);a+=okAttr_BoneWeight[0]*mat4(e,f,g,h);}{int d=b[1];vec4 e=vec4(okUni_BoneMat[d*3].x,okUni_BoneMat[d*3+1].x,okUni_BoneMat[d*3+2].x,0.0);vec4 f=vec4(okUni_BoneMat[d*3].y,okUni_BoneMat[d*3+1].y,okUni_BoneMat[d*3+2].y,0.0);vec4 g=vec4(okUni_BoneMat[d*3].z,okUni_BoneMat[d*3+1].z,okUni_BoneMat[d*3+2].z,0.0);vec4 h=vec4(okUni_BoneMat[d*3].w,okUni_BoneMat[d*3+1].w,okUni_BoneMat[d*3+2].w,1.0);a+=okAttr_BoneWeight[1]*mat4(e,f,g,h);}{int d=b[2];vec4 e=vec4(okUni_BoneMat[d*3].x,okUni_BoneMat[d*3+1].x,okUni_BoneMat[d*3+2].x,0.0);vec4 f=vec4(okUni_BoneMat[d*3].y,okUni_BoneMat[d*3+1].y,okUni_BoneMat[d*3+2].y,0.0);vec4 g=vec4(okUni_BoneMat[d*3].z,okUni_BoneMat[d*3+1].z,okUni_BoneMat[d*3+2].z,0.0);vec4 h=vec4(okUni_BoneMat[d*3].w,okUni_BoneMat[d*3+1].w,okUni_BoneMat[d*3+2].w,1.0);a+=okAttr_BoneWeight[2]*mat4(e,f,g,h);}{int d=b[3];vec4 e=vec4(okUni_BoneMat[d*3].x,okUni_BoneMat[d*3+1].x,okUni_BoneMat[d*3+2].x,0.0);vec4 f=vec4(okUni_BoneMat[d*3].y,okUni_BoneMat[d*3+1].y,okUni_BoneMat[d*3+2].y,0.0);vec4 g=vec4(okUni_BoneMat[d*3].z,okUni_BoneMat[d*3+1].z,okUni_BoneMat[d*3+2].z,0.0);vec4 h=vec4(okUni_BoneMat[d*3].w,okUni_BoneMat[d*3+1].w,okUni_BoneMat[d*3+2].w,1.0);a+=okAttr_BoneWeight[3]*mat4(e,f,g,h);}\n#endif\n#ifdef OK_NORMAL\nokVary_Normal=(\n#ifdef OK_BILLBOARD\nokUni_TransMat[3]*\n#endif\nokUni_TransMat[1]*\n#ifdef OK_SKANIMATION\na*\n#endif\nvec4(okAttr_Normal,0.0)).xyz;\n#endif\n#ifdef OK_VERTEX_COLOR\nokVary_Color=okAttr_Color;\n#endif\n#ifdef OK_TC12\nokVary_TC12=okAttr_TC12;\n#else\n#ifdef OK_TC1\nokVary_TC1=okAttr_TC1;\n#endif\n#ifdef OK_TC2\nokVary_TC2=okAttr_TC2;\n#endif\n#endif\n#ifdef OK_TC34\nokVary_TC34=okAttr_TC34;\n#else\n#ifdef OK_TC3\nokVary_TC3=okAttr_TC3;\n#endif\n#ifdef OK_TC4\nokVary_TC4=okAttr_TC4;\n#endif\n#endif\n#ifdef OK_TANGENT\nokVary_Tangent=(\n#ifdef OK_BILLBOARD\nokUni_TransMat[3]*\n#endif\nokUni_TransMat[1]*\n#ifdef OK_SKANIMATION\na*\n#endif\nvec4(okAttr_Tangent,0.0)).xyz;\n#endif\n#ifdef OK_BINORMAL\nokVary_Binormal=(\n#ifdef OK_BILLBOARD\nokUni_TransMat[3]*\n#endif\nokUni_TransMat[1]*\n#ifdef OK_SKANIMATION\na*\n#endif\nvec4(okAttr_Binormal,0.0)).xyz;\n#endif\nvec4 c=\n#ifdef OK_BILLBOARD\nokUni_TransMat[3]*\n#endif\nokUni_TransMat[0]*\n#ifdef OK_SKANIMATION\na*\n#endif\nvec4(okAttr_Pos,1.0);okVary_Pos=c.xyz;gl_Position=okUni_TransMat[2]*c;okVary_ScrTC=gl_Position;}";this.$G.Lighting="void okFunc_DctLighting(vec3 normal,vec3 camVec,vec3 reflectVec,vec3 lightDir,vec3 lightColor\n#ifdef OK_DYNAMICSHADOW\n,vec4 shadowMask,vec4 shadowFactor\n#endif\n,inout vec3 diffuse,inout vec3 specular){vec3 curDiffuse=vec3(0.0),curSpecular=vec3(0.0);\n#ifdef OK_SCRIPT_DCTLIGHT_CODE\nokFunc_GetMaterialDctLighting(lightDir,lightColor,curDiffuse,curSpecular);\n#else\nvec3 lightVec=-lightDir;float diffuseFactor=max(0.0,dot(lightVec,normal));\n#ifdef OK_SCRIPT_DIFFUSEPOWER_CODE\ndiffuseFactor=pow(diffuseFactor,okFunc_GetMaterialDiffusePower());\n#endif\ncurDiffuse=diffuseFactor*lightColor;float specularFactor=pow(clamp(dot(reflectVec,lightVec),0.0,1.0),okFunc_GetMaterialSpecularPower());curSpecular=specularFactor*lightColor;\n#endif\n#ifdef OK_DYNAMICSHADOW\nvec3 shadow=mix(vec3(1)-lightColor,vec3(1),dot(shadowMask,shadowFactor));curDiffuse*=shadow;curSpecular*=shadow;\n#endif\ndiffuse+=curDiffuse;specular+=curSpecular;}void okFunc_PointLighting(vec3 pos,vec3 normal,vec3 camVec,vec3 reflectVec,vec3 lightPos,float lightRange,vec3 lightColor\n#ifdef OK_DYNAMICSHADOW\n,vec4 shadowMask,vec4 shadowFactor\n#endif\n,inout vec3 diffuse,inout vec3 specular){vec3 curDiffuse=vec3(0.0),curSpecular=vec3(0.0);\n#ifdef OK_SCRIPT_POINTLIGHT_CODE\nokFunc_GetMaterialPointLighting(lightPos,lightColor,lightRange,curDiffuse,curSpecular);\n#else\nvec3 lightVec=normalize(lightPos-pos);float lenFactor=max(0.0,1.0-distance(lightPos,pos)/lightRange);float diffuseFactor=max(0.0,dot(lightVec,normal))*lenFactor;\n#ifdef OK_SCRIPT_DIFFUSEPOWER_CODE\ndiffuseFactor=pow(diffuseFactor,okFunc_GetMaterialDiffusePower());\n#endif\ncurDiffuse=diffuseFactor*lightColor;float specularFactor=pow(clamp(dot(reflectVec,lightVec),0.0,1.0),okFunc_GetMaterialSpecularPower());curSpecular=specularFactor*lightColor;\n#endif\n#ifdef OK_DYNAMICSHADOW\nvec3 shadow=mix(vec3(1)-lightColor,vec3(1),dot(shadowMask,shadowFactor));curDiffuse*=shadow;curSpecular*=shadow;\n#endif\ndiffuse+=curDiffuse;specular+=curSpecular;}void okFunc_SpotLighting(vec3 pos,vec3 normal,vec3 camVec,vec3 reflectVec,vec3 lightPos,vec3 lightDir,float innerCone,float outerCone,vec3 lightColor\n#ifdef OK_DYNAMICSHADOW\n,vec4 shadowMask,vec4 shadowFactor\n#endif\n,inout vec3 diffuse,inout vec3 specular){vec3 curDiffuse=vec3(0.0),curSpecular=vec3(0.0);\n#ifdef OK_SCRIPT_SPOTLIGHT_CODE\nokFunc_GetMaterialSpotLighting(lightPos,lightColor,lightDir,innerCone,outerCone,curDiffuse,curSpecular);\n#else\nvec3 lightVec=normalize(lightPos-pos);float spotAngl=dot(lightVec,-lightDir);float innerAngl=cos(innerCone*0.5);float outerAngl=cos(outerCone*0.5);float diffuseFactor=clamp((spotAngl-outerAngl)/(innerAngl-outerAngl),0.0,1.0)*max(0.0,dot(lightVec,normal));\n#ifdef OK_SCRIPT_DIFFUSEPOWER_CODE\ndiffuseFactor=pow(diffuseFactor,okFunc_GetMaterialDiffusePower());\n#endif\ncurDiffuse=diffuseFactor*lightColor;float specularFactor=pow(clamp(dot(reflectVec,lightVec),0.0,1.0),okFunc_GetMaterialSpecularPower());curSpecular=specularFactor*lightColor;\n#endif\n#ifdef OK_DYNAMICSHADOW\nvec3 shadow=mix(vec3(1)-lightColor,vec3(1),dot(shadowMask,shadowFactor));curDiffuse*=shadow;curSpecular*=shadow;\n#endif\ndiffuse+=curDiffuse;specular+=curSpecular;}";this.$G.Utility="vec4 okFunc_EncodeFloat(float d){vec4 a=vec4(256*256*256,256*256,256,1);vec4 b=vec4(0,1.0/256.0,1.0/256.0,1.0/256.0);vec4 c=fract(d*a);c-=c.xxyz*b;return c;}float okFunc_DecodeFloat(vec4 e){return dot(vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0),e);}vec3 okFunc_DecodeChar3(float d){return fract(d*vec3(1.0,256.0,65536.0));}vec4 okFunc_FetchTexture(sampler2D f,vec2 g){return texture2D(f,g);}vec4 okFunc_FetchTexture(sampler2D f,vec2 g,float k,float l,float m){m=floor(m);vec2 h=1.0/vec2(k,l);float i=floor(m/k);float j=m-k*i;return texture2D(f,vec2(j,i)*h+g/vec2(k,l));}vec4 okFunc_FetchTexture(samplerCube f,vec3 n){return textureCube(f,n);}vec4 okFunc_FetchDummyTexture(vec2 g){return vec4(1.0);}vec4 okFunc_FetchDummyTexture(vec2 g,float k,float l,float m){return vec4(1.0);}vec4 okFunc_FetchDummyTexture(vec3 n){return vec4(1.0);}";this.aVertexSourceMap.Depth='#include"Utility"\n#include"HeaderCommon"\n#include"HeaderVS"\nvoid main(void){okFunc_ProcessVertex();}';this.aFragmentSourceMap.Depth='#include"Utility"\n#include"HeaderCommon"\n#include"HeaderFS"\nvoid main(void){okFunc_ProcessFragment();\n#ifdef OK_SUPPORT_FLOAT_RT\ngl_FragColor.a=gl_FragCoord.z;\n#else\ngl_FragColor=okFunc_EncodeFloat(gl_FragCoord.z);\n#endif\n}';this.aVertexSourceMap.DepthDefault='#include"Utility"\n#include"HeaderVS"\nvoid main(void){gl_Position=okUni_TransMat[2]*(okUni_TransMat[0]*vec4(okAttr_Pos,1.0));}';this.aFragmentSourceMap.DepthDefault='#include"Utility"\nvoid main(void){\n#ifdef OK_SUPPORT_FLOAT_RT\ngl_FragColor.a=gl_FragCoord.z;\n#else\ngl_FragColor=encodeFloat(gl_FragCoord.z);\n#endif\n}';this.aVertexSourceMap.FlatColor="#if TEX\nvarying vec2 fragmentTexCoord;\n#endif\nattribute vec3 position;\n#if TEX\nattribute vec2 texcoord;\n#endif\nuniform mat4 matWorld;uniform mat4 matViewProj;void main(void){\n#if TEX\nfragmentTexCoord=texcoord;\n#endif\ngl_Position=matViewProj*matWorld*vec4(position,1.0);}";this.aFragmentSourceMap.FlatColor="#if TEX\nvarying vec2 fragmentTexCoord;\n#endif\nuniform vec3 color;\n#if TEX\nuniform sampler2D texSampler;\n#endif\nvoid main(void){\n#if TEX\nvec3 a=color*texture2D(texSampler,fragmentTexCoord).xyz;\n#else\nvec3 a=color;\n#endif\ngl_FragColor=vec4(a,1.0);}";this.aVertexSourceMap.GaussianFilter="varying vec2 okVary_ScrTC;attribute vec3 okAttr_Pos;void main(void){gl_Position=vec4(okAttr_Pos,1.0);okVary_ScrTC=(gl_Position.xy+1.0)*0.5;}";this.aFragmentSourceMap.GaussianFilter="varying vec2 okVary_ScrTC;uniform vec4 okUni_ScreenPosOffsetAndScale;uniform vec2 okUni_TexelSize;uniform sampler2D okUni_Tex;void main(void){vec2 a=okUni_ScreenPosOffsetAndScale.xy+okVary_ScrTC*okUni_ScreenPosOffsetAndScale.zw;vec4 b=texture2D(okUni_Tex,a)*0.25;b+=(texture2D(okUni_Tex,a+okUni_TexelSize*vec2(3.0,0.0))+texture2D(okUni_Tex,a+okUni_TexelSize*vec2(-3.0,0.0))+texture2D(okUni_Tex,a+okUni_TexelSize*vec2(0.0,3.0))+texture2D(okUni_Tex,a+okUni_TexelSize*vec2(0.0,-3.0)))*0.125;b+=(texture2D(okUni_Tex,a+okUni_TexelSize*vec2(3.0,3.0))+texture2D(okUni_Tex,a+okUni_TexelSize*vec2(3.0,-3.0))+texture2D(okUni_Tex,a+okUni_TexelSize*vec2(-3.0,3.0))+texture2D(okUni_Tex,a+okUni_TexelSize*vec2(-3.0,-3.0)))*0.0625;gl_FragColor=b;}";this.aVertexSourceMap.Glow='#include"Utility"\n#include"HeaderCommon"\n#include"HeaderVS"\nvoid main(void){okFunc_ProcessVertex();}';this.aFragmentSourceMap.Glow='#include"Utility"\n#include"HeaderCommon"\n#include"HeaderFS"\nvoid main(void){okFunc_ProcessFragment();vec3 glowColor=okUni_General[4].xyz;\n#ifdef OK_FOG\n{float d=distance(okVary_Pos,okUni_General[8].xyz);float fog=clamp(1.0-1.0/exp(clamp((d-okUni_General[10].x)*okUni_General[10].y,0.0,1.0)*okUni_General[9].w),0.0,1.0);fog=smoothstep(0.0,0.95,fog);glowColor=mix(glowColor,okUni_General[9].xyz,fog);}\n#endif\ngl_FragColor=vec4(glowColor,1.0);}';this.aVertexSourceMap.GlowDefault='#include"HeaderVS"\nvoid main(void){gl_Position=okUni_TransMat[2]*(okUni_TransMat[0]*vec4(okAttr_Pos,1.0));}';this.aFragmentSourceMap.GlowDefault="void main(void){gl_FragColor=vec4(0.0,0.0,0.0,0.0);}";this.aVertexSourceMap.Lighting='#include"Utility"\n#include"HeaderCommon"\n#include"HeaderVS"\nvoid main(void){okFunc_ProcessVertex();}';this.aFragmentSourceMap.Lighting='#include"Utility"\n#include"HeaderCommon"\n#include"HeaderFS"\n#include"Lighting"\n#ifdef OK_DYNAMICSHADOW\nuniform sampler2D okUni_shadowSampler;\n#endif\nvoid main(void){okFunc_ProcessFragment();\n#ifdef OK_DYNAMICLIGHTING\nvec3 emissive=okFunc_GetMaterialEmissive();vec3 ambient=mix(okUni_General[5].xyz,okUni_General[6].xyz,(N.y+1.0)*0.5);ambient*=(okUni_General[1].xyz+okUni_General[3].xyz*pow(clamp(dot(-V,R),0.0,1.0),8.0)*okFunc_GetMaterialSpecular());vec3 diffuse=vec3(0.0);vec3 specular=vec3(0.0);vec3 customlighting=vec3(0.0);\n#ifdef OK_DYNAMICSHADOW\nvec4 shadowFactor=vec4(texture2D(okUni_shadowSampler,SCRTC).xyz,1.0);\n#endif\n#endif\n#ifdef OK_DYNAMICLIGHTING\n#if OK_DCTLIGHT_NUM>=1\nokFunc_DctLighting(N,-V,R,okUni_General[11].xyz,okUni_General[15].xyz\n#ifdef OK_DYNAMICSHADOW\n,okUni_General[19],shadowFactor\n#endif\n,diffuse,specular);\n#endif\n#if OK_DCTLIGHT_NUM>=2\nokFunc_DctLighting(N,-V,R,okUni_General[12].xyz,okUni_General[16].xyz\n#ifdef OK_DYNAMICSHADOW\n,okUni_General[20],shadowFactor\n#endif\n,diffuse,specular);\n#endif\n#if OK_DCTLIGHT_NUM>=3\nokFunc_DctLighting(N,-V,R,okUni_General[13].xyz,okUni_General[17].xyz\n#ifdef OK_DYNAMICSHADOW\n,okUni_General[21],shadowFactor\n#endif\n,diffuse,specular);\n#endif\n#if OK_DCTLIGHT_NUM>=4\nokFunc_DctLighting(N,-V,R,okUni_General[14].xyz,okUni_General[18].xyz\n#ifdef OK_DYNAMICSHADOW\n,okUni_General[22],shadowFactor\n#endif\n,diffuse,specular);\n#endif\n#if OK_POINTLIGHT_NUM>=1\nokFunc_PointLighting(P,N,-V,R,okUni_General[23].xyz,okUni_General[23].w,okUni_General[27].xyz\n#ifdef OK_DYNAMICSHADOW\n,okUni_General[31],shadowFactor\n#endif\n,diffuse,specular);\n#endif\n#if OK_POINTLIGHT_NUM>=2\nokFunc_PointLighting(P,N,-V,R,okUni_General[24].xyz,okUni_General[24].w,okUni_General[28].xyz\n#ifdef OK_DYNAMICSHADOW\n,okUni_General[32],shadowFactor\n#endif\n,diffuse,specular);\n#endif\n#if OK_POINTLIGHT_NUM>=3\nokFunc_PointLighting(P,N,-V,R,okUni_General[25].xyz,okUni_General[25].w,okUni_General[29].xyz\n#ifdef OK_DYNAMICSHADOW\n,okUni_General[33],shadowFactor\n#endif\n,diffuse,specular);\n#endif\n#if OK_POINTLIGHT_NUM>=4\nokFunc_PointLighting(P,N,-V,R,okUni_General[26].xyz,okUni_General[26].w,okUni_General[30].xyz\n#ifdef OK_DYNAMICSHADOW\n,okUni_General[34],shadowFactor\n#endif\n,diffuse,specular);\n#endif\n#if OK_SPOTLIGHT_NUM>=1\nokFunc_SpotLighting(P,N,-V,R,okUni_General[35].xyz,okUni_General[39].xyz,okUni_General[43].x,okUni_General[43].y,vec3(okUni_General[39].w,okUni_General[43].zw)\n#ifdef OK_DYNAMICSHADOW\n,okUni_General[47],shadowFactor\n#endif\n,diffuse,specular);\n#endif\n#if OK_SPOTLIGHT_NUM>=2\nokFunc_SpotLighting(P,N,-V,R,okUni_General[36].xyz,okUni_General[40].xyz,okUni_General[44].x,okUni_General[44].y,vec3(okUni_General[40].w,okUni_General[44].zw)\n#ifdef OK_DYNAMICSHADOW\n,okUni_General[48],shadowFactor\n#endif\n,diffuse,specular);\n#endif\n#if OK_SPOTLIGHT_NUM>=3\nokFunc_SpotLighting(P,N,-V,R,okUni_General[37].xyz,okUni_General[41].xyz,okUni_General[45].x,okUni_General[45].y,vec3(okUni_General[41].w,okUni_General[45].zw)\n#ifdef OK_DYNAMICSHADOW\n,okUni_General[49],shadowFactor\n#endif\n,diffuse,specular);\n#endif\n#if OK_SPOTLIGHT_NUM>=4\nokFunc_SpotLighting(P,N,-V,R,okUni_General[38].xyz,okUni_General[42].xyz,okUni_General[46].x,okUni_General[46].y,vec3(okUni_General[42].w,okUni_General[46].zw)\n#ifdef OK_DYNAMICSHADOW\n,okUni_General[50],shadowFactor\n#endif\n,diffuse,specular);\n#endif\n#endif\n#ifdef OK_DYNAMICLIGHTING\nvec3 lightingColor=emissive+(ambient+diffuse)*okFunc_GetMaterialDiffuse()+specular*okFunc_GetMaterialSpecular();\n#else\nvec3 lightingColor=okFunc_GetMaterialEmissive()+(okUni_General[1].xyz+okUni_General[2].xyz)*okFunc_GetMaterialDiffuse();\n#endif\n#ifdef OK_AUTO_VERTEX_COLOR\nlightingColor+=VC;\n#endif\n#ifdef OK_FOG\n{float d=distance(okVary_Pos,okUni_General[8].xyz);float fog=clamp(1.0-1.0/exp(clamp((d-okUni_General[10].x)*okUni_General[10].y,0.0,1.0)*okUni_General[9].w),0.0,1.0);fog=smoothstep(0.0,0.95,fog);lightingColor=mix(lightingColor,okUni_General[9].xyz,fog);}\n#endif\ngl_FragColor=vec4(lightingColor,\n#if defined(OK_BLEND)||defined(OK_ALPHA_TEST)\nokFunc_GetMaterialAlpha()\n#else\n1.0\n#endif\n);}';this.aVertexSourceMap.LightingDefault='#include"HeaderVS"\nvoid main(void){gl_Position=okUni_TransMat[2]*(okUni_TransMat[0]*vec4(okAttr_Pos,1.0));}';this.aFragmentSourceMap.LightingDefault="void main(void){gl_FragColor=vec4(1.0,0.0,0.0,1.0);}";this.aVertexSourceMap.Output="varying vec2 okVary_ScrTC;attribute vec3 okAttr_Pos;uniform vec4 okUni_SrcOffsetScale;uniform vec4 okUni_DestOffsetScale;void main(void){vec2 a=(okAttr_Pos.xy+1.0)*0.5;gl_Position=vec4((okUni_DestOffsetScale.xy+a*okUni_DestOffsetScale.zw)*2.0-1.0,okAttr_Pos.z,1.0);okVary_ScrTC=okUni_SrcOffsetScale.xy+a*okUni_SrcOffsetScale.zw;}";this.aFragmentSourceMap.Output="varying vec2 okVary_ScrTC;uniform sampler2D okUni_Tex;void main(void){vec4 a=texture2D(okUni_Tex,okVary_ScrTC);gl_FragColor=a;}";this.aVertexSourceMap.ShadowDepth='#include"Utility"\n#include"HeaderCommon"\nvarying float okVary_Depth;\n#include"HeaderVS"\nvoid main(void){okFunc_ProcessVertex();okVary_Depth=gl_Position.z;}';this.aFragmentSourceMap.ShadowDepth='#include"Utility"\n#include"HeaderCommon"\nvarying float okVary_Depth;\n#include"HeaderFS"\nvoid main(void){okFunc_ProcessFragment();\n#ifdef OK_SUPPORT_FLOAT_RT\ngl_FragColor.a=okVary_Depth;\n#else\ngl_FragColor=okFunc_EncodeFloat(okVary_Depth);\n#endif\n}';this.aVertexSourceMap.ShadowDepthDefault='#include"Utility"\nvarying float okVary_Depth;\n#include"HeaderVS"\nvoid main(void){gl_Position=okUni_TransMat[2]*(okUni_TransMat[0]*vec4(okAttr_Pos,1.0));okVary_Depth=gl_Position.z;}';this.aFragmentSourceMap.ShadowDepthDefault='#include"Utility"\nvarying float okVary_Depth;void main(void){\n#ifdef OK_SUPPORT_FLOAT_RT\ngl_FragColor.a=okVary_Depth;\n#else\ngl_FragColor=okFunc_EncodeFloat(okVary_Depth);\n#endif\n}';this.aVertexSourceMap.ShadowFinal="varying vec4 screenPos;uniform mat4 matArray[3];attribute vec4 vertMask0;attribute vec4 vertMask1;uniform vec3 vertList[8];void main(void){vec3 a=vertList[0]*vertMask0.x;a+=vertList[1]*vertMask0.y;a+=vertList[2]*vertMask0.z;a+=vertList[3]*vertMask0.w;a+=vertList[4]*vertMask1.x;a+=vertList[5]*vertMask1.y;a+=vertList[6]*vertMask1.z;a+=vertList[7]*vertMask1.w;gl_Position=matArray[0]*vec4(a,1);screenPos=gl_Position;}";this.aFragmentSourceMap.ShadowFinal="varying vec4 screenPos;uniform mat4 matArray[3];uniform vec4 screenPosOffsetAndScale;uniform vec3 shadowPixelSizeAndOffset;uniform vec4 shadowClamp;uniform sampler2D samplerArray[2];vec4 a=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);float o(vec4 g){vec4 i=vec4(min(1.0,g.z-shadowPixelSizeAndOffset.z));vec2 j=g.xy/g.w;if(j.x<shadowClamp.x||j.x>shadowClamp.z||j.y<shadowClamp.y||j.y>shadowClamp.w)discard;\n#ifdef OK_SUPPORT_FLOAT_RT\nfloat k=texture2D(samplerArray[1],j).a;\n#else\nfloat k=dot(a,texture2D(samplerArray[1],j));\n#endif\nvec4 m=vec4(dot(a,texture2D(samplerArray[1],j+shadowPixelSizeAndOffset.xy*vec2(-1,-1))),dot(a,texture2D(samplerArray[1],j+shadowPixelSizeAndOffset.xy*vec2(0,-1))),dot(a,texture2D(samplerArray[1],j+shadowPixelSizeAndOffset.xy*vec2(1,-1))),dot(a,texture2D(samplerArray[1],j+shadowPixelSizeAndOffset.xy*vec2(-1,0))));vec4 n=vec4(dot(a,texture2D(samplerArray[1],j+shadowPixelSizeAndOffset.xy*vec2(1,0))),dot(a,texture2D(samplerArray[1],j+shadowPixelSizeAndOffset.xy*vec2(-1,1))),dot(a,texture2D(samplerArray[1],j+shadowPixelSizeAndOffset.xy*vec2(0,1))),dot(a,texture2D(samplerArray[1],j+shadowPixelSizeAndOffset.xy*vec2(1,1))));return(dot(sign(m-i),vec4(1.0))+dot(sign(n-i),vec4(1.0))+k)*0.111111;}void main(void){vec2 b=screenPos.xy/screenPos.w;vec2 c=screenPosOffsetAndScale.xy+(b+1.0)*0.5*screenPosOffsetAndScale.zw;\n#ifdef OK_SUPPORT_FLOAT_RT\nfloat d=texture2D(samplerArray[0],c).a;\n#else\nfloat d=dot(a,texture2D(samplerArray[0],c));\n#endif\nvec4 f=matArray[1]*vec4(b,d*2.0-1.0,1.0);f/=f.w;vec4 g=matArray[2]*f;float h=o(g);gl_FragColor=vec4(vec3(h),1.0);}"}okShaderManager.prototype={clear:function(){this.$16="mediump";for(var d in this.$F1){this.$F1[d].releaseShader();this.$F1[d].releaseSource()}okA._object(this.$F1);this.$F1=okA.object();for(var a in this.$E){this.$E[a].releaseShader();this.$E[a].releaseSource()}okA._object(this.$E);this.$E=okA.object();for(var c in this.$81){this.$81[c].releaseProgram()}okA._object(this.$81);this.$81=okA.object()},setShaderSourcePath:function(a){this.$k6=a},getProgram:function(a,d,c){switch(a){case"Lighting":return this.getLightingProgram(d,c);case"Depth":return this.getDepthProgram(d,c);case"Glow":return this.getGlowProgram(d,c);case"ShadowDepth":return this.getShadowDepthProgram(d,c);case"ShadowFinal":return this.getShadowFinalProgram();case"Output":return this.getOutputProgram()}},getFlatColorProgram:function(f){var p="Fl";var o=this.$81[p];if(o!=null){return o}var l="Fl";var c="Fl";var n=this.$F1[l];var h=this.$E[c];if(n==null||h==null){var a=null,k=null;if(n==null){a=new okShader(this.rc,35633)}if(h==null){k=new okShader(this.rc,35632)}var d=new Object;d.sVs=a;d.sFs=k;this._getSrc("FlatColor",d);var m=okA.object();this._getGlobalDef(m);m.TEX=(f?1:0);if(n==null){a.compile(m);this.$F1[l]=a;n=a}if(h==null){k.setFloatPrecision(this.$16);k.compile(m);this.$E[c]=k;h=k}okA._object(m)}var e=new okProgram(this.rc);e.attachVertexShader(n);e.attachFragmentShader(h);e.link();this.$81[p]=e;return e},getOutputProgram:function(){var n="Op";var m=this.$81[n];if(m!=null){return m}var k="Op";var c="Op";var l=this.$F1[k];var f=this.$E[c];if(l==null||f==null){var a=null,h=null;if(l==null){a=new okShader(this.rc,35633)}if(f==null){h=new okShader(this.rc,35632)}var d=new Object;d.sVs=a;d.sFs=h;this._getSrc("Output",d);if(l==null){a.compile();this.$F1[k]=a;l=a}if(f==null){h.setFloatPrecision(this.$16);h.compile();this.$E[c]=h;f=h}}var e=new okProgram(this.rc);e.attachVertexShader(l);e.attachFragmentShader(f);e.link();this.$81[n]=e;return e},getGaussianProgram:function(l){var p="Gau"+l;var o=this.$81[p];if(o!=null){return o}var k="Gau";var c=p;var n=this.$F1[k];var f=this.$E[c];if(n==null||f==null){var m=new Object;this._getGlobalDef(m);if(l==0){m.OK_HORIZONTAL=1}else{m.OK_VERTICAL=1}var a=null,h=null;if(n==null){a=new okShader(this.rc,35633)}if(f==null){h=new okShader(this.rc,35632)}var d=new Object;d.sVs=a;d.sFs=h;this._getSrc("GaussianFilter",d);if(n==null){a.compile(m);this.$F1[k]=a;n=a}if(f==null){h.setFloatPrecision(this.$16);h.compile(m);this.$E[c]=h;f=h}}var e=new okProgram(this.rc);e.attachVertexShader(n);e.attachFragmentShader(f);e.link();this.$81[p]=e;return e},getDefaultDepthProgram:function(){var h="DeD"+this.sGlobayKey;var m=this.$81[h];if(m!=null){return m}var l=this.$F1[h];var e=this.$E[h];if(l==null||e==null){var k=okA.object();this._getGlobalDef(k);var a=null,f=null;if(l==null){a=new okShader(this.rc,35633)}if(e==null){f=new okShader(this.rc,35632)}var c=new Object;c.sVs=a;c.sFs=f;this._getSrc("DepthDefault",c);if(l==null){a.compile(k);this.$F1[h]=a;l=a}if(e==null){f.setFloatPrecision(this.$16);f.compile(k);this.$E[h]=f;e=f}okA._object(k)}var d=new okProgram(this.rc);d.attachVertexShader(l);d.attachFragmentShader(e);d.link();this.$81[h]=d;return d},getDepthProgram:function(m,f){var q="De"+f._getShdKeyP(m,true);var p=this.$81[q];if(p=="Fail"){return this.getDefaultShadowDepthProgram()}if(p!=null){return p}var l="De"+f._getShdKeyV(m,true);var c="De"+f._getShdKeyF(m,true);var o=this.$F1[l];var h=this.$E[c];if(o==null||h==null){var n=okA.object();this._getGlobalDef(n);f._getShdDef(m,true,n);var a=null,k=null;if(o==null){a=new okShader(this.rc,35633)}if(h==null){k=new okShader(this.rc,35632)}var d=new Object;d.sVs=a;d.sFs=k;this._getSrc("Depth",d);if(o==null){if(a.compile(n)){this.$F1[l]=a;o=a}else{this.$81[q]="Fail";return this.getDefaultDepthProgram()}}if(h==null){k.setFloatPrecision(this.$16);if(k.compile(n)){this.$E[c]=k;h=k}else{this.$81[q]="Fail";return this.getDefaultDepthProgram()}}okA._object(n)}var e=new okProgram(this.rc);e.attachVertexShader(o);e.attachFragmentShader(h);if(!e.link()){return this.getDefaultDepthProgram()}this.$81[q]=e;return e},getGlowProgram:function(m,f){var n=f.$r5;var s="Gl"+f._getShdKeyP(m,true);if(m.$b2&&n.$a2){s+="_1"}var q=this.$81[s];if(q=="Fail"){return this.getDefaultShadowDepthProgram()}if(q!=null){return q}var l="Gl"+f._getShdKeyV(m,true);var c="Gl"+f._getShdKeyF(m,true);if(m.$b2&&n.$a2){c+="_1"}var p=this.$F1[l];var h=this.$E[c];if(p==null||h==null){var o=okA.object();this._getGlobalDef(o);if(m.$b2&&n.$a2){o.OK_FOG="1"}f._getShdDef(m,true,o);var a=null,k=null;if(p==null){a=new okShader(this.rc,35633)}if(h==null){k=new okShader(this.rc,35632)}var d=new Object;d.sVs=a;d.sFs=k;this._getSrc("Glow",d);if(p==null){if(a.compile(o)){this.$F1[l]=a;p=a}else{this.$81[s]="Fail";return this.getDefaultDepthProgram()}}if(h==null){k.setFloatPrecision(this.$16);if(k.compile(o)){this.$E[c]=k;h=k}else{this.$81[s]="Fail";return this.getDefaultDepthProgram()}}okA._object(o)}var e=new okProgram(this.rc);e.attachVertexShader(p);e.attachFragmentShader(h);if(!e.link()){return this.getDefaultDepthProgram()}this.$81[s]=e;return e},getDefaultGlowProgram:function(){var h="GlD";var m=this.$81[h];if(m!=null){return m}var l=this.$F1[h];var e=this.$E[h];if(l==null||e==null){var k=okA.object();this._getGlobalDef(k);var a=null,f=null;if(l==null){a=new okShader(this.rc,35633)}if(e==null){f=new okShader(this.rc,35632)}var c=new Object;c.sVs=a;c.sFs=f;this._getSrc("GlowDefault",c);if(l==null){a.compile(k);this.$F1[h]=a;l=a}if(e==null){f.setFloatPrecision(this.$16);f.compile(k);this.$E[h]=f;e=f}okA._object(k)}var d=new okProgram(this.rc);d.attachVertexShader(l);d.attachFragmentShader(e);d.link();this.$81[h]=d;return d},getDefaultShadowDepthProgram:function(){var h="ShDD";var m=this.$81[h];if(m!=null){return m}var l=this.$F1[h];var e=this.$E[h];if(l==null||e==null){var k=okA.object();this._getGlobalDef(k);var a=null,f=null;if(l==null){a=new okShader(this.rc,35633)}if(e==null){f=new okShader(this.rc,35632)}var c=new Object;c.sVs=a;c.sFs=f;this._getSrc("ShadowDepthDefault",c);if(l==null){a.compile(k);this.$F1[h]=a;l=a}if(e==null){f.setFloatPrecision(this.$16);f.compile(k);this.$E[h]=f;e=f}okA._object(k)}var d=new okProgram(this.rc);d.attachVertexShader(l);d.attachFragmentShader(e);d.link();this.$81[h]=d;return d},getShadowDepthProgram:function(m,f){var q="ShD"+f._getShdKeyP(m,true);var p=this.$81[q];if(p=="Fail"){return this.getDefaultShadowDepthProgram()}if(p!=null){return p}var l="ShD"+f._getShdKeyV(m,true);var c="ShD"+f._getShdKeyF(m,true);var o=this.$F1[l];var h=this.$E[c];if(o==null||h==null){var n=okA.object();this._getGlobalDef(n);f._getShdDef(m,true,n);var a=null,k=null;if(o==null){a=new okShader(this.rc,35633)}if(h==null){k=new okShader(this.rc,35632)}var d=new Object;d.sVs=a;d.sFs=k;this._getSrc("ShadowDepth",d);if(o==null){if(a.compile(n)){this.$F1[l]=a;o=a}else{this.$81[q]="Fail";return this.getDefaultShadowDepthProgram()}}if(h==null){k.setFloatPrecision(this.$16);if(k.compile(n)){this.$E[c]=k;h=k}else{this.$81[q]="Fail";return this.getDefaultShadowDepthProgram()}}okA._object(n)}var e=new okProgram(this.rc);e.attachVertexShader(o);e.attachFragmentShader(h);if(!e.link()){this.$81[q]="Fail";return this.getDefaultShadowDepthProgram()}this.$81[q]=e;return e},getShadowFinalProgram:function(){var h="ShF";var m=this.$81[h];if(m!=null){return m}var l=this.$F1[h];var e=this.$E[h];if(l==null||e==null){var k=okA.object();this._getGlobalDef(k);var a=null,f=null;if(l==null){a=new okShader(this.rc,35633)}if(e==null){f=new okShader(this.rc,35632)}var c=new Object;c.sVs=a;c.sFs=f;this._getSrc("ShadowFinal",c);if(l==null){a.compile(k);this.$F1[h]=a;l=a}if(e==null){f.setFloatPrecision(this.$16);f.compile(k);this.$E[h]=f;e=f}okA._object(k)}var d=new okProgram(this.rc);d.attachVertexShader(l);d.attachFragmentShader(e);d.link();this.$81[h]=d;return d},getDefaultLightingProgram:function(){var h="LiD";var m=this.$81[h];if(m!=null){return m}var l=this.$F1[h];var e=this.$E[h];if(l==null||e==null){var k=okA.object();this._getGlobalDef(k);var a=null,f=null;if(l==null){a=new okShader(this.rc,35633)}if(e==null){f=new okShader(this.rc,35632)}var c=new Object;c.sVs=a;c.sFs=f;this._getSrc("LightingDefault",c);if(l==null){a.compile(k);this.$F1[h]=a;l=a}if(e==null){f.setFloatPrecision(this.$16);f.compile(k);this.$E[h]=f;e=f}okA._object(k)}var d=new okProgram(this.rc);d.attachVertexShader(l);d.attachFragmentShader(e);d.link();this.$81[h]=d;return d},getLightingProgram:function(m,f){var q="Li"+f._getShdKeyP(m,false);var p=this.$81[q];if(p=="Fail"){return this.getDefaultLightingProgram()}else{if(p){return p}}var l="Li"+f._getShdKeyV(m,false);var c="Li"+f._getShdKeyF(m,false);var o=this.$F1[l];var h=this.$E[c];if(o==null||h==null){var n=okA.object();this._getGlobalDef(n);f._getShdDef(m,false,n);var a=null,k=null;if(o==null){a=new okShader(this.rc,35633)}if(h==null){k=new okShader(this.rc,35632)}var d=new Object;d.sVs=a;d.sFs=k;this._getSrc("Lighting",d);if(o==null){if(a.compile(n)){this.$F1[l]=a;o=a}else{this.$81[q]="Fail";return this.getDefaultLightingProgram()}}if(h==null){k.setFloatPrecision(this.$16);if(k.compile(n)){this.$E[c]=k;h=k}else{this.$81[q]="Fail";return this.getDefaultLightingProgram()}}okA._object(n)}var e=new okProgram(this.rc);e.attachVertexShader(o);e.attachFragmentShader(h);if(!e.link()){this.$81[q]="Fail";return this.getDefaultLightingProgram()}this.$81[q]=e;return e},_getSrc:function(a,c){if(this.aVertexSourceMap){if(c.sVs){c.sVs.loadSource(this.aVertexSourceMap[a],this.$G)}if(c.sFs){c.sFs.loadSource(this.aFragmentSourceMap[a],this.$G)}}},_getGlobalDef:function(c){for(var a in this.$F){c[a]=this.$F[a]}}};function okRenderBaseStage(){this.$K5=null;this.$82=true;this.$1=[new okMat4(),new okMat4(),new okMat4(),new okMat4()]}okRenderBaseStage.prototype.clear=function(){this.$82=true;this.deleteResource()};okRenderBaseStage.prototype.enable=function(a){this.$82=a};okRenderBaseStage.prototype.isEnabled=function(){return this.$82};okRenderBaseStage.prototype.init=function(a){this.$K5=a};okRenderBaseStage.prototype.createResource=function(){};okRenderBaseStage.prototype.deleteResource=function(){};okRenderBaseStage.prototype.beginView=function(a){};okRenderBaseStage.prototype.endView=function(){};okRenderBaseStage.prototype.prepare=function(){};okRenderBaseStage.prototype.render=function(){};okRenderBaseStage.prototype._renderBatches=function(v,U,m,k,aa,ag,B){var W=this.$K5.rc;var l=this.$K5.$G5;var I=this.$K5.$L5;var R=this.$K5.$J5;var V=this.$K5.$B6;var ad=l.$N2;var Q=l.$34;var ai=l.$24;var J=I.getResource("$R$White");var ah=I.getResource("$R$WhiteCube");var M=ad.getPos();var e=(B?B:ad.getViewProjMat4());var x=ad.getViewInvMat4();x.m03=x.m13=x.m23=0;this.$1[2]=e;this.$1[3]=x;var z=okA.array();z.push(0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,1,1,1,0,l.$Y6.x,l.$Y6.y,l.$Y6.z,l.$b4/1000,l.$07.x,l.$07.y,l.$07.z,l.$i3,ad.$W4/Q,(ai-ad.$X4-ad.$U4)/ai,ad.$V4/Q,ad.$U4/ai,M.x,M.y,M.z,1,l.$W6.x,l.$W6.y,l.$W6.z,l.$73,l.$93,1/(l.$83-l.$93),0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1);var S=v.length;for(var af=0;af<S;++af){var o=v[af];if(aa&&aa(o)==false){continue}var C=o.$a;var h=o.$r5;var Y=l.$t2&&!h.$I2&&o.$s2&&l.$q1[1];var E=0;var H=V.getProgram(U,l,o);H.bind();this.$1[0]=o.$g5;this.$1[1]=o.$i5;H.setUniformMat4Array("okUni_TransMat",this.$1);var N=C.Position;if(N){H.setAttribute("okAttr_Pos",N.buf,N.$I4,N.iOffset,N.iStride)}if(m||h.$O1){var O=C.Normal;if(O){H.setAttribute("okAttr_Normal",O.buf,O.$I4,O.iOffset,O.iStride)}var q=C.Color;if(q){H.setAttribute("okAttr_Color",q.buf,q.$I4,q.iOffset,q.iStride)}}if(h.$22){W.enable(2929)}else{W.disable(2929)}if(h.$32){W.depthMask(true)}else{W.depthMask(false)}if(h.$A2){W.disable(2884)}else{W.enable(2884)}if(o.$k4==1){W.lineWidth(h.$g3)}if(h.$V1){W.blendEquationSeparate(h.$S3,h.$T3);W.blendFuncSeparate(h.$V3,h.$Q3,h.$W3,h.$R3)}if(k||h.$O1){z[0]=h.$V6.x;z[1]=h.$V6.y;z[2]=h.$V6.z;z[3]=h.$c3;z[4]=h.$Q6.x;z[5]=h.$Q6.y;z[6]=h.$Q6.z;z[7]=h.$p3;z[8]=h.$U6.x;z[9]=h.$U6.y;z[10]=h.$U6.z;z[11]=h.$23;z[12]=h.$17.x;z[13]=h.$17.y;z[14]=h.$17.z;z[15]=h.$33;z[16]=h.$X6.x;z[17]=h.$X6.y;z[18]=h.$X6.z}if(m){var c=R.getRenderTarget("ShadowProj");if(Y&&c){H.setSampler("okUni_shadowSampler",E);c.bind(E);W.texParameteri(3553,10240,9729);W.texParameteri(3553,10241,9729);W.texParameteri(3553,10242,33071);W.texParameteri(3553,10243,33071);E+=1}var aj=o.$t.length;var X=0;for(var ac=0;ac<aj;++ac){var al=o.$t[ac];if(al.$O[o.$u4]){var T=al.getLightDir();var P=al.getColor();z[(11+X)*4]=T.x;z[(11+X)*4+1]=T.y;z[(11+X)*4+2]=T.z;z[(15+X)*4]=P.x*al.$e3;z[(15+X)*4+1]=P.y*al.$e3;z[(15+X)*4+2]=P.z*al.$e3;if(Y){z[(19+X)*4]=al.$H4==0?1:0;z[(19+X)*4+1]=al.$H4==1?1:0;z[(19+X)*4+2]=al.$H4==2?1:0;z[(19+X)*4+3]=al.$H4==3?1:0}okA._vec3(T);okA._vec3(P);X+=1;if(X==4){break}}}var am=o.$51.length;var X=0;for(var ac=0;ac<am;++ac){var al=o.$51[ac];if(al.$O[o.$u4]){var F=al.getPos();var D=al.getRange();var P=al.getColor();z[(23+X)*4]=F.x;z[(23+X)*4+1]=F.y;z[(23+X)*4+2]=F.z;z[(23+X)*4+3]=D;z[(27+X)*4]=P.x*al.$e3;z[(27+X)*4+1]=P.y*al.$e3;z[(27+X)*4+2]=P.z*al.$e3;if(Y){z[(31+X)*4]=al.$H4==0?1:0;z[(31+X)*4+1]=al.$H4==1?1:0;z[(31+X)*4+2]=al.$H4==2?1:0;z[(31+X)*4+3]=al.$H4==3?1:0}okA._vec3(F);okA._vec3(P);X+=1;if(X==4){break}}}var K=o.$o1.length;var X=0;for(var ac=0;ac<K;++ac){var al=o.$o1[ac];if(al.$O[o.$u4]){var F=al.getPos();var T=al.getLightDir();var ak=al.getInnerCone()*Math.PI/180;var f=al.getOuterCone()*Math.PI/180;var P=al.getColor();z[(35+X)*4]=F.x;z[(35+X)*4+1]=F.y;z[(35+X)*4+2]=F.z;z[(39+X)*4]=T.x;z[(39+X)*4+1]=T.y;z[(39+X)*4+2]=T.z;z[(39+X)*4+3]=P.x*al.$e3;z[(43+X)*4]=ak;z[(43+X)*4+1]=f;z[(43+X)*4+2]=P.y*al.$e3;z[(43+X)*4+3]=P.z*al.$e3;if(Y){z[(47+X)*4]=al.$H4==0?1:0;z[(47+X)*4+1]=al.$H4==1?1:0;z[(47+X)*4+2]=al.$H4==2?1:0;z[(47+X)*4+3]=al.$H4==3?1:0}okA._vec3(F);okA._vec3(T);okA._vec3(P);X+=1;if(X==4){break}}}}if(k||m||h.$O1){H.setUniformFloat4Array("okUni_General",z)}if(m||h.$O1){for(var ae=0;ae<7;++ae){if(h.$v1[ae]!=-1){var G=I.getResource(h.$v1[ae]);var a=G.isValid();var L=3553;var A=J;if(G.getType()==34067){L=34067;A=ah}H.setSampler("okUni_Sampler"+ae,E);if(a){G.bind(E);var d=G.isMipMap();W.texParameteri(L,10240,h.$t1[ae]);if(d){if(h.$t1[ae]==9729){W.texParameteri(L,10241,9985)}else{if(h.$t1[ae]==9728){W.texParameteri(L,10241,9984)}else{W.texParameteri(L,10241,h.$t1[ae])}}}else{if(h.$t1[ae]==9984||h.$t1[ae]==9986){W.texParameteri(L,10241,9728)}else{if(h.$t1[ae]==9985||h.$t1[ae]==9987){W.texParameteri(L,10241,9729)}else{W.texParameteri(L,10241,h.$t1[ae])}}}}else{A.bind(E);W.texParameteri(L,10240,9728);W.texParameteri(L,10241,9728)}W.texParameteri(L,10242,h.$x1[ae]);W.texParameteri(L,10243,h.$y1[ae]);E+=1}}var p=C.Texcoord1;var u=C.Texcoord2;if(p&&u&&p.buf==u.buf&&p.iIdx==u.iIdx-1){H.setAttribute("okAttr_TC12",p.buf,p.$I4+u.$I4,p.iOffset,p.iStride)}else{if(p){H.setAttribute("okAttr_TC1",p.buf,p.$I4,p.iOffset,p.iStride)}else{if(u){H.setAttribute("okAttr_TC2",u.buf,u.$I4,u.iOffset,u.iStride)}}}var t=C.Texcoord3;var w=C.Texcoord4;if(t&&w&&t.buf==w.buf&&t.iIdx==w.iIdx-1){H.setAttribute("okAttr_TC34",t.buf,t.$I4+t.$I4,t.iOffset,t.iStride)}else{if(t){H.setAttribute("okAttr_TC3",t.buf,t.$I4,t.iOffset,t.iStride)}else{if(w){H.setAttribute("okAttr_TC4",w.buf,w.$I4,w.iOffset,w.iStride)}}}var s=C[h.$r1[4]];if(s){H.setAttribute("okAttr_Tangent",s.buf,s.$I4,s.iOffset,s.iStride)}var ab=C[h.$c[4]];if(ab){H.setAttribute("okAttr_Binormal",ab.buf,ab.$I4,ab.iOffset,ab.iStride)}}if(o.$f){var Z=C[o.$T5];var y=C[o.$U5];H.setAttribute("okAttr_BoneIdx",Z.buf,Z.$I4,Z.iOffset,Z.iStride);H.setAttribute("okAttr_BoneWeight",y.buf,y.$I4,y.iOffset,y.iStride);H.setUniformFloat4Array("okUni_BoneMat",o.$f)}if(ag){ag(W,o)}o.$25.drawIndex(o.$k4,o.$l4,o.$j4)}W.enable(2929);W.depthMask(true);W.depthFunc(515);W.enable(2884);okA._array(z)};function okRenderDepthStage(){okBaseCall(this);this.$U2=null;this.$V2=null;this.$T2=null}okExtend(okRenderDepthStage,okRenderBaseStage);okRenderDepthStage.prototype.createResource=function(){var d=this.$K5.rc;var e=this.$K5.$G5;var a=this.$K5.$J5;var c=this.$K5.$Z2;if(this.$V2==null){this.$V2=new okTexture(d)}this.$V2.createTexture(3553,e.$34,e.$24,c.bFloatRt?6406:6408,c.bFloatRt?5126:5121);a.setRenderTarget("DTex",this.$V2);if(this.depthStencilBuffer==null){this.depthStencilBuffer=new okRenderBuffer(d)}this.depthStencilBuffer.createBuffer(34041,e.$34,e.$24);a.setRenderTarget("DSBuf",this.depthStencilBuffer);if(this.$U2==null){this.$U2=new okFrameBuffer(d)}this.$U2.createBuffer();this.$U2.bind();this.$U2.attachRenderTexture(0,this.$V2);this.$U2.attachDepthStencilBuffer(this.depthStencilBuffer);this.$U2.unbind()};okRenderDepthStage.prototype.deleteResource=function(){var c=this.$K5.rc;var d=this.$K5.$G5;var a=this.$K5.$J5;if(this.$V2){this.$V2.releaseTexture();a.setRenderTarget("DTex",null)}if(this.depthStencilBuffer){this.depthStencilBuffer.releaseBuffer();a.setRenderTarget("DSBuf",null)}if(this.$U2){this.$U2.releaseBuffer()}};okRenderDepthStage.prototype.beginView=function(a){var d=this.$K5.rc;var e=this.$K5.$G5;var c=this.$K5.$G5.$N2;if(a!=true){this.$U2.bind();c.bindViewport();d.clearColor(1,1,1,1);d.clearDepth(1);d.clear(16384|256|1024);this.$U2.unbind();if(e.bAntiAlias){d.clearDepth(1);d.clear(256|1024)}}};okRenderDepthStage.prototype.endView=function(){};okRenderDepthStage.prototype.render=function(){var e=this.$K5.rc;var f=this.$K5.$G5;var a=this.$K5.$I5;var d=this.$K5.$Z2;this.$U2.bind();f.$N2.bindViewport();e.enable(2929);e.depthFunc(515);e.enable(2884);e.depthMask(true);e.colorMask(true,true,true,true);var c=a.getBatchList("Visible_Opaque");if(c.length>0){this._renderBatches(c,"Depth",false,false,this._clipBatch)}if(d.iDepthBits<24&&!f.bAntiAlias){e.clearDepth(1);e.clear(256)}this.$U2.unbind()};okRenderDepthStage.prototype._clipBatch=function(a){return a.$r5.$32};function okRenderShadowStage(){okBaseCall(this);this.$j1=new Array;this.$i4=512;this.$75=null;this.$95=null;this.$65=null;this.$D5=null;this.$E5=null;this.$C3=null;this.$B3=null;this.$J6=[0,1]}okExtend(okRenderShadowStage,okRenderBaseStage);okRenderShadowStage.prototype.clear=function(){this.$j1.length=0;okBaseCall(this,"clear")};okRenderShadowStage.prototype.createResource=function(){var e=this.$K5.rc;var f=this.$K5.$G5;var c=this.$K5.$I5;var a=this.$K5.$J5;var d=this.$K5.$Z2;if(this.$95==null){this.$95=new okTexture(e)}this.$95.createTexture(3553,Math.min(this.$i4,f.$34),Math.min(this.$i4,f.$24),d.bFloatRt?6406:6408,d.bFloatRt?5126:5121);a.setRenderTarget("ShadowDepth",this.$95);if(this.$65==null){this.$65=new okRenderBuffer(e)}this.$65.createBuffer(33189,Math.min(this.$i4,f.$34),Math.min(this.$i4,f.$24));if(this.$75==null){this.$75=new okFrameBuffer(e)}this.$75.createBuffer();this.$75.bind();this.$75.attachRenderTexture(0,this.$95);this.$75.attachDepthBuffer(this.$65);this.$75.unbind();if(this.$E5==null){this.$E5=new okTexture(e)}this.$E5.createTexture(3553,f.$34,f.$24,6408);a.setRenderTarget("ShadowProj",this.$E5);if(this.$D5==null){this.$D5=new okFrameBuffer(e)}this.$D5.createBuffer();this.$D5.bind();this.$D5.attachRenderTexture(0,this.$E5);this.$D5.attachDepthStencilBuffer(a.getRenderTarget("DSBuf"));this.$D5.unbind();if(this.$C3==null){this.$C3=[new okArrayBuffer(e),new okArrayBuffer(e)]}this.$C3[0].createBuffer(34962,5126,35044,new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]));this.$C3[1].createBuffer(34962,5126,35044,new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]));if(this.$B3==null){this.$B3=new okArrayBuffer(e)}this.$B3.createBuffer(34963,5123,35044,new Uint16Array([0,1,2,0,2,3,1,5,6,1,6,2,3,2,6,3,6,7,4,0,3,4,3,7,4,5,1,4,1,0,4,7,6,4,6,5]))};okRenderShadowStage.prototype.deleteResource=function(){var d=this.$K5.rc;var e=this.$K5.$G5;var c=this.$K5.$I5;var a=this.$K5.$J5;if(this.$95){this.$95.releaseTexture();a.setRenderTarget("ShadowDepth",null)}if(this.$65){this.$65.releaseBuffer()}if(this.$75){this.$75.releaseBuffer()}if(this.$E5){this.$E5.releaseTexture();a.setRenderTarget("ShadowProj",null)}if(this.$D5){this.$D5.releaseBuffer()}if(this.$C3[0]){this.$C3[0].releaseBuffer()}if(this.$C3[1]){this.$C3[1].releaseBuffer()}if(this.$B3){this.$B3.releaseBuffer()}};okRenderShadowStage.prototype.beginView=function(){};okRenderShadowStage.prototype.endView=function(){};okRenderShadowStage.prototype.render=function(){var A=this.$K5.rc;var M=this.$K5.$G5;var f=this.$K5.$B6;var k=M.$z6;var F=k.getZone();var d=this.$K5.$I5;var I=this.$K5.$J5;var o=M.$N2;var E=o.getPos();var x=Math.min(M.$34,this.$i4);var w=Math.min(M.$24,this.$i4);var z=o.getViewInvMat4();z.m03=z.m13=z.m23=0;if(!M.$t2||!k){return}this.$j1.length=0;var s=F.$Q;var p=0;var L=s.getRoot();while(L){var G=L.data;if(!G.$Y1||!G.$G2){G.$H4=3}else{G.$H4=p;p+=1;var h=G.$6.length;for(var D=0;D<h;++D){var e=G.$6[D];if((e.getType()&(1|2|32|64|128|256))&&e.$G2&&e.$Y1&&e.getState()!=1){this._genShadowCaster(G,e,M)}}}L=L.next}var C=this.$j1.length;var n=0;var J=new okLayout2DHelper(x,w);for(var D=0;D<C;++D){var m=this.$j1[D];var B=new okVec2(0,0);if(m.$k3>=1){B.x=Math.min(x,m.$l3*Math.max(M.$N2.getViewportWidth(),M.$N2.getViewportHeight()));B.y=Math.min(w,B.x/m.$k3)}else{B.y=Math.min(w,m.$l3*Math.max(M.$N2.getViewportWidth(),M.$N2.getViewportHeight()));B.x=Math.min(x,B.y*m.$k3)}B.x=Math.max(8,B.x);B.y=Math.max(8,B.y);m.$F5=J.add(B.x,B.y);if(m.$F5==null){m.$m2=true;J.reset(x,w);m.$F5=J.add(B.x,B.y)}m.$F5.width=Math.min(m.$F5.width,M.$34);m.$F5.height=Math.min(m.$F5.height,M.$24);m.$F5.width-=3;m.$F5.height-=3;m.$F5.width=okAlign(m.$F5.width,4);m.$F5.height=okAlign(m.$F5.height,4);m.$F5.x+=2;m.$F5.y+=2;m.$F5.width-=2;m.$F5.height-=2;var a=new okVec2(m.$F5.x/x,m.$F5.y/w);var y=new okVec2(m.$F5.width/x,m.$F5.height/w);var t=new okMat4();m.$f5.clone(t);t.m00=(t.m00+t.m30)/2;t.m01=(t.m01+t.m31)/2;t.m02=(t.m02+t.m32)/2;t.m03=(t.m03+t.m33)/2;t.m00=t.m00*y.x+t.m30*a.x;t.m01=t.m01*y.x+t.m31*a.x;t.m02=t.m02*y.x+t.m32*a.x;t.m03=t.m03*y.x+t.m33*a.x;t.m10=(t.m10+t.m30)/2;t.m11=(t.m11+t.m31)/2;t.m12=(t.m12+t.m32)/2;t.m13=(t.m13+t.m33)/2;t.m10=t.m10*y.y+t.m30*a.y;t.m11=t.m11*y.y+t.m31*a.y;t.m12=t.m12*y.y+t.m32*a.y;t.m13=t.m13*y.y+t.m33*a.y;m.$l5=t}this.$D5.bind();o.bindViewport();A.clearColor(1,1,1,1);A.clear(16384|1024);var q=I.getRenderTarget("DTex");var l=0;while(l<C){this.$75.bind();A.viewport(0,0,x,w);A.scissor(0,0,x,w);A.clearColor(1,1,1,1);A.clear(16384|256);A.enable(2929);A.depthFunc(515);var v=0;for(v=l;v<C;++v){var m=this.$j1[v];if(m.$m2){m.$m2=false;break}var H=m.$F5;A.viewport(H.x,H.y,H.width,H.height);var K=m.$b;if(K.length>0){this._renderBatches(K,"ShadowDepth",false,false,null,this._setDepthBatch,m.$f5)}}this.$D5.bind();o.bindViewport();for(var D=l;D<v;++D){var m=this.$j1[D];var c=m.$55;A.enable(2884);A.disable(2929);A.depthMask(false);A.enable(3042);A.blendFuncSeparate(774,0,772,0);A.colorMask(c.$H4==0,c.$H4==1,c.$H4==2,false);var u=f.getShadowFinalProgram();u.bind();u.setAttribute("vertMask0",this.$C3[0],4);u.setAttribute("vertMask1",this.$C3[1],4);if(m.$85.$p2){m.$85._genPointList()}u.setUniformVec3Array("vertList",m.$85.$71);o.getViewProjMat4().clone(this.$1[0]);o.getViewProjInvMat4().clone(this.$1[1]);m.$l5.clone(this.$1[2]);u.setUniformMat4Array("matArray",this.$1);u.setUniformFloat4("screenPosOffsetAndScale",o.$W4/this.$E5.getSizeU(),(A.canvas.clientHeight-o.$X4-o.$U4)/this.$E5.getSizeV(),o.$V4/this.$E5.getSizeU(),o.$U4/this.$E5.getSizeV());u.setUniformFloat3("shadowPixelSizeAndOffset",1/x,1/w,Math.max(G.$m3,m.$03.$m3));u.setUniformFloat4("shadowClamp",m.$F5.x/x,m.$F5.y/w,(m.$F5.x+m.$F5.width)/x,(m.$F5.y+m.$F5.height)/w);u.setSamplerArray("samplerArray",this.$J6);q.bind(0);A.texParameteri(3553,10240,9728);A.texParameteri(3553,10241,9728);A.texParameteri(3553,10242,33071);A.texParameteri(3553,10243,33071);this.$95.bind(1);A.texParameteri(3553,10240,9728);A.texParameteri(3553,10241,9728);A.texParameteri(3553,10242,33071);A.texParameteri(3553,10243,33071);this.$B3.drawIndex(4);A.disable(3042);A.enable(2929);l+=1}A.enable(2884);A.depthMask(true);A.colorMask(true,true,true,true);this.$D5.unbind();o.bindViewport()}};okRenderShadowStage.prototype._setDepthBatch=function(c,a){c.enable(2929)};okRenderShadowStage.prototype._genShadowCaster=function(F,h,I){var t=I.$N2;if(F.getType()==4){var E=F.getMat43();E.setColumn(3,0,0,0);var k=F.getInvMat43();var a=h.getBoundingBox();var B=new okVec3(1000000,1000000,1000000);var A=new okVec3(-1000000,-1000000,-1000000);for(var D=0;D<8;++D){var u=a.getPoint(D);var z=okMat43MulVec3(k,u);B=okVec3Min(B,z);A=okVec3Max(A,z)}var w=okVec3MulVal(okVec3Add(B,A),0.5);w.z=A.z+0.1;var o=okVec3Sub(A,B);E.setColumn(3,okMat43MulVec3(E,w));k=E.inverse();var q=new okShadowCaster();q.$03=h;q.$55=F;q.$b=new Array;h.genRenderBatch(q.$b,I);q.$e5=new okMat4();k.toMat4(q.$e5);q.$f5=okMat4Mul(okMat4Ortho(-o.x*0.5,o.x*0.5,o.y*0.5,-o.y*0.5,0.1,o.z+0.1),q.$e5);var l=0.1,s=o.z+0.1;q.$f5.m20=-k.m20/(s-l);q.$f5.m21=-k.m21/(s-l);q.$f5.m22=-k.m22/(s-l);q.$f5.m23=(-k.m23-l)/(s-l);q.$85=new okFrustum();q.$85.setByViewProjMat(okMat4Mul(okMat4Ortho(-o.x*0.5,o.x*0.5,o.y*0.5,-o.y*0.5,0.1,10000),q.$e5));q.$k3=o.x/o.y;var C=okVec3Sub(a.vMax,a.vMin).len();var y=new okVec4((a.vMax.x+a.vMin.x)*0.5,(a.vMax.y+a.vMin.y)*0.5,(a.vMax.z+a.vMin.z)*0.5,1);var f=okMat4MulVec4(t.getViewProjMat4(),y);q.$l3=h.$n3*C/Math.max(1,Math.abs(f.w));this.$j1.push(q)}else{if(F.getType()==16){var E=F.getMat43();var k=E.inverse();var a=h.getBoundingBox();var B=new okVec3(1000000,1000000,1000000);var A=new okVec3(-1000000,-1000000,-1000000);for(var D=0;D<8;++D){var u=a.getPoint(D);var z=okMat43MulVec3(k,u);B=okVec3Min(B,z);A=okVec3Max(A,z)}var q=new okShadowCaster();q.$03=h;q.$55=F;q.$b=new Array;h.genRenderBatch(q.$b,I);q.$e5=new okMat4();k.toMat4(q.$e5);q.$k3=1;var s=-B.z+0.1,l=Math.max(0.1,-A.z);q.$f5=okMat4Mul(okMat4Proj(F.getOuterCone(),1,l,s),q.$e5);q.$f5.m20=-q.$e5.m20/(s-l);q.$f5.m21=-q.$e5.m21/(s-l);q.$f5.m22=-q.$e5.m22/(s-l);q.$f5.m23=(-q.$e5.m23-l)/(s-l);q.$85=new okFrustum();q.$85.setByViewProjMat(okMat4Mul(okMat4Proj(F.getOuterCone(),1,l,F.$j3),q.$e5));var C=okVec3Sub(a.vMax,a.vMin).len();var y=new okVec4((a.vMax.x+a.vMin.x)*0.5,(a.vMax.y+a.vMin.y)*0.5,(a.vMax.z+a.vMin.z)*0.5,1);var f=okMat4MulVec4(t.getViewProjMat4(),y);q.$l3=h.$n3*C/Math.max(1,Math.abs(f.w));this.$j1.push(q)}else{if(F.getType()==8){var m=okVec3Sub(F.getPos(),h.getPos());var n=new okVec3(0,1,0);var p=okVec3Cross(n,m);if(p.equal(OAK.VEC3_ZERO)){n.set(1,0,0);p=okVec3Cross(n,m)}n=okVec3Cross(m,p);p=p.normalize();n=n.normalize();m=m.normalize();var E=new okMat43();E.setColumn(0,p);E.setColumn(1,n);E.setColumn(2,m);E.setColumn(3,F.getPos());var k=E.inverse();var a=h.getBoundingBox();var B=new okVec3(1000000,1000000,1000000);var A=new okVec3(-1000000,-1000000,-1000000);var e=0,d=0;for(var D=0;D<8;++D){var u=a.getPoint(D);var z=okMat43MulVec3(k,u);B=okVec3Min(B,z);A=okVec3Max(A,z);e=Math.max(e,Math.atan(Math.abs(z.x)/Math.max(0.1,-z.z)));d=Math.max(d,Math.atan(Math.abs(z.y)/Math.max(0.1,-z.z)))}if(Math.max(e,d)<120*Math.PI/180){var q=new okShadowCaster();q.$03=h;q.$55=F;q.$b=new Array;h.genRenderBatch(q.$b,I);q.$e5=new okMat4();k.toMat4(q.$e5);q.$k3=Math.tan(e)/Math.tan(d);var s=-B.z+0.1,l=Math.max(0.1,-A.z);q.$f5=okMat4Mul(okMat4Proj(d*2*180/Math.PI,q.$k3,l,s),q.$e5);q.$f5.m20=-q.$e5.m20/(s-l);q.$f5.m21=-q.$e5.m21/(s-l);q.$f5.m22=-q.$e5.m22/(s-l);q.$f5.m23=(-q.$e5.m23-l)/(s-l);q.$85=new okFrustum();q.$85.setByViewProjMat(okMat4Mul(okMat4Proj(d*2*180/Math.PI,q.$k3,l,F.$j3),q.$e5));var C=okVec3Sub(a.vMax,a.vMin).len();var y=new okVec4((a.vMax.x+a.vMin.x)*0.5,(a.vMax.y+a.vMin.y)*0.5,(a.vMax.z+a.vMin.z)*0.5,1);var f=okMat4MulVec4(t.getViewProjMat4(),y);q.$l3=h.$n3*C/Math.max(1,Math.abs(f.w));this.$j1.push(q)}else{var H=[new okMat43(),new okMat43(),new okMat43(),new okMat43(),new okMat43(),new okMat43()];var x=F.getPos();H[0].setColumn(0,0,1,0);H[0].setColumn(1,0,0,1);H[0].setColumn(2,1,0,0);H[0].setColumn(3,x);H[1].setColumn(0,0,-1,0);H[1].setColumn(1,0,0,1);H[1].setColumn(2,-1,0,0);H[1].setColumn(3,x);H[2].setColumn(0,-1,0,0);H[2].setColumn(1,0,0,1);H[2].setColumn(2,0,1,0);H[2].setColumn(3,x);H[3].setColumn(0,1,0,0);H[3].setColumn(1,0,0,1);H[3].setColumn(2,0,-1,0);H[3].setColumn(3,x);H[4].setColumn(0,1,0,0);H[4].setColumn(1,0,1,0);H[4].setColumn(2,0,0,1);H[4].setColumn(3,x);H[5].setColumn(0,1,0,0);H[5].setColumn(1,0,-1,0);H[5].setColumn(2,0,0,-1);H[5].setColumn(3,x);var c=[H[0].inverse(),H[1].inverse(),H[2].inverse(),H[3].inverse(),H[4].inverse(),H[5].inverse()];for(var D=0;D<6;++D){var k=c[D];var a=h.getBoundingBox();var B=new okVec3(1000000,1000000,1000000);var A=new okVec3(-1000000,-1000000,-1000000);var e=0,d=0;for(var D=0;D<8;++D){var u=a.getPoint(D);var z=okMat43MulVec3(k,u);B=okVec3Min(B,z);A=okVec3Max(A,z)}var s=-B.z+0.1,l=Math.max(0.1,-A.z);if(s<0.1){continue}var G=new okFrustum();G.setByViewProjMat(okMat4Mul(okMat4Proj(91,1,l,F.$j3),k));if(G.collideAABBox(a)==0){continue}var q=new okShadowCaster();q.$03=h;q.$55=F;q.$b=new Array;h.genRenderBatch(q.$b,I);q.$e5=new okMat4();k.toMat4(q.$e5);q.$k3=1;q.$f5=okMat4Mul(okMat4Proj(d*2*180/Math.PI,q.$k3,l,s),q.$e5);q.$f5.m20=-q.$e5.m20/(s-l);q.$f5.m21=-q.$e5.m21/(s-l);q.$f5.m22=-q.$e5.m22/(s-l);q.$f5.m23=(-q.$e5.m23-l)/(s-l);q.$85=G;var C=okVec3Sub(a.vMax,a.vMin).len();var y=new okVec4((a.vMax.x+a.vMin.x)*0.5,(a.vMax.y+a.vMin.y)*0.5,(a.vMax.z+a.vMin.z)*0.5,1);var f=okMat4MulVec4(t.getViewProjMat4(),y);q.$l3=h.$n3*C/Math.max(1,Math.abs(f.w));this.$j1.push(q)}}}}}};function okShadowCaster(){this.$03=null;this.$55=null;this.$b=null;this.$d5=null;this.$e5=null;this.$f5=null;this.$85=null;this.$l5=null;this.$k3=1;this.$l3=0;this.$F5=null;this.$m2=false}function okRenderLightingStage(){okBaseCall(this);this.$75=null;this.$95=null}okExtend(okRenderLightingStage,okRenderBaseStage);okRenderLightingStage.prototype.createResource=function(){var c=this.$K5.rc;var d=this.$K5.$G5;var a=this.$K5.$J5;if(d.bAntiAlias==false){if(this.$95==null){this.$95=new okTexture(c)}this.$95.createTexture(3553,d.$34,d.$24,6408);a.setRenderTarget("LTex",this.$95);if(this.$75==null){this.$75=new okFrameBuffer(c)}this.$75.createBuffer();this.$75.bind();this.$75.attachRenderTexture(0,this.$95);this.$75.attachDepthStencilBuffer(a.getRenderTarget("DSBuf"));this.$75.unbind()}};okRenderLightingStage.prototype.deleteResource=function(){var c=this.$K5.rc;var d=this.$K5.$G5;var a=this.$K5.$J5;if(d.bAntiAlias==false){if(this.$95){this.$95.releaseTexture();a.setRenderTarget("LTex",null)}if(this.$75){this.$75.releaseBuffer()}}};okRenderLightingStage.prototype.renderBackTex=function(c){var e=this.$K5.rc;var k=this.$K5.$G5;var d=k.$N2;e.disable(2929);e.depthMask(false);e.disable(3042);var h=this.$K5.$L5.getResource("$R$Quad");var f=h.getMesh(0);var a=this.$K5.$B6.getOutputProgram();a.bind();a.setAttribute("okAttr_Pos",f.getAttributeArrayBuffer("Position"),3);a.setUniformFloat4("okUni_DestOffsetScale",0,0,1,1);a.setUniformFloat4("okUni_SrcOffsetScale",0,1,1,-1);a.setTexture("okUni_Tex",c,33071,9729);f.draw();e.enable(2929);e.depthMask(true)};okRenderLightingStage.prototype.beginView=function(c){var e=this.$K5.rc;var d=this.$K5.$G5.$N2;var f=this.$K5.$G5;if(c!=true){if(f.bAntiAlias){e.bindFramebuffer(36160,null)}else{this.$75.bind()}d.bindViewport();if(d.$P3==-1){var a=d.getBackColor();e.clearColor(a.x,a.y,a.z,a.w);e.clear(16384)}else{this.renderBackTex(this.$K5.$L5.getResource(d.$P3))}if(!f.bAntiAlias){this.$75.unbind()}}};okRenderLightingStage.prototype.endView=function(){};okRenderLightingStage.prototype.render=function(f){var e=this.$K5.rc;var f=this.$K5.$G5;var c=this.$K5.$I5;if(f.bAntiAlias){e.bindFramebuffer(36160,null)}else{this.$75.bind()}f.$N2.bindViewport();var d=c.getBatchList("Visible_Opaque");if(d.length>0){e.enable(2929);e.depthFunc(515);e.enable(2884);e.disable(3042);this._renderBatches(d,"Lighting",true,true)}var a=c.getBatchList("Visible_Trans");if(a.length>0){e.enable(3042);e.enable(2884);this._renderBatches(a,"Lighting",true,true);e.disable(3042)}if(!f.bAntiAlias){this.$75.unbind()}};function okRenderPostStage(){okBaseCall(this);this.$A5=null;this.$B5=null;this.$X2=null;this.$z5=null}okExtend(okRenderPostStage,okRenderBaseStage);okRenderPostStage.prototype.createResource=function(){var c=this.$K5.rc;var d=this.$K5.$G5;var a=this.$K5.$J5;if(this.$A5==null){this.$A5=new okTexture(c)}this.$A5.createTexture(3553,d.$34,d.$24,6408);if(this.$B5==null){this.$B5=new okTexture(c)}this.$B5.createTexture(3553,Math.floor(d.$34*0.5),Math.floor(d.$24*0.5),6408);if(this.$X2==null){this.$X2=new okRenderBuffer(c)}this.$X2.createBuffer(34041,Math.floor(d.$34*0.5),Math.floor(d.$24*0.5));if(this.$z5==null){this.$z5=new okFrameBuffer(c)}this.$z5.createBuffer()};okRenderPostStage.prototype.deleteResource=function(){var c=this.$K5.rc;var d=this.$K5.$G5;var a=this.$K5.$J5;if(this.$A5){this.$A5.releaseTexture()}if(this.$B5){this.$B5.releaseTexture()}if(this.$X2){this.$X2.releaseBuffer()}if(this.$z5){this.$z5.releaseBuffer()}};okRenderPostStage.prototype.beginView=function(a){};okRenderPostStage.prototype.endView=function(){};okRenderPostStage.prototype.render=function(){var a=this.$K5.rc;var o=this.$K5.$G5;var l=this.$K5.$B6;var c=this.$K5.$L5;var h=this.$K5.$I5;var q=this.$K5.$J5;var m=o.$N2;var p=o.$34;var e=o.$24;var k=c.getResource("$R$Quad");var n=k.getMesh();var d=h.getBatchList("Visible_Glow");if(d.length>0){this.$z5.bind();this.$z5.attachRenderTexture(0,this.$A5);this.$z5.attachDepthStencilBuffer(q.getRenderTarget("DSBuf"));a.clearColor(0,0,0,0);a.clear(16384);a.enable(2929);a.depthFunc(515);m.bindViewport();this._renderBatches(d,"Glow",false,true,null,null,null,true);a.disable(2929);a.depthMask(false);this.$z5.attachRenderTexture(0,this.$B5);this.$z5.attachDepthStencilBuffer(this.$X2);a.viewport(0,0,this.$B5.getSizeU(),this.$B5.getSizeV());var f=l.getGaussianProgram(0);f.bind();f.setAttribute("okAttr_Pos",n.getAttributeArrayBuffer("Position"),3);f.setUniformFloat2("okUni_TexelSize",1/this.$A5.getSizeU(),1/this.$A5.getSizeV());f.setUniformFloat4("okUni_ScreenPosOffsetAndScale",m.$W4/p,(e-m.$X4-m.$U4)/e,m.$V4/p,m.$U4/e);f.setTexture("okUni_Tex",this.$A5,33071,9729,9729);n.draw();a.enable(3042);a.blendEquation(32774);a.blendFunc(1,1);if(o.bAntiAlias){a.bindFramebuffer(36160,null)}else{this.$z5.attachRenderTexture(0,q.getRenderTarget("LTex"));this.$z5.attachDepthStencilBuffer(q.getRenderTarget("DSBuf"))}a.viewport(0,0,p,e);var f=l.getGaussianProgram(1);f.bind();f.setAttribute("okAttr_Pos",n.getAttributeArrayBuffer("Position"),3);f.setUniformFloat2("okUni_TexelSize",1/this.$B5.getSizeU(),1/this.$B5.getSizeV());f.setUniformFloat4("okUni_ScreenPosOffsetAndScale",0,0,1,1);f.setTexture("okUni_Tex",this.$B5,33071,9729,9729);n.draw();if(!o.bAntiAlias){this.$z5.unbind()}a.enable(2929);a.depthMask(true);a.disable(3042)}};function okAttribFormat(){this.$56="";this.iOffset=0;this.iStride=0;this.$I4=0;this.iIdx=0;this.buf=null}okAttribFormat.prototype={clear:function(){this.$56="";this.iOffset=0;this.iStride=0;this.$I4=0;this.buf=null}};function okRenderBatch(){this.$a=okA.object();this.$25=null;this.$k4=0;this.$l4=0;this.$j4=0;this.$r5=null;this.$g5=null;this.$i5=null;this.$t=null;this.$51=null;this.$o1=null;this.$L2=null;this.$f=null;this.$T5=null;this.$U5=null;this.$s2=true;this.$92=false;this.$u4=-1;this.$h1=new Array;this.$o3=0;this.$p6="";this.$l6="";this.$n6="";this.$q6="";this.$m6="";this.$o6="";this.$k1=okA.object();this.$l1=okA.object();this.$v2=true;this.$u2=true}okRenderBatch.prototype={clear:function(){this.$a=null;this.$25=null;this.$k4=0;this.$l4=0;this.$j4=0;this.$r5=null;if(this.$g5){okA._mat4(this.$g5)}if(this.$i5){okA._mat4(this.$i5)}this.$g5=null;this.$i5=null;this.$t=null;this.$51=null;this.$o1=null;if(this.$f){okA._array(this.$f);this.$f=null}this.$T5=null;this.$U5=null;this.$L2=null;this.$s2=true;this.$92=false;this.$u4=-1;this.$h1.length=0;this.$p6="";this.$l6="";this.$n6="";this.$q6="";this.$m6="";this.$o6="";for(var a in this.$k1){delete this.$k1[a]}for(var a in this.$l1){delete this.$l1[a]}this.$v2=true;this.$u2=true;this.$o3=0},addResourceId:function(a){this.$h1.push(a)},_genShdKey:function(A){var h=this.$r5;var a=this.$a;var z=0,C=0,t=0;var y=this.$t.length;for(var q=0;q<y;++q){var w=this.$t[q];if(w.$O[this.$u4]){z+=1;if(z==4){break}}}y=this.$51.length;for(var q=0;q<y;++q){var w=this.$51[q];if(w.$O[this.$u4]){C+=1;if(C==4){break}}}y=this.$o1.length;for(var q=0;q<y;++q){var w=this.$o1[q];if(w.$O[this.$u4]){t+=1;if(t==4){break}}}var B=A.$t2&&!h.$I2&&this.$s2&&A.$q1[1];var d=h._getShdKeyV();var l=h._getShdKeyF();var e=h._getShdKeyP();var v=a.Texcoord1;var u=a.Texcoord2;var s=a.Texcoord3;var p=a.Texcoord4;var o=(v?1:0)+(u?2:0)+(s?4:0)+(p?8:0)+((v&&u&&v.iIdx==(u.iIdx-1))?16:0)+((s&&p&&s.iIdx==(p.iIdx-1))?32:0);var f=0,x=0,m=0;var n=0,c=0,k=0;f=(this.$f?1:0)+(this.$92?2:0)+(a.Normal?4:0)+(a.Color?8:0);x=(a.Normal?1:0)+(a.Color?2:0)+(B?4:0)+(A.$b2?8:0);m=(this.$f?1:0)+(this.$92?2:0)+(a.Normal?4:0)+(a.Color?8:0)+(B?16:0)+(A.$b2?32:0);if(h.$O1){n=(this.$f?1:0)+(this.$92?2:0)+(a.Normal?4:0)+(a.Color?8:0);c=(a.Normal?1:0)+(a.Color?2:0);k=(this.$f?1:0)+(this.$92?2:0)+(a.Normal?4:0)+(a.Color?8:0)}else{n=(this.$f?1:0)+(this.$92?2:0);c=0;k=(this.$f?1:0)+(this.$92?2:0)}this.$p6="0"+d+"_"+o+"_"+f;this.$l6="0"+l+"_"+z+C+t+"_"+o+"_"+x;this.$n6="0"+e+"_"+z+C+t+"_"+o+"_"+m;if(h.$O1){this.$q6="1"+d+"_"+o+"_"+n;this.$m6="1"+l+"_"+o+"_"+c;this.$o6="1"+e+"_"+o+"_"+k}else{this.$q6="2"+n;this.$m6="2"+c;this.$o6="2"+k}},_genShdDef:function(w){var f=this.$r5;var a=this.$a;var v=0,y=0,n=0;var u=this.$t.length;for(var l=0;l<u;++l){var t=this.$t[l];if(t.$O[this.$u4]){v+=1;if(v==4){break}}}u=this.$51.length;for(var l=0;l<u;++l){var t=this.$51[l];if(t.$O[this.$u4]){y+=1;if(y==4){break}}}u=this.$o1.length;for(var l=0;l<u;++l){var t=this.$o1[l];if(t.$O[this.$u4]){n+=1;if(n==4){break}}}var x=w.$t2&&!f.$I2&&this.$s2&&w.$q1[1];var q=a.Texcoord1;var p=a.Texcoord2;var m=a.Texcoord3;var k=a.Texcoord4;var h=(q?1:0)+(p?2:0)+(m?4:0)+(k?8:0)+((q&&p&&q.iIdx==(p.iIdx-1))?16:0)+((m&&k&&m.iIdx==(k.iIdx-1))?32:0);var d=this.$k1;f._getShdDef(d);d.OK_DCTLIGHT_NUM=v;d.OK_POINTLIGHT_NUM=y;d.OK_SPOTLIGHT_NUM=n;if(this.$f){d.OK_SKANIMATION=1}if(this.$92){d.OK_BILLBOARD=1}if(a.Normal){d.OK_NORMAL=1}if(a.Color){d.OK_VERTEX_COLOR=1}if(x){d.OK_DYNAMICSHADOW=1}if(!w.$b2&&d.OK_FOG){delete d.OK_FOG}var c=okA.object();if(h&16){d.OK_TC12=1;c.Texcoord1="okVary_TC12.xy";c.Texcoord2="okVary_TC12.zw"}else{if(h&1){d.OK_TC1=1;c.Texcoord1="okVary_TC1"}else{c.Texcoord1="vec2(0.0, 0.0)"}if(h&2){d.OK_TC2=1;c.Texcoord2="okVary_TC2"}else{c.Texcoord2="vec2(0.0, 0.0)"}}if(h&32){d.OK_TC34=1;c.Texcoord3="okVary_TC34.xy";c.Texcoord4="okVary_TC34.zw"}else{if(h&4){d.OK_TC3=1;c.Texcoord3="okVary_TC3"}else{c.Texcoord3="vec2(0.0, 0.0)"}if(h&8){d.OK_TC4=1;c.Texcoord4="okVary_TC4"}else{c.Texcoord4="vec2(0.0, 0.0)"}}if(c[f.$A1[0]]){d.OK_ALBEDO1_TC=c[f.$A1[0]]}if(c[f.$A1[1]]){d.OK_ALBEDO2_TC=c[f.$A1[1]]}if(c[f.$A1[2]]){d.OK_ALBEDO3_TC=c[f.$A1[2]]}if(c[f.$A1[3]]){d.OK_ALBEDO4_TC=c[f.$A1[3]]}if(c[f.$A1[4]]){d.OK_NORMALMAP_TC=c[f.$A1[4]]}if(c[f.$A1[5]]){d.OK_OPACITY_TC=c[f.$A1[5]]}if(c[f.$A1[6]]){d.OK_SPECULAR_LEVEL_TC=c[f.$A1[6]]}okA._object(c);var o=this.$l1;if(f.$O1){for(var e in this.$k1){o[e]=this.$k1[e]}}else{if(this.$f){o.OK_SKANIMATION=1}if(this.$92){o.OK_BILLBOARD=1}}},_getShdKeyV:function(c,a){if(this.$v2){this._genShdKey(c);this.$v2=false}return a?this.$q6:this.$p6},_getShdKeyF:function(c,a){if(this.$v2){this._genShdKey(c);this.$v2=false}return a?this.$m6:this.$l6},_getShdKeyP:function(c,a){if(this.$v2){this._genShdKey(c);this.$v2=false}return a?this.$o6:this.$n6},_getShdDef:function(e,d,c){if(this.$u2){this._genShdDef(e);this.$u2=false}if(d){for(var a in this.$l1){c[a]=this.$l1[a]}}else{for(var a in this.$k1){c[a]=this.$k1[a]}}}};function okRenderSourceCollector(){this.$d1=new Object;this.$b1=new Object;this.$c1=new Object;this.$R=new Object}okRenderSourceCollector.prototype={clear:function(){this.$d1=new Object;for(var e in this.$b1){var d=this.$b1[e];if(this.$c1[e]==true){var a=d.length;for(var c=0;c<a;++c){okA._renderBatch(d[c])}}d.length=0;delete this.$b1[e]}this.$c1=new Object;this.$R=new Object},createEntityList:function(a){var c=new Array;this.$d1[a]=c;return c},clearEntityList:function(a){if(this.$d1[a]){this.$d1[a].length=0}},attachEntity:function(a,d,c){this.$d1[a].push(d)},genBatchList:function(d,l){var h=this.$d1[d];var e=l.$N2;if(h!=null){var f=new Array;var c=h.length;for(var a=0;a<c;++a){var k=h[a];if(k.$G2&&k.getState(e.getFrustum())!=1){k.genRenderBatch(f,l)}}this.$b1[d]=f;this.$c1[d]=false}},sortBatchListByCamera:function(a,p,o){var m=p.$N2;var f=this.$b1[a];var h=m.getPos();var c=f.length;for(var l=0;l<c;++l){var k=f[l];var q=k.$L2;var n=q.vMin;var s=q.vMax;var d=new okVec3((n.x+s.x)*0.5,(n.y+s.y)*0.5,(n.z+s.z)*0.5);k.$o3=okVec3Len(d,h)}var e=f.sort(o?this._N2FSortFunc:this._F2NSortFunc);this.$b1[a]=e},getEntityList:function(a){return this.$d1[a]},createBatchList:function(a){this.$c1[a]=false;this.$b1[a]=okA.array();return this.$b1[a]},getBatchList:function(a){return this.$b1[a]},enableReleaseBatch:function(c,a){this.$c1[c]=a},createLightList:function(a){this.$R[a]=new Array},attachLight:function(a,c){this.$R[a].push(c)},getLightList:function(a){return this.$R[a]},_F2NSortFunc:function(d,c){return c.$o3-d.$o3},_N2FSortFunc:function(d,c){return d.$o3-c.$o3}};function okRenderTargetCollector(a){this.rc=a;this.$e1=new Object}okRenderTargetCollector.prototype={clear:function(){for(var a in this.$e1){delete this.$e1[a]}},setRenderTarget:function(c,a){this.$e1[c]=a},getRenderTarget:function(a){return this.$e1[a]},setFinalRenderTarget:function(){this.rc.bindFramebuffer(36160,null)}};function okRenderer(f,h){var c=f.canvas;this.rc=h.rc;this.$13=h.$13;this.$Z2=h.$Z2;this.$L5=h.$L5;this.$A6=h.$A6;this.$B6=new okShaderManager(this);this.$I5=new okRenderSourceCollector();this.$J5=new okRenderTargetCollector(this.rc);this.$G5=new okRenderEnvironment();this.$G5.canvas=c;this.$G5.$34=c.width;this.$G5.$24=c.height;this.$G5.$L4=(new Date).getTime();this.$G5.$b4=0;this.$G5.bAntiAlias=f.antialias?true:false;var o=this.$L5.createResource(1,"$R$Quad",true);this.$L5.setCustomResourceState(o,5);var e=this.$L5.getResource(o);okGenQuadMesh(e.createMesh("Quad"),-1,1,1,-1,false,true);var k=this.$L5.createResource(2,"$R$White",true);this.$L5.setCustomResourceState(k,5);this.$L5.getResource(k).createTexture(3553,1,1,6408,5121,[255,255,255,255]);var m=this.$L5.createResource(2,"$R$Black",true);this.$L5.setCustomResourceState(m,5);this.$L5.getResource(m).createTexture(3553,1,1,6408,5121,[0,0,0,0]);var l=this.$L5.createResource(2,"$R$WhiteCube",true);this.$L5.setCustomResourceState(l,5);this.$L5.getResource(l).createTexture(34067,1,1,6408,5121,[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255]);var a=this.$L5.createResource(2,"$R$BlackCube",true);this.$L5.setCustomResourceState(a,5);this.$L5.getResource(a).createTexture(34067,1,1,6408,5121,[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]);this.$E6=new okFrameBuffer(this.rc);this.$E6.createBuffer();this.$H5=[new okRenderDepthStage(),new okRenderShadowStage(),new okRenderLightingStage(),new okRenderPostStage()];var n=this.$H5.length;for(var d=0;d<n;++d){this.$H5[d].init(this)}this._createPipelineResource();for(var d=0;d<this.$Z2.iTexNum;++d){this.rc.activeTexture(33984+d);this.rc.bindTexture(3553,null)}}okRenderer.prototype={clear:function(){this.$B6.clear();this.$I5.clear();this.$J5.clear();this.$G5.clear();this.$L5.deleteResource("$R$Quad");this.$L5.deleteResource("$R$White");this.$L5.deleteResource("$R$Black");this.$L5.deleteResource("$R$WhiteCube");this.$L5.deleteResource("$R$BlackCube");if(this.$E6){this.$E6.releaseBuffer();this.$E6=null}var c=this.$H5.length;for(var a=0;a<c;++a){this.$H5[a].clear()}},_createPipelineResource:function(){var c=this.$H5.length;for(var a=0;a<c;++a){this.$H5[a].createResource()}},_deletePipelineResource:function(){var c=this.$H5.length;for(var a=0;a<c;++a){this.$H5[a].init(this);this.$H5[a].deleteResource()}},_onResize:function(){this.$G5.$34=this.$G5.canvas.width;this.$G5.$24=this.$G5.canvas.height;this._deletePipelineResource();this._createPipelineResource()},enableStage:function(c,a){this.$H5[c].enable(a);this.$G5.$q1[c]=a},isStageEnabled:function(a){return this.$G5.$q1[a]},getRenderSourceCollector:function(){return this.$I5},getRenderTargetCollector:function(){return this.$J5},clearView:function(c,a,d,f){var e=this.rc;if(this.$G5.bAntiAlias){e.bindFramebuffer(36160,null)}else{this.$H5[2].$75.bind()}if(c&16384){if(a==null){a=this.$G5.$N2.$S6}e.clearColor(a.x,a.y,a.z,a.w)}if(c&256){e.clearDepth(d?d:1)}if(c&1024){e.stencilFunc(519,f?f:0,4294967295)}e.clear(c)},beginView:function(f,d){var e=this.rc;var k=this.$L5;this.$G5.$N2=f;e.enable(3089);e.enable(2929);e.depthMask(true);e.disable(3042);e.enable(2884);f.bindViewport();var h=this.$H5.length;for(var c=0;c<h;++c){var a=this.$H5[c];a.beginView(d)}},endView:function(){var d=this.$H5.length;for(var c=0;c<d;++c){var a=this.$H5[c];a.endView()}this.$G5.$N2=null},renderScene:function(a){this.$G5.$z6=a;var e=this.$I5;e.clear();a.getZone()._visCull(this.$G5.$N2,e.createEntityList("Visible"));this._postCull();var f=this.$H5.length;for(var d=0;d<f;++d){var c=this.$H5[d];if(c.$82){c.render()}}this.$G5.$z6=null},renderEntity:function(k){var f=this.$I5;f.clear();var e=f.createEntityList("Visible");e.push(k);this._postCull();var c=this.$G5.$q1[1];this.enableStage(1,false);var h=this.$H5.length;for(var d=0;d<h;++d){var a=this.$H5[d];if(a.$82){a.render()}}this.enableStage(1,c)},renderEntityArray:function(h){var k=this.$I5;k.clear();var f=k.createEntityList("Visible");var a=h.length;for(var e=0;e<a;++e){f.push(h[e])}this._postCull();var d=this.$G5.$q1[1];this.enableStage(1,false);var l=this.$H5.length;for(var e=0;e<l;++e){var c=this.$H5[e];if(c.$82){c.render()}}this.enableStage(1,d)},present:function(d){this.$G5.$b4=(new Date).getTime()-this.$G5.$L4;this.$G5.$i3=Math.random();var a=this.rc;var m=this.$G5;var n=this.$J5;if(!m.bAntiAlias){var h=n.getRenderTarget("LTex");if(d==null){a.bindFramebuffer(36160,null);a.viewport(0,0,m.$34,m.$24);a.scissor(0,0,m.$34,m.$24)}else{this.$E6.bind();this.$E6.attachRenderTexture(0,d);var l=d.getSizeU(),e=d.getSizeV();a.viewport(0,0,l,e);a.scissor(0,0,l,e)}a.disable(2929);a.depthMask(false);a.disable(3042);var f=this.$L5.getResource("$R$Quad");var k=f.getMesh(0);var c=this.$B6.getOutputProgram();c.bind();c.setAttribute("okAttr_Pos",k.getAttributeArrayBuffer("Position"),3);c.setTexture("okUni_Tex",h,33071,9728);c.setUniformFloat4("okUni_DestOffsetScale",0,0,1,1);if(d==null){c.setUniformFloat4("okUni_SrcOffsetScale",0,0,1,1)}else{c.setUniformFloat4("okUni_SrcOffsetScale",0,0,d.getSizeU()/m.$34,d.getSizeV()/m.$24)}k.draw();a.enable(2929);a.depthMask(true);if(d){this.$E6.unbind()}}if(this.$G5.$34!=this.$G5.canvas.width||this.$G5.$24!=this.$G5.canvas.height){this._onResize()}},setSceneConfig:function(a){a.$07.clone(this.$G5.$07);a.$Y6.clone(this.$G5.$Y6);this.$G5.$t2=a.$t2;this.$G5.$b2=a.$b2;a.$W6.clone(this.$G5.$W6);this.$G5.$93=a.$93;this.$G5.$83=a.$83;this.$G5.$73=a.$73;a.iFogMode=this.$G5.iFogMode},setSkyColor:function(d,c,a){if(c!=null){this.$G5.$07.set(d,c,a)}else{d.clone(this.$G5.$07)}},getSkyColor:function(){return this.$G5.$07},setGroundColor:function(d,c,a){if(c!=null){this.$G5.$Y6.set(d,c,a)}else{d.clone(this.$G5.$Y6)}},getGroundColor:function(){return this.$G5.$Y6},enableFog:function(c,a){this.$G5.$b2=a},isFogEnabled:function(a){return this.$G5.$b2},setFogColor:function(e,d,c,a){if(c==null){this.$G5.$W6.x=d.x;this.$G5.$W6.y=d.y;this.$G5.$W6.z=d.z}else{this.$G5.$W6.x=d;this.$G5.$W6.y=c;this.$G5.$W6.z=a}},getFogColor:function(a){var c=okA.vec3();return this.$G5.$W6.clone(c)},setFogDistanceNear:function(c,a){this.$G5.$93=Math.max(0.001,a)},setFogDistanceFar:function(c,a){this.$G5.$83=Math.max(0.001,a)},getFogDistanceNear:function(a){return this.$G5.$93},getFogDistanceFar:function(a){return this.$G5.$83},setFogDensity:function(c,a){this.$G5.$73=a},getFogDensity:function(a){return this.$G5.$73},enableShadow:function(a){this.$G5.$t2=a},isShadowEnabled:function(){return this.$G5.$t2},_drawTexture:function(a){this.rc.bindFramebuffer(36160,null);this.rc.viewport(0,0,a.getSizeU(),a.getSizeV());this.rc.disable(2929);var e=this.$L5.getResource("$R$Quad");var d=e.getMesh();var c=this.$B6.getFlatColorProgram(true);c.bind();c.setUniformMat4("matWorld",okMat4Mul(okMat4Trans(0,0,-0.1),okMat4Scale(a.getSizeU()*0.5,a.getSizeV()*0.5,1)));c.setUniformMat4("matViewProj",okMat4Ortho(-a.getSizeU()*0.5,a.getSizeU()*0.5,a.getSizeV()*0.5,-a.getSizeV()*0.5,0.1,100));c.setAttribute("position",d.getAttributeArrayBuffer("Position"),3);c.setAttribute("texcoord",d.getAttributeArrayBuffer("Texcoord1"),2);c.setUniformFloat3("color",1,1,1);c.setSampler("texSampler",0);a.bind(0);this.rc.texParameteri(3553,10240,9728);this.rc.texParameteri(3553,10241,9728);this.rc.texParameteri(3553,10242,33071);this.rc.texParameteri(3553,10243,33071);d.draw()},_postCull:function(){var a=this.$I5;a.genBatchList("Visible",this.$G5);a.enableReleaseBatch("Visible",true);var h=a.getBatchList("Visible");var d=a.createBatchList("Visible_Opaque");var k=a.createBatchList("Visible_Trans");var l=a.createBatchList("Visible_Glow");var c=h.length;for(var e=0;e<c;++e){var f=h[e];var m=f.$r5;if(m.$V1){k.push(f)}else{d.push(f)}if(m.$d2){l.push(f)}}a.sortBatchListByCamera("Visible_Trans",this.$G5,0)}};function okEngineInfo(a){this.rc=a;this.sPlatform="";this.sBrowserAgent="";this.sBrowserVendor="";this.sWebGLVersion="";this.sGLSLVersion="";this.iAttributeNum=0;this.iVertexUniformNum=0;this.iFragmentUniformNum=0;this.iVaryingNum=0;this.iRedBits=0;this.iGreenBits=0;this.iBlueBits=0;this.iAlphaBits=0;this.iDepthBits=0;this.iTexNum=0;this.iVertexTexNum=0;this.iTexSize=0;this.iCubeTexSize=0;this.$V4=0;this.$U4=0;this.bFloatTex=false;this.bFloatRt=false}okEngineInfo.prototype={clear:function(){this.sPlatform="";this.sBrowserAgent="";this.sBrowserVendor="";this.sWebGLVersion="";this.sGLSLVersion="";this.iAttributeNum=0;this.iVertexUniformNum=0;this.iFragmentUniformNum=0;this.iVaryingNum=0;this.iRedBits=0;this.iGreenBits=0;this.iBlueBits=0;this.iAlphaBits=0;this.iDepthBits=0;this.iTexNum=0;this.iVertexTexNum=0;this.iTexSize=0;this.iCubeTexSize=0;this.$V4=0;this.$U4=0;this.bFloatTex=false;this.bFloatRt=false},init:function(){var k=this.rc;this.sPlatform=navigator.platform;this.sBrowserAgent=navigator.userAgent;this.sBrowserVendor=k.getParameter(7936);var c=k.getParameter(7936);this.sWebGLVersion=c.substr(6,(c.indexOf(" ",6)!=-1)?c.indexOf(" ",6)-6:null);var c=k.getParameter(35724);this.sGLSLVersion=c.substr(6,(c.indexOf(" ",14)!=-1)?c.indexOf(" ",14)-14:null);var e=k.getSupportedExtensions();this.iAttributeNum=k.getParameter(34921);this.iVertexUniformNum=k.getParameter(36347);this.iFragmentUniformNum=k.getParameter(36349);this.iVaryingNum=k.getParameter(36348);this.iRedBits=k.getParameter(3410);this.iGreenBits=k.getParameter(3411);this.iBlueBits=k.getParameter(3412);this.iAlphaBits=k.getParameter(3413);this.iDepthBits=k.getParameter(3414);this.iTexNum=k.getParameter(35661);this.iVertexTexNum=k.getParameter(35660);this.iTexSize=k.getParameter(3379);this.iCubeTexSize=k.getParameter(34076);this.$V4=k.getParameter(3386)[0];this.$U4=k.getParameter(3386)[1];this.bFloatTex=false;for(var d=0;d<e.length;++d){if(e[d]=="OES_texture_float"){this.bFloatTex=true;break}}if(this.sPlatform.indexOf("Mac")!=-1){this.bFloatTex=false}this.bFloatRt=false;if(this.bFloatTex){var a=new okTexture(k);a.createTexture(3553,2,2,6408,5126);var h=new okRenderBuffer(k);h.createBuffer(34041,2,2);var f=new okFrameBuffer(k);f.createBuffer();f.bind();f.attachRenderTexture(0,a);f.attachDepthStencilBuffer(h);if(k.checkFramebufferStatus(36160)==36053){this.bFloatRt=true}f.unbind();f.releaseBuffer();h.releaseBuffer();a.releaseTexture()}},getPlatform:function(){return this.sPlatform},getBrowserAgent:function(){return this.sBrowserAgent},getBrowserVendor:function(){return this.sBrowserVendor},getWebGLVersion:function(){return this.sWebGLVersion},getGLSLVersion:function(){return this.sGLSLVersion},getShaderAttributeMaxNum:function(){return this.iAttributeNum},getShaderVertexUniformMaxNum:function(){return this.iVertexUniformNum},getShaderFragmentUniformMaxNum:function(){return this.iFragmentUniformNum},getShaderVaryingMaxNum:function(){return this.iVaryingNum},getRedBits:function(){return this.iRedBits},getGreenBits:function(){return this.iGreenBits},getBlueBits:function(){return this.iBlueBits},getAlphaBits:function(){return this.iAlphaBits},getDepthBits:function(){return this.iDepthBits},getShaderTextureMaxNum:function(){return this.iTexNum},getShaderVertexTextureMaxNum:function(){return this.iVertexTexNum},getTextureMaxSize:function(){return this.iTexSize},getCubeMapTextureMaxSize:function(){return this.iCubeTexSize},getViewportMaxWidth:function(){return this.$V4},getViewportMaxHeight:function(){return this.$U4},isFloatTextureSupported:function(){return this.bFloatTex},isFloatRenderTargetSupported:function(){return this.bFloatRt=false}};function okEngineSetting(){this.canvas=null;this.antialias=false;this.bAsyncLoad=false}function okEngine(){this.canvas=null;this.rc=null;this.$13=null;this.$Z2=null;this.$L5=null;this.$A6=null;this.$K5=null;this.bInitializaed=false}okEngine.prototype={init:function(c){this.clear();if(c==null){return false}var a=null;try{a=c.canvas.getContext("experimental-webgl",{antialias:c.antialias?true:false,stencil:true});if(a==null){a=c.canvas.getContext("webgl",{antialias:c.antialias,stencil:true})}}catch(d){}if(!a){return false}this.canvas=c.canvas;this.rc=a;this.$13=new okExtension(this.rc);this.$Z2=new okEngineInfo(this.rc);this.$Z2.init();this.$L5=new okResourceManager(c,this.rc);this.$A6=new okSceneManager(c,this);this.$K5=new okRenderer(c,this);this.bInitializaed=true;return true},clear:function(){if(this.$13){this.$13=null}if(this.$Z2){this.$Z2.clear();this.$Z2=null}if(this.$A6){this.$A6.clear();this.$A6=null}if(this.$K5){this.$K5.clear();this.$K5=null}if(this.$L5){this.$L5.clear();this.$L5=null}this.rc=null;this.canvas=null;this.bInitializaed=false},getCanvas:function(){return this.canvas},getRenderContext:function(){return this.rc},getEngineInfo:function(){return this.$Z2},getSceneManager:function(){return this.$A6},getResourceManager:function(){return this.$L5},getRenderer:function(){return this.$K5}};